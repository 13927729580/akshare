

<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>6. 时间序列与日期用法 &mdash; AkShare 1.0.0 文档</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script src="../../_static/translations.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="搜索" href="../../search.html" />
    <link rel="next" title="AkShare 策略示例" href="../../demo.html" />
    <link rel="prev" title="5. Pandas 数据结构" href="pandas-04.html" />
    <meta name="referrer" content="no-referrer"/>
     

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> AkShare
          

          
          </a>

          
            
            
              <div class="version">
                1.0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="在文档中搜索" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">AkShare 概览</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">AkShare 安装指导</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributor.html">AkShare 贡献源码</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../answer.html">AkShare 答疑专栏</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial.html">AkShare 快速入门</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../data/index.html">AkShare 数据字典</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../anaconda.html">AkShare 环境配置</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../special.html">AkShare 特别说明</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../strategy.html">AkShare 量化策略</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../platform.html">AkShare 量化平台</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">AkShare 专题教程</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../anaconda/index.html">Anaconda 教程</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Pandas 教程</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="pandas-00.html">1. Pandas 概览</a></li>
<li class="toctree-l3"><a class="reference internal" href="pandas-01.html">2. Pandas 基础用法</a></li>
<li class="toctree-l3"><a class="reference internal" href="pandas-02.html">3. Pandas 25 式</a></li>
<li class="toctree-l3"><a class="reference internal" href="pandas-03.html">4. Pandas 10大新功能</a></li>
<li class="toctree-l3"><a class="reference internal" href="pandas-04.html">5. Pandas 数据结构</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">6. 时间序列与日期用法</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id2">6.1. 时间序列纵览</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vs">6.2. 时间戳 vs. 时间段</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id3">6.3. 转换时间戳</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id9">6.4. 生成时间戳范围</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id11">6.5. 时间戳的界限</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id12">6.6. 索引</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id17">6.7. 日期/时间组件</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dateoffset">6.8. DateOffset 对象</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id27">6.9. 时间序列实例方法</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id31">6.10. 重采样</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id37">6.11. 时间跨度表示</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id41">6.12. 界外跨度表示</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id42">6.13. 时区控制</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../demo.html">AkShare 策略示例</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">AkShare 版本更新</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">AkShare</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">AkShare 专题教程</a> &raquo;</li>
        
          <li><a href="index.html">Pandas 教程</a> &raquo;</li>
        
      <li><span class="section-number">6. </span>时间序列与日期用法</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/topic/pandas/pandas-05.md.txt" rel="nofollow"> 查看页面源码</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="id1">
<h1><span class="section-number">6. </span>时间序列与日期用法<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h1>
<p>依托 NumPy 的 <code class="docutils literal notranslate"><span class="pre">datetime64</span></code>、<code class="docutils literal notranslate"><span class="pre">timedelta64</span></code> 等数据类型，Pandas 可以处理各种时间序列数据，还能调用 <code class="docutils literal notranslate"><span class="pre">scikits.timeseries</span></code> 等 Python 支持库的时间序列功能。</p>
<p>Pandas 支持以下操作：</p>
<p>解析 <code class="docutils literal notranslate"><span class="pre">时间字符串</span></code>、<code class="docutils literal notranslate"><span class="pre">np.datetime64</span></code>、<code class="docutils literal notranslate"><span class="pre">datetime.datetime</span></code> 等多种时间序列数据。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">datetime</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">dti</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">([</span><span class="s1">&#39;1/1/2018&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s1">&#39;2018-01-01&#39;</span><span class="p">),</span>
   <span class="o">...</span><span class="p">:</span>                       <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2018</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)])</span>
   <span class="o">...</span><span class="p">:</span> 

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">dti</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2018-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-01&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<p>生成 <code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code>、<code class="docutils literal notranslate"><span class="pre">TimedeltaIndex</span> </code>、<code class="docutils literal notranslate"><span class="pre">PeriodIndex</span></code> 等定频日期与时间段序列。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">dti</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;2018-01-01&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;H&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">dti</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span> 
<span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2018-01-01 00:00:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-01 01:00:00&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2018-01-01 02:00:00&#39;</span><span class="p">],</span>
              <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;H&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>处理、转换带时区的日期时间数据。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="s1">&#39;UTC&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">dti</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span> 
<span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2018-01-01 00:00:00+00:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-01 01:00:00+00:00&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2018-01-01 02:00:00+00:00&#39;</span><span class="p">],</span>
              <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns, UTC]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;H&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">dti</span><span class="o">.</span><span class="n">tz_convert</span><span class="p">(</span><span class="s1">&#39;US/Pacific&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">8</span><span class="p">]:</span> 
<span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2017-12-31 16:00:00-08:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2017-12-31 17:00:00-08:00&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2017-12-31 18:00:00-08:00&#39;</span><span class="p">],</span>
              <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns, US/Pacific]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;H&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>按指定频率重采样，并转换为时间序列。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;2018-01-01&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;H&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">)),</span> <span class="n">index</span><span class="o">=</span><span class="n">idx</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">ts</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">11</span><span class="p">]:</span> 
<span class="mi">2018</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>    <span class="mi">0</span>
<span class="mi">2018</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">01</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>    <span class="mi">1</span>
<span class="mi">2018</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">02</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>    <span class="mi">2</span>
<span class="mi">2018</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">03</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>    <span class="mi">3</span>
<span class="mi">2018</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">04</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>    <span class="mi">4</span>
<span class="n">Freq</span><span class="p">:</span> <span class="n">H</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="n">ts</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;2H&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">12</span><span class="p">]:</span> 
<span class="mi">2018</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>    <span class="mf">0.5</span>
<span class="mi">2018</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">02</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>    <span class="mf">2.5</span>
<span class="mi">2018</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">04</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>    <span class="mf">4.0</span>
<span class="n">Freq</span><span class="p">:</span> <span class="mi">2</span><span class="n">H</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</pre></div>
</div>
<p>用绝对或相对时间差计算日期与时间。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="n">friday</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2018-01-05&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="n">friday</span><span class="o">.</span><span class="n">day_name</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="s1">&#39;Friday&#39;</span>

<span class="c1"># 添加 1 个日历日</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="n">saturday</span> <span class="o">=</span> <span class="n">friday</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="s1">&#39;1 day&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="n">saturday</span><span class="o">.</span><span class="n">day_name</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="s1">&#39;Saturday&#39;</span>

<span class="c1"># 添加 1 个工作日，从星期五跳到星期一</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="n">monday</span> <span class="o">=</span> <span class="n">friday</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">BDay</span><span class="p">()</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="n">monday</span><span class="o">.</span><span class="n">day_name</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="s1">&#39;Monday&#39;</span>
</pre></div>
</div>
<p>Pandas 提供了一组精悍、实用的工具集以完成上述操作。</p>
<div class="section" id="id2">
<h2><span class="section-number">6.1. </span>时间序列纵览<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h2>
<p>Pandas 支持 4 种常见时间概念：</p>
<ol class="simple">
<li><p>日期时间（Datetime）：带时区的日期时间，类似于标准库的 <code class="docutils literal notranslate"><span class="pre">datetime.datetime</span></code> 。</p></li>
<li><p>时间差（Timedelta）：绝对时间周期，类似于标准库的 <code class="docutils literal notranslate"><span class="pre">datetime.timedelta</span></code>。</p></li>
<li><p>时间段（Timespan）：在某一时点以指定频率定义的时间跨度。</p></li>
<li><p>日期偏移（Dateoffset）：与日历运算对应的时间段，类似于 <code class="docutils literal notranslate"><span class="pre">dateutil</span></code> 的 <code class="docutils literal notranslate"><span class="pre">dateutil.relativedelta.relativedelta</span></code>。</p></li>
</ol>
<table border="1" class="docutils">
<thead>
<tr>
<th align="center">时间概念</th>
<th align="center">标量类</th>
<th align="center">数组类</th>
<th align="center">Pandas 数据类型</th>
<th align="center">主要构建方法</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">Date times</td>
<td align="center"><code>Timestamp</code></td>
<td align="center"><code>DatetimeIndex</code></td>
<td align="center"><code>datetime64[ns]</code> 或 <code>datetime64[ns,tz]</code></td>
<td align="center"><code>to_datetime</code> 或 <code>date_range</code></td>
</tr>
<tr>
<td align="center">Time deltas</td>
<td align="center"><code>Timedelta</code></td>
<td align="center"><code>TimedeltaIndex</code></td>
<td align="center"><code>timedelta64[ns]</code></td>
<td align="center"><code>to_timedelta</code> 或 <code>timedelta_range</code></td>
</tr>
<tr>
<td align="center">Time spans</td>
<td align="center"><code>Period</code></td>
<td align="center"><code>PeriodIndex</code></td>
<td align="center"><code>period[freq]</code></td>
<td align="center"><code>Period</code> 或 <code>period_range</code></td>
</tr>
<tr>
<td align="center">Date offsets</td>
<td align="center"><code>DateOffset</code></td>
<td align="center"><code>None</code></td>
<td align="center"><code>None</code></td>
<td align="center"><code>DateOffset</code></td>
</tr>
</tbody>
</table><p>一般情况下，时间序列主要是 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.html#pandas.Series"><code class="docutils literal notranslate"><span class="pre">Series</span></code></a> 或 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame"><code class="docutils literal notranslate"><span class="pre">DataFrame</span></code></a> 的时间型索引，可以用时间元素进行操控。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;2000&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">19</span><span class="p">]:</span> 
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span>    <span class="mi">0</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span>    <span class="mi">1</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span>    <span class="mi">2</span>
<span class="n">Freq</span><span class="p">:</span> <span class="n">D</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>
</pre></div>
</div>
<p>当然，<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.html#pandas.Series"><code class="docutils literal notranslate"><span class="pre">Series</span></code></a> 与 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame"><code class="docutils literal notranslate"><span class="pre">DataFrame</span></code></a> 也可以直接把时间序列当成数据。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;2000&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">20</span><span class="p">]:</span> 
<span class="mi">0</span>   <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span>
<span class="mi">1</span>   <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span>
<span class="mi">2</span>   <span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">datetime64</span><span class="p">[</span><span class="n">ns</span><span class="p">]</span>
</pre></div>
</div>
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.html#pandas.Series"><code class="docutils literal notranslate"><span class="pre">Series</span></code></a> 与 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame"><code class="docutils literal notranslate"><span class="pre">DataFrame</span></code></a> 提供了 <code class="docutils literal notranslate"><span class="pre">datetime</span></code>、<code class="docutils literal notranslate"><span class="pre">timedelta</span></code> 、<code class="docutils literal notranslate"><span class="pre">Period</span></code> 扩展类型与专有用法，不过，<code class="docutils literal notranslate"><span class="pre">Dateoffset</span></code> 则保存为 <code class="docutils literal notranslate"><span class="pre">object</span></code>。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">period_range</span><span class="p">(</span><span class="s1">&#39;1/1/2011&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">21</span><span class="p">]:</span> 
<span class="mi">0</span>    <span class="mi">2011</span><span class="o">-</span><span class="mi">01</span>
<span class="mi">1</span>    <span class="mi">2011</span><span class="o">-</span><span class="mi">02</span>
<span class="mi">2</span>    <span class="mi">2011</span><span class="o">-</span><span class="mi">03</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">period</span><span class="p">[</span><span class="n">M</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">22</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">pd</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">pd</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span><span class="mi">2</span><span class="p">)])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">22</span><span class="p">]:</span> 
<span class="mi">0</span>         <span class="o">&lt;</span><span class="n">DateOffset</span><span class="o">&gt;</span>
<span class="mi">1</span>    <span class="o">&lt;</span><span class="mi">2</span> <span class="o">*</span> <span class="n">DateOffsets</span><span class="o">&gt;</span>
<span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">23</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;1/1/2011&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">23</span><span class="p">]:</span> 
<span class="mi">0</span>   <span class="mi">2011</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">31</span>
<span class="mi">1</span>   <span class="mi">2011</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">28</span>
<span class="mi">2</span>   <span class="mi">2011</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">31</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">datetime64</span><span class="p">[</span><span class="n">ns</span><span class="p">]</span>
</pre></div>
</div>
<p>Pandas 用 <code class="docutils literal notranslate"><span class="pre">NaT</span></code> 表示日期时间、时间差及时间段的空值，代表了缺失日期或空日期的值，类似于浮点数的 <code class="docutils literal notranslate"><span class="pre">np.nan</span></code>。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">24</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">24</span><span class="p">]:</span> <span class="n">NaT</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">25</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">25</span><span class="p">]:</span> <span class="n">NaT</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">26</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Period</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">26</span><span class="p">]:</span> <span class="n">NaT</span>

<span class="c1"># 与 np.nan 一样，pd.NaT 不等于 pd.NaT </span>
<span class="n">In</span> <span class="p">[</span><span class="mi">27</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span> <span class="o">==</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">27</span><span class="p">]:</span> <span class="kc">False</span>
</pre></div>
</div>
</div>
<div class="section" id="vs">
<h2><span class="section-number">6.2. </span>时间戳 vs. 时间段<a class="headerlink" href="#vs" title="永久链接至标题">¶</a></h2>
<p>时间戳是最基本的时间序列数据，用于把数值与时点关联在一起。Pandas 对象通过时间戳调用时点数据。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">28</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">28</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2012-05-01 00:00:00&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">29</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2012-05-01&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">29</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2012-05-01 00:00:00&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">30</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">30</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2012-05-01 00:00:00&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>不过，大多数情况下，用时间段改变变量更自然。<code class="docutils literal notranslate"><span class="pre">Period</span></code> 表示的时间段更直观，还可以用日期时间格式的字符串进行推断。</p>
<p>示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">31</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Period</span><span class="p">(</span><span class="s1">&#39;2011-01&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">31</span><span class="p">]:</span> <span class="n">Period</span><span class="p">(</span><span class="s1">&#39;2011-01&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">32</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Period</span><span class="p">(</span><span class="s1">&#39;2012-05&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">32</span><span class="p">]:</span> <span class="n">Period</span><span class="p">(</span><span class="s1">&#39;2012-05-01&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Timestamp.html#pandas.Timestamp"><code class="docutils literal notranslate"><span class="pre">Timestamp</span></code></a> 与 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Period.html#pandas.Period"><code class="docutils literal notranslate"><span class="pre">Period</span></code></a> 可以用作索引。作为索引的 <code class="docutils literal notranslate"><span class="pre">Timestamp</span></code> 与 <code class="docutils literal notranslate"><span class="pre">Period</span></code> 列表则被强制转换为对应的 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DatetimeIndex.html#pandas.DatetimeIndex"><code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code></a> 与 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.PeriodIndex.html#pandas.PeriodIndex"><code class="docutils literal notranslate"><span class="pre">PeriodIndex</span></code></a>。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">33</span><span class="p">]:</span> <span class="n">dates</span> <span class="o">=</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2012-05-01&#39;</span><span class="p">),</span>
   <span class="o">....</span><span class="p">:</span>          <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2012-05-02&#39;</span><span class="p">),</span>
   <span class="o">....</span><span class="p">:</span>          <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2012-05-03&#39;</span><span class="p">)]</span>
   <span class="o">....</span><span class="p">:</span> 

<span class="n">In</span> <span class="p">[</span><span class="mi">34</span><span class="p">]:</span> <span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">dates</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">35</span><span class="p">]:</span> <span class="nb">type</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">35</span><span class="p">]:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">indexes</span><span class="o">.</span><span class="n">datetimes</span><span class="o">.</span><span class="n">DatetimeIndex</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">36</span><span class="p">]:</span> <span class="n">ts</span><span class="o">.</span><span class="n">index</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">36</span><span class="p">]:</span> <span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2012-05-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2012-05-02&#39;</span><span class="p">,</span> <span class="s1">&#39;2012-05-03&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">37</span><span class="p">]:</span> <span class="n">ts</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">37</span><span class="p">]:</span> 
<span class="mi">2012</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">01</span>    <span class="mf">0.469112</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">02</span>   <span class="o">-</span><span class="mf">0.282863</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">03</span>   <span class="o">-</span><span class="mf">1.509059</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">38</span><span class="p">]:</span> <span class="n">periods</span> <span class="o">=</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Period</span><span class="p">(</span><span class="s1">&#39;2012-01&#39;</span><span class="p">),</span> <span class="n">pd</span><span class="o">.</span><span class="n">Period</span><span class="p">(</span><span class="s1">&#39;2012-02&#39;</span><span class="p">),</span> <span class="n">pd</span><span class="o">.</span><span class="n">Period</span><span class="p">(</span><span class="s1">&#39;2012-03&#39;</span><span class="p">)]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">39</span><span class="p">]:</span> <span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">periods</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">40</span><span class="p">]:</span> <span class="nb">type</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">40</span><span class="p">]:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">indexes</span><span class="o">.</span><span class="n">period</span><span class="o">.</span><span class="n">PeriodIndex</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">41</span><span class="p">]:</span> <span class="n">ts</span><span class="o">.</span><span class="n">index</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">41</span><span class="p">]:</span> <span class="n">PeriodIndex</span><span class="p">([</span><span class="s1">&#39;2012-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2012-02&#39;</span><span class="p">,</span> <span class="s1">&#39;2012-03&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;period[M]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">42</span><span class="p">]:</span> <span class="n">ts</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">42</span><span class="p">]:</span> 
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span>   <span class="o">-</span><span class="mf">1.135632</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">02</span>    <span class="mf">1.212112</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">03</span>   <span class="o">-</span><span class="mf">0.173215</span>
<span class="n">Freq</span><span class="p">:</span> <span class="n">M</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</pre></div>
</div>
<p>Pandas 可以识别这两种表现形式，并在两者之间进行转化。Pandas 后台用 <code class="docutils literal notranslate"><span class="pre">Timestamp</span></code> 实例代表时间戳，用 <code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code> 实例代表时间戳序列。Pandas 用 <code class="docutils literal notranslate"><span class="pre">Period</span></code> 对象表示符合规律的时间段标量值，用 <code class="docutils literal notranslate"><span class="pre">PeriodIndex</span></code> 表示时间段序列。未来版本会支持用任意起止时间实现不规律时间间隔。</p>
</div>
<div class="section" id="id3">
<h2><span class="section-number">6.3. </span>转换时间戳<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">to_datetime</span></code> 函数用于转换字符串、纪元式及混合的日期 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.html#pandas.Series"><code class="docutils literal notranslate"><span class="pre">Series</span></code></a> 或日期列表。转换 <code class="docutils literal notranslate"><span class="pre">Series</span></code>，返回具有相同索引的 <code class="docutils literal notranslate"><span class="pre">Series</span></code>，日期时间列表被转换为 <code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code>：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">43</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="s1">&#39;Jul 31, 2009&#39;</span><span class="p">,</span> <span class="s1">&#39;2010-01-10&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">]))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">43</span><span class="p">]:</span> 
<span class="mi">0</span>   <span class="mi">2009</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">31</span>
<span class="mi">1</span>   <span class="mi">2010</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>
<span class="mi">2</span>          <span class="n">NaT</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">datetime64</span><span class="p">[</span><span class="n">ns</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">44</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">([</span><span class="s1">&#39;2005/11/23&#39;</span><span class="p">,</span> <span class="s1">&#39;2010.12.31&#39;</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">44</span><span class="p">]:</span> <span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2005-11-23&#39;</span><span class="p">,</span> <span class="s1">&#39;2010-12-31&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<p>解析欧式日期（日-月-年），要用 <code class="docutils literal notranslate"><span class="pre">dayfirst</span></code> 关键字参数：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">45</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">([</span><span class="s1">&#39;04-01-2012 10:00&#39;</span><span class="p">],</span> <span class="n">dayfirst</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">45</span><span class="p">]:</span> <span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2012-01-04 10:00:00&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">46</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">([</span><span class="s1">&#39;14-01-2012&#39;</span><span class="p">,</span> <span class="s1">&#39;01-14-2012&#39;</span><span class="p">],</span> <span class="n">dayfirst</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">46</span><span class="p">]:</span> <span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2012-01-14&#39;</span><span class="p">,</span> <span class="s1">&#39;2012-01-14&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<p>::: danger 警告</p>
<p>从上例可以看出，<code class="docutils literal notranslate"><span class="pre">dayfirst</span></code> 并不严苛，如果不能把第一个数解析为<strong>日</strong>，就会以 <code class="docutils literal notranslate"><span class="pre">dayfirst</span></code> 为 <code class="docutils literal notranslate"><span class="pre">False</span></code> 进行解析。</p>
<p>:::</p>
<p><code class="docutils literal notranslate"><span class="pre">to_datetime</span></code> 转换单个字符串时，返回单个 <code class="docutils literal notranslate"><span class="pre">Timestamp</span></code>。<code class="docutils literal notranslate"><span class="pre">Timestamp</span></code> 仅支持字符串输入，不支持 <code class="docutils literal notranslate"><span class="pre">dayfirst</span></code>、<code class="docutils literal notranslate"><span class="pre">format</span></code> 等字符串解析选项，如果要使用这些选项，就要用 <code class="docutils literal notranslate"><span class="pre">to_datetime</span></code>。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">47</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s1">&#39;2010/11/12&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">47</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2010-11-12 00:00:00&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">48</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2010/11/12&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">48</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2010-11-12 00:00:00&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Pandas 还支持直接使用 <code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code> 构建器：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">49</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2018-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-03&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-05&#39;</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">49</span><span class="p">]:</span> <span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2018-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-03&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-05&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<p>创建 <code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code> 时，传递字符串 <code class="docutils literal notranslate"><span class="pre">infer</span></code> 可推断索引的频率。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">50</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2018-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-03&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-05&#39;</span><span class="p">],</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;infer&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">50</span><span class="p">]:</span> <span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2018-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-03&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-05&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;2D&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="id4">
<h3>提供格式参数<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h3>
<p>要实现精准转换，除了传递 <code class="docutils literal notranslate"><span class="pre">datetime</span></code> 字符串，还要指定 <code class="docutils literal notranslate"><span class="pre">format</span></code> 参数，指定此参数还可以加速转换速度。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">51</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s1">&#39;2010/11/12&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y/%m/</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">51</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2010-11-12 00:00:00&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">52</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s1">&#39;12-11-2010 00:00&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">-%m-%Y %H:%M&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">52</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2010-11-12 00:00:00&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>要了解更多 <code class="docutils literal notranslate"><span class="pre">format</span></code> 选项，请参阅 Python <a class="reference external" href="https://docs.python.org/3/library/datetime.html#strftime-and-strptime-behavior">日期时间文档</a>。</p>
</div>
<div class="section" id="id5">
<h3>用多列组合日期时间<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h3>
<p><em>0.18.1 版新增。</em></p>
<p>Pandas 还可以把 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 里的整数或字符串列组合成 <code class="docutils literal notranslate"><span class="pre">Timestamp</span> <span class="pre">Series</span></code>。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">53</span><span class="p">]:</span> <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;year&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2015</span><span class="p">,</span> <span class="mi">2016</span><span class="p">],</span>
   <span class="o">....</span><span class="p">:</span>                    <span class="s1">&#39;month&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
   <span class="o">....</span><span class="p">:</span>                    <span class="s1">&#39;day&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
   <span class="o">....</span><span class="p">:</span>                    <span class="s1">&#39;hour&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]})</span>
   <span class="o">....</span><span class="p">:</span> 

<span class="n">In</span> <span class="p">[</span><span class="mi">54</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">54</span><span class="p">]:</span> 
<span class="mi">0</span>   <span class="mi">2015</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span> <span class="mi">02</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>
<span class="mi">1</span>   <span class="mi">2016</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">05</span> <span class="mi">03</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">datetime64</span><span class="p">[</span><span class="n">ns</span><span class="p">]</span>
</pre></div>
</div>
<p>只传递组合所需的列也可以。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">55</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;month&#39;</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">]])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">55</span><span class="p">]:</span> 
<span class="mi">0</span>   <span class="mi">2015</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span>
<span class="mi">1</span>   <span class="mi">2016</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">05</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">datetime64</span><span class="p">[</span><span class="n">ns</span><span class="p">]</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">pd.to_datetime</span></code> 查找列名里日期时间组件的标准名称，包括：</p>
<ul class="simple">
<li><p>必填：<code class="docutils literal notranslate"><span class="pre">year</span></code>、<code class="docutils literal notranslate"><span class="pre">month</span></code>、<code class="docutils literal notranslate"><span class="pre">day</span></code></p></li>
<li><p>可选：<code class="docutils literal notranslate"><span class="pre">hour</span></code>、<code class="docutils literal notranslate"><span class="pre">minute</span></code>、<code class="docutils literal notranslate"><span class="pre">second</span></code>、<code class="docutils literal notranslate"><span class="pre">millisecond</span></code>、<code class="docutils literal notranslate"><span class="pre">microsecond</span></code>、<code class="docutils literal notranslate"><span class="pre">nanosecond</span></code></p></li>
</ul>
</div>
<div class="section" id="id6">
<h3>无效数据<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h3>
<p>不可解析时，默认值 <code class="docutils literal notranslate"><span class="pre">errors='raise'</span></code> 会触发错误：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">([</span><span class="s1">&#39;2009/07/31&#39;</span><span class="p">,</span> <span class="s1">&#39;asd&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;raise&#39;</span><span class="p">)</span>
<span class="ne">ValueError</span><span class="p">:</span> <span class="n">Unknown</span> <span class="n">string</span> <span class="nb">format</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">errors='ignore'</span></code> 返回原始输入：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">56</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">([</span><span class="s1">&#39;2009/07/31&#39;</span><span class="p">,</span> <span class="s1">&#39;asd&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">56</span><span class="p">]:</span> <span class="n">Index</span><span class="p">([</span><span class="s1">&#39;2009/07/31&#39;</span><span class="p">,</span> <span class="s1">&#39;asd&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;object&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">errors='coerce'</span></code> 把无法解析的数据转换为 <code class="docutils literal notranslate"><span class="pre">NaT</span></code>，即不是时间（Not a Time）：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">57</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">([</span><span class="s1">&#39;2009/07/31&#39;</span><span class="p">,</span> <span class="s1">&#39;asd&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">57</span><span class="p">]:</span> <span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2009-07-31&#39;</span><span class="p">,</span> <span class="s1">&#39;NaT&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id7">
<h3>纪元时间戳<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h3>
<p>Pandas 支持把整数或浮点数纪元时间转换为 <code class="docutils literal notranslate"><span class="pre">Timestamp</span></code> 与 <code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code>。鉴于 <code class="docutils literal notranslate"><span class="pre">Timestamp</span></code> 对象内部存储方式，这种转换的默认单位是纳秒。不过，一般都会用指定其它时间单位 <code class="docutils literal notranslate"><span class="pre">unit</span></code> 来存储纪元数据，纪元时间从 <code class="docutils literal notranslate"><span class="pre">origin</span></code> 参数指定的时点开始计算。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">58</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">([</span><span class="mi">1349720105</span><span class="p">,</span> <span class="mi">1349806505</span><span class="p">,</span> <span class="mi">1349892905</span><span class="p">,</span>
   <span class="o">....</span><span class="p">:</span>                 <span class="mi">1349979305</span><span class="p">,</span> <span class="mi">1350065705</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
   <span class="o">....</span><span class="p">:</span> 
<span class="n">Out</span><span class="p">[</span><span class="mi">58</span><span class="p">]:</span> 
<span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2012-10-08 18:15:05&#39;</span><span class="p">,</span> <span class="s1">&#39;2012-10-09 18:15:05&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2012-10-10 18:15:05&#39;</span><span class="p">,</span> <span class="s1">&#39;2012-10-11 18:15:05&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2012-10-12 18:15:05&#39;</span><span class="p">],</span>
              <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">59</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">([</span><span class="mi">1349720105100</span><span class="p">,</span> <span class="mi">1349720105200</span><span class="p">,</span> <span class="mi">1349720105300</span><span class="p">,</span>
   <span class="o">....</span><span class="p">:</span>                 <span class="mi">1349720105400</span><span class="p">,</span> <span class="mi">1349720105500</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;ms&#39;</span><span class="p">)</span>
   <span class="o">....</span><span class="p">:</span> 
<span class="n">Out</span><span class="p">[</span><span class="mi">59</span><span class="p">]:</span> 
<span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2012-10-08 18:15:05.100000&#39;</span><span class="p">,</span> <span class="s1">&#39;2012-10-08 18:15:05.200000&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2012-10-08 18:15:05.300000&#39;</span><span class="p">,</span> <span class="s1">&#39;2012-10-08 18:15:05.400000&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2012-10-08 18:15:05.500000&#39;</span><span class="p">],</span>
              <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<p>用带 <code class="docutils literal notranslate"><span class="pre">tz</span></code> 参数的纪元时间戳创建 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Timestamp.html#pandas.Timestamp"><code class="docutils literal notranslate"><span class="pre">Timestamp</span></code></a> 或 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DatetimeIndex.html#pandas.DatetimeIndex"><code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code></a> 时，要先把纪元时间戳转化为 UTC，然后再把结果转换为指定时区。不过这种操作方式现在已经<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/whatsnew/v0.24.0.html#whatsnew-0240-deprecations-integer-tz">废弃</a>了，对于其它时区 Wall Time 里的纪元时间戳，建议先把纪元时间戳转换为无时区时间戳，再本地化时区。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">60</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="mi">1262347200000000000</span><span class="p">)</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="s1">&#39;US/Pacific&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">60</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2010-01-01 12:00:00-0800&#39;</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s1">&#39;US/Pacific&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">61</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">([</span><span class="mi">1262347200000000000</span><span class="p">])</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="s1">&#39;US/Pacific&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">61</span><span class="p">]:</span> <span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2010-01-01 12:00:00-08:00&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns, US/Pacific]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<p>::: tip 注意</p>
<p>纪元时间取整到最近的纳秒。</p>
<p>:::</p>
<p>::: danger 警告</p>
<p><a class="reference external" href="https://docs.python.org/3/tutorial/floatingpoint.html#tut-fp-issues">Python 浮点数</a>只精确到 15 位小数，因此，转换浮点纪元时间可能会导致不精准或失控的结果。转换过程中，免不了对高精度 <code class="docutils literal notranslate"><span class="pre">Timestamp</span></code> 取整，只有用 <code class="docutils literal notranslate"><span class="pre">int64</span></code> 等定宽类型才有可能实现极其精准的效果。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">62</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">([</span><span class="mf">1490195805.433</span><span class="p">,</span> <span class="mf">1490195805.433502912</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">62</span><span class="p">]:</span> <span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2017-03-22 15:16:45.433000088&#39;</span><span class="p">,</span> <span class="s1">&#39;2017-03-22 15:16:45.433502913&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">63</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="mi">1490195805433502912</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;ns&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">63</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2017-03-22 15:16:45.433502912&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>:::</p>
<p>::: tip 参阅</p>
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#timeseries-origin">应用 <code class="docutils literal notranslate"><span class="pre">origin</span></code> 参数</a></p>
<p>:::</p>
</div>
<div class="section" id="id8">
<h3>把时间戳转换为纪元<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h3>
<p>反转上述操作，把 <code class="docutils literal notranslate"><span class="pre">Timestamp</span></code> 转换为 <code class="docutils literal notranslate"><span class="pre">unix</span></code> 纪元：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">64</span><span class="p">]:</span> <span class="n">stamps</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;2012-10-08 18:15:05&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">65</span><span class="p">]:</span> <span class="n">stamps</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">65</span><span class="p">]:</span> 
<span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2012-10-08 18:15:05&#39;</span><span class="p">,</span> <span class="s1">&#39;2012-10-09 18:15:05&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2012-10-10 18:15:05&#39;</span><span class="p">,</span> <span class="s1">&#39;2012-10-11 18:15:05&#39;</span><span class="p">],</span>
              <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>首先与纪元开始时点（1970 年 1 月 1 日午夜，UTC）相减，然后以 1 秒为时间单位（<code class="docutils literal notranslate"><span class="pre">unit='1s'</span></code>）取底整除。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">66</span><span class="p">]:</span> <span class="p">(</span><span class="n">stamps</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">&quot;1970-01-01&quot;</span><span class="p">))</span> <span class="o">//</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="s1">&#39;1s&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">66</span><span class="p">]:</span> <span class="n">Int64Index</span><span class="p">([</span><span class="mi">1349720105</span><span class="p">,</span> <span class="mi">1349806505</span><span class="p">,</span> <span class="mi">1349892905</span><span class="p">,</span> <span class="mi">1349979305</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int64&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="origin">
<h3>应用 <code class="docutils literal notranslate"><span class="pre">origin</span></code> 参数<a class="headerlink" href="#origin" title="永久链接至标题">¶</a></h3>
<p><em>0.20.0 版新增。</em></p>
<p><code class="docutils literal notranslate"><span class="pre">origin</span></code> 参数可以指定 <code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code> 的备选开始时点。例如，把<code class="docutils literal notranslate"><span class="pre">1960-01-01</span></code> 作为开始日期：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">67</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;1960-01-01&#39;</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">67</span><span class="p">]:</span> <span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;1960-01-02&#39;</span><span class="p">,</span> <span class="s1">&#39;1960-01-03&#39;</span><span class="p">,</span> <span class="s1">&#39;1960-01-04&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<p>默认值为 <code class="docutils literal notranslate"><span class="pre">origin='unix'</span></code>，即 <code class="docutils literal notranslate"><span class="pre">1970-01-01</span> <span class="pre">00:00:00</span></code>，一般把这个时点称为 <code class="docutils literal notranslate"><span class="pre">unix</span> <span class="pre">纪元</span></code> 或 <code class="docutils literal notranslate"><span class="pre">POSIX</span></code> 时间。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">68</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">68</span><span class="p">]:</span> <span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;1970-01-02&#39;</span><span class="p">,</span> <span class="s1">&#39;1970-01-03&#39;</span><span class="p">,</span> <span class="s1">&#39;1970-01-04&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id9">
<h2><span class="section-number">6.4. </span>生成时间戳范围<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code>、<code class="docutils literal notranslate"><span class="pre">Index</span></code> 构建器可以生成时间戳索引，此处要提供 <code class="docutils literal notranslate"><span class="pre">datetime</span></code> 对象列表。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">69</span><span class="p">]:</span> <span class="n">dates</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
   <span class="o">....</span><span class="p">:</span>          <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
   <span class="o">....</span><span class="p">:</span>          <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]</span>
   <span class="o">....</span><span class="p">:</span> 

<span class="c1"># 注意频率信息</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">70</span><span class="p">]:</span> <span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">(</span><span class="n">dates</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">71</span><span class="p">]:</span> <span class="n">index</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">71</span><span class="p">]:</span> <span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2012-05-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2012-05-02&#39;</span><span class="p">,</span> <span class="s1">&#39;2012-05-03&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

<span class="c1"># 自动转换为 DatetimeIndex</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">72</span><span class="p">]:</span> <span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="n">dates</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">73</span><span class="p">]:</span> <span class="n">index</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">73</span><span class="p">]:</span> <span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2012-05-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2012-05-02&#39;</span><span class="p">,</span> <span class="s1">&#39;2012-05-03&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<p>实际工作中，生成大量时间戳的超长索引时，一个个输入时间戳又枯燥，又低效。如果时间戳是定频的，用 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.date_range.html#pandas.date_range"><code class="docutils literal notranslate"><span class="pre">date_range()</span></code></a> 与 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.bdate_range.html#pandas.bdate_range"><code class="docutils literal notranslate"><span class="pre">bdate_range()</span></code></a> 函数即可创建 <code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code>。<code class="docutils literal notranslate"><span class="pre">date_range</span></code> 默认的频率是<strong>日历日</strong>，<code class="docutils literal notranslate"><span class="pre">bdate_range</span></code> 的默认频率是<strong>工作日</strong>：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">74</span><span class="p">]:</span> <span class="n">start</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2011</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">75</span><span class="p">]:</span> <span class="n">end</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">76</span><span class="p">]:</span> <span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">77</span><span class="p">]:</span> <span class="n">index</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">77</span><span class="p">]:</span> 
<span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2011-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-01-02&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-01-03&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-01-04&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2011-01-05&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-01-06&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-01-07&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-01-08&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2011-01-09&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-01-10&#39;</span><span class="p">,</span>
               <span class="o">...</span>
               <span class="s1">&#39;2011-12-23&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-12-24&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-12-25&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-12-26&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2011-12-27&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-12-28&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-12-29&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-12-30&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2011-12-31&#39;</span><span class="p">,</span> <span class="s1">&#39;2012-01-01&#39;</span><span class="p">],</span>
              <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">366</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">78</span><span class="p">]:</span> <span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">bdate_range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">79</span><span class="p">]:</span> <span class="n">index</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">79</span><span class="p">]:</span> 
<span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2011-01-03&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-01-04&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-01-05&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-01-06&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2011-01-07&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-01-10&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-01-11&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-01-12&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2011-01-13&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-01-14&#39;</span><span class="p">,</span>
               <span class="o">...</span>
               <span class="s1">&#39;2011-12-19&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-12-20&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-12-21&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-12-22&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2011-12-23&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-12-26&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-12-27&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-12-28&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2011-12-29&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-12-30&#39;</span><span class="p">],</span>
              <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">260</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;B&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">date_range</span></code>、<code class="docutils literal notranslate"><span class="pre">bdate_range</span></code> 等便捷函数可以调用各种<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#timeseries-offset-aliases">频率别名</a>：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">80</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">80</span><span class="p">]:</span> 
<span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2011-01-31&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-02-28&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-03-31&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-04-30&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2011-05-31&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-06-30&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-07-31&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-08-31&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2011-09-30&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-10-31&#39;</span><span class="p">,</span>
               <span class="o">...</span>
               <span class="s1">&#39;2093-07-31&#39;</span><span class="p">,</span> <span class="s1">&#39;2093-08-31&#39;</span><span class="p">,</span> <span class="s1">&#39;2093-09-30&#39;</span><span class="p">,</span> <span class="s1">&#39;2093-10-31&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2093-11-30&#39;</span><span class="p">,</span> <span class="s1">&#39;2093-12-31&#39;</span><span class="p">,</span> <span class="s1">&#39;2094-01-31&#39;</span><span class="p">,</span> <span class="s1">&#39;2094-02-28&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2094-03-31&#39;</span><span class="p">,</span> <span class="s1">&#39;2094-04-30&#39;</span><span class="p">],</span>
              <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">81</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">bdate_range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;BQS&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">81</span><span class="p">]:</span> 
<span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2011-01-03&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-04-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-07-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-10-03&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2012-01-02&#39;</span><span class="p">,</span> <span class="s1">&#39;2012-04-02&#39;</span><span class="p">,</span> <span class="s1">&#39;2012-07-02&#39;</span><span class="p">,</span> <span class="s1">&#39;2012-10-01&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2013-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2013-04-01&#39;</span><span class="p">,</span>
               <span class="o">...</span>
               <span class="s1">&#39;2071-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2071-04-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2071-07-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2071-10-01&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2072-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2072-04-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2072-07-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2072-10-03&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2073-01-02&#39;</span><span class="p">,</span> <span class="s1">&#39;2073-04-03&#39;</span><span class="p">],</span>
              <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;BQS-JAN&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">date_range</span></code> 与 <code class="docutils literal notranslate"><span class="pre">bdate_range</span></code> 通过指定 <code class="docutils literal notranslate"><span class="pre">start</span></code>、<code class="docutils literal notranslate"><span class="pre">end</span></code>、<code class="docutils literal notranslate"><span class="pre">period</span></code> 与 <code class="docutils literal notranslate"><span class="pre">freq</span></code> 等参数，简化了生成日期范围这项工作。开始与结束日期是必填项，因此，不会生成指定范围之外的日期。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">82</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;BM&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">82</span><span class="p">]:</span> 
<span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2011-01-31&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-02-28&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-03-31&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-04-29&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2011-05-31&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-06-30&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-07-29&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-08-31&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2011-09-30&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-10-31&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-11-30&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-12-30&#39;</span><span class="p">],</span>
              <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;BM&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">83</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;W&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">83</span><span class="p">]:</span> 
<span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2011-01-02&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-01-09&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-01-16&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-01-23&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2011-01-30&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-02-06&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-02-13&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-02-20&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2011-02-27&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-03-06&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-03-13&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-03-20&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2011-03-27&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-04-03&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-04-10&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-04-17&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2011-04-24&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-05-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-05-08&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-05-15&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2011-05-22&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-05-29&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-06-05&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-06-12&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2011-06-19&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-06-26&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-07-03&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-07-10&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2011-07-17&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-07-24&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-07-31&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-08-07&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2011-08-14&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-08-21&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-08-28&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-09-04&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2011-09-11&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-09-18&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-09-25&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-10-02&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2011-10-09&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-10-16&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-10-23&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-10-30&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2011-11-06&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-11-13&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-11-20&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-11-27&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2011-12-04&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-12-11&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-12-18&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-12-25&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2012-01-01&#39;</span><span class="p">],</span>
              <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;W-SUN&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">84</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">bdate_range</span><span class="p">(</span><span class="n">end</span><span class="o">=</span><span class="n">end</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">84</span><span class="p">]:</span> 
<span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2011-12-05&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-12-06&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-12-07&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-12-08&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2011-12-09&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-12-12&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-12-13&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-12-14&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2011-12-15&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-12-16&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-12-19&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-12-20&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2011-12-21&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-12-22&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-12-23&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-12-26&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2011-12-27&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-12-28&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-12-29&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-12-30&#39;</span><span class="p">],</span>
              <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;B&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">85</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">bdate_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">85</span><span class="p">]:</span> 
<span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2011-01-03&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-01-04&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-01-05&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-01-06&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2011-01-07&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-01-10&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-01-11&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-01-12&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2011-01-13&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-01-14&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-01-17&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-01-18&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2011-01-19&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-01-20&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-01-21&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-01-24&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2011-01-25&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-01-26&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-01-27&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-01-28&#39;</span><span class="p">],</span>
              <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;B&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><em>0.23.0 版新增。</em></p>
<p>指定 <code class="docutils literal notranslate"><span class="pre">start</span></code>、<code class="docutils literal notranslate"><span class="pre">end</span></code>、<code class="docutils literal notranslate"><span class="pre">periods</span></code> 即可生成从 <code class="docutils literal notranslate"><span class="pre">start</span></code> 开始至 <code class="docutils literal notranslate"><span class="pre">end</span></code> 结束的等距日期范围，这个日期范围包含了 <code class="docutils literal notranslate"><span class="pre">start</span></code> 与 <code class="docutils literal notranslate"><span class="pre">end</span></code>，生成的 <code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code> 里的元素数量为 <code class="docutils literal notranslate"><span class="pre">periods</span></code> 的值。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">86</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;2018-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-05&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">86</span><span class="p">]:</span> 
<span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2018-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-02&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-03&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-04&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2018-01-05&#39;</span><span class="p">],</span>
              <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">87</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;2018-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-05&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">87</span><span class="p">]:</span> 
<span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2018-01-01 00:00:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-01 10:40:00&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2018-01-01 21:20:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-02 08:00:00&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2018-01-02 18:40:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-03 05:20:00&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2018-01-03 16:00:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-04 02:40:00&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2018-01-04 13:20:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2018-01-05 00:00:00&#39;</span><span class="p">],</span>
              <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="id10">
<h3>自定义频率范围<a class="headerlink" href="#id10" title="永久链接至标题">¶</a></h3>
<p>设定 <code class="docutils literal notranslate"><span class="pre">weekmask</span></code> 与 <code class="docutils literal notranslate"><span class="pre">holidays</span></code> 参数，<code class="docutils literal notranslate"><span class="pre">bdate_range</span></code> 还可以生成自定义频率日期范围。这些参数只用于传递自定义字符串。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">88</span><span class="p">]:</span> <span class="n">weekmask</span> <span class="o">=</span> <span class="s1">&#39;Mon Wed Fri&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">89</span><span class="p">]:</span> <span class="n">holidays</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2011</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2011</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">14</span><span class="p">)]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">90</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">bdate_range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="n">weekmask</span><span class="o">=</span><span class="n">weekmask</span><span class="p">,</span> <span class="n">holidays</span><span class="o">=</span><span class="n">holidays</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">90</span><span class="p">]:</span> 
<span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2011-01-03&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-01-07&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-01-10&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-01-12&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2011-01-14&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-01-17&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-01-19&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-01-21&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2011-01-24&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-01-26&#39;</span><span class="p">,</span>
               <span class="o">...</span>
               <span class="s1">&#39;2011-12-09&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-12-12&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-12-14&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-12-16&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2011-12-19&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-12-21&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-12-23&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-12-26&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2011-12-28&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-12-30&#39;</span><span class="p">],</span>
              <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">154</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;C&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">91</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">bdate_range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;CBMS&#39;</span><span class="p">,</span> <span class="n">weekmask</span><span class="o">=</span><span class="n">weekmask</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">91</span><span class="p">]:</span> 
<span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2011-01-03&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-02-02&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-03-02&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-04-01&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2011-05-02&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-06-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-07-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-08-01&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2011-09-02&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-10-03&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-11-02&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-12-02&#39;</span><span class="p">],</span>
              <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;CBMS&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>::: tip  参阅</p>
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#timeseries-custombusinessdays">自定义工作日</a></p>
<p>:::</p>
</div>
</div>
<div class="section" id="id11">
<h2><span class="section-number">6.5. </span>时间戳的界限<a class="headerlink" href="#id11" title="永久链接至标题">¶</a></h2>
<p>Pandas 时间戳的最低单位为纳秒，64 位整数显示的时间跨度约为 584 年，这就是 <code class="docutils literal notranslate"><span class="pre">Timestamp</span></code> 的界限：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">92</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="o">.</span><span class="n">min</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">92</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;1677-09-21 00:12:43.145225&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">93</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="o">.</span><span class="n">max</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">93</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2262-04-11 23:47:16.854775807&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>::: tip 参阅</p>
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#timeseries-oob">时间段越界展示</a></p>
<p>:::</p>
</div>
<div class="section" id="id12">
<h2><span class="section-number">6.6. </span>索引<a class="headerlink" href="#id12" title="永久链接至标题">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code> 主要用于 Pandas 对象的索引，为时间序列做了很多优化：</p>
<ul class="simple">
<li><p>预计算了各种偏移量的日期范围，并在后台缓存，让后台生成后续日期范围的速度非常快（仅需抓取切片）。</p></li>
<li><p>在 Pandas 对象上用 <code class="docutils literal notranslate"><span class="pre">shift</span></code> 与 <code class="docutils literal notranslate"><span class="pre">tshift</span></code> 方法进行快速偏移。</p></li>
<li><p>合并具有相同频率的重叠 <code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code> 对象的速度非常快（这点对快速数据对齐非常重要）。</p></li>
<li><p>通过 <code class="docutils literal notranslate"><span class="pre">year</span></code>、<code class="docutils literal notranslate"><span class="pre">month</span></code> 等属性快速访问日期字段。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">snap</span></code> 等正则函数与超快的 <code class="docutils literal notranslate"><span class="pre">asof</span></code> 逻辑。</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code> 支持 <code class="docutils literal notranslate"><span class="pre">Index</span></code> 的所有基本用法，以及一些列简化频率处理的高级时间序列专有方法。</p>
<p>::: tip 参阅</p>
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/getting_started/basics.html#basics-reindexing">重置索引</a></p>
<p>:::</p>
<p>::: tip 注意</p>
<p>Pandas 不强制排序日期索引，但如果日期未排序，可能会引发失控或错误操作。</p>
<p>:::</p>
<p><code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code> 可以当作常规索引，支持选择、切片等方法。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">94</span><span class="p">]:</span> <span class="n">rng</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;BM&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">95</span><span class="p">]:</span> <span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rng</span><span class="p">)),</span> <span class="n">index</span><span class="o">=</span><span class="n">rng</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">96</span><span class="p">]:</span> <span class="n">ts</span><span class="o">.</span><span class="n">index</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">96</span><span class="p">]:</span> 
<span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2011-01-31&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-02-28&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-03-31&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-04-29&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2011-05-31&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-06-30&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-07-29&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-08-31&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2011-09-30&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-10-31&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-11-30&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-12-30&#39;</span><span class="p">],</span>
              <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;BM&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">97</span><span class="p">]:</span> <span class="n">ts</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">97</span><span class="p">]:</span> 
<span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2011-01-31&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-02-28&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-03-31&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-04-29&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2011-05-31&#39;</span><span class="p">],</span>
              <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;BM&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">98</span><span class="p">]:</span> <span class="n">ts</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">98</span><span class="p">]:</span> 
<span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2011-01-31&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-03-31&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-05-31&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-07-29&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2011-09-30&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-11-30&#39;</span><span class="p">],</span>
              <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;2BM&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="id13">
<h3>局部字符串索引<a class="headerlink" href="#id13" title="永久链接至标题">¶</a></h3>
<p>能解析为时间戳的日期与字符串可以作为索引的参数：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">99</span><span class="p">]:</span> <span class="n">ts</span><span class="p">[</span><span class="s1">&#39;1/31/2011&#39;</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">99</span><span class="p">]:</span> <span class="mf">0.11920871129693428</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">100</span><span class="p">]:</span> <span class="n">ts</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2011</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">25</span><span class="p">):]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">100</span><span class="p">]:</span> 
<span class="mi">2011</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">30</span>    <span class="mf">0.56702</span>
<span class="n">Freq</span><span class="p">:</span> <span class="n">BM</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">101</span><span class="p">]:</span> <span class="n">ts</span><span class="p">[</span><span class="s1">&#39;10/31/2011&#39;</span><span class="p">:</span><span class="s1">&#39;12/31/2011&#39;</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">101</span><span class="p">]:</span> 
<span class="mi">2011</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">31</span>    <span class="mf">0.271860</span>
<span class="mi">2011</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">30</span>   <span class="o">-</span><span class="mf">0.424972</span>
<span class="mi">2011</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">30</span>    <span class="mf">0.567020</span>
<span class="n">Freq</span><span class="p">:</span> <span class="n">BM</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</pre></div>
</div>
<p>Pandas 为访问较长的时间序列提供了便捷方法，<strong>年</strong>、<strong>年月</strong>字符串均可：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">102</span><span class="p">]:</span> <span class="n">ts</span><span class="p">[</span><span class="s1">&#39;2011&#39;</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">102</span><span class="p">]:</span> 
<span class="mi">2011</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">31</span>    <span class="mf">0.119209</span>
<span class="mi">2011</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">28</span>   <span class="o">-</span><span class="mf">1.044236</span>
<span class="mi">2011</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">31</span>   <span class="o">-</span><span class="mf">0.861849</span>
<span class="mi">2011</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">29</span>   <span class="o">-</span><span class="mf">2.104569</span>
<span class="mi">2011</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">31</span>   <span class="o">-</span><span class="mf">0.494929</span>
<span class="mi">2011</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">30</span>    <span class="mf">1.071804</span>
<span class="mi">2011</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">29</span>    <span class="mf">0.721555</span>
<span class="mi">2011</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">31</span>   <span class="o">-</span><span class="mf">0.706771</span>
<span class="mi">2011</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">30</span>   <span class="o">-</span><span class="mf">1.039575</span>
<span class="mi">2011</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">31</span>    <span class="mf">0.271860</span>
<span class="mi">2011</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">30</span>   <span class="o">-</span><span class="mf">0.424972</span>
<span class="mi">2011</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">30</span>    <span class="mf">0.567020</span>
<span class="n">Freq</span><span class="p">:</span> <span class="n">BM</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">103</span><span class="p">]:</span> <span class="n">ts</span><span class="p">[</span><span class="s1">&#39;2011-6&#39;</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">103</span><span class="p">]:</span> 
<span class="mi">2011</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">30</span>    <span class="mf">1.071804</span>
<span class="n">Freq</span><span class="p">:</span> <span class="n">BM</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</pre></div>
</div>
<p>带 <code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code> 的 <code class="docutils literal notranslate"><span class="pre">DateFrame</span></code> 也支持这种切片方式。局部字符串是标签切片的一种形式，这种切片也<strong>包含</strong>截止时点，即，与日期匹配的时间也会包含在内：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">104</span><span class="p">]:</span> <span class="n">dft</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">100000</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">],</span>
   <span class="o">.....</span><span class="p">:</span>                    <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;20130101&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">100000</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;T&#39;</span><span class="p">))</span>
   <span class="o">.....</span><span class="p">:</span> 

<span class="n">In</span> <span class="p">[</span><span class="mi">105</span><span class="p">]:</span> <span class="n">dft</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">105</span><span class="p">]:</span> 
                            <span class="n">A</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>  <span class="mf">0.276232</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="mf">1.087401</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="mf">0.673690</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mi">00</span>  <span class="mf">0.113648</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="mf">1.478427</span>
<span class="o">...</span>                       <span class="o">...</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">11</span> <span class="mi">10</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="mf">0.747967</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">11</span> <span class="mi">10</span><span class="p">:</span><span class="mi">36</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="mf">0.034523</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">11</span> <span class="mi">10</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="mf">0.201754</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">11</span> <span class="mi">10</span><span class="p">:</span><span class="mi">38</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="mf">1.509067</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">11</span> <span class="mi">10</span><span class="p">:</span><span class="mi">39</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="mf">1.693043</span>

<span class="p">[</span><span class="mi">100000</span> <span class="n">rows</span> <span class="n">x</span> <span class="mi">1</span> <span class="n">columns</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">106</span><span class="p">]:</span> <span class="n">dft</span><span class="p">[</span><span class="s1">&#39;2013&#39;</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">106</span><span class="p">]:</span> 
                            <span class="n">A</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>  <span class="mf">0.276232</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="mf">1.087401</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="mf">0.673690</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mi">00</span>  <span class="mf">0.113648</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="mf">1.478427</span>
<span class="o">...</span>                       <span class="o">...</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">11</span> <span class="mi">10</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="mf">0.747967</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">11</span> <span class="mi">10</span><span class="p">:</span><span class="mi">36</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="mf">0.034523</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">11</span> <span class="mi">10</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="mf">0.201754</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">11</span> <span class="mi">10</span><span class="p">:</span><span class="mi">38</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="mf">1.509067</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">11</span> <span class="mi">10</span><span class="p">:</span><span class="mi">39</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="mf">1.693043</span>

<span class="p">[</span><span class="mi">100000</span> <span class="n">rows</span> <span class="n">x</span> <span class="mi">1</span> <span class="n">columns</span><span class="p">]</span>
</pre></div>
</div>
<p>下列代码截取了自 1 月 1 日凌晨起，至 2 月 28 日午夜的日期与时间。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">107</span><span class="p">]:</span> <span class="n">dft</span><span class="p">[</span><span class="s1">&#39;2013-1&#39;</span><span class="p">:</span><span class="s1">&#39;2013-2&#39;</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">107</span><span class="p">]:</span> 
                            <span class="n">A</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>  <span class="mf">0.276232</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="mf">1.087401</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="mf">0.673690</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mi">00</span>  <span class="mf">0.113648</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="mf">1.478427</span>
<span class="o">...</span>                       <span class="o">...</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">28</span> <span class="mi">23</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="mi">00</span>  <span class="mf">0.850929</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">28</span> <span class="mi">23</span><span class="p">:</span><span class="mi">56</span><span class="p">:</span><span class="mi">00</span>  <span class="mf">0.976712</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">28</span> <span class="mi">23</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="mf">2.693884</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">28</span> <span class="mi">23</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="mf">1.575535</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">28</span> <span class="mi">23</span><span class="p">:</span><span class="mi">59</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="mf">1.573517</span>

<span class="p">[</span><span class="mi">84960</span> <span class="n">rows</span> <span class="n">x</span> <span class="mi">1</span> <span class="n">columns</span><span class="p">]</span>
</pre></div>
</div>
<p>下列代码截取了<strong>包含截止日期及其时间在内</strong>的日期与时间。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">108</span><span class="p">]:</span> <span class="n">dft</span><span class="p">[</span><span class="s1">&#39;2013-1&#39;</span><span class="p">:</span><span class="s1">&#39;2013-2-28&#39;</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">108</span><span class="p">]:</span> 
                            <span class="n">A</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>  <span class="mf">0.276232</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="mf">1.087401</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="mf">0.673690</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mi">00</span>  <span class="mf">0.113648</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="mf">1.478427</span>
<span class="o">...</span>                       <span class="o">...</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">28</span> <span class="mi">23</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="mi">00</span>  <span class="mf">0.850929</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">28</span> <span class="mi">23</span><span class="p">:</span><span class="mi">56</span><span class="p">:</span><span class="mi">00</span>  <span class="mf">0.976712</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">28</span> <span class="mi">23</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="mf">2.693884</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">28</span> <span class="mi">23</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="mf">1.575535</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">28</span> <span class="mi">23</span><span class="p">:</span><span class="mi">59</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="mf">1.573517</span>

<span class="p">[</span><span class="mi">84960</span> <span class="n">rows</span> <span class="n">x</span> <span class="mi">1</span> <span class="n">columns</span><span class="p">]</span>
</pre></div>
</div>
<p>下列代码指定了精准的截止时间，注意此处的结果与上述截取结果的区别：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">109</span><span class="p">]:</span> <span class="n">dft</span><span class="p">[</span><span class="s1">&#39;2013-1&#39;</span><span class="p">:</span><span class="s1">&#39;2013-2-28 00:00:00&#39;</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">109</span><span class="p">]:</span> 
                            <span class="n">A</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>  <span class="mf">0.276232</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="mf">1.087401</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="mf">0.673690</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mi">00</span>  <span class="mf">0.113648</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="mf">1.478427</span>
<span class="o">...</span>                       <span class="o">...</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">27</span> <span class="mi">23</span><span class="p">:</span><span class="mi">56</span><span class="p">:</span><span class="mi">00</span>  <span class="mf">1.197749</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">27</span> <span class="mi">23</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mi">00</span>  <span class="mf">0.720521</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">27</span> <span class="mi">23</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="mf">0.072718</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">27</span> <span class="mi">23</span><span class="p">:</span><span class="mi">59</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="mf">0.681192</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">28</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="mf">0.557501</span>

<span class="p">[</span><span class="mi">83521</span> <span class="n">rows</span> <span class="n">x</span> <span class="mi">1</span> <span class="n">columns</span><span class="p">]</span>
</pre></div>
</div>
<p>截止时间是索引的一部分，包含在截取的内容之内：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">110</span><span class="p">]:</span> <span class="n">dft</span><span class="p">[</span><span class="s1">&#39;2013-1-15&#39;</span><span class="p">:</span><span class="s1">&#39;2013-1-15 12:30:00&#39;</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">110</span><span class="p">]:</span> 
                            <span class="n">A</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">15</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="mf">0.984810</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">15</span> <span class="mi">00</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">00</span>  <span class="mf">0.941451</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">15</span> <span class="mi">00</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mi">00</span>  <span class="mf">1.559365</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">15</span> <span class="mi">00</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mi">00</span>  <span class="mf">1.034374</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">15</span> <span class="mi">00</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="mf">1.480656</span>
<span class="o">...</span>                       <span class="o">...</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">26</span><span class="p">:</span><span class="mi">00</span>  <span class="mf">0.371454</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="mf">0.930806</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">28</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="mf">0.069177</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">29</span><span class="p">:</span><span class="mi">00</span>  <span class="mf">0.066510</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="mf">0.003945</span>

<span class="p">[</span><span class="mi">751</span> <span class="n">rows</span> <span class="n">x</span> <span class="mi">1</span> <span class="n">columns</span><span class="p">]</span>
</pre></div>
</div>
<p><em>0.18.0 版新增</em>。</p>
<p><code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code> 局部字符串索引还支持多层索引 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">111</span><span class="p">]:</span> <span class="n">dft2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
   <span class="o">.....</span><span class="p">:</span>                     <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">],</span>
   <span class="o">.....</span><span class="p">:</span>                     <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_product</span><span class="p">(</span>
   <span class="o">.....</span><span class="p">:</span>                         <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;20130101&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;12H&#39;</span><span class="p">),</span>
   <span class="o">.....</span><span class="p">:</span>                          <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">]]))</span>
   <span class="o">.....</span><span class="p">:</span> 

<span class="n">In</span> <span class="p">[</span><span class="mi">112</span><span class="p">]:</span> <span class="n">dft2</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">112</span><span class="p">]:</span> 
                              <span class="n">A</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span> <span class="n">a</span> <span class="o">-</span><span class="mf">0.298694</span>
                    <span class="n">b</span>  <span class="mf">0.823553</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">12</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span> <span class="n">a</span>  <span class="mf">0.943285</span>
                    <span class="n">b</span> <span class="o">-</span><span class="mf">1.479399</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span> <span class="n">a</span> <span class="o">-</span><span class="mf">1.643342</span>
<span class="o">...</span>                         <span class="o">...</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">04</span> <span class="mi">12</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span> <span class="n">b</span>  <span class="mf">0.069036</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">05</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span> <span class="n">a</span>  <span class="mf">0.122297</span>
                    <span class="n">b</span>  <span class="mf">1.422060</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">05</span> <span class="mi">12</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span> <span class="n">a</span>  <span class="mf">0.370079</span>
                    <span class="n">b</span>  <span class="mf">1.016331</span>

<span class="p">[</span><span class="mi">20</span> <span class="n">rows</span> <span class="n">x</span> <span class="mi">1</span> <span class="n">columns</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">113</span><span class="p">]:</span> <span class="n">dft2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;2013-01-05&#39;</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">113</span><span class="p">]:</span> 
                              <span class="n">A</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">05</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span> <span class="n">a</span>  <span class="mf">0.122297</span>
                    <span class="n">b</span>  <span class="mf">1.422060</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">05</span> <span class="mi">12</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span> <span class="n">a</span>  <span class="mf">0.370079</span>
                    <span class="n">b</span>  <span class="mf">1.016331</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">114</span><span class="p">]:</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">IndexSlice</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">115</span><span class="p">]:</span> <span class="n">dft2</span> <span class="o">=</span> <span class="n">dft2</span><span class="o">.</span><span class="n">swaplevel</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">116</span><span class="p">]:</span> <span class="n">dft2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">[:,</span> <span class="s1">&#39;2013-01-05&#39;</span><span class="p">],</span> <span class="p">:]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">116</span><span class="p">]:</span> 
                              <span class="n">A</span>
<span class="n">a</span> <span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">05</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>  <span class="mf">0.122297</span>
  <span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">05</span> <span class="mi">12</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>  <span class="mf">0.370079</span>
<span class="n">b</span> <span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">05</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>  <span class="mf">1.422060</span>
  <span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">05</span> <span class="mi">12</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>  <span class="mf">1.016331</span>
</pre></div>
</div>
<p><em>0.25.0 版新增</em>。</p>
<p>字符串索引切片支持 UTC 偏移。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">117</span><span class="p">]:</span> <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2019-01-01&#39;</span><span class="p">],</span> <span class="n">tz</span><span class="o">=</span><span class="s1">&#39;US/Pacific&#39;</span><span class="p">))</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">118</span><span class="p">]:</span> <span class="n">df</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">118</span><span class="p">]:</span> 
                           <span class="mi">0</span>
<span class="mi">2019</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="o">-</span><span class="mi">08</span><span class="p">:</span><span class="mi">00</span>  <span class="mi">0</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">119</span><span class="p">]:</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;2019-01-01 12:00:00+04:00&#39;</span><span class="p">:</span><span class="s1">&#39;2019-01-01 13:00:00+04:00&#39;</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">119</span><span class="p">]:</span> 
                           <span class="mi">0</span>
<span class="mi">2019</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="o">-</span><span class="mi">08</span><span class="p">:</span><span class="mi">00</span>  <span class="mi">0</span>
</pre></div>
</div>
</div>
<div class="section" id="id14">
<h3>切片 vs. 精准匹配<a class="headerlink" href="#id14" title="永久链接至标题">¶</a></h3>
<p><em>0.20.0 版新增。</em></p>
<p>基于索引的精度，字符串既可用于切片，也可用于精准匹配。字符串精度比索引精度低，就是切片，比索引精度高，则是精准匹配。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">120</span><span class="p">]:</span> <span class="n">series_minute</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
   <span class="o">.....</span><span class="p">:</span>                           <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2011-12-31 23:59:00&#39;</span><span class="p">,</span>
   <span class="o">.....</span><span class="p">:</span>                                             <span class="s1">&#39;2012-01-01 00:00:00&#39;</span><span class="p">,</span>
   <span class="o">.....</span><span class="p">:</span>                                             <span class="s1">&#39;2012-01-01 00:02:00&#39;</span><span class="p">]))</span>
   <span class="o">.....</span><span class="p">:</span> 

<span class="n">In</span> <span class="p">[</span><span class="mi">121</span><span class="p">]:</span> <span class="n">series_minute</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">resolution</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">121</span><span class="p">]:</span> <span class="s1">&#39;minute&#39;</span>
</pre></div>
</div>
<p>下例中的时间戳字符串没有 <code class="docutils literal notranslate"><span class="pre">Series</span></code> 对象的精度高。<code class="docutils literal notranslate"><span class="pre">series_minute</span></code> 到<code class="docutils literal notranslate"><span class="pre">秒</span></code>，时间戳字符串只到<code class="docutils literal notranslate"><span class="pre">分</span></code>。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">122</span><span class="p">]:</span> <span class="n">series_minute</span><span class="p">[</span><span class="s1">&#39;2011-12-31 23&#39;</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">122</span><span class="p">]:</span> 
<span class="mi">2011</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">31</span> <span class="mi">23</span><span class="p">:</span><span class="mi">59</span><span class="p">:</span><span class="mi">00</span>    <span class="mi">1</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>
</pre></div>
</div>
<p>精度为分钟（或更高精度）的时间戳字符串，给出的是标量，不会被当作切片。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">123</span><span class="p">]:</span> <span class="n">series_minute</span><span class="p">[</span><span class="s1">&#39;2011-12-31 23:59&#39;</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">123</span><span class="p">]:</span> <span class="mi">1</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">124</span><span class="p">]:</span> <span class="n">series_minute</span><span class="p">[</span><span class="s1">&#39;2011-12-31 23:59:00&#39;</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">124</span><span class="p">]:</span> <span class="mi">1</span>
</pre></div>
</div>
<p>索引的精度为秒时，精度为分钟的时间戳返回的是 <code class="docutils literal notranslate"><span class="pre">Series</span></code>。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">125</span><span class="p">]:</span> <span class="n">series_second</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
   <span class="o">.....</span><span class="p">:</span>                           <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2011-12-31 23:59:59&#39;</span><span class="p">,</span>
   <span class="o">.....</span><span class="p">:</span>                                             <span class="s1">&#39;2012-01-01 00:00:00&#39;</span><span class="p">,</span>
   <span class="o">.....</span><span class="p">:</span>                                             <span class="s1">&#39;2012-01-01 00:00:01&#39;</span><span class="p">]))</span>
   <span class="o">.....</span><span class="p">:</span> 

<span class="n">In</span> <span class="p">[</span><span class="mi">126</span><span class="p">]:</span> <span class="n">series_second</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">resolution</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">126</span><span class="p">]:</span> <span class="s1">&#39;second&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">127</span><span class="p">]:</span> <span class="n">series_second</span><span class="p">[</span><span class="s1">&#39;2011-12-31 23:59&#39;</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">127</span><span class="p">]:</span> 
<span class="mi">2011</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">31</span> <span class="mi">23</span><span class="p">:</span><span class="mi">59</span><span class="p">:</span><span class="mi">59</span>    <span class="mi">1</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>
</pre></div>
</div>
<p>用时间戳字符串切片时，还可以用 <code class="docutils literal notranslate"><span class="pre">[]</span></code> 索引 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">128</span><span class="p">]:</span> <span class="n">dft_minute</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]},</span>
   <span class="o">.....</span><span class="p">:</span>                           <span class="n">index</span><span class="o">=</span><span class="n">series_minute</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
   <span class="o">.....</span><span class="p">:</span> 

<span class="n">In</span> <span class="p">[</span><span class="mi">129</span><span class="p">]:</span> <span class="n">dft_minute</span><span class="p">[</span><span class="s1">&#39;2011-12-31 23&#39;</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">129</span><span class="p">]:</span> 
                     <span class="n">a</span>  <span class="n">b</span>
<span class="mi">2011</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">31</span> <span class="mi">23</span><span class="p">:</span><span class="mi">59</span><span class="p">:</span><span class="mi">00</span>  <span class="mi">1</span>  <span class="mi">4</span>
</pre></div>
</div>
<p>::: danger 警告</p>
<p>字符串执行精确匹配时，用 <code class="docutils literal notranslate"><span class="pre">[]</span></code> 按列，而不是按行截取 <code class="docutils literal notranslate"><span class="pre">DateFrame</span></code> ，参阅<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#indexing-basics">索引基础</a>。如，<code class="docutils literal notranslate"><span class="pre">dft_minute</span> <span class="pre">['2011-12-31</span> <span class="pre">23:59']</span></code> 会触发 <code class="docutils literal notranslate"><span class="pre">KeyError</span></code>，这是因为 <code class="docutils literal notranslate"><span class="pre">2012-12-31</span> <span class="pre">23:59</span></code>与索引的精度一样，但没有叫这个名字的列。</p>
<p>为了实现精准切片，要用 <code class="docutils literal notranslate"><span class="pre">.loc</span></code> 对行进行切片或选择。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">130</span><span class="p">]:</span> <span class="n">dft_minute</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;2011-12-31 23:59&#39;</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">130</span><span class="p">]:</span> 
<span class="n">a</span>    <span class="mi">1</span>
<span class="n">b</span>    <span class="mi">4</span>
<span class="n">Name</span><span class="p">:</span> <span class="mi">2011</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">31</span> <span class="mi">23</span><span class="p">:</span><span class="mi">59</span><span class="p">:</span><span class="mi">00</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>
</pre></div>
</div>
<p>:::</p>
<p>注意：<code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code> 精度不能低于日。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">131</span><span class="p">]:</span> <span class="n">series_monthly</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
   <span class="o">.....</span><span class="p">:</span>                            <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2011-12&#39;</span><span class="p">,</span> <span class="s1">&#39;2012-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2012-02&#39;</span><span class="p">]))</span>
   <span class="o">.....</span><span class="p">:</span> 

<span class="n">In</span> <span class="p">[</span><span class="mi">132</span><span class="p">]:</span> <span class="n">series_monthly</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">resolution</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">132</span><span class="p">]:</span> <span class="s1">&#39;day&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">133</span><span class="p">]:</span> <span class="n">series_monthly</span><span class="p">[</span><span class="s1">&#39;2011-12&#39;</span><span class="p">]</span>  <span class="c1"># 返回的是 Series</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">133</span><span class="p">]:</span> 
<span class="mi">2011</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">01</span>    <span class="mi">1</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>
</pre></div>
</div>
</div>
<div class="section" id="id15">
<h3>精确索引<a class="headerlink" href="#id15" title="永久链接至标题">¶</a></h3>
<p>正如上节所述，局部字符串依靠时间段的<strong>精度</strong>索引 <code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code>，即时间间隔与索引精度相关。反之，用 <code class="docutils literal notranslate"><span class="pre">Timestamp</span></code> 或 <code class="docutils literal notranslate"><span class="pre">datetime</span></code> 索引更精准，这些对象指定的时间更精确。注意，精确索引包含了起始时点。</p>
<p>就算没有显式指定，<code class="docutils literal notranslate"><span class="pre">Timestamp</span></code> 与<code class="docutils literal notranslate"><span class="pre">datetime</span></code> 也支持 <code class="docutils literal notranslate"><span class="pre">hours</span></code>、<code class="docutils literal notranslate"><span class="pre">minutes</span></code>、<code class="docutils literal notranslate"><span class="pre">seconds</span></code>，默认值为 0。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">134</span><span class="p">]:</span> <span class="n">dft</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">28</span><span class="p">)]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">134</span><span class="p">]:</span> 
                            <span class="n">A</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>  <span class="mf">0.276232</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="mf">1.087401</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="mf">0.673690</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mi">00</span>  <span class="mf">0.113648</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="mf">1.478427</span>
<span class="o">...</span>                       <span class="o">...</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">27</span> <span class="mi">23</span><span class="p">:</span><span class="mi">56</span><span class="p">:</span><span class="mi">00</span>  <span class="mf">1.197749</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">27</span> <span class="mi">23</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mi">00</span>  <span class="mf">0.720521</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">27</span> <span class="mi">23</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="mf">0.072718</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">27</span> <span class="mi">23</span><span class="p">:</span><span class="mi">59</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="mf">0.681192</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">28</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="mf">0.557501</span>

<span class="p">[</span><span class="mi">83521</span> <span class="n">rows</span> <span class="n">x</span> <span class="mi">1</span> <span class="n">columns</span><span class="p">]</span>
</pre></div>
</div>
<p>不用默认值。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">135</span><span class="p">]:</span> <span class="n">dft</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
   <span class="o">.....</span><span class="p">:</span>     <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span>
   <span class="o">.....</span><span class="p">:</span> 
<span class="n">Out</span><span class="p">[</span><span class="mi">135</span><span class="p">]:</span> 
                            <span class="n">A</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">10</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">00</span>  <span class="mf">0.565375</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">10</span><span class="p">:</span><span class="mi">13</span><span class="p">:</span><span class="mi">00</span>  <span class="mf">0.068184</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">10</span><span class="p">:</span><span class="mi">14</span><span class="p">:</span><span class="mi">00</span>  <span class="mf">0.788871</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">10</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="mf">0.280343</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">10</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">00</span>  <span class="mf">0.931536</span>
<span class="o">...</span>                       <span class="o">...</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">28</span> <span class="mi">10</span><span class="p">:</span><span class="mi">08</span><span class="p">:</span><span class="mi">00</span>  <span class="mf">0.148098</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">28</span> <span class="mi">10</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="mf">0.388138</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">28</span> <span class="mi">10</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mi">00</span>  <span class="mf">0.139348</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">28</span> <span class="mi">10</span><span class="p">:</span><span class="mi">11</span><span class="p">:</span><span class="mi">00</span>  <span class="mf">0.085288</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">28</span> <span class="mi">10</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">00</span>  <span class="mf">0.950146</span>

<span class="p">[</span><span class="mi">83521</span> <span class="n">rows</span> <span class="n">x</span> <span class="mi">1</span> <span class="n">columns</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="id16">
<h3>截断与花式索引<a class="headerlink" href="#id16" title="永久链接至标题">¶</a></h3>
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.truncate.html#pandas.DataFrame.truncate"><code class="docutils literal notranslate"><span class="pre">truncate()</span></code></a> 便捷函数与切片类似。注意，与切片返回的是部分匹配日期不同， <code class="docutils literal notranslate"><span class="pre">truncate</span></code> 假设 <code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code> 里未标明时间组件的值为 0。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">136</span><span class="p">]:</span> <span class="n">rng2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;2011-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2012-01-01&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;W&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">137</span><span class="p">]:</span> <span class="n">ts2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rng2</span><span class="p">)),</span> <span class="n">index</span><span class="o">=</span><span class="n">rng2</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">138</span><span class="p">]:</span> <span class="n">ts2</span><span class="o">.</span><span class="n">truncate</span><span class="p">(</span><span class="n">before</span><span class="o">=</span><span class="s1">&#39;2011-11&#39;</span><span class="p">,</span> <span class="n">after</span><span class="o">=</span><span class="s1">&#39;2011-12&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">138</span><span class="p">]:</span> 
<span class="mi">2011</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">06</span>    <span class="mf">0.437823</span>
<span class="mi">2011</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">13</span>   <span class="o">-</span><span class="mf">0.293083</span>
<span class="mi">2011</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">20</span>   <span class="o">-</span><span class="mf">0.059881</span>
<span class="mi">2011</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">27</span>    <span class="mf">1.252450</span>
<span class="n">Freq</span><span class="p">:</span> <span class="n">W</span><span class="o">-</span><span class="n">SUN</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">139</span><span class="p">]:</span> <span class="n">ts2</span><span class="p">[</span><span class="s1">&#39;2011-11&#39;</span><span class="p">:</span><span class="s1">&#39;2011-12&#39;</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">139</span><span class="p">]:</span> 
<span class="mi">2011</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">06</span>    <span class="mf">0.437823</span>
<span class="mi">2011</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">13</span>   <span class="o">-</span><span class="mf">0.293083</span>
<span class="mi">2011</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">20</span>   <span class="o">-</span><span class="mf">0.059881</span>
<span class="mi">2011</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">27</span>    <span class="mf">1.252450</span>
<span class="mi">2011</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">04</span>    <span class="mf">0.046611</span>
<span class="mi">2011</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">11</span>    <span class="mf">0.059478</span>
<span class="mi">2011</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">18</span>   <span class="o">-</span><span class="mf">0.286539</span>
<span class="mi">2011</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">25</span>    <span class="mf">0.841669</span>
<span class="n">Freq</span><span class="p">:</span> <span class="n">W</span><span class="o">-</span><span class="n">SUN</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</pre></div>
</div>
<p>花式索引返回 <code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code>， 但因为打乱了 <code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code> 频率，丢弃了频率信息，见 <code class="docutils literal notranslate"><span class="pre">freq=None</span></code>：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">140</span><span class="p">]:</span> <span class="n">ts2</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">]]</span><span class="o">.</span><span class="n">index</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">140</span><span class="p">]:</span> <span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2011-01-02&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-01-16&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-02-13&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id17">
<h2><span class="section-number">6.7. </span>日期/时间组件<a class="headerlink" href="#id17" title="永久链接至标题">¶</a></h2>
<p>以下日期/时间属性可以访问 <code class="docutils literal notranslate"><span class="pre">Timestamp</span></code> 或 <code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code>。</p>
<table border="1" class="docutils">
<thead>
<tr>
<th align="center">属性</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">year</td>
<td align="center">datetime 的年</td>
</tr>
<tr>
<td align="center">month</td>
<td align="center">datetime 的月</td>
</tr>
<tr>
<td align="center">day</td>
<td align="center">datetime 的日</td>
</tr>
<tr>
<td align="center">hour</td>
<td align="center">datetime 的小时</td>
</tr>
<tr>
<td align="center">minute</td>
<td align="center">datetime 的分钟</td>
</tr>
<tr>
<td align="center">second</td>
<td align="center">datetime 的秒</td>
</tr>
<tr>
<td align="center">microsecond</td>
<td align="center">datetime 的微秒</td>
</tr>
<tr>
<td align="center">nanosecond</td>
<td align="center">datetime 的纳秒</td>
</tr>
<tr>
<td align="center">date</td>
<td align="center">返回 datetime.date（不包含时区信息）</td>
</tr>
<tr>
<td align="center">time</td>
<td align="center">返回 datetime.time（不包含时区信息）</td>
</tr>
<tr>
<td align="center">timetz</td>
<td align="center">返回带本地时区信息的 datetime.time</td>
</tr>
<tr>
<td align="center">dayofyear</td>
<td align="center">一年里的第几天</td>
</tr>
<tr>
<td align="center">weekofyear</td>
<td align="center">一年里的第几周</td>
</tr>
<tr>
<td align="center">week</td>
<td align="center">一年里的第几周</td>
</tr>
<tr>
<td align="center">dayofweek</td>
<td align="center">一周里的第几天，Monday=0, Sunday=6</td>
</tr>
<tr>
<td align="center">weekday</td>
<td align="center">一周里的第几天，Monday=0, Sunday=6</td>
</tr>
<tr>
<td align="center">weekday_name</td>
<td align="center">这一天是星期几 （如，Friday）</td>
</tr>
<tr>
<td align="center">quarter</td>
<td align="center">日期所处的季节：Jan-Mar = 1，Apr-Jun = 2 等</td>
</tr>
<tr>
<td align="center">days_in_month</td>
<td align="center">日期所在的月有多少天</td>
</tr>
<tr>
<td align="center">is_month_start</td>
<td align="center">逻辑判断是不是月初（由频率定义）</td>
</tr>
<tr>
<td align="center">is_month_end</td>
<td align="center">逻辑判断是不是月末（由频率定义）</td>
</tr>
<tr>
<td align="center">is_quarter_start</td>
<td align="center">逻辑判断是不是季初（由频率定义）</td>
</tr>
<tr>
<td align="center">is_quarter_end</td>
<td align="center">逻辑判断是不是季末（由频率定义）</td>
</tr>
<tr>
<td align="center">is_year_start</td>
<td align="center">逻辑判断是不是年初（由频率定义）</td>
</tr>
<tr>
<td align="center">is_year_end</td>
<td align="center">逻辑判断是不是年末（由频率定义）</td>
</tr>
<tr>
<td align="center">is_leap_year</td>
<td align="center">逻辑判断是不是日期所在年是不是闰年</td>
</tr>
</tbody>
</table><p>参照 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/getting_started/basics.html#basics-dt-accessors">.dt 访问器</a> 一节介绍的知识点，<code class="docutils literal notranslate"><span class="pre">Series</span></code> 的值为 <code class="docutils literal notranslate"><span class="pre">datetime</span></code> 时，还可以用 <code class="docutils literal notranslate"><span class="pre">.dt</span></code> 访问这些属性。</p>
</div>
<div class="section" id="dateoffset">
<h2><span class="section-number">6.8. </span>DateOffset 对象<a class="headerlink" href="#dateoffset" title="永久链接至标题">¶</a></h2>
<p>上例中，频率字符串（如，<code class="docutils literal notranslate"><span class="pre">D</span></code>）用于定义指定的频率：</p>
<ul class="simple">
<li><p>用 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.date_range.html#pandas.date_range"><code class="docutils literal notranslate"><span class="pre">date_range()</span></code></a> 按指定频率分隔 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DatetimeIndex.html#pandas.DatetimeIndex"><code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code></a> 里的日期与时间</p></li>
<li><p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Period.html#pandas.Period"><code class="docutils literal notranslate"><span class="pre">Period</span></code></a> 或 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.PeriodIndex.html#pandas.PeriodIndex"><code class="docutils literal notranslate"><span class="pre">PeriodIndex</span></code></a> 的频率</p></li>
</ul>
<p>频率字符串表示的是 <code class="docutils literal notranslate"><span class="pre">DateOffset</span></code> 对象及其子类。<code class="docutils literal notranslate"><span class="pre">DateOffset</span></code> 类似于时间差 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Timedelta.html#pandas.Timedelta"><code class="docutils literal notranslate"><span class="pre">Timedelta</span></code></a> ，但遵循指定的日历日规则。例如，<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Timedelta.html#pandas.Timedelta"><code class="docutils literal notranslate"><span class="pre">Timedelta</span></code></a> 表示的每日时间差一直都是 24 小时，而 <code class="docutils literal notranslate"><span class="pre">DateOffset</span></code> 的每日偏移量则是与下一天相同的时间差，使用夏时制时，每日偏移时间有可能是 23 或 24 小时，甚至还有可能是 25 小时。不过，<code class="docutils literal notranslate"><span class="pre">DateOffset</span></code> 子类只能是等于或小于<strong>小时</strong>的时间单位（<code class="docutils literal notranslate"><span class="pre">Hour</span></code>、<code class="docutils literal notranslate"><span class="pre">Minute</span></code>、<code class="docutils literal notranslate"><span class="pre">Second</span></code>、<code class="docutils literal notranslate"><span class="pre">Milli</span></code>、<code class="docutils literal notranslate"><span class="pre">Micro</span></code>、<code class="docutils literal notranslate"><span class="pre">Nano</span></code>），操作类似于 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Timedelta.html#pandas.Timedelta"><code class="docutils literal notranslate"><span class="pre">Timedelta</span></code></a> 及对应的绝对时间。</p>
<p><code class="docutils literal notranslate"><span class="pre">DateOffset</span></code> 基础操作类似于 <code class="docutils literal notranslate"><span class="pre">dateutil.relativedelta</span></code>（<a class="reference external" href="https://dateutil.readthedocs.io/en/stable/relativedelta.html">relativedelta 文档</a>），可按指定的日历日时间段偏移日期时间。可用算数运算符（+）或 <code class="docutils literal notranslate"><span class="pre">apply</span></code> 方法执行日期偏移操作。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 指定包含夏时制变迁的某天</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">141</span><span class="p">]:</span> <span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2016-10-30 00:00:00&#39;</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s1">&#39;Europe/Helsinki&#39;</span><span class="p">)</span>

<span class="c1"># 对应的绝对时间</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">142</span><span class="p">]:</span> <span class="n">ts</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">142</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2016-10-30 23:00:00+0200&#39;</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s1">&#39;Europe/Helsinki&#39;</span><span class="p">)</span>

<span class="c1"># 对应的日历时间</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">143</span><span class="p">]:</span> <span class="n">ts</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">143</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2016-10-31 00:00:00+0200&#39;</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s1">&#39;Europe/Helsinki&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">144</span><span class="p">]:</span> <span class="n">friday</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2018-01-05&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">145</span><span class="p">]:</span> <span class="n">friday</span><span class="o">.</span><span class="n">day_name</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">145</span><span class="p">]:</span> <span class="s1">&#39;Friday&#39;</span>

<span class="c1"># 与两个工作日相加（星期五 --&gt; 星期二）</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">146</span><span class="p">]:</span> <span class="n">two_business_days</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">BDay</span><span class="p">()</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">147</span><span class="p">]:</span> <span class="n">two_business_days</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">friday</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">147</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2018-01-09 00:00:00&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">148</span><span class="p">]:</span> <span class="n">friday</span> <span class="o">+</span> <span class="n">two_business_days</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">148</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2018-01-09 00:00:00&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">149</span><span class="p">]:</span> <span class="p">(</span><span class="n">friday</span> <span class="o">+</span> <span class="n">two_business_days</span><span class="p">)</span><span class="o">.</span><span class="n">day_name</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">149</span><span class="p">]:</span> <span class="s1">&#39;Tuesday&#39;</span>
</pre></div>
</div>
<p>大多数 <code class="docutils literal notranslate"><span class="pre">DateOffset</span></code> 都支持频率字符串或偏移别名，可用作 <code class="docutils literal notranslate"><span class="pre">freq</span></code> 关键字参数。有效的日期偏移及频率字符串如下：</p>
<table border="1" class="docutils">
<thead>
<tr>
<th align="center">日期偏移量</th>
<th align="center">频率字符串</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.DateOffset.html#pandas.tseries.offsets.DateOffset"><code>DateOffset</code></a></td>
<td align="center">无</td>
<td align="center">通用偏移类，默认为一个日历日</td>
</tr>
<tr>
<td align="center"><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.BDay.html#pandas.tseries.offsets.BDay"><code>BDay</code></a> 或 <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.BusinessDay.html#pandas.tseries.offsets.BusinessDay"><code>BusinessDay</code></a></td>
<td align="center"><code>'B'</code></td>
<td align="center">工作日</td>
</tr>
<tr>
<td align="center"><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.CDay.html#pandas.tseries.offsets.CDay"><code>CDay</code></a> 或 <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.CustomBusinessDay.html#pandas.tseries.offsets.CustomBusinessDay"><code>CustomBusinessDay</code></a></td>
<td align="center"><code>'C'</code></td>
<td align="center">自定义工作日</td>
</tr>
<tr>
<td align="center"><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.Week.html#pandas.tseries.offsets.Week"><code>Week</code></a></td>
<td align="center"><code>'W'</code></td>
<td align="center">一周，可选周内固定某日</td>
</tr>
<tr>
<td align="center"><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.WeekOfMonth.html#pandas.tseries.offsets.WeekOfMonth"><code>WeekOfMonth</code></a></td>
<td align="center"><code>'WOM'</code></td>
<td align="center">每月第几周的第几天</td>
</tr>
<tr>
<td align="center"><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.LastWeekOfMonth.html#pandas.tseries.offsets.LastWeekOfMonth"><code>LastWeekOfMonth</code></a></td>
<td align="center"><code>'LWOM'</code></td>
<td align="center">每月最后一周的第几天</td>
</tr>
<tr>
<td align="center"><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.MonthEnd.html#pandas.tseries.offsets.MonthEnd"><code>MonthEnd</code></a></td>
<td align="center"><code>'M'</code></td>
<td align="center">日历日月末</td>
</tr>
<tr>
<td align="center"><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.MonthBegin.html#pandas.tseries.offsets.MonthBegin"><code>MonthBegin</code></a></td>
<td align="center"><code>'MS'</code></td>
<td align="center">日历日月初</td>
</tr>
<tr>
<td align="center"><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.BMonthEnd.html#pandas.tseries.offsets.BMonthEnd"><code>BMonthEnd</code></a> 或 <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.BusinessMonthEnd.html#pandas.tseries.offsets.BusinessMonthEnd"><code>BusinessMonthEnd</code></a></td>
<td align="center"><code>'BM'</code></td>
<td align="center">工作日月末</td>
</tr>
<tr>
<td align="center"><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.BMonthBegin.html#pandas.tseries.offsets.BMonthBegin"><code>BMonthBegin</code></a> 或 <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.BusinessMonthBegin.html#pandas.tseries.offsets.BusinessMonthBegin"><code>BusinessMonthBegin</code></a></td>
<td align="center"><code>'BMS'</code></td>
<td align="center">工作日月初</td>
</tr>
<tr>
<td align="center"><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.CBMonthEnd.html#pandas.tseries.offsets.CBMonthEnd"><code>CBMonthEnd</code></a> 或 <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.CustomBusinessMonthEnd.html#pandas.tseries.offsets.CustomBusinessMonthEnd"><code>CustomBusinessMonthEnd</code></a></td>
<td align="center"><code>'CBM'</code></td>
<td align="center">自定义工作日月末</td>
</tr>
<tr>
<td align="center"><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.CBMonthBegin.html#pandas.tseries.offsets.CBMonthBegin"><code>CBMonthBegin</code></a> 或 <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.CustomBusinessMonthBegin.html#pandas.tseries.offsets.CustomBusinessMonthBegin"><code>CustomBusinessMonthBegin</code></a></td>
<td align="center"><code>'CBMS'</code></td>
<td align="center">自定义工作日月初</td>
</tr>
<tr>
<td align="center"><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.SemiMonthEnd.html#pandas.tseries.offsets.SemiMonthEnd"><code>SemiMonthEnd</code></a></td>
<td align="center"><code>'SM'</code></td>
<td align="center">某月第 15 天（或其它半数日期）与日历日月末</td>
</tr>
<tr>
<td align="center"><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.SemiMonthBegin.html#pandas.tseries.offsets.SemiMonthBegin"><code>SemiMonthBegin</code></a></td>
<td align="center"><code>'SMS'</code></td>
<td align="center">日历日月初与第 15 天（或其它半数日期）</td>
</tr>
<tr>
<td align="center"><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.QuarterEnd.html#pandas.tseries.offsets.QuarterEnd"><code>QuarterEnd</code></a></td>
<td align="center"><code>'Q'</code></td>
<td align="center">日历日季末</td>
</tr>
<tr>
<td align="center"><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.QuarterBegin.html#pandas.tseries.offsets.QuarterBegin"><code>QuarterBegin</code></a></td>
<td align="center"><code>'QS'</code></td>
<td align="center">日历日季初</td>
</tr>
<tr>
<td align="center"><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.BQuarterEnd.html#pandas.tseries.offsets.BQuarterEnd"><code>BQuarterEnd</code></a></td>
<td align="center"><code>'BQ</code></td>
<td align="center">工作日季末</td>
</tr>
<tr>
<td align="center"><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.BQuarterBegin.html#pandas.tseries.offsets.BQuarterBegin"><code>BQuarterBegin</code></a></td>
<td align="center"><code>'BQS'</code></td>
<td align="center">工作日季初</td>
</tr>
<tr>
<td align="center"><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.FY5253Quarter.html#pandas.tseries.offsets.FY5253Quarter"><code>FY5253Quarter</code></a></td>
<td align="center"><code>'REQ'</code></td>
<td align="center">零售季，又名 52-53 周</td>
</tr>
<tr>
<td align="center"><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.YearEnd.html#pandas.tseries.offsets.YearEnd"><code>YearEnd</code></a></td>
<td align="center"><code>'A'</code></td>
<td align="center">日历日年末</td>
</tr>
<tr>
<td align="center"><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.YearBegin.html#pandas.tseries.offsets.YearBegin"><code>YearBegin</code></a></td>
<td align="center"><code>'AS'</code> 或 <code>'BYS'</code></td>
<td align="center">日历日年初</td>
</tr>
<tr>
<td align="center"><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.BYearEnd.html#pandas.tseries.offsets.BYearEnd"><code>BYearEnd</code></a></td>
<td align="center"><code>'BA'</code></td>
<td align="center">工作日年末</td>
</tr>
<tr>
<td align="center"><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.BYearBegin.html#pandas.tseries.offsets.BYearBegin"><code>BYearBegin</code></a></td>
<td align="center"><code>'BAS'</code></td>
<td align="center">工作日年初</td>
</tr>
<tr>
<td align="center"><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.FY5253.html#pandas.tseries.offsets.FY5253"><code>FY5253</code></a></td>
<td align="center"><code>'RE'</code></td>
<td align="center">零售年（又名 52-53 周）</td>
</tr>
<tr>
<td align="center"><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.Easter.html#pandas.tseries.offsets.Easter"><code>Easter</code></a></td>
<td align="center">无</td>
<td align="center">复活节假日</td>
</tr>
<tr>
<td align="center"><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.BusinessHour.html#pandas.tseries.offsets.BusinessHour"><code>BusinessHour</code></a></td>
<td align="center"><code>'BH'</code></td>
<td align="center">工作小时</td>
</tr>
<tr>
<td align="center"><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.CustomBusinessHour.html#pandas.tseries.offsets.CustomBusinessHour"><code>CustomBusinessHour</code></a></td>
<td align="center"><code>'CBH'</code></td>
<td align="center">自定义工作小时</td>
</tr>
<tr>
<td align="center"><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.Day.html#pandas.tseries.offsets.Day"><code>Day</code></a></td>
<td align="center"><code>'D'</code></td>
<td align="center">一天</td>
</tr>
<tr>
<td align="center"><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.Hour.html#pandas.tseries.offsets.Hour"><code>Hour</code></a></td>
<td align="center"><code>'H'</code></td>
<td align="center">一小时</td>
</tr>
<tr>
<td align="center"><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.Minute.html#pandas.tseries.offsets.Minute"><code>Minute</code></a></td>
<td align="center"><code>'T'</code> 或 <code>'min'</code></td>
<td align="center">一分钟</td>
</tr>
<tr>
<td align="center"><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.Second.html#pandas.tseries.offsets.Second"><code>Second</code></a></td>
<td align="center"><code>'S'</code></td>
<td align="center">一秒</td>
</tr>
<tr>
<td align="center"><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.Milli.html#pandas.tseries.offsets.Milli"><code>Milli</code></a></td>
<td align="center"><code>'L'</code> 或 <code>'ms'</code></td>
<td align="center">一毫秒</td>
</tr>
<tr>
<td align="center"><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.Micro.html#pandas.tseries.offsets.Micro"><code>Micro</code></a></td>
<td align="center"><code>'U'</code> 或 <code>'us'</code></td>
<td align="center">一微秒</td>
</tr>
<tr>
<td align="center"><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.Nano.html#pandas.tseries.offsets.Nano"><code>Nano</code></a></td>
<td align="center"><code>'N'</code></td>
<td align="center">一纳秒</td>
</tr>
</tbody>
</table><p><code class="docutils literal notranslate"><span class="pre">DateOffset</span></code> 还支持 <code class="docutils literal notranslate"><span class="pre">rollforward()</span></code> 与 <code class="docutils literal notranslate"><span class="pre">rollback()</span></code> 方法，按偏移量把某一日期<strong>向前</strong>或<strong>向后</strong>移动至有效偏移日期。例如，工作日偏移滚动日期时会跳过周末（即，星期六与星期日），直接到星期一，因为工作日偏移针对的是工作日。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">150</span><span class="p">]:</span> <span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2018-01-06 00:00:00&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">151</span><span class="p">]:</span> <span class="n">ts</span><span class="o">.</span><span class="n">day_name</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">151</span><span class="p">]:</span> <span class="s1">&#39;Saturday&#39;</span>

<span class="c1"># 工作时间的有效偏移日期为星期一至星期五</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">152</span><span class="p">]:</span> <span class="n">offset</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">BusinessHour</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="s1">&#39;09:00&#39;</span><span class="p">)</span>

<span class="c1"># 向前偏移到最近的工作日，即星期一</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">153</span><span class="p">]:</span> <span class="n">offset</span><span class="o">.</span><span class="n">rollforward</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">153</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2018-01-08 09:00:00&#39;</span><span class="p">)</span>

<span class="c1"># 向前偏移至最近的工作日，同时，小时也相应增加了</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">154</span><span class="p">]:</span> <span class="n">ts</span> <span class="o">+</span> <span class="n">offset</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">154</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2018-01-08 10:00:00&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>这些操作默认保存时间（小时、分钟等）信息。<code class="docutils literal notranslate"><span class="pre">normalize()</span></code> 可以把时间重置为午夜零点，是否应用此操作，取决于是否需要保留时间信息。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">155</span><span class="p">]:</span> <span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-01-01 09:00&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">156</span><span class="p">]:</span> <span class="n">day</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">Day</span><span class="p">()</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">157</span><span class="p">]:</span> <span class="n">day</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">157</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-01-02 09:00:00&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">158</span><span class="p">]:</span> <span class="n">day</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">158</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-01-02 00:00:00&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">159</span><span class="p">]:</span> <span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-01-01 22:00&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">160</span><span class="p">]:</span> <span class="n">hour</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">Hour</span><span class="p">()</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">161</span><span class="p">]:</span> <span class="n">hour</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">161</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-01-01 23:00:00&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">162</span><span class="p">]:</span> <span class="n">hour</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">162</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-01-01 00:00:00&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">163</span><span class="p">]:</span> <span class="n">hour</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">&quot;2014-01-01 23:30&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">163</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-01-02 00:00:00&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="id18">
<h3>参数偏移<a class="headerlink" href="#id18" title="永久链接至标题">¶</a></h3>
<p>偏移量支持参数，可以让不同操作生成不同结果。例如，<code class="docutils literal notranslate"><span class="pre">Week</span></code> 偏移生成每周数据时支持 <code class="docutils literal notranslate"><span class="pre">weekday</span></code> 参数，生成日期始终位于一周中的指定日期。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">164</span><span class="p">]:</span> <span class="n">d</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2008</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">165</span><span class="p">]:</span> <span class="n">d</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">165</span><span class="p">]:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2008</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">166</span><span class="p">]:</span> <span class="n">d</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">Week</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">166</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2008-08-25 09:00:00&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">167</span><span class="p">]:</span> <span class="n">d</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">Week</span><span class="p">(</span><span class="n">weekday</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">167</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2008-08-22 09:00:00&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">168</span><span class="p">]:</span> <span class="p">(</span><span class="n">d</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">Week</span><span class="p">(</span><span class="n">weekday</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span><span class="o">.</span><span class="n">weekday</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">168</span><span class="p">]:</span> <span class="mi">4</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">169</span><span class="p">]:</span> <span class="n">d</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">Week</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">169</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2008-08-11 09:00:00&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>加减法也支持 <code class="docutils literal notranslate"><span class="pre">normalize</span></code> 选项。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">170</span><span class="p">]:</span> <span class="n">d</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">Week</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">170</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2008-08-25 00:00:00&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">171</span><span class="p">]:</span> <span class="n">d</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">Week</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">171</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2008-08-11 00:00:00&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">YearEnd</span></code> 也支持参数，如 <code class="docutils literal notranslate"><span class="pre">month</span></code> 参数，用于指定月份 。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">172</span><span class="p">]:</span> <span class="n">d</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">YearEnd</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">172</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2008-12-31 09:00:00&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">173</span><span class="p">]:</span> <span class="n">d</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">YearEnd</span><span class="p">(</span><span class="n">month</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">173</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2009-06-30 09:00:00&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="series-datetimeindex">
<h3><code class="docutils literal notranslate"><span class="pre">Series</span></code> 与 <code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code> 偏移<a class="headerlink" href="#series-datetimeindex" title="永久链接至标题">¶</a></h3>
<p>可以为 <code class="docutils literal notranslate"><span class="pre">Series</span></code> 或 <code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code> 里的每个元素应用偏移。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">174</span><span class="p">]:</span> <span class="n">rng</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;2012-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2012-01-03&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">175</span><span class="p">]:</span> <span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">rng</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">176</span><span class="p">]:</span> <span class="n">rng</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">176</span><span class="p">]:</span> <span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2012-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2012-01-02&#39;</span><span class="p">,</span> <span class="s1">&#39;2012-01-03&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">177</span><span class="p">]:</span> <span class="n">rng</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">177</span><span class="p">]:</span> <span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2012-03-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2012-03-02&#39;</span><span class="p">,</span> <span class="s1">&#39;2012-03-03&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">178</span><span class="p">]:</span> <span class="n">s</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">178</span><span class="p">]:</span> 
<span class="mi">0</span>   <span class="mi">2012</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">01</span>
<span class="mi">1</span>   <span class="mi">2012</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">02</span>
<span class="mi">2</span>   <span class="mi">2012</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">03</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">datetime64</span><span class="p">[</span><span class="n">ns</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">179</span><span class="p">]:</span> <span class="n">s</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">179</span><span class="p">]:</span> 
<span class="mi">0</span>   <span class="mi">2011</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">01</span>
<span class="mi">1</span>   <span class="mi">2011</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">02</span>
<span class="mi">2</span>   <span class="mi">2011</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">03</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">datetime64</span><span class="p">[</span><span class="n">ns</span><span class="p">]</span>
</pre></div>
</div>
<p>如果偏移直接映射 <code class="docutils literal notranslate"><span class="pre">Timedelta</span></code> （<code class="docutils literal notranslate"><span class="pre">Day</span></code>、<code class="docutils literal notranslate"><span class="pre">Hour</span></code>、<code class="docutils literal notranslate"><span class="pre">Minute</span></code>、<code class="docutils literal notranslate"><span class="pre">Second</span></code>、<code class="docutils literal notranslate"><span class="pre">Micro</span></code>、<code class="docutils literal notranslate"><span class="pre">Milli</span></code>、<code class="docutils literal notranslate"><span class="pre">Nano</span></code>），则该偏移与 <code class="docutils literal notranslate"><span class="pre">Timedelta</span></code> 的使用方式完全一样。参阅<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timedeltas.html#timedeltas-operations">时间差 - Timedelta</a>，查看更多示例。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">180</span><span class="p">]:</span> <span class="n">s</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">Day</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">180</span><span class="p">]:</span> 
<span class="mi">0</span>   <span class="mi">2011</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">30</span>
<span class="mi">1</span>   <span class="mi">2011</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">31</span>
<span class="mi">2</span>   <span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">datetime64</span><span class="p">[</span><span class="n">ns</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">181</span><span class="p">]:</span> <span class="n">td</span> <span class="o">=</span> <span class="n">s</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;2011-12-29&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-12-31&#39;</span><span class="p">))</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">182</span><span class="p">]:</span> <span class="n">td</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">182</span><span class="p">]:</span> 
<span class="mi">0</span>   <span class="mi">3</span> <span class="n">days</span>
<span class="mi">1</span>   <span class="mi">3</span> <span class="n">days</span>
<span class="mi">2</span>   <span class="mi">3</span> <span class="n">days</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">timedelta64</span><span class="p">[</span><span class="n">ns</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">183</span><span class="p">]:</span> <span class="n">td</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">Minute</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">183</span><span class="p">]:</span> 
<span class="mi">0</span>   <span class="mi">3</span> <span class="n">days</span> <span class="mi">00</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">00</span>
<span class="mi">1</span>   <span class="mi">3</span> <span class="n">days</span> <span class="mi">00</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">00</span>
<span class="mi">2</span>   <span class="mi">3</span> <span class="n">days</span> <span class="mi">00</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">00</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">timedelta64</span><span class="p">[</span><span class="n">ns</span><span class="p">]</span>
</pre></div>
</div>
<p>注意，某些偏移量（如 <code class="docutils literal notranslate"><span class="pre">BQuarterEnd</span></code>）不支持矢量操作，即使可以执行运算，速度也非常慢，并可能显示 <code class="docutils literal notranslate"><span class="pre">PerformanceWaring</span></code>（性能警告）。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">184</span><span class="p">]:</span> <span class="n">rng</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">BQuarterEnd</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">184</span><span class="p">]:</span> <span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2012-03-30&#39;</span><span class="p">,</span> <span class="s1">&#39;2012-03-30&#39;</span><span class="p">,</span> <span class="s1">&#39;2012-03-30&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id19">
<h3>自定义工作日<a class="headerlink" href="#id19" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Cday</span></code> 或 <code class="docutils literal notranslate"><span class="pre">CustomBusinessDay</span></code> 类可以参数化 <code class="docutils literal notranslate"><span class="pre">BusinessDay</span></code> 类，用于创建支持本地周末与传统节假日的自定义工作日历。</p>
<p>下面这个例子就很有意思，知道吗？埃及的周末是星期五与星期六。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">185</span><span class="p">]:</span> <span class="n">weekmask_egypt</span> <span class="o">=</span> <span class="s1">&#39;Sun Mon Tue Wed Thu&#39;</span>


<span class="c1"># 下面是 2012 - 2014 年的五一劳动节</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">186</span><span class="p">]:</span> <span class="n">holidays</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;2012-05-01&#39;</span><span class="p">,</span>
   <span class="o">.....</span><span class="p">:</span>             <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
   <span class="o">.....</span><span class="p">:</span>             <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s1">&#39;2014-05-01&#39;</span><span class="p">)]</span>
   <span class="o">.....</span><span class="p">:</span> 

<span class="n">In</span> <span class="p">[</span><span class="mi">187</span><span class="p">]:</span> <span class="n">bday_egypt</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">CustomBusinessDay</span><span class="p">(</span><span class="n">holidays</span><span class="o">=</span><span class="n">holidays</span><span class="p">,</span>
   <span class="o">.....</span><span class="p">:</span>                                           <span class="n">weekmask</span><span class="o">=</span><span class="n">weekmask_egypt</span><span class="p">)</span>
   <span class="o">.....</span><span class="p">:</span> 

<span class="n">In</span> <span class="p">[</span><span class="mi">188</span><span class="p">]:</span> <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">189</span><span class="p">]:</span> <span class="n">dt</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">bday_egypt</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">189</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2013-05-05 00:00:00&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>下列代码实现了日期与工作日之间的映射关系。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">190</span><span class="p">]:</span> <span class="n">dts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="n">bday_egypt</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">191</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">dts</span><span class="o">.</span><span class="n">weekday</span><span class="p">,</span> <span class="n">dts</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
   <span class="o">.....</span><span class="p">:</span>     <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="s1">&#39;Mon Tue Wed Thu Fri Sat Sun&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">()))</span>
   <span class="o">.....</span><span class="p">:</span> 
<span class="n">Out</span><span class="p">[</span><span class="mi">191</span><span class="p">]:</span> 
<span class="mi">2013</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">30</span>    <span class="n">Tue</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">02</span>    <span class="n">Thu</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">05</span>    <span class="n">Sun</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">06</span>    <span class="n">Mon</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">07</span>    <span class="n">Tue</span>
<span class="n">Freq</span><span class="p">:</span> <span class="n">C</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>
</pre></div>
</div>
<p>节日日历支持节假日列表。更多信息，请参阅<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#timeseries-holiday">节日日历</a>文档。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">192</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">pandas.tseries.holiday</span> <span class="kn">import</span> <span class="n">USFederalHolidayCalendar</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">193</span><span class="p">]:</span> <span class="n">bday_us</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">CustomBusinessDay</span><span class="p">(</span><span class="n">calendar</span><span class="o">=</span><span class="n">USFederalHolidayCalendar</span><span class="p">())</span>

<span class="c1"># 马丁路德金纪念日前的星期五</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">194</span><span class="p">]:</span> <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2014</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">17</span><span class="p">)</span>

<span class="c1"># 马丁路德金纪念日后的星期二，因为星期一放假，所以跳过了</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">195</span><span class="p">]:</span> <span class="n">dt</span> <span class="o">+</span> <span class="n">bday_us</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">195</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-01-21 00:00:00&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>遵循节日日历规则的月偏移可以用正常方式定义。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">196</span><span class="p">]:</span> <span class="n">bmth_us</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">CustomBusinessMonthBegin</span><span class="p">(</span>
   <span class="o">.....</span><span class="p">:</span>     <span class="n">calendar</span><span class="o">=</span><span class="n">USFederalHolidayCalendar</span><span class="p">())</span>
   <span class="o">.....</span><span class="p">:</span> 

<span class="c1"># 跳过新年</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">197</span><span class="p">]:</span> <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">17</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">198</span><span class="p">]:</span> <span class="n">dt</span> <span class="o">+</span> <span class="n">bmth_us</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">198</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-01-02 00:00:00&#39;</span><span class="p">)</span>

<span class="c1"># 定义带自定义偏移的日期索引</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">199</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="s1">&#39;20100101&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;20120101&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="n">bmth_us</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">199</span><span class="p">]:</span> 
<span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2010-01-04&#39;</span><span class="p">,</span> <span class="s1">&#39;2010-02-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2010-03-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2010-04-01&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2010-05-03&#39;</span><span class="p">,</span> <span class="s1">&#39;2010-06-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2010-07-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2010-08-02&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2010-09-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2010-10-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2010-11-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2010-12-01&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2011-01-03&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-02-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-03-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-04-01&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2011-05-02&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-06-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-07-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-08-01&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2011-09-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-10-03&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-11-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-12-01&#39;</span><span class="p">],</span>
              <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;CBMS&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>::: tip 注意</p>
<p>频率字符串 ‘C’ 验证 <code class="docutils literal notranslate"><span class="pre">CustomBusinessDay</span></code> 日期偏移 调用，注意，<code class="docutils literal notranslate"><span class="pre">CustomBusinessDay</span></code> 可实现参数化，<code class="docutils literal notranslate"><span class="pre">CustomBusinessDay</span></code> 实例会各不相同，且频率字符串 ‘C’ 无法识别这个问题。用户应确保应用里调用的频率字符串 ‘C’ 的一致性 。</p>
</div>
<div class="section" id="id20">
<h3>工作时间<a class="headerlink" href="#id20" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">BusinessHour</span></code> 表示 <code class="docutils literal notranslate"><span class="pre">BusinessDay</span></code> 基础上的工作时间，用于指定开始与结束工作时间。</p>
<p><code class="docutils literal notranslate"><span class="pre">BusinessHour</span></code> 默认的工作时间是 9:00 - 17:00。<code class="docutils literal notranslate"><span class="pre">BusinessHour</span></code> 加法以小时频率增加 <code class="docutils literal notranslate"><span class="pre">Timestamp</span></code> 。如果目标 <code class="docutils literal notranslate"><span class="pre">Timestamp</span></code> 超出了一小时，则要先移动到下一个工作小时，再行增加。如果超过了当日工作时间的范围，剩下的时间则添加到下一个工作日。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">200</span><span class="p">]:</span> <span class="n">bh</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">BusinessHour</span><span class="p">()</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">201</span><span class="p">]:</span> <span class="n">bh</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">201</span><span class="p">]:</span> <span class="o">&lt;</span><span class="n">BusinessHour</span><span class="p">:</span> <span class="n">BH</span><span class="o">=</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span><span class="o">-</span><span class="mi">17</span><span class="p">:</span><span class="mi">00</span><span class="o">&gt;</span>

<span class="c1"># 2014 年 8 月 1 日是星期五</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">202</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-08-01 10:00&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">weekday</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">202</span><span class="p">]:</span> <span class="mi">4</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">203</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-08-01 10:00&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">bh</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">203</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-08-01 11:00:00&#39;</span><span class="p">)</span>

<span class="c1"># 下例等同于： pd.Timestamp(&#39;2014-08-01 09:00&#39;) + bh</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">204</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-08-01 08:00&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">bh</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">204</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-08-01 10:00:00&#39;</span><span class="p">)</span>

<span class="c1"># 如果计算结果为当日下班时间，则转移到下一个工作日的上班时间</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">205</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-08-01 16:00&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">bh</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">205</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-08-04 09:00:00&#39;</span><span class="p">)</span>

<span class="c1"># 剩下的时间也会添加到下一天</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">206</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-08-01 16:30&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">bh</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">206</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-08-04 09:30:00&#39;</span><span class="p">)</span>

<span class="c1"># 添加 2 个工作小时</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">207</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-08-01 10:00&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">BusinessHour</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">207</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-08-01 12:00:00&#39;</span><span class="p">)</span>

<span class="c1"># 减掉 3 个工作小时</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">208</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-08-01 10:00&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">BusinessHour</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">208</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-07-31 15:00:00&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>还可以用关键字指定 <code class="docutils literal notranslate"><span class="pre">start</span></code> 与 <code class="docutils literal notranslate"><span class="pre">end</span></code> 时间。参数必须是<code class="docutils literal notranslate"><span class="pre">hour:minute</span></code> 格式的字符串或 <code class="docutils literal notranslate"><span class="pre">datetime.time</span></code> 实例。把秒、微秒、纳秒设置为工作时间会导致 <code class="docutils literal notranslate"><span class="pre">ValueError</span></code>。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">209</span><span class="p">]:</span> <span class="n">bh</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">BusinessHour</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="s1">&#39;11:00&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">time</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">210</span><span class="p">]:</span> <span class="n">bh</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">210</span><span class="p">]:</span> <span class="o">&lt;</span><span class="n">BusinessHour</span><span class="p">:</span> <span class="n">BH</span><span class="o">=</span><span class="mi">11</span><span class="p">:</span><span class="mi">00</span><span class="o">-</span><span class="mi">20</span><span class="p">:</span><span class="mi">00</span><span class="o">&gt;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">211</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-08-01 13:00&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">bh</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">211</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-08-01 14:00:00&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">212</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-08-01 09:00&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">bh</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">212</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-08-01 12:00:00&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">213</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-08-01 18:00&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">bh</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">213</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-08-01 19:00:00&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">start</span></code> 时间晚于 <code class="docutils literal notranslate"><span class="pre">end</span></code> 时间表示夜班工作时间。此时，工作时间将从午夜延至第二天。工作时间是否有效取决于该时间是否开始于有效的 <code class="docutils literal notranslate"><span class="pre">BusinessDay</span></code>。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">214</span><span class="p">]:</span> <span class="n">bh</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">BusinessHour</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="s1">&#39;17:00&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;09:00&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">215</span><span class="p">]:</span> <span class="n">bh</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">215</span><span class="p">]:</span> <span class="o">&lt;</span><span class="n">BusinessHour</span><span class="p">:</span> <span class="n">BH</span><span class="o">=</span><span class="mi">17</span><span class="p">:</span><span class="mi">00</span><span class="o">-</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span><span class="o">&gt;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">216</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-08-01 17:00&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">bh</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">216</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-08-01 18:00:00&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">217</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-08-01 23:00&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">bh</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">217</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-08-02 00:00:00&#39;</span><span class="p">)</span>

<span class="c1"># 虽然 2014 年 8 月 2 日是星期六，</span>
<span class="c1"># 但因为工作时间开始于星期五，因此，也是有效的</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">218</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-08-02 04:00&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">bh</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">218</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-08-02 05:00:00&#39;</span><span class="p">)</span>


<span class="c1"># 虽然 2014 年 8 月 4 日是星期一，</span>
<span class="c1"># 但开始时间是星期日，因此，超出了工作时间</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">219</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-08-04 04:00&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">bh</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">219</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-08-04 18:00:00&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">BusinessHour.rollforward</span></code> 与 <code class="docutils literal notranslate"><span class="pre">rollback</span></code> 操作将前滚至下一天的上班时间，或回滚至前一天的下班时间。与其它偏移量不同，<code class="docutils literal notranslate"><span class="pre">BusinessHour.rollforward</span></code> 输出与 <code class="docutils literal notranslate"><span class="pre">apply</span></code> 定义不同的结果。</p>
<p>这是因为一天工作时间的结束等同于第二天工作时间的开始。默认情况下，工作时间为 9:00 - 17:00，Pandas 认为 <code class="docutils literal notranslate"><span class="pre">2014-08-01</span> <span class="pre">17:00</span></code> 与 <code class="docutils literal notranslate"><span class="pre">2014-08-04</span> <span class="pre">09:00</span></code> 之间的时间间隔为 0 分钟。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 把时间戳回滚到前一天的下班时间</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">220</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">BusinessHour</span><span class="p">()</span><span class="o">.</span><span class="n">rollback</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-08-02 15:00&#39;</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">220</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-08-01 17:00:00&#39;</span><span class="p">)</span>

<span class="c1"># 把时间戳前滚到下一个工作日的上班时间</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">221</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">BusinessHour</span><span class="p">()</span><span class="o">.</span><span class="n">rollforward</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-08-02 15:00&#39;</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">221</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-08-04 09:00:00&#39;</span><span class="p">)</span>

<span class="c1"># 等同于：BusinessHour().apply(pd.Timestamp(&#39;2014-08-01 17:00&#39;))</span>
<span class="c1"># 与 BusinessHour().apply(pd.Timestamp(&#39;2014-08-04 09:00&#39;))</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">222</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">BusinessHour</span><span class="p">()</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-08-02 15:00&#39;</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">222</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-08-04 10:00:00&#39;</span><span class="p">)</span>

<span class="c1"># 工作日的结果（仅供参考）</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">223</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">BusinessHour</span><span class="p">()</span><span class="o">.</span><span class="n">rollforward</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-08-02&#39;</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">223</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-08-04 09:00:00&#39;</span><span class="p">)</span>

<span class="c1"># 等同于 BusinessDay().apply(pd.Timestamp(&#39;2014-08-01&#39;))</span>
<span class="c1"># 等同于 rollforward 因为工作日不会重叠</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">224</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">BusinessHour</span><span class="p">()</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-08-02&#39;</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">224</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-08-04 10:00:00&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">BusinessHour</span></code> 把星期六与星期日当成假日。<code class="docutils literal notranslate"><span class="pre">CustomBusinessHour</span></code> 可以把节假日设为工作时间，详见下文。</p>
</div>
<div class="section" id="id21">
<h3>自定义工作时间<a class="headerlink" href="#id21" title="永久链接至标题">¶</a></h3>
<p><em>0.18.1 版新增</em>。</p>
<p><code class="docutils literal notranslate"><span class="pre">CustomBusinessHour</span></code> 是 <code class="docutils literal notranslate"><span class="pre">BusinessHour</span></code> 和 <code class="docutils literal notranslate"><span class="pre">CustomBusinessDay</span></code> 的混合体，可以指定任意节假日。除了跳过自定义节假日之外，<code class="docutils literal notranslate"><span class="pre">CustomBusinessHour</span></code> 的运作方式与 <code class="docutils literal notranslate"><span class="pre">BusinessHour</span></code> 一样。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">225</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">pandas.tseries.holiday</span> <span class="kn">import</span> <span class="n">USFederalHolidayCalendar</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">226</span><span class="p">]:</span> <span class="n">bhour_us</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">CustomBusinessHour</span><span class="p">(</span><span class="n">calendar</span><span class="o">=</span><span class="n">USFederalHolidayCalendar</span><span class="p">())</span>

<span class="c1"># 马丁路德金纪念日之前的星期五</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">227</span><span class="p">]:</span> <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2014</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">228</span><span class="p">]:</span> <span class="n">dt</span> <span class="o">+</span> <span class="n">bhour_us</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">228</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-01-17 16:00:00&#39;</span><span class="p">)</span>

<span class="c1"># 跳至马丁路德金纪念日之后的星期二，星期一过节，所以跳过了</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">229</span><span class="p">]:</span> <span class="n">dt</span> <span class="o">+</span> <span class="n">bhour_us</span> <span class="o">*</span> <span class="mi">2</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">229</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-01-21 09:00:00&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">BusinessHour</span></code> 支持与 <code class="docutils literal notranslate"><span class="pre">CustomBusinessDay</span></code> 一样的关键字参数。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">230</span><span class="p">]:</span> <span class="n">bhour_mon</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">CustomBusinessHour</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="s1">&#39;10:00&#39;</span><span class="p">,</span>
   <span class="o">.....</span><span class="p">:</span>                                           <span class="n">weekmask</span><span class="o">=</span><span class="s1">&#39;Tue Wed Thu Fri&#39;</span><span class="p">)</span>
   <span class="o">.....</span><span class="p">:</span> 

<span class="c1"># 跳过了星期一，因为星期一过节，工作时间从 10 点开始</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">231</span><span class="p">]:</span> <span class="n">dt</span> <span class="o">+</span> <span class="n">bhour_mon</span> <span class="o">*</span> <span class="mi">2</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">231</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-01-21 10:00:00&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id22">
<h3>偏移量别名<a class="headerlink" href="#id22" title="永久链接至标题">¶</a></h3>
<p>时间序列频率的字符串别名在这里叫<strong>偏移量别名</strong>。</p>
<table border="1" class="docutils">
<thead>
<tr>
<th align="center">别名</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">B</td>
<td align="left">工作日频率</td>
</tr>
<tr>
<td align="center">C</td>
<td align="left">自定义工作日频率</td>
</tr>
<tr>
<td align="center">D</td>
<td align="left">日历日频率</td>
</tr>
<tr>
<td align="center">W</td>
<td align="left">周频率</td>
</tr>
<tr>
<td align="center">M</td>
<td align="left">月末频率</td>
</tr>
<tr>
<td align="center">SM</td>
<td align="left">半月末频率（15 号与月末）</td>
</tr>
<tr>
<td align="center">BM</td>
<td align="left">工作日月末频率</td>
</tr>
<tr>
<td align="center">CBM</td>
<td align="left">自定义工作日月末频率</td>
</tr>
<tr>
<td align="center">MS</td>
<td align="left">月初频率</td>
</tr>
<tr>
<td align="center">SMS</td>
<td align="left">半月初频率（1 号与 15 号）</td>
</tr>
<tr>
<td align="center">BMS</td>
<td align="left">工作日月初频率</td>
</tr>
<tr>
<td align="center">CBMS</td>
<td align="left">自定义工作日月初频率</td>
</tr>
<tr>
<td align="center">Q</td>
<td align="left">季末频率</td>
</tr>
<tr>
<td align="center">BQ</td>
<td align="left">工作日季末频率</td>
</tr>
<tr>
<td align="center">QS</td>
<td align="left">季初频率</td>
</tr>
<tr>
<td align="center">BQS</td>
<td align="left">工作日季初频率</td>
</tr>
<tr>
<td align="center">A, Y</td>
<td align="left">年末频率</td>
</tr>
<tr>
<td align="center">BA, BY</td>
<td align="left">工作日年末频率</td>
</tr>
<tr>
<td align="center">AS, YS</td>
<td align="left">年初频率</td>
</tr>
<tr>
<td align="center">BAS, BYS</td>
<td align="left">工作日年初频率</td>
</tr>
<tr>
<td align="center">BH</td>
<td align="left">工作时间频率</td>
</tr>
<tr>
<td align="center">H</td>
<td align="left">小时频率</td>
</tr>
<tr>
<td align="center">T, min</td>
<td align="left">分钟频率</td>
</tr>
<tr>
<td align="center">S</td>
<td align="left">秒频率</td>
</tr>
<tr>
<td align="center">L, ms</td>
<td align="left">毫秒</td>
</tr>
<tr>
<td align="center">U, us</td>
<td align="left">微秒</td>
</tr>
<tr>
<td align="center">N</td>
<td align="left">纳秒</td>
</tr>
</tbody>
</table></div>
<div class="section" id="id23">
<h3>别名组合<a class="headerlink" href="#id23" title="永久链接至标题">¶</a></h3>
<p>如前说述，别名与偏移量实例在绝大多数函数里可以互换：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">232</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;B&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">232</span><span class="p">]:</span> 
<span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2011-01-03&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-01-04&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-01-05&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-01-06&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2011-01-07&#39;</span><span class="p">],</span>
              <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;B&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">233</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">BDay</span><span class="p">())</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">233</span><span class="p">]:</span> 
<span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2011-01-03&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-01-04&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-01-05&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-01-06&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2011-01-07&#39;</span><span class="p">],</span>
              <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;B&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>可以组合日与当日偏移量。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">234</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;2h20min&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">234</span><span class="p">]:</span> 
<span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2011-01-01 00:00:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-01-01 02:20:00&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2011-01-01 04:40:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-01-01 07:00:00&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2011-01-01 09:20:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-01-01 11:40:00&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2011-01-01 14:00:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-01-01 16:20:00&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2011-01-01 18:40:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-01-01 21:00:00&#39;</span><span class="p">],</span>
              <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;140T&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">235</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;1D10U&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">235</span><span class="p">]:</span> 
<span class="n">DatetimeIndex</span><span class="p">([</span>       <span class="s1">&#39;2011-01-01 00:00:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-01-02 00:00:00.000010&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2011-01-03 00:00:00.000020&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-01-04 00:00:00.000030&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2011-01-05 00:00:00.000040&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-01-06 00:00:00.000050&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2011-01-07 00:00:00.000060&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-01-08 00:00:00.000070&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2011-01-09 00:00:00.000080&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-01-10 00:00:00.000090&#39;</span><span class="p">],</span>
              <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;86400000010U&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id24">
<h3>锚定偏移量<a class="headerlink" href="#id24" title="永久链接至标题">¶</a></h3>
<p>可以指定某些频率的锚定后缀：</p>
<table border="1" class="docutils">
<thead>
<tr>
<th align="center">别名</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">W-SUN</td>
<td align="left">周频率（星期日），与 “W” 相同</td>
</tr>
<tr>
<td align="center">W-MON</td>
<td align="left">周频率（星期一）</td>
</tr>
<tr>
<td align="center">W-TUE</td>
<td align="left">周频率（星期二）</td>
</tr>
<tr>
<td align="center">W-WED</td>
<td align="left">周频率（星期三）</td>
</tr>
<tr>
<td align="center">W-THU</td>
<td align="left">周频率（星期四）</td>
</tr>
<tr>
<td align="center">W-FRI</td>
<td align="left">周频率（星期五）</td>
</tr>
<tr>
<td align="center">W-SAT</td>
<td align="left">周频率（星期六）</td>
</tr>
<tr>
<td align="center">(B)Q(S)-DEC</td>
<td align="left">季频率，该年结束于十二月，与 “Q” 相同</td>
</tr>
<tr>
<td align="center">(B)Q(S)-JAN</td>
<td align="left">季频率，该年结束于一月</td>
</tr>
<tr>
<td align="center">(B)Q(S)-FEB</td>
<td align="left">季频率，该年结束于二月</td>
</tr>
<tr>
<td align="center">(B)Q(S)-MAR</td>
<td align="left">季频率，该年结束于三月</td>
</tr>
<tr>
<td align="center">(B)Q(S)-APR</td>
<td align="left">季频率，该年结束于四月</td>
</tr>
<tr>
<td align="center">(B)Q(S)-MAY</td>
<td align="left">季频率，该年结束于五月</td>
</tr>
<tr>
<td align="center">(B)Q(S)-JUN</td>
<td align="left">季频率，该年结束于六月</td>
</tr>
<tr>
<td align="center">(B)Q(S)-JUL</td>
<td align="left">季频率，该年结束于七月</td>
</tr>
<tr>
<td align="center">(B)Q(S)-AUG</td>
<td align="left">季频率，该年结束于八月</td>
</tr>
<tr>
<td align="center">(B)Q(S)-SEP</td>
<td align="left">季频率，该年结束于九月</td>
</tr>
<tr>
<td align="center">(B)Q(S)-OCT</td>
<td align="left">季频率，该年结束于十月</td>
</tr>
<tr>
<td align="center">(B)Q(S)-NOV</td>
<td align="left">季频率，该年结束于十一月</td>
</tr>
<tr>
<td align="center">(B)A(S)-DEC</td>
<td align="left">年频率，锚定结束于十二月，与 “A” 相同</td>
</tr>
<tr>
<td align="center">(B)A(S)-JAN</td>
<td align="left">年频率，锚定结束于一月</td>
</tr>
<tr>
<td align="center">(B)A(S)-FEB</td>
<td align="left">年频率，锚定结束于二月</td>
</tr>
<tr>
<td align="center">(B)A(S)-MAR</td>
<td align="left">年频率，锚定结束于三月</td>
</tr>
<tr>
<td align="center">(B)A(S)-APR</td>
<td align="left">年频率，锚定结束于四月</td>
</tr>
<tr>
<td align="center">(B)A(S)-MAY</td>
<td align="left">年频率，锚定结束于五月</td>
</tr>
<tr>
<td align="center">(B)A(S)-JUN</td>
<td align="left">年频率，锚定结束于六月</td>
</tr>
<tr>
<td align="center">(B)A(S)-JUL</td>
<td align="left">年频率，锚定结束于七月</td>
</tr>
<tr>
<td align="center">(B)A(S)-AUG</td>
<td align="left">年频率，锚定结束于八月</td>
</tr>
<tr>
<td align="center">(B)A(S)-SEP</td>
<td align="left">年频率，锚定结束于九月</td>
</tr>
<tr>
<td align="center">(B)A(S)-OCT</td>
<td align="left">年频率，锚定结束于十月</td>
</tr>
<tr>
<td align="center">(B)A(S)-NOV</td>
<td align="left">年频率，锚定结束于十一月</td>
</tr>
</tbody>
</table><p>这些别名可以用作 <code class="docutils literal notranslate"><span class="pre">date_range</span></code>、<code class="docutils literal notranslate"><span class="pre">bdate_range</span></code> 、<code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code> 及其它时间序列函数的参数。</p>
</div>
<div class="section" id="id25">
<h3>锚定偏移量的含义<a class="headerlink" href="#id25" title="永久链接至标题">¶</a></h3>
<p>对于偏移量锚定于开始或结束指定频率（<code class="docutils literal notranslate"><span class="pre">MonthEnd</span></code>、<code class="docutils literal notranslate"><span class="pre">MonthBegin</span></code>、<code class="docutils literal notranslate"><span class="pre">WeekEnd</span></code> 等）下列规则应用于前滚与后滚。</p>
<p><code class="docutils literal notranslate"><span class="pre">n</span></code> 不为 0 时，如果给定日期不是锚定日期，将寻找下一个或上一个锚点，并向前或向后移动 <code class="docutils literal notranslate"><span class="pre">|n|-1</span> </code> 步。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">236</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-01-02&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">MonthBegin</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">236</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-02-01 00:00:00&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">237</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-01-02&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">MonthEnd</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">237</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-01-31 00:00:00&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">238</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-01-02&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">MonthBegin</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">238</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-01-01 00:00:00&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">239</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-01-02&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">MonthEnd</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">239</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2013-12-31 00:00:00&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">240</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-01-02&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">MonthBegin</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">240</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-05-01 00:00:00&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">241</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-01-02&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">MonthBegin</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">241</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2013-10-01 00:00:00&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>如果给定日期是锚定日期，则向前（或向后）移动 <code class="docutils literal notranslate"><span class="pre">|n|</span></code> 个点。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">242</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-01-01&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">MonthBegin</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">242</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-02-01 00:00:00&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">243</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-01-31&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">MonthEnd</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">243</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-02-28 00:00:00&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">244</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-01-01&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">MonthBegin</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">244</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2013-12-01 00:00:00&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">245</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-01-31&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">MonthEnd</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">245</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2013-12-31 00:00:00&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">246</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-01-01&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">MonthBegin</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">246</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-05-01 00:00:00&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">247</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-01-31&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">MonthBegin</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">247</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2013-10-01 00:00:00&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">n=0</span></code> 时，如果日期在锚点，则不移动，否则将前滚至下一个锚点。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">248</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-01-02&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">MonthBegin</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">248</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-02-01 00:00:00&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">249</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-01-02&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">MonthEnd</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">249</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-01-31 00:00:00&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">250</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-01-01&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">MonthBegin</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">250</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-01-01 00:00:00&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">251</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-01-31&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">MonthEnd</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">251</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-01-31 00:00:00&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id26">
<h3>假日与节日日历<a class="headerlink" href="#id26" title="永久链接至标题">¶</a></h3>
<p>用假日与日历可以轻松定义 <code class="docutils literal notranslate"><span class="pre">CustomBusinessDay</span></code> 假日规则，或其它分析所需的预设假日。<code class="docutils literal notranslate"><span class="pre">AbstractHolidayCalendar</span></code> 类支持所有返回假日列表的方法，并且仅需在指定假日日历类里定义 <code class="docutils literal notranslate"><span class="pre">rules</span></code> 。<code class="docutils literal notranslate"><span class="pre">start_date</span></code> 与 <code class="docutils literal notranslate"><span class="pre">end_date</span></code> 类属性决定了假日的范围。该操作会覆盖 <code class="docutils literal notranslate"><span class="pre">AbstractHolidayCalendar</span></code> 类，适用于所有日历子类。<code class="docutils literal notranslate"><span class="pre">USFederalHolidayCalendar</span></code> 是仅有的假日日历，主要用作开发其它日历的示例。</p>
<p>固定日期的假日，如美国阵亡将士纪念日或美国国庆日（7 月 4 日），取决于该假日是否是在周末，可以使用以下规则：</p>
<table border="1" class="docutils">
<thead>
<tr>
<th align="center">规则</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">nearest_workday</td>
<td align="center">把星期六移至星期五，星期日移至星期一</td>
</tr>
<tr>
<td align="center">sunday_to_monday</td>
<td align="center">星期六紧接着星期一</td>
</tr>
<tr>
<td align="center">next_monday_or_tuesday</td>
<td align="center">把星期六移至星期一，并把星期日/星期一移至星期二</td>
</tr>
<tr>
<td align="center">previous_friday</td>
<td align="center">把星期六与星期日移至上一个星期五</td>
</tr>
<tr>
<td align="center">next_monday</td>
<td align="center">把星期六与星期日移至下一个星期一</td>
</tr>
</tbody>
</table><p>下例展示如何定义假日与假日日历：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">252</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">pandas.tseries.holiday</span> <span class="kn">import</span> <span class="n">Holiday</span><span class="p">,</span> <span class="n">USMemorialDay</span><span class="p">,</span>\
   <span class="o">.....</span><span class="p">:</span>     <span class="n">AbstractHolidayCalendar</span><span class="p">,</span> <span class="n">nearest_workday</span><span class="p">,</span> <span class="n">MO</span>
   <span class="o">.....</span><span class="p">:</span> 

<span class="n">In</span> <span class="p">[</span><span class="mi">253</span><span class="p">]:</span> <span class="k">class</span> <span class="nc">ExampleCalendar</span><span class="p">(</span><span class="n">AbstractHolidayCalendar</span><span class="p">):</span>
   <span class="o">.....</span><span class="p">:</span>     <span class="n">rules</span> <span class="o">=</span> <span class="p">[</span>
   <span class="o">.....</span><span class="p">:</span>         <span class="n">USMemorialDay</span><span class="p">,</span>
   <span class="o">.....</span><span class="p">:</span>         <span class="n">Holiday</span><span class="p">(</span><span class="s1">&#39;July 4th&#39;</span><span class="p">,</span> <span class="n">month</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">observance</span><span class="o">=</span><span class="n">nearest_workday</span><span class="p">),</span>
   <span class="o">.....</span><span class="p">:</span>         <span class="n">Holiday</span><span class="p">(</span><span class="s1">&#39;Columbus Day&#39;</span><span class="p">,</span> <span class="n">month</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
   <span class="o">.....</span><span class="p">:</span>                 <span class="n">offset</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">weekday</span><span class="o">=</span><span class="n">MO</span><span class="p">(</span><span class="mi">2</span><span class="p">)))]</span>
   <span class="o">.....</span><span class="p">:</span> 

<span class="n">In</span> <span class="p">[</span><span class="mi">254</span><span class="p">]:</span> <span class="n">cal</span> <span class="o">=</span> <span class="n">ExampleCalendar</span><span class="p">()</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">255</span><span class="p">]:</span> <span class="n">cal</span><span class="o">.</span><span class="n">holidays</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">255</span><span class="p">]:</span> <span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2012-05-28&#39;</span><span class="p">,</span> <span class="s1">&#39;2012-07-04&#39;</span><span class="p">,</span> <span class="s1">&#39;2012-10-08&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<p>::: tip 提示</p>
<p><code class="docutils literal notranslate"><span class="pre">weekday=MO(2)</span></code> 与 <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">*</span> <span class="pre">Week(weekday=2)</span></code> 相同。</p>
<p>:::</p>
<p>用这个日历创建索引，或计算偏移量，将跳过周末与假日（如，纪念日与国庆节）。下列代码用 <code class="docutils literal notranslate"><span class="pre">ExampleCalendar</span></code> 设定自定义工作日偏移量。至于其它偏移量，可以用于创建 <code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code> 或添加到 <code class="docutils literal notranslate"><span class="pre">datetime</span></code> 与 <code class="docutils literal notranslate"><span class="pre">Timestamp</span></code> 对象。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">256</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="s1">&#39;7/1/2012&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;7/10/2012&#39;</span><span class="p">,</span>
   <span class="o">.....</span><span class="p">:</span>               <span class="n">freq</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">CDay</span><span class="p">(</span><span class="n">calendar</span><span class="o">=</span><span class="n">cal</span><span class="p">))</span><span class="o">.</span><span class="n">to_pydatetime</span><span class="p">()</span>
   <span class="o">.....</span><span class="p">:</span> 
<span class="n">Out</span><span class="p">[</span><span class="mi">256</span><span class="p">]:</span> 
<span class="n">array</span><span class="p">([</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
       <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
       <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
       <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
       <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
       <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">257</span><span class="p">]:</span> <span class="n">offset</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">CustomBusinessDay</span><span class="p">(</span><span class="n">calendar</span><span class="o">=</span><span class="n">cal</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">258</span><span class="p">]:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span> <span class="o">+</span> <span class="n">offset</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">258</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2012-05-29 00:00:00&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">259</span><span class="p">]:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">offset</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">259</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2012-07-05 00:00:00&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">260</span><span class="p">]:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">offset</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">260</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2012-07-06 00:00:00&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">261</span><span class="p">]:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">+</span> <span class="n">offset</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">261</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2012-07-09 00:00:00&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">AbstractHolidayCalendar</span></code> 的类属性 <code class="docutils literal notranslate"><span class="pre">start_date</span></code> 与 <code class="docutils literal notranslate"><span class="pre">end_date</span></code> 定义日期范围。默认值如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">262</span><span class="p">]:</span> <span class="n">AbstractHolidayCalendar</span><span class="o">.</span><span class="n">start_date</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">262</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;1970-01-01 00:00:00&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">263</span><span class="p">]:</span> <span class="n">AbstractHolidayCalendar</span><span class="o">.</span><span class="n">end_date</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">263</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2030-12-31 00:00:00&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>这两个日期可以用 <code class="docutils literal notranslate"><span class="pre">datetime</span></code>、<code class="docutils literal notranslate"><span class="pre">Timestamp</span></code>、<code class="docutils literal notranslate"><span class="pre">字符串</span></code> 修改。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">264</span><span class="p">]:</span> <span class="n">AbstractHolidayCalendar</span><span class="o">.</span><span class="n">start_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">265</span><span class="p">]:</span> <span class="n">AbstractHolidayCalendar</span><span class="o">.</span><span class="n">end_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">266</span><span class="p">]:</span> <span class="n">cal</span><span class="o">.</span><span class="n">holidays</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">266</span><span class="p">]:</span> <span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2012-05-28&#39;</span><span class="p">,</span> <span class="s1">&#39;2012-07-04&#39;</span><span class="p">,</span> <span class="s1">&#39;2012-10-08&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">get_calender</span></code> 函数通过日历名称访问日历，返回的是日历实例。任意导入的日历都自动适用于此函数。同时，<code class="docutils literal notranslate"><span class="pre">HolidayCalendarFactory</span></code> 还提供了一个创建日历组合或含附加规则日历的简易接口。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">267</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">pandas.tseries.holiday</span> <span class="kn">import</span> <span class="n">get_calendar</span><span class="p">,</span> <span class="n">HolidayCalendarFactory</span><span class="p">,</span>\
   <span class="o">.....</span><span class="p">:</span>     <span class="n">USLaborDay</span>
   <span class="o">.....</span><span class="p">:</span> 

<span class="n">In</span> <span class="p">[</span><span class="mi">268</span><span class="p">]:</span> <span class="n">cal</span> <span class="o">=</span> <span class="n">get_calendar</span><span class="p">(</span><span class="s1">&#39;ExampleCalendar&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">269</span><span class="p">]:</span> <span class="n">cal</span><span class="o">.</span><span class="n">rules</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">269</span><span class="p">]:</span> 
<span class="p">[</span><span class="n">Holiday</span><span class="p">:</span> <span class="n">Memorial</span> <span class="n">Day</span> <span class="p">(</span><span class="n">month</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="mi">31</span><span class="p">,</span> <span class="n">offset</span><span class="o">=&lt;</span><span class="n">DateOffset</span><span class="p">:</span> <span class="n">weekday</span><span class="o">=</span><span class="n">MO</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">&gt;</span><span class="p">),</span>
 <span class="n">Holiday</span><span class="p">:</span> <span class="n">July</span> <span class="mi">4</span><span class="n">th</span> <span class="p">(</span><span class="n">month</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">observance</span><span class="o">=&lt;</span><span class="n">function</span> <span class="n">nearest_workday</span> <span class="n">at</span> <span class="mh">0x7f2460862c20</span><span class="o">&gt;</span><span class="p">),</span>
 <span class="n">Holiday</span><span class="p">:</span> <span class="n">Columbus</span> <span class="n">Day</span> <span class="p">(</span><span class="n">month</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">offset</span><span class="o">=&lt;</span><span class="n">DateOffset</span><span class="p">:</span> <span class="n">weekday</span><span class="o">=</span><span class="n">MO</span><span class="p">(</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">&gt;</span><span class="p">)]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">270</span><span class="p">]:</span> <span class="n">new_cal</span> <span class="o">=</span> <span class="n">HolidayCalendarFactory</span><span class="p">(</span><span class="s1">&#39;NewExampleCalendar&#39;</span><span class="p">,</span> <span class="n">cal</span><span class="p">,</span> <span class="n">USLaborDay</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">271</span><span class="p">]:</span> <span class="n">new_cal</span><span class="o">.</span><span class="n">rules</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">271</span><span class="p">]:</span> 
<span class="p">[</span><span class="n">Holiday</span><span class="p">:</span> <span class="n">Labor</span> <span class="n">Day</span> <span class="p">(</span><span class="n">month</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">offset</span><span class="o">=&lt;</span><span class="n">DateOffset</span><span class="p">:</span> <span class="n">weekday</span><span class="o">=</span><span class="n">MO</span><span class="p">(</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">&gt;</span><span class="p">),</span>
 <span class="n">Holiday</span><span class="p">:</span> <span class="n">Memorial</span> <span class="n">Day</span> <span class="p">(</span><span class="n">month</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="mi">31</span><span class="p">,</span> <span class="n">offset</span><span class="o">=&lt;</span><span class="n">DateOffset</span><span class="p">:</span> <span class="n">weekday</span><span class="o">=</span><span class="n">MO</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">&gt;</span><span class="p">),</span>
 <span class="n">Holiday</span><span class="p">:</span> <span class="n">July</span> <span class="mi">4</span><span class="n">th</span> <span class="p">(</span><span class="n">month</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">observance</span><span class="o">=&lt;</span><span class="n">function</span> <span class="n">nearest_workday</span> <span class="n">at</span> <span class="mh">0x7f2460862c20</span><span class="o">&gt;</span><span class="p">),</span>
 <span class="n">Holiday</span><span class="p">:</span> <span class="n">Columbus</span> <span class="n">Day</span> <span class="p">(</span><span class="n">month</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">offset</span><span class="o">=&lt;</span><span class="n">DateOffset</span><span class="p">:</span> <span class="n">weekday</span><span class="o">=</span><span class="n">MO</span><span class="p">(</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">&gt;</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id27">
<h2><span class="section-number">6.9. </span>时间序列实例方法<a class="headerlink" href="#id27" title="永久链接至标题">¶</a></h2>
<div class="section" id="id28">
<h3>移位与延迟<a class="headerlink" href="#id28" title="永久链接至标题">¶</a></h3>
<p>有时，需要整体向前或向后移动时间序列里的值，这就是移位与延迟。实现这一操作的方法是 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.shift.html#pandas.Series.shift"><code class="docutils literal notranslate"><span class="pre">shift()</span></code></a>，该方法适用于所有 Pandas 对象。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">272</span><span class="p">]:</span> <span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rng</span><span class="p">)),</span> <span class="n">index</span><span class="o">=</span><span class="n">rng</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">273</span><span class="p">]:</span> <span class="n">ts</span> <span class="o">=</span> <span class="n">ts</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">274</span><span class="p">]:</span> <span class="n">ts</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">274</span><span class="p">]:</span> 
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span>    <span class="n">NaN</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span>    <span class="mf">0.0</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span>    <span class="mf">1.0</span>
<span class="n">Freq</span><span class="p">:</span> <span class="n">D</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">shift</span></code> 方法支持 <code class="docutils literal notranslate"><span class="pre">freq</span></code> 参数，可以把 <code class="docutils literal notranslate"><span class="pre">DateOffset</span></code>、<code class="docutils literal notranslate"><span class="pre">timedelta</span></code> 对象、<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#timeseries-offset-aliases"><code class="docutils literal notranslate"><span class="pre">偏移量别名</span></code></a> 作为参数值：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">275</span><span class="p">]:</span> <span class="n">ts</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">BDay</span><span class="p">())</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">275</span><span class="p">]:</span> 
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">06</span>    <span class="mi">0</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">09</span>    <span class="mi">1</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>    <span class="mi">2</span>
<span class="n">Freq</span><span class="p">:</span> <span class="n">B</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">276</span><span class="p">]:</span> <span class="n">ts</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;BM&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">276</span><span class="p">]:</span> 
<span class="mi">2012</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">31</span>    <span class="mi">0</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">31</span>    <span class="mi">1</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">31</span>    <span class="mi">2</span>
<span class="n">Freq</span><span class="p">:</span> <span class="n">D</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>
</pre></div>
</div>
<p>除更改数据与索引的对齐方式外，<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 与 <code class="docutils literal notranslate"><span class="pre">Series</span></code> 对象还提供了 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.tshift.html#pandas.Series.tshift"><code class="docutils literal notranslate"><span class="pre">tshift()</span></code></a> 便捷方法，可以指定偏移量修改索引日期。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">277</span><span class="p">]:</span> <span class="n">ts</span><span class="o">.</span><span class="n">tshift</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">277</span><span class="p">]:</span> 
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">06</span>    <span class="mi">0</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">07</span>    <span class="mi">1</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span>    <span class="mi">2</span>
<span class="n">Freq</span><span class="p">:</span> <span class="n">D</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>
</pre></div>
</div>
<p>注意，使用 <code class="docutils literal notranslate"><span class="pre">tshift()</span></code> 时，因为数据没有重对齐，<code class="docutils literal notranslate"><span class="pre">NaN</span></code> 不会排在前面。</p>
</div>
<div class="section" id="id29">
<h3>频率转换<a class="headerlink" href="#id29" title="永久链接至标题">¶</a></h3>
<p>改变频率的函数主要是 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.asfreq.html#pandas.Series.asfreq"><code class="docutils literal notranslate"><span class="pre">asfreq()</span></code></a>。对于 <code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code>，这就是一个调用 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.reindex.html#pandas.Series.reindex"><code class="docutils literal notranslate"><span class="pre">reindex()</span></code></a>，并生成 <code class="docutils literal notranslate"><span class="pre">date_range</span></code> 的便捷打包器。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">278</span><span class="p">]:</span> <span class="n">dr</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;1/1/2010&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="mi">3</span> <span class="o">*</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">BDay</span><span class="p">())</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">279</span><span class="p">]:</span> <span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">dr</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">280</span><span class="p">]:</span> <span class="n">ts</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">280</span><span class="p">]:</span> 
<span class="mi">2010</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span>    <span class="mf">1.494522</span>
<span class="mi">2010</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">06</span>   <span class="o">-</span><span class="mf">0.778425</span>
<span class="mi">2010</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">11</span>   <span class="o">-</span><span class="mf">0.253355</span>
<span class="n">Freq</span><span class="p">:</span> <span class="mi">3</span><span class="n">B</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">281</span><span class="p">]:</span> <span class="n">ts</span><span class="o">.</span><span class="n">asfreq</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">BDay</span><span class="p">())</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">281</span><span class="p">]:</span> 
<span class="mi">2010</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span>    <span class="mf">1.494522</span>
<span class="mi">2010</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">04</span>         <span class="n">NaN</span>
<span class="mi">2010</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">05</span>         <span class="n">NaN</span>
<span class="mi">2010</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">06</span>   <span class="o">-</span><span class="mf">0.778425</span>
<span class="mi">2010</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">07</span>         <span class="n">NaN</span>
<span class="mi">2010</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span>         <span class="n">NaN</span>
<span class="mi">2010</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">11</span>   <span class="o">-</span><span class="mf">0.253355</span>
<span class="n">Freq</span><span class="p">:</span> <span class="n">B</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">asfreq</span></code> 用起来很方便，可以为频率转化后出现的任意间隔指定插值方法。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">282</span><span class="p">]:</span> <span class="n">ts</span><span class="o">.</span><span class="n">asfreq</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">BDay</span><span class="p">(),</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;pad&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">282</span><span class="p">]:</span> 
<span class="mi">2010</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span>    <span class="mf">1.494522</span>
<span class="mi">2010</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">04</span>    <span class="mf">1.494522</span>
<span class="mi">2010</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">05</span>    <span class="mf">1.494522</span>
<span class="mi">2010</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">06</span>   <span class="o">-</span><span class="mf">0.778425</span>
<span class="mi">2010</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">07</span>   <span class="o">-</span><span class="mf">0.778425</span>
<span class="mi">2010</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span>   <span class="o">-</span><span class="mf">0.778425</span>
<span class="mi">2010</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">11</span>   <span class="o">-</span><span class="mf">0.253355</span>
<span class="n">Freq</span><span class="p">:</span> <span class="n">B</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</pre></div>
</div>
</div>
<div class="section" id="id30">
<h3>向前与向后填充<a class="headerlink" href="#id30" title="永久链接至标题">¶</a></h3>
<p>与 <code class="docutils literal notranslate"><span class="pre">asfreq</span></code> 与 <code class="docutils literal notranslate"><span class="pre">reindex</span></code> 相关的是 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.fillna.html#pandas.Series.fillna"><code class="docutils literal notranslate"><span class="pre">fillna()</span></code></a>，有关文档请参阅<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/missing_data.html#missing-data-fillna">缺失值</a>。</p>
</div>
<div class="section" id="python">
<h3>转换 Python 日期与时间<a class="headerlink" href="#python" title="永久链接至标题">¶</a></h3>
<p>用 <code class="docutils literal notranslate"><span class="pre">to_datetime</span></code> 方法可以把<code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code> 转换为 Python 原生 <a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime"><code class="docutils literal notranslate"><span class="pre">datetime.datetime</span></code></a> 对象数组。</p>
</div>
</div>
<div class="section" id="id31">
<h2><span class="section-number">6.10. </span>重采样<a class="headerlink" href="#id31" title="永久链接至标题">¶</a></h2>
<p>::: danger 警告</p>
<p>0.18.0 版修改了 <code class="docutils literal notranslate"><span class="pre">.resample</span></code> 接口，现在的 <code class="docutils literal notranslate"><span class="pre">.resample</span></code> 更灵活，更像 groupby。参阅<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/whatsnew/v0.18.0.html#whatsnew-0180-breaking-resample">更新文档</a> ，对比新旧版本操作的区别。</p>
<p>:::</p>
<p>Pandas 有一个虽然简单，但却强大、高效的功能，可在频率转换时执行重采样，如，将秒数据转换为 5 分钟数据，这种操作在金融等领域里的应用非常广泛。</p>
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.resample.html#pandas.Series.resample"><code class="docutils literal notranslate"><span class="pre">resample()</span></code></a> 是基于时间的分组操作，每个组都遵循归纳方法。参阅 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/cookbook.html#cookbook-resample">Cookbook 示例</a>了解高级应用。</p>
<p>从 0.18.0 版开始，<code class="docutils literal notranslate"><span class="pre">resample()</span></code> 可以直接用于 <code class="docutils literal notranslate"><span class="pre">DataFrameGroupBy</span></code> 对象，参阅 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/groupby.html#groupby-transform-window-resample">groupby 文档</a>。</p>
<p>::: tip 注意</p>
<p><code class="docutils literal notranslate"><span class="pre">.resample()</span></code> 类似于基于时间偏移量的 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.rolling.html#pandas.Series.rolling"><code class="docutils literal notranslate"><span class="pre">rolling()</span></code></a> 操作，请参阅<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/computation.html#stats-moments-ts-versus-resampling">这里</a>的讨论。</p>
<p>:::</p>
<div class="section" id="id32">
<h3>基础知识<a class="headerlink" href="#id32" title="永久链接至标题">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">283</span><span class="p">]:</span> <span class="n">rng</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;1/1/2012&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;S&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">284</span><span class="p">]:</span> <span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">rng</span><span class="p">)),</span> <span class="n">index</span><span class="o">=</span><span class="n">rng</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">285</span><span class="p">]:</span> <span class="n">ts</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;5Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">285</span><span class="p">]:</span> 
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span>    <span class="mi">25103</span>
<span class="n">Freq</span><span class="p">:</span> <span class="mi">5</span><span class="n">T</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">resample</span></code> 函数非常灵活，可以指定多种频率转换与重采样参数。</p>
<p>任何支持<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/groupby.html#groupby-dispatch">派送（dispatch）</a>的函数都可用于 <code class="docutils literal notranslate"><span class="pre">resample</span></code> 返回对象，包括 <code class="docutils literal notranslate"><span class="pre">sum</span></code>、<code class="docutils literal notranslate"><span class="pre">mean</span></code>、<code class="docutils literal notranslate"><span class="pre">std</span></code>、<code class="docutils literal notranslate"><span class="pre">sem</span></code>、<code class="docutils literal notranslate"><span class="pre">max</span></code>、<code class="docutils literal notranslate"><span class="pre">min</span></code>、<code class="docutils literal notranslate"><span class="pre">mid</span></code>、<code class="docutils literal notranslate"><span class="pre">median</span></code>、<code class="docutils literal notranslate"><span class="pre">first</span></code>、<code class="docutils literal notranslate"><span class="pre">last</span></code>、<code class="docutils literal notranslate"><span class="pre">ohlc</span></code>：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">286</span><span class="p">]:</span> <span class="n">ts</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;5Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">286</span><span class="p">]:</span> 
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span>    <span class="mf">251.03</span>
<span class="n">Freq</span><span class="p">:</span> <span class="mi">5</span><span class="n">T</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">287</span><span class="p">]:</span> <span class="n">ts</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;5Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">ohlc</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">287</span><span class="p">]:</span> 
            <span class="nb">open</span>  <span class="n">high</span>  <span class="n">low</span>  <span class="n">close</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span>   <span class="mi">308</span>   <span class="mi">460</span>    <span class="mi">9</span>    <span class="mi">205</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">288</span><span class="p">]:</span> <span class="n">ts</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;5Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">288</span><span class="p">]:</span> 
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span>    <span class="mi">460</span>
<span class="n">Freq</span><span class="p">:</span> <span class="mi">5</span><span class="n">T</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>
</pre></div>
</div>
<p>对于下采样，<code class="docutils literal notranslate"><span class="pre">closed</span></code> 可以设置为<code class="docutils literal notranslate"><span class="pre">left</span></code> 或 <code class="docutils literal notranslate"><span class="pre">right</span></code>，用于指定关闭哪一端间隔：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">289</span><span class="p">]:</span> <span class="n">ts</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;5Min&#39;</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">289</span><span class="p">]:</span> 
<span class="mi">2011</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">31</span> <span class="mi">23</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="mi">00</span>    <span class="mf">308.000000</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>    <span class="mf">250.454545</span>
<span class="n">Freq</span><span class="p">:</span> <span class="mi">5</span><span class="n">T</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">290</span><span class="p">]:</span> <span class="n">ts</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;5Min&#39;</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">290</span><span class="p">]:</span> 
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span>    <span class="mf">251.03</span>
<span class="n">Freq</span><span class="p">:</span> <span class="mi">5</span><span class="n">T</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">label</span></code>、<code class="docutils literal notranslate"><span class="pre">loffset</span></code> 等参数用于生成标签。<code class="docutils literal notranslate"><span class="pre">label</span></code> 指定生成的结果是否要为间隔标注起始时间。<code class="docutils literal notranslate"><span class="pre">loffset</span></code> 调整输出标签的时间。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">291</span><span class="p">]:</span> <span class="n">ts</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;5Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>  <span class="c1"># 默认为 label=&#39;left&#39;</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">291</span><span class="p">]:</span> 
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span>    <span class="mf">251.03</span>
<span class="n">Freq</span><span class="p">:</span> <span class="mi">5</span><span class="n">T</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">292</span><span class="p">]:</span> <span class="n">ts</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;5Min&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">292</span><span class="p">]:</span> 
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span>    <span class="mf">251.03</span>
<span class="n">Freq</span><span class="p">:</span> <span class="mi">5</span><span class="n">T</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">293</span><span class="p">]:</span> <span class="n">ts</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;5Min&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">loffset</span><span class="o">=</span><span class="s1">&#39;1s&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">293</span><span class="p">]:</span> 
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span>    <span class="mf">251.03</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</pre></div>
</div>
<p>::: danger 警告</p>
<p>除了 <code class="docutils literal notranslate"><span class="pre">M</span></code>、<code class="docutils literal notranslate"><span class="pre">A</span></code>、<code class="docutils literal notranslate"><span class="pre">Q</span></code>、<code class="docutils literal notranslate"><span class="pre">BM</span></code>、<code class="docutils literal notranslate"><span class="pre">BA</span></code>、<code class="docutils literal notranslate"><span class="pre">BQ</span></code>、<code class="docutils literal notranslate"><span class="pre">W</span></code> 的默认值是 <code class="docutils literal notranslate"><span class="pre">right</span></code> 外，其它频率偏移量的 <code class="docutils literal notranslate"><span class="pre">label</span></code> 与 <code class="docutils literal notranslate"><span class="pre">closed</span></code> 默认值都是 <code class="docutils literal notranslate"><span class="pre">left</span></code>。</p>
<p>这种操作可能会导致时间回溯，即后面的时间会被拉回到前面的时间，如下例的 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.tseries.offsets.BusinessDay.html#pandas.tseries.offsets.BusinessDay"><code class="docutils literal notranslate"><span class="pre">BusinessDay</span></code></a> 频率所示。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">294</span><span class="p">]:</span> <span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;2000-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2000-01-05&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_series</span><span class="p">()</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">295</span><span class="p">]:</span> <span class="n">s</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">296</span><span class="p">]:</span> <span class="n">s</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">weekday_name</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">296</span><span class="p">]:</span> 
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span>     <span class="n">Saturday</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span>       <span class="n">Sunday</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span>          <span class="n">NaN</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">04</span>      <span class="n">Tuesday</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">05</span>    <span class="n">Wednesday</span>
<span class="n">Freq</span><span class="p">:</span> <span class="n">D</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>

<span class="c1"># 默认为：label=&#39;left&#39;, closed=&#39;left&#39;</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">297</span><span class="p">]:</span> <span class="n">s</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">last</span><span class="p">()</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">weekday_name</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">297</span><span class="p">]:</span> 
<span class="mi">1999</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">31</span>       <span class="n">Sunday</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span>          <span class="n">NaN</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">04</span>      <span class="n">Tuesday</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">05</span>    <span class="n">Wednesday</span>
<span class="n">Freq</span><span class="p">:</span> <span class="n">B</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>
</pre></div>
</div>
<p>看到了吗？星期日被拉回到了上一个星期五。要想把星期日移至星期一，改用以下代码：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">298</span><span class="p">]:</span> <span class="n">s</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">last</span><span class="p">()</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">weekday_name</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">298</span><span class="p">]:</span> 
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span>       <span class="n">Sunday</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">04</span>      <span class="n">Tuesday</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">05</span>    <span class="n">Wednesday</span>
<span class="n">Freq</span><span class="p">:</span> <span class="n">B</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>
</pre></div>
</div>
<p>:::</p>
<p><code class="docutils literal notranslate"><span class="pre">axis</span></code> 参数的值为 <code class="docutils literal notranslate"><span class="pre">0</span></code> 或 <code class="docutils literal notranslate"><span class="pre">1</span></code>，并可指定 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 重采样的轴。</p>
<p><code class="docutils literal notranslate"><span class="pre">kind</span></code> 参数可以是 <code class="docutils literal notranslate"><span class="pre">timestamp</span></code> 或 <code class="docutils literal notranslate"><span class="pre">period</span></code>，转换为时间戳或时间段形式的索引。<code class="docutils literal notranslate"><span class="pre">resample</span></code> 默认保留输入的日期时间形式。</p>
<p>重采样 <code class="docutils literal notranslate"><span class="pre">period</span></code> 数据时（详情见下文），<code class="docutils literal notranslate"><span class="pre">convention</span></code> 可以设置为 <code class="docutils literal notranslate"><span class="pre">start</span></code> 或 <code class="docutils literal notranslate"><span class="pre">end</span></code>。指定低频时间段如何转换为高频时间段。</p>
</div>
<div class="section" id="id33">
<h3>上采样<a class="headerlink" href="#id33" title="永久链接至标题">¶</a></h3>
<p>上采样可以指定上采样的方式及插入时间间隔的 <code class="docutils literal notranslate"><span class="pre">limit</span></code> 参数：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 从秒到每 250 毫秒</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">299</span><span class="p">]:</span> <span class="n">ts</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;250L&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">asfreq</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">299</span><span class="p">]:</span> 
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.000</span>    <span class="mf">308.0</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.250</span>      <span class="n">NaN</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.500</span>      <span class="n">NaN</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.750</span>      <span class="n">NaN</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">01.000</span>    <span class="mf">204.0</span>
<span class="n">Freq</span><span class="p">:</span> <span class="mi">250</span><span class="n">L</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">300</span><span class="p">]:</span> <span class="n">ts</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;250L&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">ffill</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">300</span><span class="p">]:</span> 
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.000</span>    <span class="mi">308</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.250</span>    <span class="mi">308</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.500</span>    <span class="mi">308</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.750</span>    <span class="mi">308</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">01.000</span>    <span class="mi">204</span>
<span class="n">Freq</span><span class="p">:</span> <span class="mi">250</span><span class="n">L</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">301</span><span class="p">]:</span> <span class="n">ts</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;250L&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">ffill</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">301</span><span class="p">]:</span> 
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.000</span>    <span class="mf">308.0</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.250</span>    <span class="mf">308.0</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.500</span>    <span class="mf">308.0</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.750</span>      <span class="n">NaN</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">01.000</span>    <span class="mf">204.0</span>
<span class="n">Freq</span><span class="p">:</span> <span class="mi">250</span><span class="n">L</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</pre></div>
</div>
</div>
<div class="section" id="id34">
<h3>稀疏重采样<a class="headerlink" href="#id34" title="永久链接至标题">¶</a></h3>
<p>相对于时间点总量，稀疏时间序列重采样的点要少很多。单纯上采样稀疏系列可能会生成很多中间值。未指定填充值，即 <code class="docutils literal notranslate"><span class="pre">fill_method</span></code> 是 <code class="docutils literal notranslate"><span class="pre">None</span></code> 时，中间值将填充为 <code class="docutils literal notranslate"><span class="pre">NaN</span></code>。</p>
<p>鉴于 <code class="docutils literal notranslate"><span class="pre">resample</span></code> 是基于时间的分组，下列这种方法可以有效重采样，只是分组不是都为 <code class="docutils literal notranslate"><span class="pre">NaN</span></code>。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">302</span><span class="p">]:</span> <span class="n">rng</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;2014-1-1&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="s1">&#39;1s&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">303</span><span class="p">]:</span> <span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">rng</span><span class="p">)</span>
</pre></div>
</div>
<p>对 <code class="docutils literal notranslate"><span class="pre">Series</span></code> 全范围重采样。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">304</span><span class="p">]:</span> <span class="n">ts</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;3T&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">304</span><span class="p">]:</span> 
<span class="mi">2014</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>     <span class="mi">0</span>
<span class="mi">2014</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mi">00</span>     <span class="mi">0</span>
<span class="mi">2014</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mi">00</span>     <span class="mi">0</span>
<span class="mi">2014</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span>     <span class="mi">0</span>
<span class="mi">2014</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">00</span>     <span class="mi">0</span>
                       <span class="o">..</span>
<span class="mi">2014</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">09</span> <span class="mi">23</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="mi">00</span>     <span class="mi">0</span>
<span class="mi">2014</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">09</span> <span class="mi">23</span><span class="p">:</span><span class="mi">51</span><span class="p">:</span><span class="mi">00</span>     <span class="mi">0</span>
<span class="mi">2014</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">09</span> <span class="mi">23</span><span class="p">:</span><span class="mi">54</span><span class="p">:</span><span class="mi">00</span>     <span class="mi">0</span>
<span class="mi">2014</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">09</span> <span class="mi">23</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mi">00</span>     <span class="mi">0</span>
<span class="mi">2014</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">10</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>    <span class="mi">99</span>
<span class="n">Freq</span><span class="p">:</span> <span class="mi">3</span><span class="n">T</span><span class="p">,</span> <span class="n">Length</span><span class="p">:</span> <span class="mi">47521</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>
</pre></div>
</div>
<p>对以下包含点的分组重采样：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">305</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">306</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">pandas.tseries.frequencies</span> <span class="kn">import</span> <span class="n">to_offset</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">307</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">round</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">freq</span><span class="p">):</span>
   <span class="o">.....</span><span class="p">:</span>     <span class="n">freq</span> <span class="o">=</span> <span class="n">to_offset</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span>
   <span class="o">.....</span><span class="p">:</span>     <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">((</span><span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="o">//</span> <span class="n">freq</span><span class="o">.</span><span class="n">delta</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">*</span> <span class="n">freq</span><span class="o">.</span><span class="n">delta</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
   <span class="o">.....</span><span class="p">:</span> 

<span class="n">In</span> <span class="p">[</span><span class="mi">308</span><span class="p">]:</span> <span class="n">ts</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;3T&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">308</span><span class="p">]:</span> 
<span class="mi">2014</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span>     <span class="mi">0</span>
<span class="mi">2014</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span>     <span class="mi">1</span>
<span class="mi">2014</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span>     <span class="mi">2</span>
<span class="mi">2014</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">04</span>     <span class="mi">3</span>
<span class="mi">2014</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">05</span>     <span class="mi">4</span>
              <span class="o">..</span>
<span class="mi">2014</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">06</span>    <span class="mi">95</span>
<span class="mi">2014</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">07</span>    <span class="mi">96</span>
<span class="mi">2014</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">08</span>    <span class="mi">97</span>
<span class="mi">2014</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">09</span>    <span class="mi">98</span>
<span class="mi">2014</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">10</span>    <span class="mi">99</span>
<span class="n">Length</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>
</pre></div>
</div>
</div>
<div class="section" id="id35">
<h3>聚合<a class="headerlink" href="#id35" title="永久链接至标题">¶</a></h3>
<p>类似于<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/getting_started/basics.html#basics-aggregate">聚合 API</a>，<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/groupby.html#groupby-aggregate">Groupby API</a> 及<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/computation.html#stats-aggregate">窗口函数 API</a>，<code class="docutils literal notranslate"><span class="pre">Resampler</span></code> 可以有选择地重采样。</p>
<p><code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 重采样，默认用相同函数操作所有列。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">309</span><span class="p">]:</span> <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
   <span class="o">.....</span><span class="p">:</span>                   <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;1/1/2012&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">1000</span><span class="p">),</span>
   <span class="o">.....</span><span class="p">:</span>                   <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">])</span>
   <span class="o">.....</span><span class="p">:</span> 

<span class="n">In</span> <span class="p">[</span><span class="mi">310</span><span class="p">]:</span> <span class="n">r</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;3T&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">311</span><span class="p">]:</span> <span class="n">r</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">311</span><span class="p">]:</span> 
                            <span class="n">A</span>         <span class="n">B</span>         <span class="n">C</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="mf">0.033823</span> <span class="o">-</span><span class="mf">0.121514</span> <span class="o">-</span><span class="mf">0.081447</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mi">00</span>  <span class="mf">0.056909</span>  <span class="mf">0.146731</span> <span class="o">-</span><span class="mf">0.024320</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="mf">0.058837</span>  <span class="mf">0.047046</span> <span class="o">-</span><span class="mf">0.052021</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span>  <span class="mf">0.063123</span> <span class="o">-</span><span class="mf">0.026158</span> <span class="o">-</span><span class="mf">0.066533</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">00</span>  <span class="mf">0.186340</span> <span class="o">-</span><span class="mf">0.003144</span>  <span class="mf">0.074752</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="mf">0.085954</span> <span class="o">-</span><span class="mf">0.016287</span> <span class="o">-</span><span class="mf">0.050046</span>
</pre></div>
</div>
<p>标准 <code class="docutils literal notranslate"><span class="pre">getitem</span></code> 操作可以指定的一列或多列。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">312</span><span class="p">]:</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">312</span><span class="p">]:</span> 
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>   <span class="o">-</span><span class="mf">0.033823</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mi">00</span>    <span class="mf">0.056909</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mi">00</span>   <span class="o">-</span><span class="mf">0.058837</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span>    <span class="mf">0.063123</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">00</span>    <span class="mf">0.186340</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">00</span>   <span class="o">-</span><span class="mf">0.085954</span>
<span class="n">Freq</span><span class="p">:</span> <span class="mi">3</span><span class="n">T</span><span class="p">,</span> <span class="n">Name</span><span class="p">:</span> <span class="n">A</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">313</span><span class="p">]:</span> <span class="n">r</span><span class="p">[[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">313</span><span class="p">]:</span> 
                            <span class="n">A</span>         <span class="n">B</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="mf">0.033823</span> <span class="o">-</span><span class="mf">0.121514</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mi">00</span>  <span class="mf">0.056909</span>  <span class="mf">0.146731</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="mf">0.058837</span>  <span class="mf">0.047046</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span>  <span class="mf">0.063123</span> <span class="o">-</span><span class="mf">0.026158</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">00</span>  <span class="mf">0.186340</span> <span class="o">-</span><span class="mf">0.003144</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="mf">0.085954</span> <span class="o">-</span><span class="mf">0.016287</span>
</pre></div>
</div>
<p>聚合还支持函数列表与字典，输出的是 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">314</span><span class="p">]:</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">314</span><span class="p">]:</span> 
                           <span class="nb">sum</span>      <span class="n">mean</span>       <span class="n">std</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>  <span class="o">-</span><span class="mf">6.088060</span> <span class="o">-</span><span class="mf">0.033823</span>  <span class="mf">1.043263</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mi">00</span>  <span class="mf">10.243678</span>  <span class="mf">0.056909</span>  <span class="mf">1.058534</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="mf">10.590584</span> <span class="o">-</span><span class="mf">0.058837</span>  <span class="mf">0.949264</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span>  <span class="mf">11.362228</span>  <span class="mf">0.063123</span>  <span class="mf">1.028096</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">00</span>  <span class="mf">33.541257</span>  <span class="mf">0.186340</span>  <span class="mf">0.884586</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">00</span>  <span class="o">-</span><span class="mf">8.595393</span> <span class="o">-</span><span class="mf">0.085954</span>  <span class="mf">1.035476</span>
</pre></div>
</div>
<p>重采样后的 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>，可以为每列指定函数列表，生成结构化索引的聚合结果：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">315</span><span class="p">]:</span> <span class="n">r</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">315</span><span class="p">]:</span> 
                             <span class="n">A</span>                    <span class="n">B</span>                    <span class="n">C</span>          
                           <span class="nb">sum</span>      <span class="n">mean</span>        <span class="nb">sum</span>      <span class="n">mean</span>        <span class="nb">sum</span>      <span class="n">mean</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>  <span class="o">-</span><span class="mf">6.088060</span> <span class="o">-</span><span class="mf">0.033823</span> <span class="o">-</span><span class="mf">21.872530</span> <span class="o">-</span><span class="mf">0.121514</span> <span class="o">-</span><span class="mf">14.660515</span> <span class="o">-</span><span class="mf">0.081447</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mi">00</span>  <span class="mf">10.243678</span>  <span class="mf">0.056909</span>  <span class="mf">26.411633</span>  <span class="mf">0.146731</span>  <span class="o">-</span><span class="mf">4.377642</span> <span class="o">-</span><span class="mf">0.024320</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="mf">10.590584</span> <span class="o">-</span><span class="mf">0.058837</span>   <span class="mf">8.468289</span>  <span class="mf">0.047046</span>  <span class="o">-</span><span class="mf">9.363825</span> <span class="o">-</span><span class="mf">0.052021</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span>  <span class="mf">11.362228</span>  <span class="mf">0.063123</span>  <span class="o">-</span><span class="mf">4.708526</span> <span class="o">-</span><span class="mf">0.026158</span> <span class="o">-</span><span class="mf">11.975895</span> <span class="o">-</span><span class="mf">0.066533</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">00</span>  <span class="mf">33.541257</span>  <span class="mf">0.186340</span>  <span class="o">-</span><span class="mf">0.565895</span> <span class="o">-</span><span class="mf">0.003144</span>  <span class="mf">13.455299</span>  <span class="mf">0.074752</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">00</span>  <span class="o">-</span><span class="mf">8.595393</span> <span class="o">-</span><span class="mf">0.085954</span>  <span class="o">-</span><span class="mf">1.628689</span> <span class="o">-</span><span class="mf">0.016287</span>  <span class="o">-</span><span class="mf">5.004580</span> <span class="o">-</span><span class="mf">0.050046</span>
</pre></div>
</div>
<p>把字典传递给 <code class="docutils literal notranslate"><span class="pre">aggregate</span></code>，可以为 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 里不同的列应用不同聚合函数。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">316</span><span class="p">]:</span> <span class="n">r</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">,</span>
   <span class="o">.....</span><span class="p">:</span>        <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)})</span>
   <span class="o">.....</span><span class="p">:</span> 
<span class="n">Out</span><span class="p">[</span><span class="mi">316</span><span class="p">]:</span> 
                             <span class="n">A</span>         <span class="n">B</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>  <span class="o">-</span><span class="mf">6.088060</span>  <span class="mf">1.001294</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mi">00</span>  <span class="mf">10.243678</span>  <span class="mf">1.074597</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="mf">10.590584</span>  <span class="mf">0.987309</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span>  <span class="mf">11.362228</span>  <span class="mf">0.944953</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">00</span>  <span class="mf">33.541257</span>  <span class="mf">1.095025</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">00</span>  <span class="o">-</span><span class="mf">8.595393</span>  <span class="mf">1.035312</span>
</pre></div>
</div>
<p>还可以用字符串代替函数名。为了让字符串有效，必须在重采样对象上操作：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">317</span><span class="p">]:</span> <span class="n">r</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="s1">&#39;sum&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="s1">&#39;std&#39;</span><span class="p">})</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">317</span><span class="p">]:</span> 
                             <span class="n">A</span>         <span class="n">B</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>  <span class="o">-</span><span class="mf">6.088060</span>  <span class="mf">1.001294</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mi">00</span>  <span class="mf">10.243678</span>  <span class="mf">1.074597</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="mf">10.590584</span>  <span class="mf">0.987309</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span>  <span class="mf">11.362228</span>  <span class="mf">0.944953</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">00</span>  <span class="mf">33.541257</span>  <span class="mf">1.095025</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">00</span>  <span class="o">-</span><span class="mf">8.595393</span>  <span class="mf">1.035312</span>
</pre></div>
</div>
<p>甚至还可以为每列单独多个聚合函数。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">318</span><span class="p">]:</span> <span class="n">r</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;sum&#39;</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">],</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">]})</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">318</span><span class="p">]:</span> 
                             <span class="n">A</span>                   <span class="n">B</span>          
                           <span class="nb">sum</span>       <span class="n">std</span>      <span class="n">mean</span>       <span class="n">std</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>  <span class="o">-</span><span class="mf">6.088060</span>  <span class="mf">1.043263</span> <span class="o">-</span><span class="mf">0.121514</span>  <span class="mf">1.001294</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mi">00</span>  <span class="mf">10.243678</span>  <span class="mf">1.058534</span>  <span class="mf">0.146731</span>  <span class="mf">1.074597</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="mf">10.590584</span>  <span class="mf">0.949264</span>  <span class="mf">0.047046</span>  <span class="mf">0.987309</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span>  <span class="mf">11.362228</span>  <span class="mf">1.028096</span> <span class="o">-</span><span class="mf">0.026158</span>  <span class="mf">0.944953</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">00</span>  <span class="mf">33.541257</span>  <span class="mf">0.884586</span> <span class="o">-</span><span class="mf">0.003144</span>  <span class="mf">1.095025</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">00</span>  <span class="o">-</span><span class="mf">8.595393</span>  <span class="mf">1.035476</span> <span class="o">-</span><span class="mf">0.016287</span>  <span class="mf">1.035312</span>
</pre></div>
</div>
<p>如果 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 用的不是 <code class="docutils literal notranslate"><span class="pre">datetime</span></code> 型索引，则可以基于 <code class="docutils literal notranslate"><span class="pre">datetime</span></code> 数据列重采样，用关键字 <code class="docutils literal notranslate"><span class="pre">on</span></code> 控制。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">319</span><span class="p">]:</span> <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;2015-01-01&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;W&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span>
   <span class="o">.....</span><span class="p">:</span>                    <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">)},</span>
   <span class="o">.....</span><span class="p">:</span>                   <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_arrays</span><span class="p">([</span>
   <span class="o">.....</span><span class="p">:</span>                       <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
   <span class="o">.....</span><span class="p">:</span>                       <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;2015-01-01&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;W&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">5</span><span class="p">)],</span>
   <span class="o">.....</span><span class="p">:</span>                       <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">]))</span>
   <span class="o">.....</span><span class="p">:</span> 

<span class="n">In</span> <span class="p">[</span><span class="mi">320</span><span class="p">]:</span> <span class="n">df</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">320</span><span class="p">]:</span> 
                   <span class="n">date</span>  <span class="n">a</span>
<span class="n">v</span> <span class="n">d</span>                       
<span class="mi">1</span> <span class="mi">2015</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">04</span> <span class="mi">2015</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">04</span>  <span class="mi">0</span>
<span class="mi">2</span> <span class="mi">2015</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">11</span> <span class="mi">2015</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">11</span>  <span class="mi">1</span>
<span class="mi">3</span> <span class="mi">2015</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">18</span> <span class="mi">2015</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">18</span>  <span class="mi">2</span>
<span class="mi">4</span> <span class="mi">2015</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">25</span> <span class="mi">2015</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">25</span>  <span class="mi">3</span>
<span class="mi">5</span> <span class="mi">2015</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">01</span> <span class="mi">2015</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">01</span>  <span class="mi">4</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">321</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">321</span><span class="p">]:</span> 
            <span class="n">a</span>
<span class="n">date</span>         
<span class="mi">2015</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">31</span>  <span class="mi">6</span>
<span class="mi">2015</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">28</span>  <span class="mi">4</span>
</pre></div>
</div>
<p>同样，还可以对 <code class="docutils literal notranslate"><span class="pre">datetime</span> <span class="pre">MultiIndex</span></code> 重采样，通过关键字 <code class="docutils literal notranslate"><span class="pre">level</span></code> 传递名字与位置。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">322</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">322</span><span class="p">]:</span> 
            <span class="n">a</span>
<span class="n">d</span>            
<span class="mi">2015</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">31</span>  <span class="mi">6</span>
<span class="mi">2015</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">28</span>  <span class="mi">4</span>
</pre></div>
</div>
</div>
<div class="section" id="id36">
<h3>分组迭代<a class="headerlink" href="#id36" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Resampler</span></code>对象迭代分组数据的操作非常自然，类似于  <a class="reference external" href="https://docs.python.org/3/library/itertools.html#itertools.groupby"><code class="docutils literal notranslate"><span class="pre">itertools.groupby()</span></code></a>：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">323</span><span class="p">]:</span> <span class="n">small</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
   <span class="o">.....</span><span class="p">:</span>     <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span>
   <span class="o">.....</span><span class="p">:</span>     <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">([</span><span class="s1">&#39;2017-01-01T00:00:00&#39;</span><span class="p">,</span>
   <span class="o">.....</span><span class="p">:</span>                           <span class="s1">&#39;2017-01-01T00:30:00&#39;</span><span class="p">,</span>
   <span class="o">.....</span><span class="p">:</span>                           <span class="s1">&#39;2017-01-01T00:31:00&#39;</span><span class="p">,</span>
   <span class="o">.....</span><span class="p">:</span>                           <span class="s1">&#39;2017-01-01T01:00:00&#39;</span><span class="p">,</span>
   <span class="o">.....</span><span class="p">:</span>                           <span class="s1">&#39;2017-01-01T03:00:00&#39;</span><span class="p">,</span>
   <span class="o">.....</span><span class="p">:</span>                           <span class="s1">&#39;2017-01-01T03:05:00&#39;</span><span class="p">])</span>
   <span class="o">.....</span><span class="p">:</span> <span class="p">)</span>
   <span class="o">.....</span><span class="p">:</span> 

<span class="n">In</span> <span class="p">[</span><span class="mi">324</span><span class="p">]:</span> <span class="n">resampled</span> <span class="o">=</span> <span class="n">small</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">325</span><span class="p">]:</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">resampled</span><span class="p">:</span>
   <span class="o">.....</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Group: &quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
   <span class="o">.....</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">27</span><span class="p">)</span>
   <span class="o">.....</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
   <span class="o">.....</span><span class="p">:</span> 
<span class="n">Group</span><span class="p">:</span>  <span class="mi">2017</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>
<span class="o">---------------------------</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>    <span class="mi">0</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">00</span>    <span class="mi">1</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">31</span><span class="p">:</span><span class="mi">00</span>    <span class="mi">2</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>

<span class="n">Group</span><span class="p">:</span>  <span class="mi">2017</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">01</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>
<span class="o">---------------------------</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">01</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>    <span class="mi">3</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>

<span class="n">Group</span><span class="p">:</span>  <span class="mi">2017</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">02</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>
<span class="o">---------------------------</span>
<span class="n">Series</span><span class="p">([],</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span><span class="p">)</span>

<span class="n">Group</span><span class="p">:</span>  <span class="mi">2017</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">03</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>
<span class="o">---------------------------</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">03</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>    <span class="mi">4</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">03</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="mi">00</span>    <span class="mi">5</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>
</pre></div>
</div>
<p>了解更多详情，请参阅<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/groupby.html#groupby-iterating-label">分组迭代</a>或 <a class="reference external" href="https://docs.python.org/3/library/itertools.html#itertools.groupby"><code class="docutils literal notranslate"><span class="pre">itertools.groupby()</span></code></a>。</p>
</div>
</div>
<div class="section" id="id37">
<h2><span class="section-number">6.11. </span>时间跨度表示<a class="headerlink" href="#id37" title="永久链接至标题">¶</a></h2>
<p>规律时间间隔可以用 Pandas 的 <code class="docutils literal notranslate"><span class="pre">Peirod</span></code> 对象表示，<code class="docutils literal notranslate"><span class="pre">Period</span></code> 对象序列叫做 <code class="docutils literal notranslate"><span class="pre">PeriodIndex</span></code>，用便捷函数 <code class="docutils literal notranslate"><span class="pre">period_range</span></code> 创建。</p>
<div class="section" id="period">
<h3>Period<a class="headerlink" href="#period" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Period</span></code> 表示时间跨度，即时间段，如年、季、月、日等。关键字 <code class="docutils literal notranslate"><span class="pre">freq</span></code> 与频率别名可以指定时间段。<code class="docutils literal notranslate"><span class="pre">freq</span></code> 表示的是 <code class="docutils literal notranslate"><span class="pre">Period</span></code> 的时间跨度，不能为负，如，<code class="docutils literal notranslate"><span class="pre">-3D</span></code>。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">326</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Period</span><span class="p">(</span><span class="s1">&#39;2012&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;A-DEC&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">326</span><span class="p">]:</span> <span class="n">Period</span><span class="p">(</span><span class="s1">&#39;2012&#39;</span><span class="p">,</span> <span class="s1">&#39;A-DEC&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">327</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Period</span><span class="p">(</span><span class="s1">&#39;2012-1-1&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">327</span><span class="p">]:</span> <span class="n">Period</span><span class="p">(</span><span class="s1">&#39;2012-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">328</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Period</span><span class="p">(</span><span class="s1">&#39;2012-1-1 19:00&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;H&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">328</span><span class="p">]:</span> <span class="n">Period</span><span class="p">(</span><span class="s1">&#39;2012-01-01 19:00&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">329</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Period</span><span class="p">(</span><span class="s1">&#39;2012-1-1 19:00&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;5H&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">329</span><span class="p">]:</span> <span class="n">Period</span><span class="p">(</span><span class="s1">&#39;2012-01-01 19:00&#39;</span><span class="p">,</span> <span class="s1">&#39;5H&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>时间段加减法按自身频率位移。 不同频率的时间段不可进行算术运算。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">330</span><span class="p">]:</span> <span class="n">p</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Period</span><span class="p">(</span><span class="s1">&#39;2012&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;A-DEC&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">331</span><span class="p">]:</span> <span class="n">p</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">331</span><span class="p">]:</span> <span class="n">Period</span><span class="p">(</span><span class="s1">&#39;2013&#39;</span><span class="p">,</span> <span class="s1">&#39;A-DEC&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">332</span><span class="p">]:</span> <span class="n">p</span> <span class="o">-</span> <span class="mi">3</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">332</span><span class="p">]:</span> <span class="n">Period</span><span class="p">(</span><span class="s1">&#39;2009&#39;</span><span class="p">,</span> <span class="s1">&#39;A-DEC&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">333</span><span class="p">]:</span> <span class="n">p</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Period</span><span class="p">(</span><span class="s1">&#39;2012-01&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;2M&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">334</span><span class="p">]:</span> <span class="n">p</span> <span class="o">+</span> <span class="mi">2</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">334</span><span class="p">]:</span> <span class="n">Period</span><span class="p">(</span><span class="s1">&#39;2012-05&#39;</span><span class="p">,</span> <span class="s1">&#39;2M&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">335</span><span class="p">]:</span> <span class="n">p</span> <span class="o">-</span> <span class="mi">1</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">335</span><span class="p">]:</span> <span class="n">Period</span><span class="p">(</span><span class="s1">&#39;2011-11&#39;</span><span class="p">,</span> <span class="s1">&#39;2M&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">336</span><span class="p">]:</span> <span class="n">p</span> <span class="o">==</span> <span class="n">pd</span><span class="o">.</span><span class="n">Period</span><span class="p">(</span><span class="s1">&#39;2012-01&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;3M&#39;</span><span class="p">)</span>
<span class="o">---------------------------------------------------------------------------</span>
<span class="n">IncompatibleFrequency</span>                     <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">336</span><span class="o">-</span><span class="mi">4</span><span class="n">b67dc0b596c</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="o">----&gt;</span> <span class="mi">1</span> <span class="n">p</span> <span class="o">==</span> <span class="n">pd</span><span class="o">.</span><span class="n">Period</span><span class="p">(</span><span class="s1">&#39;2012-01&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;3M&#39;</span><span class="p">)</span>

<span class="o">/</span><span class="n">pandas</span><span class="o">/</span><span class="n">pandas</span><span class="o">/</span><span class="n">_libs</span><span class="o">/</span><span class="n">tslibs</span><span class="o">/</span><span class="n">period</span><span class="o">.</span><span class="n">pyx</span> <span class="ow">in</span> <span class="n">pandas</span><span class="o">.</span><span class="n">_libs</span><span class="o">.</span><span class="n">tslibs</span><span class="o">.</span><span class="n">period</span><span class="o">.</span><span class="n">_Period</span><span class="o">.</span><span class="n">__richcmp__</span><span class="p">()</span>

<span class="n">IncompatibleFrequency</span><span class="p">:</span> <span class="n">Input</span> <span class="n">has</span> <span class="n">different</span> <span class="n">freq</span><span class="o">=</span><span class="mi">3</span><span class="n">M</span> <span class="kn">from</span> <span class="nn">Period</span><span class="p">(</span><span class="n">freq</span><span class="o">=</span><span class="mi">2</span><span class="n">M</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">freq</span></code> 的频率为日或更高频率时，如 <code class="docutils literal notranslate"><span class="pre">D</span></code>、<code class="docutils literal notranslate"><span class="pre">H</span></code>、<code class="docutils literal notranslate"><span class="pre">T</span></code>、<code class="docutils literal notranslate"><span class="pre">S</span></code>、<code class="docutils literal notranslate"><span class="pre">L</span></code>、<code class="docutils literal notranslate"><span class="pre">U</span></code>、<code class="docutils literal notranslate"><span class="pre">N</span></code>，<code class="docutils literal notranslate"><span class="pre">offsets</span></code> 与 <code class="docutils literal notranslate"><span class="pre">timedelta</span></code> 可以用相同频率实现加法。否则，会触发 <code class="docutils literal notranslate"><span class="pre">ValueError</span></code>。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">337</span><span class="p">]:</span> <span class="n">p</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Period</span><span class="p">(</span><span class="s1">&#39;2014-07-01 09:00&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;H&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">338</span><span class="p">]:</span> <span class="n">p</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">Hour</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">338</span><span class="p">]:</span> <span class="n">Period</span><span class="p">(</span><span class="s1">&#39;2014-07-01 11:00&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">339</span><span class="p">]:</span> <span class="n">p</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">120</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">339</span><span class="p">]:</span> <span class="n">Period</span><span class="p">(</span><span class="s1">&#39;2014-07-01 11:00&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">340</span><span class="p">]:</span> <span class="n">p</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="mi">7200</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">340</span><span class="p">]:</span> <span class="n">Period</span><span class="p">(</span><span class="s1">&#39;2014-07-01 11:00&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">)</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">p</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">Minute</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">Traceback</span>
   <span class="o">...</span>
<span class="ne">ValueError</span><span class="p">:</span> <span class="n">Input</span> <span class="n">has</span> <span class="n">different</span> <span class="n">freq</span> <span class="kn">from</span> <span class="nn">Period</span><span class="p">(</span><span class="n">freq</span><span class="o">=</span><span class="n">H</span><span class="p">)</span>
</pre></div>
</div>
<p>如果 <code class="docutils literal notranslate"><span class="pre">Period</span></code> 为其它频率，只有相同频率的 <code class="docutils literal notranslate"><span class="pre">offsets</span></code> 可以相加。否则，会触发 <code class="docutils literal notranslate"><span class="pre">ValueError</span></code>。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">341</span><span class="p">]:</span> <span class="n">p</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Period</span><span class="p">(</span><span class="s1">&#39;2014-07&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">342</span><span class="p">]:</span> <span class="n">p</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">MonthEnd</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">342</span><span class="p">]:</span> <span class="n">Period</span><span class="p">(</span><span class="s1">&#39;2014-10&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">)</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">p</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">MonthBegin</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">Traceback</span>
   <span class="o">...</span>
<span class="ne">ValueError</span><span class="p">:</span> <span class="n">Input</span> <span class="n">has</span> <span class="n">different</span> <span class="n">freq</span> <span class="kn">from</span> <span class="nn">Period</span><span class="p">(</span><span class="n">freq</span><span class="o">=</span><span class="n">M</span><span class="p">)</span>
</pre></div>
</div>
<p>用相同频率计算不同时间段实例之间的区别，将返回这些实例之间的频率单元数量。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">343</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Period</span><span class="p">(</span><span class="s1">&#39;2012&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;A-DEC&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">Period</span><span class="p">(</span><span class="s1">&#39;2002&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;A-DEC&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">343</span><span class="p">]:</span> <span class="o">&lt;</span><span class="mi">10</span> <span class="o">*</span> <span class="n">YearEnds</span><span class="p">:</span> <span class="n">month</span><span class="o">=</span><span class="mi">12</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="periodindex-period-range">
<h3>PeriodIndex 与 period_range<a class="headerlink" href="#periodindex-period-range" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">period_range</span></code> 便捷函数可以创建有规律的 <code class="docutils literal notranslate"><span class="pre">Period</span></code> 对象序列，即 <code class="docutils literal notranslate"><span class="pre">PeriodIndex</span></code>。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">344</span><span class="p">]:</span> <span class="n">prng</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">period_range</span><span class="p">(</span><span class="s1">&#39;1/1/2011&#39;</span><span class="p">,</span> <span class="s1">&#39;1/1/2012&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">345</span><span class="p">]:</span> <span class="n">prng</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">345</span><span class="p">]:</span> 
<span class="n">PeriodIndex</span><span class="p">([</span><span class="s1">&#39;2011-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-02&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-03&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-04&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-05&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-06&#39;</span><span class="p">,</span>
             <span class="s1">&#39;2011-07&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-08&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-09&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-10&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-11&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-12&#39;</span><span class="p">,</span>
             <span class="s1">&#39;2012-01&#39;</span><span class="p">],</span>
            <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;period[M]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>也可以直接用 <code class="docutils literal notranslate"><span class="pre">PeriodIndex</span></code> 创建：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">346</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">PeriodIndex</span><span class="p">([</span><span class="s1">&#39;2011-1&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-2&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-3&#39;</span><span class="p">],</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">346</span><span class="p">]:</span> <span class="n">PeriodIndex</span><span class="p">([</span><span class="s1">&#39;2011-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-02&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-03&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;period[M]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>频率为复数时，输出的 <code class="docutils literal notranslate"><span class="pre">Period</span></code> 序列为复数时间段。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">347</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">period_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="s1">&#39;2014-01&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;3M&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">347</span><span class="p">]:</span> <span class="n">PeriodIndex</span><span class="p">([</span><span class="s1">&#39;2014-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2014-04&#39;</span><span class="p">,</span> <span class="s1">&#39;2014-07&#39;</span><span class="p">,</span> <span class="s1">&#39;2014-10&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;period[3M]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;3M&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Period</span></code> 对象的 <code class="docutils literal notranslate"><span class="pre">start</span></code> 或 <code class="docutils literal notranslate"><span class="pre">end</span></code> 会被当作 <code class="docutils literal notranslate"><span class="pre">PeriodIndex</span></code> 的锚定终点，其频率与 <code class="docutils literal notranslate"><span class="pre">PeriodIndex</span></code> 的频率一样。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">348</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">period_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Period</span><span class="p">(</span><span class="s1">&#39;2017Q1&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;Q&#39;</span><span class="p">),</span>
   <span class="o">.....</span><span class="p">:</span>                 <span class="n">end</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Period</span><span class="p">(</span><span class="s1">&#39;2017Q2&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;Q&#39;</span><span class="p">),</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">)</span>
   <span class="o">.....</span><span class="p">:</span> 
<span class="n">Out</span><span class="p">[</span><span class="mi">348</span><span class="p">]:</span> <span class="n">PeriodIndex</span><span class="p">([</span><span class="s1">&#39;2017-03&#39;</span><span class="p">,</span> <span class="s1">&#39;2017-04&#39;</span><span class="p">,</span> <span class="s1">&#39;2017-05&#39;</span><span class="p">,</span> <span class="s1">&#39;2017-06&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;period[M]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>和 <code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code> 一样，<code class="docutils literal notranslate"><span class="pre">PeriodIndex</span></code> 也可以作为 Pandas 对象的索引。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">349</span><span class="p">]:</span> <span class="n">ps</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">prng</span><span class="p">)),</span> <span class="n">prng</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">350</span><span class="p">]:</span> <span class="n">ps</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">350</span><span class="p">]:</span> 
<span class="mi">2011</span><span class="o">-</span><span class="mi">01</span>   <span class="o">-</span><span class="mf">2.916901</span>
<span class="mi">2011</span><span class="o">-</span><span class="mi">02</span>    <span class="mf">0.514474</span>
<span class="mi">2011</span><span class="o">-</span><span class="mi">03</span>    <span class="mf">1.346470</span>
<span class="mi">2011</span><span class="o">-</span><span class="mi">04</span>    <span class="mf">0.816397</span>
<span class="mi">2011</span><span class="o">-</span><span class="mi">05</span>    <span class="mf">2.258648</span>
<span class="mi">2011</span><span class="o">-</span><span class="mi">06</span>    <span class="mf">0.494789</span>
<span class="mi">2011</span><span class="o">-</span><span class="mi">07</span>    <span class="mf">0.301239</span>
<span class="mi">2011</span><span class="o">-</span><span class="mi">08</span>    <span class="mf">0.464776</span>
<span class="mi">2011</span><span class="o">-</span><span class="mi">09</span>   <span class="o">-</span><span class="mf">1.393581</span>
<span class="mi">2011</span><span class="o">-</span><span class="mi">10</span>    <span class="mf">0.056780</span>
<span class="mi">2011</span><span class="o">-</span><span class="mi">11</span>    <span class="mf">0.197035</span>
<span class="mi">2011</span><span class="o">-</span><span class="mi">12</span>    <span class="mf">2.261385</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span>   <span class="o">-</span><span class="mf">0.329583</span>
<span class="n">Freq</span><span class="p">:</span> <span class="n">M</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">PeriodIndex</span></code> 的加减法与 <code class="docutils literal notranslate"><span class="pre">Period</span></code> 一样。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">351</span><span class="p">]:</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">period_range</span><span class="p">(</span><span class="s1">&#39;2014-07-01 09:00&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;H&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">352</span><span class="p">]:</span> <span class="n">idx</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">352</span><span class="p">]:</span> 
<span class="n">PeriodIndex</span><span class="p">([</span><span class="s1">&#39;2014-07-01 09:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2014-07-01 10:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2014-07-01 11:00&#39;</span><span class="p">,</span>
             <span class="s1">&#39;2014-07-01 12:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2014-07-01 13:00&#39;</span><span class="p">],</span>
            <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;period[H]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;H&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">353</span><span class="p">]:</span> <span class="n">idx</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">Hour</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">353</span><span class="p">]:</span> 
<span class="n">PeriodIndex</span><span class="p">([</span><span class="s1">&#39;2014-07-01 11:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2014-07-01 12:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2014-07-01 13:00&#39;</span><span class="p">,</span>
             <span class="s1">&#39;2014-07-01 14:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2014-07-01 15:00&#39;</span><span class="p">],</span>
            <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;period[H]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;H&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">354</span><span class="p">]:</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">period_range</span><span class="p">(</span><span class="s1">&#39;2014-07&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">355</span><span class="p">]:</span> <span class="n">idx</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">355</span><span class="p">]:</span> <span class="n">PeriodIndex</span><span class="p">([</span><span class="s1">&#39;2014-07&#39;</span><span class="p">,</span> <span class="s1">&#39;2014-08&#39;</span><span class="p">,</span> <span class="s1">&#39;2014-09&#39;</span><span class="p">,</span> <span class="s1">&#39;2014-10&#39;</span><span class="p">,</span> <span class="s1">&#39;2014-11&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;period[M]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">356</span><span class="p">]:</span> <span class="n">idx</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">MonthEnd</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">356</span><span class="p">]:</span> <span class="n">PeriodIndex</span><span class="p">([</span><span class="s1">&#39;2014-10&#39;</span><span class="p">,</span> <span class="s1">&#39;2014-11&#39;</span><span class="p">,</span> <span class="s1">&#39;2014-12&#39;</span><span class="p">,</span> <span class="s1">&#39;2015-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2015-02&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;period[M]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">PeriodIndex</span></code> 有自己的数据类型，即 <code class="docutils literal notranslate"><span class="pre">period</span></code>，请参阅 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#timeseries-period-dtype">Period 数据类型</a>。</p>
</div>
<div class="section" id="id38">
<h3>Period 数据类型<a class="headerlink" href="#id38" title="永久链接至标题">¶</a></h3>
<p><em>0.19.0 版新增</em>。</p>
<p><code class="docutils literal notranslate"><span class="pre">PeriodIndex</span></code> 的自定义数据类型是 <code class="docutils literal notranslate"><span class="pre">period</span></code>，是 Pandas 扩展数据类型，类似于<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#timeseries-timezone-series">带时区信息的数据类型</a>（<code class="docutils literal notranslate"><span class="pre">datetime64[ns,</span> <span class="pre">tz]</span></code>）。</p>
<p><code class="docutils literal notranslate"><span class="pre">Period</span></code> 数据类型支持 <code class="docutils literal notranslate"><span class="pre">freq</span></code> 属性，还可以用 <code class="docutils literal notranslate"><span class="pre">period[freq]</span></code> 表示，如，<code class="docutils literal notranslate"><span class="pre">period[D]</span></code> 或 <code class="docutils literal notranslate"><span class="pre">period[M]</span></code>，这里用的是<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#timeseries-offset-aliases">频率字符串</a>。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">357</span><span class="p">]:</span> <span class="n">pi</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">period_range</span><span class="p">(</span><span class="s1">&#39;2016-01-01&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">358</span><span class="p">]:</span> <span class="n">pi</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">358</span><span class="p">]:</span> <span class="n">PeriodIndex</span><span class="p">([</span><span class="s1">&#39;2016-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2016-02&#39;</span><span class="p">,</span> <span class="s1">&#39;2016-03&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;period[M]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">359</span><span class="p">]:</span> <span class="n">pi</span><span class="o">.</span><span class="n">dtype</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">359</span><span class="p">]:</span> <span class="n">period</span><span class="p">[</span><span class="n">M</span><span class="p">]</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">period</span></code> 数据类型在 <code class="docutils literal notranslate"><span class="pre">.astype(...)</span></code> 里使用。允许改变 <code class="docutils literal notranslate"><span class="pre">PeriodIndex</span></code> 的 <code class="docutils literal notranslate"><span class="pre">freq</span></code>， 如 <code class="docutils literal notranslate"><span class="pre">.asfreq()</span></code>，并用 <code class="docutils literal notranslate"><span class="pre">to_period()</span></code> 把 <code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code> 转化为 <code class="docutils literal notranslate"><span class="pre">PeriodIndex</span></code>：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 把月频改为日频</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">360</span><span class="p">]:</span> <span class="n">pi</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;period[D]&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">360</span><span class="p">]:</span> <span class="n">PeriodIndex</span><span class="p">([</span><span class="s1">&#39;2016-01-31&#39;</span><span class="p">,</span> <span class="s1">&#39;2016-02-29&#39;</span><span class="p">,</span> <span class="s1">&#39;2016-03-31&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;period[D]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">)</span>

<span class="c1"># 转换为 DatetimeIndex</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">361</span><span class="p">]:</span> <span class="n">pi</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">361</span><span class="p">]:</span> <span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2016-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2016-02-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2016-03-01&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;MS&#39;</span><span class="p">)</span>

<span class="c1"># 转换为 PeriodIndex</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">362</span><span class="p">]:</span> <span class="n">dti</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;2011-01-01&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">363</span><span class="p">]:</span> <span class="n">dti</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">363</span><span class="p">]:</span> <span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2011-01-31&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-02-28&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-03-31&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">364</span><span class="p">]:</span> <span class="n">dti</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;period[M]&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">364</span><span class="p">]:</span> <span class="n">PeriodIndex</span><span class="p">([</span><span class="s1">&#39;2011-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-02&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-03&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;period[M]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="periodindex">
<h3>PeriodIndex 局部字符串索引<a class="headerlink" href="#periodindex" title="永久链接至标题">¶</a></h3>
<p>与 <code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code> 一样，<code class="docutils literal notranslate"><span class="pre">PeriodIndex</span></code> 可以把日期与字符串传递给 <code class="docutils literal notranslate"><span class="pre">Series</span></code> 与 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>。详情请参阅 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#timeseries-partialindexing">DatetimeIndex 局部字符串索引</a>。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">365</span><span class="p">]:</span> <span class="n">ps</span><span class="p">[</span><span class="s1">&#39;2011-01&#39;</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">365</span><span class="p">]:</span> <span class="o">-</span><span class="mf">2.9169013294054507</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">366</span><span class="p">]:</span> <span class="n">ps</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2011</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">25</span><span class="p">):]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">366</span><span class="p">]:</span> 
<span class="mi">2011</span><span class="o">-</span><span class="mi">12</span>    <span class="mf">2.261385</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span>   <span class="o">-</span><span class="mf">0.329583</span>
<span class="n">Freq</span><span class="p">:</span> <span class="n">M</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">367</span><span class="p">]:</span> <span class="n">ps</span><span class="p">[</span><span class="s1">&#39;10/31/2011&#39;</span><span class="p">:</span><span class="s1">&#39;12/31/2011&#39;</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">367</span><span class="p">]:</span> 
<span class="mi">2011</span><span class="o">-</span><span class="mi">10</span>    <span class="mf">0.056780</span>
<span class="mi">2011</span><span class="o">-</span><span class="mi">11</span>    <span class="mf">0.197035</span>
<span class="mi">2011</span><span class="o">-</span><span class="mi">12</span>    <span class="mf">2.261385</span>
<span class="n">Freq</span><span class="p">:</span> <span class="n">M</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</pre></div>
</div>
<p>传递比 <code class="docutils literal notranslate"><span class="pre">PeriodIndex</span></code> 更低频率的字符串会返回局部切片数据。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">368</span><span class="p">]:</span> <span class="n">ps</span><span class="p">[</span><span class="s1">&#39;2011&#39;</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">368</span><span class="p">]:</span> 
<span class="mi">2011</span><span class="o">-</span><span class="mi">01</span>   <span class="o">-</span><span class="mf">2.916901</span>
<span class="mi">2011</span><span class="o">-</span><span class="mi">02</span>    <span class="mf">0.514474</span>
<span class="mi">2011</span><span class="o">-</span><span class="mi">03</span>    <span class="mf">1.346470</span>
<span class="mi">2011</span><span class="o">-</span><span class="mi">04</span>    <span class="mf">0.816397</span>
<span class="mi">2011</span><span class="o">-</span><span class="mi">05</span>    <span class="mf">2.258648</span>
<span class="mi">2011</span><span class="o">-</span><span class="mi">06</span>    <span class="mf">0.494789</span>
<span class="mi">2011</span><span class="o">-</span><span class="mi">07</span>    <span class="mf">0.301239</span>
<span class="mi">2011</span><span class="o">-</span><span class="mi">08</span>    <span class="mf">0.464776</span>
<span class="mi">2011</span><span class="o">-</span><span class="mi">09</span>   <span class="o">-</span><span class="mf">1.393581</span>
<span class="mi">2011</span><span class="o">-</span><span class="mi">10</span>    <span class="mf">0.056780</span>
<span class="mi">2011</span><span class="o">-</span><span class="mi">11</span>    <span class="mf">0.197035</span>
<span class="mi">2011</span><span class="o">-</span><span class="mi">12</span>    <span class="mf">2.261385</span>
<span class="n">Freq</span><span class="p">:</span> <span class="n">M</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">369</span><span class="p">]:</span> <span class="n">dfp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">600</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
   <span class="o">.....</span><span class="p">:</span>                    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">],</span>
   <span class="o">.....</span><span class="p">:</span>                    <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">period_range</span><span class="p">(</span><span class="s1">&#39;2013-01-01 9:00&#39;</span><span class="p">,</span>
   <span class="o">.....</span><span class="p">:</span>                                          <span class="n">periods</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
   <span class="o">.....</span><span class="p">:</span>                                          <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;T&#39;</span><span class="p">))</span>
   <span class="o">.....</span><span class="p">:</span> 

<span class="n">In</span> <span class="p">[</span><span class="mi">370</span><span class="p">]:</span> <span class="n">dfp</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">370</span><span class="p">]:</span> 
                         <span class="n">A</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">09</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="mf">0.538468</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">09</span><span class="p">:</span><span class="mi">01</span> <span class="o">-</span><span class="mf">1.365819</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">09</span><span class="p">:</span><span class="mi">02</span> <span class="o">-</span><span class="mf">0.969051</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">09</span><span class="p">:</span><span class="mi">03</span> <span class="o">-</span><span class="mf">0.331152</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">09</span><span class="p">:</span><span class="mi">04</span> <span class="o">-</span><span class="mf">0.245334</span>
<span class="o">...</span>                    <span class="o">...</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">18</span><span class="p">:</span><span class="mi">55</span>  <span class="mf">0.522460</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">18</span><span class="p">:</span><span class="mi">56</span>  <span class="mf">0.118710</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">18</span><span class="p">:</span><span class="mi">57</span>  <span class="mf">0.167517</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">18</span><span class="p">:</span><span class="mi">58</span>  <span class="mf">0.922883</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">18</span><span class="p">:</span><span class="mi">59</span>  <span class="mf">1.721104</span>

<span class="p">[</span><span class="mi">600</span> <span class="n">rows</span> <span class="n">x</span> <span class="mi">1</span> <span class="n">columns</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">371</span><span class="p">]:</span> <span class="n">dfp</span><span class="p">[</span><span class="s1">&#39;2013-01-01 10H&#39;</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">371</span><span class="p">]:</span> 
                         <span class="n">A</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">10</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="mf">0.308975</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">10</span><span class="p">:</span><span class="mi">01</span>  <span class="mf">0.542520</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">10</span><span class="p">:</span><span class="mi">02</span>  <span class="mf">1.061068</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">10</span><span class="p">:</span><span class="mi">03</span>  <span class="mf">0.754005</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">10</span><span class="p">:</span><span class="mi">04</span>  <span class="mf">0.352933</span>
<span class="o">...</span>                    <span class="o">...</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">10</span><span class="p">:</span><span class="mi">55</span> <span class="o">-</span><span class="mf">0.865621</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">10</span><span class="p">:</span><span class="mi">56</span> <span class="o">-</span><span class="mf">1.167818</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">10</span><span class="p">:</span><span class="mi">57</span> <span class="o">-</span><span class="mf">2.081748</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">10</span><span class="p">:</span><span class="mi">58</span> <span class="o">-</span><span class="mf">0.527146</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">10</span><span class="p">:</span><span class="mi">59</span>  <span class="mf">0.802298</span>

<span class="p">[</span><span class="mi">60</span> <span class="n">rows</span> <span class="n">x</span> <span class="mi">1</span> <span class="n">columns</span><span class="p">]</span>
</pre></div>
</div>
<p>与 <code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code> 一样，终点包含在结果范围之内。下例中的切片数据就是从 10:00 到 11:59。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">372</span><span class="p">]:</span> <span class="n">dfp</span><span class="p">[</span><span class="s1">&#39;2013-01-01 10H&#39;</span><span class="p">:</span><span class="s1">&#39;2013-01-01 11H&#39;</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">372</span><span class="p">]:</span> 
                         <span class="n">A</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">10</span><span class="p">:</span><span class="mi">00</span> <span class="o">-</span><span class="mf">0.308975</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">10</span><span class="p">:</span><span class="mi">01</span>  <span class="mf">0.542520</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">10</span><span class="p">:</span><span class="mi">02</span>  <span class="mf">1.061068</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">10</span><span class="p">:</span><span class="mi">03</span>  <span class="mf">0.754005</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">10</span><span class="p">:</span><span class="mi">04</span>  <span class="mf">0.352933</span>
<span class="o">...</span>                    <span class="o">...</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">11</span><span class="p">:</span><span class="mi">55</span> <span class="o">-</span><span class="mf">0.590204</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">11</span><span class="p">:</span><span class="mi">56</span>  <span class="mf">1.539990</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">11</span><span class="p">:</span><span class="mi">57</span> <span class="o">-</span><span class="mf">1.224826</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">11</span><span class="p">:</span><span class="mi">58</span>  <span class="mf">0.578798</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">11</span><span class="p">:</span><span class="mi">59</span> <span class="o">-</span><span class="mf">0.685496</span>

<span class="p">[</span><span class="mi">120</span> <span class="n">rows</span> <span class="n">x</span> <span class="mi">1</span> <span class="n">columns</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="id39">
<h3>频率转换与 <code class="docutils literal notranslate"><span class="pre">PeriodIndex</span></code> 重采样<a class="headerlink" href="#id39" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Period</span></code> 与 <code class="docutils literal notranslate"><span class="pre">PeriodIndex</span></code> 的频率可以用 <code class="docutils literal notranslate"><span class="pre">asfreq</span></code> 转换。下列代码开始于 2011 财年，结束时间为十二月：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">373</span><span class="p">]:</span> <span class="n">p</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Period</span><span class="p">(</span><span class="s1">&#39;2011&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;A-DEC&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">374</span><span class="p">]:</span> <span class="n">p</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">374</span><span class="p">]:</span> <span class="n">Period</span><span class="p">(</span><span class="s1">&#39;2011&#39;</span><span class="p">,</span> <span class="s1">&#39;A-DEC&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>可以把它转换为月频。使用 <code class="docutils literal notranslate"><span class="pre">how</span></code> 参数，指定是否返回开始或结束月份。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">375</span><span class="p">]:</span> <span class="n">p</span><span class="o">.</span><span class="n">asfreq</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;start&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">375</span><span class="p">]:</span> <span class="n">Period</span><span class="p">(</span><span class="s1">&#39;2011-01&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">376</span><span class="p">]:</span> <span class="n">p</span><span class="o">.</span><span class="n">asfreq</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;end&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">376</span><span class="p">]:</span> <span class="n">Period</span><span class="p">(</span><span class="s1">&#39;2011-12&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>简称 <code class="docutils literal notranslate"><span class="pre">s</span></code> 与 <code class="docutils literal notranslate"><span class="pre">e</span></code> 用起来更方便：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">377</span><span class="p">]:</span> <span class="n">p</span><span class="o">.</span><span class="n">asfreq</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">377</span><span class="p">]:</span> <span class="n">Period</span><span class="p">(</span><span class="s1">&#39;2011-01&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">378</span><span class="p">]:</span> <span class="n">p</span><span class="o">.</span><span class="n">asfreq</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">378</span><span class="p">]:</span> <span class="n">Period</span><span class="p">(</span><span class="s1">&#39;2011-12&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>转换为“超级 period”，（如，年频就是季频的超级 period），自动返回包含输入时间段的超级 period：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">379</span><span class="p">]:</span> <span class="n">p</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Period</span><span class="p">(</span><span class="s1">&#39;2011-12&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">380</span><span class="p">]:</span> <span class="n">p</span><span class="o">.</span><span class="n">asfreq</span><span class="p">(</span><span class="s1">&#39;A-NOV&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">380</span><span class="p">]:</span> <span class="n">Period</span><span class="p">(</span><span class="s1">&#39;2012&#39;</span><span class="p">,</span> <span class="s1">&#39;A-NOV&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>注意，因为转换年频是在十一月结束的，2011 年 12 月的月时间段实际上是 <code class="docutils literal notranslate"><span class="pre">2012</span> <span class="pre">A-NOV</span></code> period。</p>
<p>用锚定频率转换时间段，对经济学、商业等领域里的各种季度数据特别有用。很多公司都依据其财年开始月与结束月定义季度。因此，2011 年第一个季度有可能 2010 年就开始了，也有可能 2011 年过了几个月才开始。通过锚定频率，Pandas 可以处理所有从 <code class="docutils literal notranslate"><span class="pre">Q-JAN</span></code> 至 <code class="docutils literal notranslate"><span class="pre">Q-DEC</span></code>的季度频率。</p>
<p><code class="docutils literal notranslate"><span class="pre">Q-DEC</span></code> 定义的是常规日历季度：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">381</span><span class="p">]:</span> <span class="n">p</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Period</span><span class="p">(</span><span class="s1">&#39;2012Q1&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;Q-DEC&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">382</span><span class="p">]:</span> <span class="n">p</span><span class="o">.</span><span class="n">asfreq</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">382</span><span class="p">]:</span> <span class="n">Period</span><span class="p">(</span><span class="s1">&#39;2012-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">383</span><span class="p">]:</span> <span class="n">p</span><span class="o">.</span><span class="n">asfreq</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">383</span><span class="p">]:</span> <span class="n">Period</span><span class="p">(</span><span class="s1">&#39;2012-03-31&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Q-MAR</span></code> 定义的是财年结束于三月：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">384</span><span class="p">]:</span> <span class="n">p</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Period</span><span class="p">(</span><span class="s1">&#39;2011Q4&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;Q-MAR&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">385</span><span class="p">]:</span> <span class="n">p</span><span class="o">.</span><span class="n">asfreq</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">385</span><span class="p">]:</span> <span class="n">Period</span><span class="p">(</span><span class="s1">&#39;2011-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">386</span><span class="p">]:</span> <span class="n">p</span><span class="o">.</span><span class="n">asfreq</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">386</span><span class="p">]:</span> <span class="n">Period</span><span class="p">(</span><span class="s1">&#39;2011-03-31&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id40">
<h3>不同表现形式之间的转换<a class="headerlink" href="#id40" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">to_period</span></code> 把时间戳转换为 <code class="docutils literal notranslate"><span class="pre">PeriodIndex</span></code>，<code class="docutils literal notranslate"><span class="pre">to_timestamp</span></code> 则执行反向操作。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">387</span><span class="p">]:</span> <span class="n">rng</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;1/1/2012&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">388</span><span class="p">]:</span> <span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rng</span><span class="p">)),</span> <span class="n">index</span><span class="o">=</span><span class="n">rng</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">389</span><span class="p">]:</span> <span class="n">ts</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">389</span><span class="p">]:</span> 
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">31</span>    <span class="mf">1.931253</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">29</span>   <span class="o">-</span><span class="mf">0.184594</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">31</span>    <span class="mf">0.249656</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">30</span>   <span class="o">-</span><span class="mf">0.978151</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">31</span>   <span class="o">-</span><span class="mf">0.873389</span>
<span class="n">Freq</span><span class="p">:</span> <span class="n">M</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">390</span><span class="p">]:</span> <span class="n">ps</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">to_period</span><span class="p">()</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">391</span><span class="p">]:</span> <span class="n">ps</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">391</span><span class="p">]:</span> 
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span>    <span class="mf">1.931253</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">02</span>   <span class="o">-</span><span class="mf">0.184594</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">03</span>    <span class="mf">0.249656</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">04</span>   <span class="o">-</span><span class="mf">0.978151</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">05</span>   <span class="o">-</span><span class="mf">0.873389</span>
<span class="n">Freq</span><span class="p">:</span> <span class="n">M</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">392</span><span class="p">]:</span> <span class="n">ps</span><span class="o">.</span><span class="n">to_timestamp</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">392</span><span class="p">]:</span> 
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span>    <span class="mf">1.931253</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">01</span>   <span class="o">-</span><span class="mf">0.184594</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">01</span>    <span class="mf">0.249656</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">01</span>   <span class="o">-</span><span class="mf">0.978151</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">01</span>   <span class="o">-</span><span class="mf">0.873389</span>
<span class="n">Freq</span><span class="p">:</span> <span class="n">MS</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</pre></div>
</div>
<p>记住 <code class="docutils literal notranslate"><span class="pre">s</span></code> 与 <code class="docutils literal notranslate"><span class="pre">e</span></code> 返回 <code class="docutils literal notranslate"><span class="pre">period</span></code> 开始或结束的时间戳：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">393</span><span class="p">]:</span> <span class="n">ps</span><span class="o">.</span><span class="n">to_timestamp</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">393</span><span class="p">]:</span> 
<span class="mi">2012</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span>    <span class="mf">1.931253</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">01</span>   <span class="o">-</span><span class="mf">0.184594</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">01</span>    <span class="mf">0.249656</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">01</span>   <span class="o">-</span><span class="mf">0.978151</span>
<span class="mi">2012</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">01</span>   <span class="o">-</span><span class="mf">0.873389</span>
<span class="n">Freq</span><span class="p">:</span> <span class="n">MS</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</pre></div>
</div>
<p>用便捷算数函数可以转换时间段与时间戳。下例中，把以 11 月年度结束的季频转换为以下一个季度月末上午 9 点：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">394</span><span class="p">]:</span> <span class="n">prng</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">period_range</span><span class="p">(</span><span class="s1">&#39;1990Q1&#39;</span><span class="p">,</span> <span class="s1">&#39;2000Q4&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;Q-NOV&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">395</span><span class="p">]:</span> <span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">prng</span><span class="p">)),</span> <span class="n">prng</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">396</span><span class="p">]:</span> <span class="n">ts</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="p">(</span><span class="n">prng</span><span class="o">.</span><span class="n">asfreq</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">asfreq</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">9</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">397</span><span class="p">]:</span> <span class="n">ts</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">397</span><span class="p">]:</span> 
<span class="mi">1990</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">01</span> <span class="mi">09</span><span class="p">:</span><span class="mi">00</span>   <span class="o">-</span><span class="mf">0.109291</span>
<span class="mi">1990</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">01</span> <span class="mi">09</span><span class="p">:</span><span class="mi">00</span>   <span class="o">-</span><span class="mf">0.637235</span>
<span class="mi">1990</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">01</span> <span class="mi">09</span><span class="p">:</span><span class="mi">00</span>   <span class="o">-</span><span class="mf">1.735925</span>
<span class="mi">1990</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">01</span> <span class="mi">09</span><span class="p">:</span><span class="mi">00</span>    <span class="mf">2.096946</span>
<span class="mi">1991</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">01</span> <span class="mi">09</span><span class="p">:</span><span class="mi">00</span>   <span class="o">-</span><span class="mf">1.039926</span>
<span class="n">Freq</span><span class="p">:</span> <span class="n">H</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id41">
<h2><span class="section-number">6.12. </span>界外跨度表示<a class="headerlink" href="#id41" title="永久链接至标题">¶</a></h2>
<p>数据在 <code class="docutils literal notranslate"><span class="pre">Timestamp</span></code> 限定边界外时，参阅 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#timeseries-timestamp-limits">Timestamp 限制</a>，可以用 <code class="docutils literal notranslate"><span class="pre">PeriodIndex</span></code> 或 <code class="docutils literal notranslate"><span class="pre">Periods</span></code> 的 <code class="docutils literal notranslate"><span class="pre">Series</span></code> 执行计算。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">398</span><span class="p">]:</span> <span class="n">span</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">period_range</span><span class="p">(</span><span class="s1">&#39;1215-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;1381-01-01&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">399</span><span class="p">]:</span> <span class="n">span</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">399</span><span class="p">]:</span> 
<span class="n">PeriodIndex</span><span class="p">([</span><span class="s1">&#39;1215-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;1215-01-02&#39;</span><span class="p">,</span> <span class="s1">&#39;1215-01-03&#39;</span><span class="p">,</span> <span class="s1">&#39;1215-01-04&#39;</span><span class="p">,</span>
             <span class="s1">&#39;1215-01-05&#39;</span><span class="p">,</span> <span class="s1">&#39;1215-01-06&#39;</span><span class="p">,</span> <span class="s1">&#39;1215-01-07&#39;</span><span class="p">,</span> <span class="s1">&#39;1215-01-08&#39;</span><span class="p">,</span>
             <span class="s1">&#39;1215-01-09&#39;</span><span class="p">,</span> <span class="s1">&#39;1215-01-10&#39;</span><span class="p">,</span>
             <span class="o">...</span>
             <span class="s1">&#39;1380-12-23&#39;</span><span class="p">,</span> <span class="s1">&#39;1380-12-24&#39;</span><span class="p">,</span> <span class="s1">&#39;1380-12-25&#39;</span><span class="p">,</span> <span class="s1">&#39;1380-12-26&#39;</span><span class="p">,</span>
             <span class="s1">&#39;1380-12-27&#39;</span><span class="p">,</span> <span class="s1">&#39;1380-12-28&#39;</span><span class="p">,</span> <span class="s1">&#39;1380-12-29&#39;</span><span class="p">,</span> <span class="s1">&#39;1380-12-30&#39;</span><span class="p">,</span>
             <span class="s1">&#39;1380-12-31&#39;</span><span class="p">,</span> <span class="s1">&#39;1381-01-01&#39;</span><span class="p">],</span>
            <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;period[D]&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">60632</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>从基于 <code class="docutils literal notranslate"><span class="pre">int64</span></code> 的 <code class="docutils literal notranslate"><span class="pre">YYYYMMDD</span></code> 表示形式转换。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">400</span><span class="p">]:</span> <span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">20121231</span><span class="p">,</span> <span class="mi">20141130</span><span class="p">,</span> <span class="mi">99991231</span><span class="p">])</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">401</span><span class="p">]:</span> <span class="n">s</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">401</span><span class="p">]:</span> 
<span class="mi">0</span>    <span class="mi">20121231</span>
<span class="mi">1</span>    <span class="mi">20141130</span>
<span class="mi">2</span>    <span class="mi">99991231</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">402</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">conv</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
   <span class="o">.....</span><span class="p">:</span>     <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Period</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">x</span> <span class="o">//</span> <span class="mi">10000</span><span class="p">,</span> <span class="n">month</span><span class="o">=</span><span class="n">x</span> <span class="o">//</span> <span class="mi">100</span> <span class="o">%</span> <span class="mi">100</span><span class="p">,</span>
   <span class="o">.....</span><span class="p">:</span>                      <span class="n">day</span><span class="o">=</span><span class="n">x</span> <span class="o">%</span> <span class="mi">100</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">)</span>
   <span class="o">.....</span><span class="p">:</span> 

<span class="n">In</span> <span class="p">[</span><span class="mi">403</span><span class="p">]:</span> <span class="n">s</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">conv</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">403</span><span class="p">]:</span> 
<span class="mi">0</span>    <span class="mi">2012</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">31</span>
<span class="mi">1</span>    <span class="mi">2014</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">30</span>
<span class="mi">2</span>    <span class="mi">9999</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">31</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">period</span><span class="p">[</span><span class="n">D</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">404</span><span class="p">]:</span> <span class="n">s</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">conv</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">404</span><span class="p">]:</span> <span class="n">Period</span><span class="p">(</span><span class="s1">&#39;9999-12-31&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>轻轻松松就可以这些数据转换成 <code class="docutils literal notranslate"><span class="pre">PeriodIndex</span></code>：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">405</span><span class="p">]:</span> <span class="n">span</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">PeriodIndex</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">conv</span><span class="p">))</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">406</span><span class="p">]:</span> <span class="n">span</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">406</span><span class="p">]:</span> <span class="n">PeriodIndex</span><span class="p">([</span><span class="s1">&#39;2012-12-31&#39;</span><span class="p">,</span> <span class="s1">&#39;2014-11-30&#39;</span><span class="p">,</span> <span class="s1">&#39;9999-12-31&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;period[D]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id42">
<h2><span class="section-number">6.13. </span>时区控制<a class="headerlink" href="#id42" title="永久链接至标题">¶</a></h2>
<p>利用 <code class="docutils literal notranslate"><span class="pre">pytz</span></code> 与 <code class="docutils literal notranslate"><span class="pre">datetuil</span></code> 或标准库 <code class="docutils literal notranslate"><span class="pre">datetime.timezone</span></code> 对象，Pandas 能以多种方式处理不同时区的时间戳。</p>
<div class="section" id="id43">
<h3>处理时区<a class="headerlink" href="#id43" title="永久链接至标题">¶</a></h3>
<p>Pandas 对象默认不支持时区信息：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">407</span><span class="p">]:</span> <span class="n">rng</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;3/6/2012 00:00&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">408</span><span class="p">]:</span> <span class="n">rng</span><span class="o">.</span><span class="n">tz</span> <span class="ow">is</span> <span class="kc">None</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">408</span><span class="p">]:</span> <span class="kc">True</span>
</pre></div>
</div>
<p>用 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.date_range.html#pandas.date_range"><code class="docutils literal notranslate"><span class="pre">date_range()</span></code></a>、<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Timestamp.html#pandas.Timestamp"><code class="docutils literal notranslate"><span class="pre">Timestamp</span></code></a> 、<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DatetimeIndex.html#pandas.DatetimeIndex"><code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code></a> 的 <code class="docutils literal notranslate"><span class="pre">tz_localize</span></code> 方法或 <code class="docutils literal notranslate"><span class="pre">tz</span></code> 关键字参数，可以为这些日期加上本地时区，即，把指定时区分配给不带时区的日期。还可以传递 <code class="docutils literal notranslate"><span class="pre">pytz</span></code> 、 <code class="docutils literal notranslate"><span class="pre">dateutil</span></code> 时区对象或奥尔森时区数据库字符串。奥尔森时区字符串默认返回 <code class="docutils literal notranslate"><span class="pre">pytz</span></code> 时区对象。要返回 <code class="docutils literal notranslate"><span class="pre">dateutil</span></code> 时区对象，在字符串前加上 <code class="docutils literal notranslate"><span class="pre">datetuil/</span></code>。</p>
<ul class="simple">
<li><p>用 <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">pytz</span> <span class="pre">import</span> <span class="pre">common_timezones,</span> <span class="pre">all_timezones</span></code> 在 <code class="docutils literal notranslate"><span class="pre">pytz</span></code> 里查找通用时区。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dateutil</span></code> 使用操作系统时区，没有固定的列表，其通用时区名与 <code class="docutils literal notranslate"><span class="pre">pytz</span></code> 相同。</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">409</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">dateutil</span>

<span class="c1"># pytz</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">410</span><span class="p">]:</span> <span class="n">rng_pytz</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;3/6/2012 00:00&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">,</span>
   <span class="o">.....</span><span class="p">:</span>                          <span class="n">tz</span><span class="o">=</span><span class="s1">&#39;Europe/London&#39;</span><span class="p">)</span>
   <span class="o">.....</span><span class="p">:</span> 

<span class="n">In</span> <span class="p">[</span><span class="mi">411</span><span class="p">]:</span> <span class="n">rng_pytz</span><span class="o">.</span><span class="n">tz</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">411</span><span class="p">]:</span> <span class="o">&lt;</span><span class="n">DstTzInfo</span> <span class="s1">&#39;Europe/London&#39;</span> <span class="n">LMT</span><span class="o">-</span><span class="mi">1</span> <span class="n">day</span><span class="p">,</span> <span class="mi">23</span><span class="p">:</span><span class="mi">59</span><span class="p">:</span><span class="mi">00</span> <span class="n">STD</span><span class="o">&gt;</span>

<span class="c1"># dateutil</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">412</span><span class="p">]:</span> <span class="n">rng_dateutil</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;3/6/2012 00:00&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">413</span><span class="p">]:</span> <span class="n">rng_dateutil</span> <span class="o">=</span> <span class="n">rng_dateutil</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="s1">&#39;dateutil/Europe/London&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">414</span><span class="p">]:</span> <span class="n">rng_dateutil</span><span class="o">.</span><span class="n">tz</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">414</span><span class="p">]:</span> <span class="n">tzfile</span><span class="p">(</span><span class="s1">&#39;/usr/share/zoneinfo/Europe/London&#39;</span><span class="p">)</span>

<span class="c1"># dateutil - utc special case</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">415</span><span class="p">]:</span> <span class="n">rng_utc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;3/6/2012 00:00&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">,</span>
   <span class="o">.....</span><span class="p">:</span>                         <span class="n">tz</span><span class="o">=</span><span class="n">dateutil</span><span class="o">.</span><span class="n">tz</span><span class="o">.</span><span class="n">tzutc</span><span class="p">())</span>
   <span class="o">.....</span><span class="p">:</span> 

<span class="n">In</span> <span class="p">[</span><span class="mi">416</span><span class="p">]:</span> <span class="n">rng_utc</span><span class="o">.</span><span class="n">tz</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">416</span><span class="p">]:</span> <span class="n">tzutc</span><span class="p">()</span>
</pre></div>
</div>
<p><em>0.25.0 版新增。</em></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># datetime.timezone</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">417</span><span class="p">]:</span> <span class="n">rng_utc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;3/6/2012 00:00&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">,</span>
   <span class="o">.....</span><span class="p">:</span>                         <span class="n">tz</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
   <span class="o">.....</span><span class="p">:</span> 

<span class="n">In</span> <span class="p">[</span><span class="mi">418</span><span class="p">]:</span> <span class="n">rng_utc</span><span class="o">.</span><span class="n">tz</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">418</span><span class="p">]:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span>
</pre></div>
</div>
<p>注意， <code class="docutils literal notranslate"><span class="pre">dateutil</span></code> 的 <code class="docutils literal notranslate"><span class="pre">UTC</span></code> 时区是个特例，要显式地创建 <code class="docutils literal notranslate"><span class="pre">dateutil.tz.tzutc</span></code> 实例。可以先创建其它时区对象。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">419</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">pytz</span>

<span class="c1"># pytz</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">420</span><span class="p">]:</span> <span class="n">tz_pytz</span> <span class="o">=</span> <span class="n">pytz</span><span class="o">.</span><span class="n">timezone</span><span class="p">(</span><span class="s1">&#39;Europe/London&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">421</span><span class="p">]:</span> <span class="n">rng_pytz</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;3/6/2012 00:00&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">422</span><span class="p">]:</span> <span class="n">rng_pytz</span> <span class="o">=</span> <span class="n">rng_pytz</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="n">tz_pytz</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">423</span><span class="p">]:</span> <span class="n">rng_pytz</span><span class="o">.</span><span class="n">tz</span> <span class="o">==</span> <span class="n">tz_pytz</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">423</span><span class="p">]:</span> <span class="kc">True</span>

<span class="c1"># dateutil</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">424</span><span class="p">]:</span> <span class="n">tz_dateutil</span> <span class="o">=</span> <span class="n">dateutil</span><span class="o">.</span><span class="n">tz</span><span class="o">.</span><span class="n">gettz</span><span class="p">(</span><span class="s1">&#39;Europe/London&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">425</span><span class="p">]:</span> <span class="n">rng_dateutil</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;3/6/2012 00:00&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">,</span>
   <span class="o">.....</span><span class="p">:</span>                              <span class="n">tz</span><span class="o">=</span><span class="n">tz_dateutil</span><span class="p">)</span>
   <span class="o">.....</span><span class="p">:</span> 

<span class="n">In</span> <span class="p">[</span><span class="mi">426</span><span class="p">]:</span> <span class="n">rng_dateutil</span><span class="o">.</span><span class="n">tz</span> <span class="o">==</span> <span class="n">tz_dateutil</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">426</span><span class="p">]:</span> <span class="kc">True</span>
</pre></div>
</div>
<p>不同时区之间转换带时区的 Pandas 对象时，用 <code class="docutils literal notranslate"><span class="pre">tz_convert</span></code> 方法。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">427</span><span class="p">]:</span> <span class="n">rng_pytz</span><span class="o">.</span><span class="n">tz_convert</span><span class="p">(</span><span class="s1">&#39;US/Eastern&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">427</span><span class="p">]:</span> 
<span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2012-03-05 19:00:00-05:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2012-03-06 19:00:00-05:00&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2012-03-07 19:00:00-05:00&#39;</span><span class="p">],</span>
              <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns, US/Eastern]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>::: tip 注意</p>
<p>使用 <code class="docutils literal notranslate"><span class="pre">pytz</span></code> 时区时，对于相同的输入时区，<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DatetimeIndex.html#pandas.DatetimeIndex"><code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code></a> 会构建一个与 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Timestamp.html#pandas.Timestamp"><code class="docutils literal notranslate"><span class="pre">Timestamp</span></code></a>  不同的时区对象。<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DatetimeIndex.html#pandas.DatetimeIndex"><code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code></a> 具有一组 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Timestamp.html#pandas.Timestamp"><code class="docutils literal notranslate"><span class="pre">Timestamp</span></code></a> 对象，UTC 偏移量也不同，不能用一个 <code class="docutils literal notranslate"><span class="pre">pytz</span></code> 时区实例简洁地表示，<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Timestamp.html#pandas.Timestamp"><code class="docutils literal notranslate"><span class="pre">Timestamp</span></code></a> 则可以用来指定 UTC 偏移量表示一个时点。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">428</span><span class="p">]:</span> <span class="n">dti</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;2019-01-01&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s1">&#39;US/Pacific&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">429</span><span class="p">]:</span> <span class="n">dti</span><span class="o">.</span><span class="n">tz</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">429</span><span class="p">]:</span> <span class="o">&lt;</span><span class="n">DstTzInfo</span> <span class="s1">&#39;US/Pacific&#39;</span> <span class="n">LMT</span><span class="o">-</span><span class="mi">1</span> <span class="n">day</span><span class="p">,</span> <span class="mi">16</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">00</span> <span class="n">STD</span><span class="o">&gt;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">430</span><span class="p">]:</span> <span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2019-01-01&#39;</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s1">&#39;US/Pacific&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">431</span><span class="p">]:</span> <span class="n">ts</span><span class="o">.</span><span class="n">tz</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">431</span><span class="p">]:</span> <span class="o">&lt;</span><span class="n">DstTzInfo</span> <span class="s1">&#39;US/Pacific&#39;</span> <span class="n">PST</span><span class="o">-</span><span class="mi">1</span> <span class="n">day</span><span class="p">,</span> <span class="mi">16</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span> <span class="n">STD</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>:::</p>
<p>::: danger 警告</p>
<p>注意不同支持库之间的转换。一些时区，<code class="docutils literal notranslate"><span class="pre">pytz</span></code> 与 <code class="docutils literal notranslate"><span class="pre">datetuil</span></code> 对时区的定义不一样。与 <code class="docutils literal notranslate"><span class="pre">US/Eastern</span></code> 等“标准”时区相比，那些更少见的时区的问题更严重。</p>
<p>:::</p>
<p>::: danger 警告</p>
<p>注意不同版本时区支持库对时区的定义并不一致。在处理本地存储数据时使用一种版本的支持库，在运算时使用另一种版本的支持库，可能会引起问题。参阅<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/io.html#io-hdf5-notes">本文</a>了解如何处理这种问题。</p>
<p>:::</p>
<p>::: danger 警告</p>
<p>对于 <code class="docutils literal notranslate"><span class="pre">pytz</span></code> 时区，直接把时区对象传递给 <code class="docutils literal notranslate"><span class="pre">datetime.datetime</span></code> 构建器是不对的，如，<code class="docutils literal notranslate"><span class="pre">datetime.datetime(2011,</span> <span class="pre">1,</span> <span class="pre">1,</span> <span class="pre">tz=pytz.timezone('US/Eastern'))</span></code>。反之，datetime 要在 <code class="docutils literal notranslate"><span class="pre">pytz</span></code> 时区对象上使用 <code class="docutils literal notranslate"><span class="pre">localize</span></code> 方法。</p>
<p>:::</p>
<p>在后台，所有 Timestamp 都存储为 UTC。含时区信息的 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DatetimeIndex.html#pandas.DatetimeIndex"><code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code></a> 或 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Timestamp.html#pandas.Timestamp"><code class="docutils literal notranslate"><span class="pre">Timestamp</span></code></a> 的值有其自己的本地化时区字段（日、小时、分钟等）。不过，对于不同时区时间戳，如果其 UTC 值相同，将被视作是相等的时间。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">432</span><span class="p">]:</span> <span class="n">rng_eastern</span> <span class="o">=</span> <span class="n">rng_utc</span><span class="o">.</span><span class="n">tz_convert</span><span class="p">(</span><span class="s1">&#39;US/Eastern&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">433</span><span class="p">]:</span> <span class="n">rng_berlin</span> <span class="o">=</span> <span class="n">rng_utc</span><span class="o">.</span><span class="n">tz_convert</span><span class="p">(</span><span class="s1">&#39;Europe/Berlin&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">434</span><span class="p">]:</span> <span class="n">rng_eastern</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">434</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2012-03-07 19:00:00-0500&#39;</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s1">&#39;US/Eastern&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">435</span><span class="p">]:</span> <span class="n">rng_berlin</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">435</span><span class="p">]:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2012-03-08 01:00:00+0100&#39;</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s1">&#39;Europe/Berlin&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">436</span><span class="p">]:</span> <span class="n">rng_eastern</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">rng_berlin</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">436</span><span class="p">]:</span> <span class="kc">True</span>
</pre></div>
</div>
<p>不同时区 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.html#pandas.Series"><code class="docutils literal notranslate"><span class="pre">Series</span></code></a> 之间的操作生成的是与 UTC 时间戳数据对齐的 UTC <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.html#pandas.Series"><code class="docutils literal notranslate"><span class="pre">Series</span></code></a>。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">437</span><span class="p">]:</span> <span class="n">ts_utc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;20130101&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s1">&#39;UTC&#39;</span><span class="p">))</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">438</span><span class="p">]:</span> <span class="n">eastern</span> <span class="o">=</span> <span class="n">ts_utc</span><span class="o">.</span><span class="n">tz_convert</span><span class="p">(</span><span class="s1">&#39;US/Eastern&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">439</span><span class="p">]:</span> <span class="n">berlin</span> <span class="o">=</span> <span class="n">ts_utc</span><span class="o">.</span><span class="n">tz_convert</span><span class="p">(</span><span class="s1">&#39;Europe/Berlin&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">440</span><span class="p">]:</span> <span class="n">result</span> <span class="o">=</span> <span class="n">eastern</span> <span class="o">+</span> <span class="n">berlin</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">441</span><span class="p">]:</span> <span class="n">result</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">441</span><span class="p">]:</span> 
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="o">+</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>    <span class="mi">0</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="o">+</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>    <span class="mi">2</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="o">+</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>    <span class="mi">4</span>
<span class="n">Freq</span><span class="p">:</span> <span class="n">D</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">442</span><span class="p">]:</span> <span class="n">result</span><span class="o">.</span><span class="n">index</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">442</span><span class="p">]:</span> 
<span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2013-01-01 00:00:00+00:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2013-01-02 00:00:00+00:00&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2013-01-03 00:00:00+00:00&#39;</span><span class="p">],</span>
              <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns, UTC]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>用 <code class="docutils literal notranslate"><span class="pre">tz_localize(None)</span></code> 或 <code class="docutils literal notranslate"><span class="pre">tz_convert(None)</span></code> 去掉时区信息。<code class="docutils literal notranslate"><span class="pre">tz_localize(None)</span></code> 去掉带本地时间表示的时区信息。<code class="docutils literal notranslate"><span class="pre">tz_convert(None)</span></code>先把时间戳转为 UTC 时间，再去掉时区信息。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">443</span><span class="p">]:</span> <span class="n">didx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="s1">&#39;2014-08-01 09:00&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;H&#39;</span><span class="p">,</span>
   <span class="o">.....</span><span class="p">:</span>                      <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s1">&#39;US/Eastern&#39;</span><span class="p">)</span>
   <span class="o">.....</span><span class="p">:</span> 

<span class="n">In</span> <span class="p">[</span><span class="mi">444</span><span class="p">]:</span> <span class="n">didx</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">444</span><span class="p">]:</span> 
<span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2014-08-01 09:00:00-04:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2014-08-01 10:00:00-04:00&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2014-08-01 11:00:00-04:00&#39;</span><span class="p">],</span>
              <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns, US/Eastern]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;H&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">445</span><span class="p">]:</span> <span class="n">didx</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">445</span><span class="p">]:</span> 
<span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2014-08-01 09:00:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2014-08-01 10:00:00&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2014-08-01 11:00:00&#39;</span><span class="p">],</span>
              <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;H&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">446</span><span class="p">]:</span> <span class="n">didx</span><span class="o">.</span><span class="n">tz_convert</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">446</span><span class="p">]:</span> 
<span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2014-08-01 13:00:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2014-08-01 14:00:00&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2014-08-01 15:00:00&#39;</span><span class="p">],</span>
              <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;H&#39;</span><span class="p">)</span>

<span class="c1"># tz_convert(None) 等同于 tz_convert(&#39;UTC&#39;).tz_localize(None)</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">447</span><span class="p">]:</span> <span class="n">didx</span><span class="o">.</span><span class="n">tz_convert</span><span class="p">(</span><span class="s1">&#39;UTC&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">447</span><span class="p">]:</span> 
<span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2014-08-01 13:00:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2014-08-01 14:00:00&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2014-08-01 15:00:00&#39;</span><span class="p">],</span>
              <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;H&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id44">
<h3>本地化导致的混淆时间<a class="headerlink" href="#id44" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">tz_localize</span></code> 不能决定时间戳的 UTC偏移量，因为本地时区的夏时制（DST）会引起一些时间在一天内出现两次的问题（“时钟回调”）。下面的选项是有效的：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">raise</span></code>：默认触发 <code class="docutils literal notranslate"><span class="pre">pytz.AmbiguousTimeError</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">infer</span></code>：依据时间戳的单一性，尝试推断正确的偏移量</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">NaT</span></code>：用 <code class="docutils literal notranslate"><span class="pre">NaT</span></code> 替换混淆时间</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bool</span></code>：<code class="docutils literal notranslate"><span class="pre">True</span></code> 代表夏时制（DST）时间，<code class="docutils literal notranslate"><span class="pre">False</span></code> 代表正常时间。数组型的 <code class="docutils literal notranslate"><span class="pre">bool</span></code> 值支持一组时间序列。</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">448</span><span class="p">]:</span> <span class="n">rng_hourly</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;11/06/2011 00:00&#39;</span><span class="p">,</span> <span class="s1">&#39;11/06/2011 01:00&#39;</span><span class="p">,</span>
   <span class="o">.....</span><span class="p">:</span>                                <span class="s1">&#39;11/06/2011 01:00&#39;</span><span class="p">,</span> <span class="s1">&#39;11/06/2011 02:00&#39;</span><span class="p">])</span>
   <span class="o">.....</span><span class="p">:</span> 
</pre></div>
</div>
<p>这种操作会引起混淆时间失败错误（ ‘11/06/2011 01:00’）。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">rng_hourly</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="s1">&#39;US/Eastern&#39;</span><span class="p">)</span>
<span class="n">AmbiguousTimeError</span><span class="p">:</span> <span class="n">Cannot</span> <span class="n">infer</span> <span class="n">dst</span> <span class="n">time</span> <span class="kn">from</span> <span class="nn">Timestamp</span><span class="p">(</span><span class="s1">&#39;2011-11-06 01:00:00&#39;</span><span class="p">),</span> <span class="k">try</span> <span class="n">using</span> <span class="n">the</span> <span class="s1">&#39;ambiguous&#39;</span> <span class="n">argument</span>
</pre></div>
</div>
<p>用下列指定的关键字控制混淆时间。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">449</span><span class="p">]:</span> <span class="n">rng_hourly</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="s1">&#39;US/Eastern&#39;</span><span class="p">,</span> <span class="n">ambiguous</span><span class="o">=</span><span class="s1">&#39;infer&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">449</span><span class="p">]:</span> 
<span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2011-11-06 00:00:00-04:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-11-06 01:00:00-04:00&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2011-11-06 01:00:00-05:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-11-06 02:00:00-05:00&#39;</span><span class="p">],</span>
              <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns, US/Eastern]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">450</span><span class="p">]:</span> <span class="n">rng_hourly</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="s1">&#39;US/Eastern&#39;</span><span class="p">,</span> <span class="n">ambiguous</span><span class="o">=</span><span class="s1">&#39;NaT&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">450</span><span class="p">]:</span> 
<span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2011-11-06 00:00:00-04:00&#39;</span><span class="p">,</span> <span class="s1">&#39;NaT&#39;</span><span class="p">,</span> <span class="s1">&#39;NaT&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2011-11-06 02:00:00-05:00&#39;</span><span class="p">],</span>
              <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns, US/Eastern]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">451</span><span class="p">]:</span> <span class="n">rng_hourly</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="s1">&#39;US/Eastern&#39;</span><span class="p">,</span> <span class="n">ambiguous</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">451</span><span class="p">]:</span> 
<span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2011-11-06 00:00:00-04:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-11-06 01:00:00-04:00&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2011-11-06 01:00:00-05:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-11-06 02:00:00-05:00&#39;</span><span class="p">],</span>
              <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns, US/Eastern]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id45">
<h3>本地化时不存在的时间<a class="headerlink" href="#id45" title="永久链接至标题">¶</a></h3>
<p>夏时制转换会移位本地时间一个小时，这样会创建一个不存在的本地时间（“时钟春季前滚”）。这种本地化操作会导致时间序列出现不存在的时间，此问题可以用 <code class="docutils literal notranslate"><span class="pre">nonexistent</span></code> 参数解决。下列都是有效的选项：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">raise</span></code>：默认触发 <code class="docutils literal notranslate"><span class="pre">pytz.NonExistentTimeError</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">NaT</span></code>：用 <code class="docutils literal notranslate"><span class="pre">NaT</span></code> 替换不存在的时间</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">shift_forward</span></code>：把不存在的时间前移至最近的真实时间</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">shift_backward</span></code>：把不存在的时间后滚至最近的真实时间</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Timedelta</span></code> 对象：用 <code class="docutils literal notranslate"><span class="pre">timedelta</span></code> 移位不存在的时间</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">452</span><span class="p">]:</span> <span class="n">dti</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="s1">&#39;2015-03-29 02:30:00&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;H&#39;</span><span class="p">)</span>

<span class="c1"># 2:30 是不存在的时间</span>
</pre></div>
</div>
<p>对不存在的时间进行本地化操作默认会触发错误。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">dti</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="s1">&#39;Europe/Warsaw&#39;</span><span class="p">)</span>
<span class="n">NonExistentTimeError</span><span class="p">:</span> <span class="mi">2015</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">29</span> <span class="mi">02</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">00</span>
</pre></div>
</div>
<p>把不存在的时间转换为 <code class="docutils literal notranslate"><span class="pre">NaT</span></code> 或移位时间</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">453</span><span class="p">]:</span> <span class="n">dti</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">453</span><span class="p">]:</span> 
<span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2015-03-29 02:30:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2015-03-29 03:30:00&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2015-03-29 04:30:00&#39;</span><span class="p">],</span>
              <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;H&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">454</span><span class="p">]:</span> <span class="n">dti</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="s1">&#39;Europe/Warsaw&#39;</span><span class="p">,</span> <span class="n">nonexistent</span><span class="o">=</span><span class="s1">&#39;shift_forward&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">454</span><span class="p">]:</span> 
<span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2015-03-29 03:00:00+02:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2015-03-29 03:30:00+02:00&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2015-03-29 04:30:00+02:00&#39;</span><span class="p">],</span>
              <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns, Europe/Warsaw]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;H&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">455</span><span class="p">]:</span> <span class="n">dti</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="s1">&#39;Europe/Warsaw&#39;</span><span class="p">,</span> <span class="n">nonexistent</span><span class="o">=</span><span class="s1">&#39;shift_backward&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">455</span><span class="p">]:</span> 
<span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2015-03-29 01:59:59.999999999+01:00&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;2015-03-29 03:30:00+02:00&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;2015-03-29 04:30:00+02:00&#39;</span><span class="p">],</span>
              <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns, Europe/Warsaw]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;H&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">456</span><span class="p">]:</span> <span class="n">dti</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="s1">&#39;Europe/Warsaw&#39;</span><span class="p">,</span> <span class="n">nonexistent</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;H&#39;</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">456</span><span class="p">]:</span> 
<span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2015-03-29 03:30:00+02:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2015-03-29 03:30:00+02:00&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2015-03-29 04:30:00+02:00&#39;</span><span class="p">],</span>
              <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns, Europe/Warsaw]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;H&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">457</span><span class="p">]:</span> <span class="n">dti</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="s1">&#39;Europe/Warsaw&#39;</span><span class="p">,</span> <span class="n">nonexistent</span><span class="o">=</span><span class="s1">&#39;NaT&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">457</span><span class="p">]:</span> 
<span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;NaT&#39;</span><span class="p">,</span> <span class="s1">&#39;2015-03-29 03:30:00+02:00&#39;</span><span class="p">,</span>
               <span class="s1">&#39;2015-03-29 04:30:00+02:00&#39;</span><span class="p">],</span>
              <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns, Europe/Warsaw]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;H&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id46">
<h3>时区序列操作<a class="headerlink" href="#id46" title="永久链接至标题">¶</a></h3>
<p>无时区 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.html#pandas.Series"><code class="docutils literal notranslate"><span class="pre">Series</span></code></a>  值的数据类型是 datetime64[ns]。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">458</span><span class="p">]:</span> <span class="n">s_naive</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;20130101&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">459</span><span class="p">]:</span> <span class="n">s_naive</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">459</span><span class="p">]:</span> 
<span class="mi">0</span>   <span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span>
<span class="mi">1</span>   <span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span>
<span class="mi">2</span>   <span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">datetime64</span><span class="p">[</span><span class="n">ns</span><span class="p">]</span>
</pre></div>
</div>
<p>有时区 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.html#pandas.Series"><code class="docutils literal notranslate"><span class="pre">Series</span></code></a> 值的数据类型是 datetime64[ns, tz]，<code class="docutils literal notranslate"><span class="pre">tz</span></code> 指的是时区。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">460</span><span class="p">]:</span> <span class="n">s_aware</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;20130101&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s1">&#39;US/Eastern&#39;</span><span class="p">))</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">461</span><span class="p">]:</span> <span class="n">s_aware</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">461</span><span class="p">]:</span> 
<span class="mi">0</span>   <span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="o">-</span><span class="mi">05</span><span class="p">:</span><span class="mi">00</span>
<span class="mi">1</span>   <span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="o">-</span><span class="mi">05</span><span class="p">:</span><span class="mi">00</span>
<span class="mi">2</span>   <span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="o">-</span><span class="mi">05</span><span class="p">:</span><span class="mi">00</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">datetime64</span><span class="p">[</span><span class="n">ns</span><span class="p">,</span> <span class="n">US</span><span class="o">/</span><span class="n">Eastern</span><span class="p">]</span>
</pre></div>
</div>
<p>这两种 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.html#pandas.Series"><code class="docutils literal notranslate"><span class="pre">Series</span></code></a> 的时区信息都可以用 <code class="docutils literal notranslate"><span class="pre">.dt</span></code> 访问器操控，参阅 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/getting_started/basics.html#basics-dt-accessors">dt 访问器</a>。</p>
<p>例如，本地化与把无时区时间戳转换为有时区时间戳。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">462</span><span class="p">]:</span> <span class="n">s_naive</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="s1">&#39;UTC&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz_convert</span><span class="p">(</span><span class="s1">&#39;US/Eastern&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">462</span><span class="p">]:</span> 
<span class="mi">0</span>   <span class="mi">2012</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">31</span> <span class="mi">19</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="o">-</span><span class="mi">05</span><span class="p">:</span><span class="mi">00</span>
<span class="mi">1</span>   <span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">19</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="o">-</span><span class="mi">05</span><span class="p">:</span><span class="mi">00</span>
<span class="mi">2</span>   <span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span> <span class="mi">19</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="o">-</span><span class="mi">05</span><span class="p">:</span><span class="mi">00</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">datetime64</span><span class="p">[</span><span class="n">ns</span><span class="p">,</span> <span class="n">US</span><span class="o">/</span><span class="n">Eastern</span><span class="p">]</span>
</pre></div>
</div>
<p>时区信息还可以用 <code class="docutils literal notranslate"><span class="pre">astype</span></code> 操控。这种方法可以本地化并转换无时区时间戳或转换有时区时间戳。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 本地化，并把无时区转换为有时区</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">463</span><span class="p">]:</span> <span class="n">s_naive</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;datetime64[ns, US/Eastern]&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">463</span><span class="p">]:</span> 
<span class="mi">0</span>   <span class="mi">2012</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">31</span> <span class="mi">19</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="o">-</span><span class="mi">05</span><span class="p">:</span><span class="mi">00</span>
<span class="mi">1</span>   <span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">19</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="o">-</span><span class="mi">05</span><span class="p">:</span><span class="mi">00</span>
<span class="mi">2</span>   <span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span> <span class="mi">19</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="o">-</span><span class="mi">05</span><span class="p">:</span><span class="mi">00</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">datetime64</span><span class="p">[</span><span class="n">ns</span><span class="p">,</span> <span class="n">US</span><span class="o">/</span><span class="n">Eastern</span><span class="p">]</span>

<span class="c1"># 把有时区变为无时区</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">464</span><span class="p">]:</span> <span class="n">s_aware</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">464</span><span class="p">]:</span> 
<span class="mi">0</span>   <span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">05</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>
<span class="mi">1</span>   <span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span> <span class="mi">05</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>
<span class="mi">2</span>   <span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span> <span class="mi">05</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">datetime64</span><span class="p">[</span><span class="n">ns</span><span class="p">]</span>

<span class="c1"># 转换为新的时区</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">465</span><span class="p">]:</span> <span class="n">s_aware</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;datetime64[ns, CET]&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">465</span><span class="p">]:</span> 
<span class="mi">0</span>   <span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">06</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="o">+</span><span class="mi">01</span><span class="p">:</span><span class="mi">00</span>
<span class="mi">1</span>   <span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span> <span class="mi">06</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="o">+</span><span class="mi">01</span><span class="p">:</span><span class="mi">00</span>
<span class="mi">2</span>   <span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span> <span class="mi">06</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="o">+</span><span class="mi">01</span><span class="p">:</span><span class="mi">00</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">datetime64</span><span class="p">[</span><span class="n">ns</span><span class="p">,</span> <span class="n">CET</span><span class="p">]</span>
</pre></div>
</div>
<p>::: tip 注意</p>
<p>在 <code class="docutils literal notranslate"><span class="pre">Series</span></code> 上应用 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.to_numpy.html#pandas.Series.to_numpy"><code class="docutils literal notranslate"><span class="pre">Series.to_numpy()</span></code></a>，返回数据的 NumPy 数组。虽然 NumPy 可以<strong>输出</strong>本地时区！但其实它当前并不支持时区，因此，有时区时间戳数据返回的是时间戳对象数组：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">466</span><span class="p">]:</span> <span class="n">s_naive</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">466</span><span class="p">]:</span> 
<span class="n">array</span><span class="p">([</span><span class="s1">&#39;2013-01-01T00:00:00.000000000&#39;</span><span class="p">,</span> <span class="s1">&#39;2013-01-02T00:00:00.000000000&#39;</span><span class="p">,</span>
       <span class="s1">&#39;2013-01-03T00:00:00.000000000&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">467</span><span class="p">]:</span> <span class="n">s_aware</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">467</span><span class="p">]:</span> 
<span class="n">array</span><span class="p">([</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2013-01-01 00:00:00-0500&#39;</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s1">&#39;US/Eastern&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">),</span>
       <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2013-01-02 00:00:00-0500&#39;</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s1">&#39;US/Eastern&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">),</span>
       <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2013-01-03 00:00:00-0500&#39;</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s1">&#39;US/Eastern&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">)],</span>
      <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
</pre></div>
</div>
<p>通过转换时间戳数组，保留时区信息。例如，转换回 <code class="docutils literal notranslate"><span class="pre">Series</span></code> 时：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">468</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">s_aware</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">468</span><span class="p">]:</span> 
<span class="mi">0</span>   <span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="o">-</span><span class="mi">05</span><span class="p">:</span><span class="mi">00</span>
<span class="mi">1</span>   <span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="o">-</span><span class="mi">05</span><span class="p">:</span><span class="mi">00</span>
<span class="mi">2</span>   <span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="o">-</span><span class="mi">05</span><span class="p">:</span><span class="mi">00</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">datetime64</span><span class="p">[</span><span class="n">ns</span><span class="p">,</span> <span class="n">US</span><span class="o">/</span><span class="n">Eastern</span><span class="p">]</span>
</pre></div>
</div>
<p>如果需要 NumPy <code class="docutils literal notranslate"><span class="pre">datetime64[ns]</span></code> 数组（带已转为 UTC 的值）而不是对象数组，可以指定 <code class="docutils literal notranslate"><span class="pre">dtype</span></code> 参数：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">469</span><span class="p">]:</span> <span class="n">s_aware</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">469</span><span class="p">]:</span> 
<span class="n">array</span><span class="p">([</span><span class="s1">&#39;2013-01-01T05:00:00.000000000&#39;</span><span class="p">,</span> <span class="s1">&#39;2013-01-02T05:00:00.000000000&#39;</span><span class="p">,</span>
       <span class="s1">&#39;2013-01-03T05:00:00.000000000&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>:::</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../demo.html" class="btn btn-neutral float-right" title="AkShare 策略示例" accesskey="n" rel="next">下一页 <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="pandas-04.html" class="btn btn-neutral float-left" title="5. Pandas 数据结构" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> 上一页</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; 版权所有 2019–2020, AkShare developers

    </p>
  </div>
    
    
    
    利用 <a href="http://sphinx-doc.org/">Sphinx</a> 构建，使用了 
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">主题</a>
    
    由 <a href="https://readthedocs.org">Read the Docs</a>开发. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  
 
<script type="text/javascript">
!function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t){var e=document.createElement("script");e.type="text/javascript";e.async=!0;e.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)};analytics.SNIPPET_VERSION="3.1.0";
analytics.load("8UDQfnf3cyFSTsM4YANnW5sXmgZVILbA");
analytics.page();
}}();

analytics.ready(function () {
    ga('require', 'linker');
    ga('linker:autoLink', ['scrapinghub.com', 'crawlera.com']);
});
</script>


</body>
</html>