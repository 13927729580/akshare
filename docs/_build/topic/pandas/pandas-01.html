

<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>2. Pandas 基础用法 &mdash; AkShare 1.0.0 文档</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script src="../../_static/translations.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="搜索" href="../../search.html" />
    <link rel="next" title="3. Pandas 25 式" href="pandas-02.html" />
    <link rel="prev" title="1. Pandas 概览" href="pandas-00.html" />
    <meta name="referrer" content="no-referrer"/>
     

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> AkShare
          

          
          </a>

          
            
            
              <div class="version">
                1.0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="在文档中搜索" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">AkShare 概览</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">AkShare 安装指导</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributor.html">AkShare 贡献源码</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../answer.html">AkShare 答疑专栏</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial.html">AkShare 快速入门</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../data/index.html">AkShare 数据字典</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../anaconda.html">AkShare 环境配置</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../special.html">AkShare 特别说明</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../strategy.html">AkShare 量化策略</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../platform.html">AkShare 量化平台</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">AkShare 专题教程</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../anaconda/index.html">Anaconda 教程</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Pandas 教程</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="pandas-00.html">1. Pandas 概览</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">2. Pandas 基础用法</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#head-tail">2.1. Head 与 Tail</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id1">2.2. 属性与底层数据</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id2">2.3. 加速操作</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id3">2.4. 二进制操作</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id10">2.5. 描述性统计</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id14">2.6. 函数应用</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id22">2.7. 重置索引与更换标签</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id27">2.8. 迭代</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dt">2.9. .dt 访问器</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id28">2.10. 矢量化字符串方法</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id29">2.11. 排序</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id36">2.12. 复制</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id37">2.13. 数据类型</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id42">2.14. 基于 <code class="docutils literal notranslate"><span class="pre">dtype</span></code> 选择列</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="pandas-02.html">3. Pandas 25 式</a></li>
<li class="toctree-l3"><a class="reference internal" href="pandas-03.html">4. Pandas 10大新功能</a></li>
<li class="toctree-l3"><a class="reference internal" href="pandas-04.html">5. Pandas 数据结构</a></li>
<li class="toctree-l3"><a class="reference internal" href="pandas-05.html">6. 时间序列与日期用法</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../demo.html">AkShare 策略示例</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">AkShare 版本更新</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">AkShare</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">AkShare 专题教程</a> &raquo;</li>
        
          <li><a href="index.html">Pandas 教程</a> &raquo;</li>
        
      <li><span class="section-number">2. </span>Pandas 基础用法</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/topic/pandas/pandas-01.md.txt" rel="nofollow"> 查看页面源码</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="pandas">
<h1><span class="section-number">2. </span>Pandas 基础用法<a class="headerlink" href="#pandas" title="永久链接至标题">¶</a></h1>
<p>本节介绍 Pandas 数据结构的基础用法。下列代码创建上一节用过的示例数据对象：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;1/1/2000&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">])</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span>
   <span class="o">...</span><span class="p">:</span>                   <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">])</span>
   <span class="o">...</span><span class="p">:</span> 
</pre></div>
</div>
<div class="section" id="head-tail">
<h2><span class="section-number">2.1. </span>Head 与 Tail<a class="headerlink" href="#head-tail" title="永久链接至标题">¶</a></h2>
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.head.html#pandas.DataFrame.head"><code class="docutils literal notranslate"><span class="pre">head()</span></code></a> 与 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.tail.html#pandas.DataFrame.tail"><code class="docutils literal notranslate"><span class="pre">tail()</span></code></a>  用于快速预览 Series 与 DataFrame，默认显示 5 条数据，也可以指定显示数据的数量。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">long_series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">long_series</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span> 
<span class="mi">0</span>   <span class="o">-</span><span class="mf">1.157892</span>
<span class="mi">1</span>   <span class="o">-</span><span class="mf">1.344312</span>
<span class="mi">2</span>    <span class="mf">0.844885</span>
<span class="mi">3</span>    <span class="mf">1.075770</span>
<span class="mi">4</span>   <span class="o">-</span><span class="mf">0.109050</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">long_series</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">6</span><span class="p">]:</span> 
<span class="mi">997</span>   <span class="o">-</span><span class="mf">0.289388</span>
<span class="mi">998</span>   <span class="o">-</span><span class="mf">1.020544</span>
<span class="mi">999</span>    <span class="mf">0.589993</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</pre></div>
</div>
</div>
<div class="section" id="id1">
<h2><span class="section-number">2.2. </span>属性与底层数据<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h2>
<p>Pandas 可以通过多个属性访问元数据：</p>
<ul class="simple">
<li><p><strong>shape</strong>:</p>
<ul>
<li><p>输出对象的轴维度，与 ndarray 一致</p></li>
</ul>
</li>
<li><p><strong>轴标签</strong></p>
<ul>
<li><p><strong>Series</strong>: <em>Index</em> (仅有此轴)</p></li>
<li><p><strong>DataFrame</strong>: <em>Index</em> (行) 与<em>列</em></p></li>
</ul>
</li>
</ul>
<p>注意： <strong>为属性赋值是安全的</strong>！</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">df</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span> 
                   <span class="n">A</span>         <span class="n">B</span>         <span class="n">C</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="o">-</span><span class="mf">0.173215</span>  <span class="mf">0.119209</span> <span class="o">-</span><span class="mf">1.044236</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span> <span class="o">-</span><span class="mf">0.861849</span> <span class="o">-</span><span class="mf">2.104569</span> <span class="o">-</span><span class="mf">0.494929</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">df</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">9</span><span class="p">]:</span> 
                   <span class="n">a</span>         <span class="n">b</span>         <span class="n">c</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="o">-</span><span class="mf">0.173215</span>  <span class="mf">0.119209</span> <span class="o">-</span><span class="mf">1.044236</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span> <span class="o">-</span><span class="mf">0.861849</span> <span class="o">-</span><span class="mf">2.104569</span> <span class="o">-</span><span class="mf">0.494929</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span>  <span class="mf">1.071804</span>  <span class="mf">0.721555</span> <span class="o">-</span><span class="mf">0.706771</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">04</span> <span class="o">-</span><span class="mf">1.039575</span>  <span class="mf">0.271860</span> <span class="o">-</span><span class="mf">0.424972</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">05</span>  <span class="mf">0.567020</span>  <span class="mf">0.276232</span> <span class="o">-</span><span class="mf">1.087401</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">06</span> <span class="o">-</span><span class="mf">0.673690</span>  <span class="mf">0.113648</span> <span class="o">-</span><span class="mf">1.478427</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">07</span>  <span class="mf">0.524988</span>  <span class="mf">0.404705</span>  <span class="mf">0.577046</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span> <span class="o">-</span><span class="mf">1.715002</span> <span class="o">-</span><span class="mf">1.039268</span> <span class="o">-</span><span class="mf">0.370647</span>
</pre></div>
</div>
<p>Pandas 对象（<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Index.html#pandas.Index"><code class="docutils literal notranslate"><span class="pre">Index</span></code></a>， <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.html#pandas.Series"><code class="docutils literal notranslate"><span class="pre">Series</span></code></a>， <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame"><code class="docutils literal notranslate"><span class="pre">DataFrame</span></code></a>）相当于数组的容器，用于存储数据、执行计算。大部分类型的底层数组都是 <a class="reference external" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.ndarray.html#numpy.ndarray"><code class="docutils literal notranslate"><span class="pre">numpy.ndarray</span></code></a>。不过，Pandas 与第三方支持库一般都会扩展 NumPy 类型系统，添加自定义数组（见<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/getting_started/basics.html#basics-dtypes">数据类型</a>）。</p>
<p><code class="docutils literal notranslate"><span class="pre">.array</span></code> 属性用于提取  <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Index.html#pandas.Index"><code class="docutils literal notranslate"><span class="pre">Index</span></code></a> 或 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.html#pandas.Series"><code class="docutils literal notranslate"><span class="pre">Series</span></code></a>  里的数据。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="n">s</span><span class="o">.</span><span class="n">array</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">10</span><span class="p">]:</span> 
<span class="o">&lt;</span><span class="n">PandasArray</span><span class="o">&gt;</span>
<span class="p">[</span> <span class="mf">0.4691122999071863</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2828633443286633</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5090585031735124</span><span class="p">,</span>
 <span class="o">-</span><span class="mf">1.1356323710171934</span><span class="p">,</span>  <span class="mf">1.2121120250208506</span><span class="p">]</span>
<span class="n">Length</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">s</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">array</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">11</span><span class="p">]:</span> 
<span class="o">&lt;</span><span class="n">PandasArray</span><span class="o">&gt;</span>
<span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">]</span>
<span class="n">Length</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>
</pre></div>
</div>
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.array.html#pandas.Series.array"><code class="docutils literal notranslate"><span class="pre">array</span></code></a> 一般指 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.api.extensions.ExtensionArray.html#pandas.api.extensions.ExtensionArray"><code class="docutils literal notranslate"><span class="pre">ExtensionArray</span></code></a>。至于什么是 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.api.extensions.ExtensionArray.html#pandas.api.extensions.ExtensionArray"><code class="docutils literal notranslate"><span class="pre">ExtensionArray</span></code></a> 及 Pandas 为什么要用 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.api.extensions.ExtensionArray.html#pandas.api.extensions.ExtensionArray"><code class="docutils literal notranslate"><span class="pre">ExtensionArray</span></code></a> 不是本节要说明的内容。更多信息请参阅<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/getting_started/basics.html#basics-dtypes">数据类型</a>。</p>
<p>提取 NumPy 数组，用 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.to_numpy.html#pandas.Series.to_numpy"><code class="docutils literal notranslate"><span class="pre">to_numpy()</span></code></a> 或 <code class="docutils literal notranslate"><span class="pre">numpy.asarray()</span></code>。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="n">s</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="n">array</span><span class="p">([</span> <span class="mf">0.4691</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2829</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5091</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.1356</span><span class="p">,</span>  <span class="mf">1.2121</span><span class="p">])</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="n">array</span><span class="p">([</span> <span class="mf">0.4691</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2829</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5091</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.1356</span><span class="p">,</span>  <span class="mf">1.2121</span><span class="p">])</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Series</span></code> 与 <code class="docutils literal notranslate"><span class="pre">Index</span></code> 的类型是 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.api.extensions.ExtensionArray.html#pandas.api.extensions.ExtensionArray"><code class="docutils literal notranslate"><span class="pre">ExtensionArray</span></code></a> 时， <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.to_numpy.html#pandas.Series.to_numpy"><code class="docutils literal notranslate"><span class="pre">to_numpy()</span></code></a> 会复制数据，并强制转换值。详情见<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/getting_started/basics.html#basics-dtypes">数据类型</a>。</p>
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.to_numpy.html#pandas.Series.to_numpy"><code class="docutils literal notranslate"><span class="pre">to_numpy()</span></code></a> 可以控制 <a class="reference external" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.ndarray.html#numpy.ndarray"><code class="docutils literal notranslate"><span class="pre">numpy.ndarray</span></code></a> 生成的数据类型。以带时区的 datetime 为例，NumPy 未提供时区信息的 datetime 数据类型，Pandas 则提供了两种表现形式：</p>
<ol class="simple">
<li><p>一种是带 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Timestamp.html#pandas.Timestamp"><code class="docutils literal notranslate"><span class="pre">Timestamp</span></code></a> 的 <a class="reference external" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.ndarray.html#numpy.ndarray"><code class="docutils literal notranslate"><span class="pre">numpy.ndarray</span></code></a>，提供了正确的 <code class="docutils literal notranslate"><span class="pre">tz</span></code> 信息。</p></li>
<li><p>另一种是 <code class="docutils literal notranslate"><span class="pre">datetime64[ns]</span></code>，这也是一种 <a class="reference external" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.ndarray.html#numpy.ndarray"><code class="docutils literal notranslate"><span class="pre">numpy.ndarray</span></code></a>，值被转换为 UTC，但去掉了时区信息。</p></li>
</ol>
<p>时区信息可以用 <code class="docutils literal notranslate"><span class="pre">dtype=object</span></code> 保存。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="n">ser</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;2000&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s2">&quot;CET&quot;</span><span class="p">))</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="n">ser</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">15</span><span class="p">]:</span> 
<span class="n">array</span><span class="p">([</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2000-01-01 00:00:00+0100&#39;</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s1">&#39;CET&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">),</span>
       <span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2000-01-02 00:00:00+0100&#39;</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s1">&#39;CET&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">)],</span>
      <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
</pre></div>
</div>
<p>或用 <code class="docutils literal notranslate"><span class="pre">dtype='datetime64[ns]'</span></code> 去除。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="n">ser</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;datetime64[ns]&quot;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">16</span><span class="p">]:</span> 
<span class="n">array</span><span class="p">([</span><span class="s1">&#39;1999-12-31T23:00:00.000000000&#39;</span><span class="p">,</span> <span class="s1">&#39;2000-01-01T23:00:00.000000000&#39;</span><span class="p">],</span>
      <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>提取 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 里的<strong>原数据</strong>稍微有点复杂。DataFrame 里所有列的数据类型都一样时，<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.to_numpy.html#pandas.DataFrame.to_numpy"><code class="docutils literal notranslate"><span class="pre">DataFrame.to_numpy()</span></code></a> 返回底层数据：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">17</span><span class="p">]:</span> 
<span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mf">0.1732</span><span class="p">,</span>  <span class="mf">0.1192</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0442</span><span class="p">],</span>
       <span class="p">[</span><span class="o">-</span><span class="mf">0.8618</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.1046</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.4949</span><span class="p">],</span>
       <span class="p">[</span> <span class="mf">1.0718</span><span class="p">,</span>  <span class="mf">0.7216</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.7068</span><span class="p">],</span>
       <span class="p">[</span><span class="o">-</span><span class="mf">1.0396</span><span class="p">,</span>  <span class="mf">0.2719</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.425</span> <span class="p">],</span>
       <span class="p">[</span> <span class="mf">0.567</span> <span class="p">,</span>  <span class="mf">0.2762</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0874</span><span class="p">],</span>
       <span class="p">[</span><span class="o">-</span><span class="mf">0.6737</span><span class="p">,</span>  <span class="mf">0.1136</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.4784</span><span class="p">],</span>
       <span class="p">[</span> <span class="mf">0.525</span> <span class="p">,</span>  <span class="mf">0.4047</span><span class="p">,</span>  <span class="mf">0.577</span> <span class="p">],</span>
       <span class="p">[</span><span class="o">-</span><span class="mf">1.715</span> <span class="p">,</span> <span class="o">-</span><span class="mf">1.0393</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.3706</span><span class="p">]])</span>
</pre></div>
</div>
<p>DataFrame 为同构型数据时，Pandas 直接修改原始 <code class="docutils literal notranslate"><span class="pre">ndarray</span></code>，所做修改会直接反应在数据结构里。对于异质型数据，即 DataFrame 列的数据类型不一样时，就不是这种操作模式了。与轴标签不同，不能为值的属性赋值。</p>
<p>::: tip 注意</p>
<p>处理异质型数据时，输出结果 <code class="docutils literal notranslate"><span class="pre">ndarray</span></code> 的数据类型适用于涉及的各类数据。若 DataFrame 里包含字符串，输出结果的数据类型就是 <code class="docutils literal notranslate"><span class="pre">object</span></code>。要是只有浮点数或整数，则输出结果的数据类型是浮点数。</p>
<p>:::</p>
<p>以前，Pandas 推荐用 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.values.html#pandas.Series.values"><code class="docutils literal notranslate"><span class="pre">Series.values</span></code></a> 或 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.values.html#pandas.DataFrame.values"><code class="docutils literal notranslate"><span class="pre">DataFrame.values</span></code></a> 从 Series 或 DataFrame 里提取数据。旧有代码库或在线教程里仍在用这种操作，但 Pandas 已改进了此功能，现在，推荐用 <code class="docutils literal notranslate"><span class="pre">.array</span></code> 或 <code class="docutils literal notranslate"><span class="pre">to_numpy</span></code> 提取数据，别再用 <code class="docutils literal notranslate"><span class="pre">.values</span></code> 了。<code class="docutils literal notranslate"><span class="pre">.values</span></code> 有以下几个缺点：</p>
<ol class="simple">
<li><p>Series 含<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/development/extending.html#extending-extension-types">扩展类型</a>时，<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.values.html#pandas.Series.values">Series.values</a> 无法判断到底是该返回 NumPy <code class="docutils literal notranslate"><span class="pre">array</span></code>，还是返回 <code class="docutils literal notranslate"><span class="pre">ExtensionArray</span></code>。而 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.array.html#pandas.Series.array"><code class="docutils literal notranslate"><span class="pre">Series.array</span></code></a> 则只返回 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.api.extensions.ExtensionArray.html#pandas.api.extensions.ExtensionArray"><code class="docutils literal notranslate"><span class="pre">ExtensionArray</span></code></a>，且不会复制数据。<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.to_numpy.html#pandas.Series.to_numpy"><code class="docutils literal notranslate"><span class="pre">Series.to_numpy()</span></code></a> 则返回 NumPy 数组，其代价是需要复制、并强制转换数据的值。</p></li>
<li><p>DataFrame 含多种数据类型时，<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.values.html#pandas.DataFrame.values"><code class="docutils literal notranslate"><span class="pre">DataFrame.values</span></code></a> 会复制数据，并将数据的值强制转换同一种数据类型，这是一种代价较高的操作。<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.to_numpy.html#pandas.DataFrame.to_numpy"><code class="docutils literal notranslate"><span class="pre">DataFrame.to_numpy()</span></code></a> 则返回 NumPy 数组，这种方式更清晰，也不会把 DataFrame 里的数据都当作一种类型。</p></li>
</ol>
</div>
<div class="section" id="id2">
<h2><span class="section-number">2.3. </span>加速操作<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h2>
<p>借助 <code class="docutils literal notranslate"><span class="pre">numexpr</span></code> 与 <code class="docutils literal notranslate"><span class="pre">bottleneck</span></code> 支持库，Pandas 可以加速特定类型的二进制数值与布尔操作。</p>
<p>处理大型数据集时，这两个支持库特别有用，加速效果也非常明显。 <code class="docutils literal notranslate"><span class="pre">numexpr</span></code> 使用智能分块、缓存与多核技术。<code class="docutils literal notranslate"><span class="pre">bottleneck</span></code> 是一组专属 cython 例程，处理含 <code class="docutils literal notranslate"><span class="pre">nans</span></code> 值的数组时，特别快。</p>
<p>请看下面这个例子（<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 包含 100 列 X 10 万行数据）:</p>
<table border="1" class="docutils">
<thead>
<tr>
<th align="center">操作</th>
<th align="center">0.11.0版 (ms)</th>
<th align="center">旧版 (ms)</th>
<th align="center">提升比率</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><code>df1 &gt; df2</code></td>
<td align="center">13.32</td>
<td align="center">125.35</td>
<td align="center">0.1063</td>
</tr>
<tr>
<td align="center"><code>df1 * df2</code></td>
<td align="center">21.71</td>
<td align="center">36.63</td>
<td align="center">0.5928</td>
</tr>
<tr>
<td align="center"><code>df1 + df2</code></td>
<td align="center">22.04</td>
<td align="center">36.50</td>
<td align="center">0.6039</td>
</tr>
</tbody>
</table><p>强烈建议安装这两个支持库，更多信息，请参阅<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/install.html#install-recommended-dependencies">推荐支持库</a>。</p>
<p>这两个支持库默认为启用状态，可用以下选项设置：</p>
<p><em>0.20.0 版新增。</em></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;compute.use_bottleneck&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;compute.use_numexpr&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h2><span class="section-number">2.4. </span>二进制操作<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h2>
<p>Pandas 数据结构之间执行二进制操作，要注意下列两个关键点：</p>
<ul class="simple">
<li><p>多维（DataFrame）与低维（Series）对象之间的广播机制；</p></li>
<li><p>计算中的缺失值处理。</p></li>
</ul>
<p>这两个问题可以同时处理，但下面先介绍怎么分开处理。</p>
<div class="section" id="id4">
<h3>匹配/广播机制<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h3>
<p>DataFrame 支持 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.add.html#pandas.DataFrame.add"><code class="docutils literal notranslate"><span class="pre">add()</span></code></a>、<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.sub.html#pandas.DataFrame.sub"><code class="docutils literal notranslate"><span class="pre">sub()</span></code></a>、<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.mul.html#pandas.DataFrame.mul"><code class="docutils literal notranslate"><span class="pre">mul()</span></code></a>、<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.div.html#pandas.DataFrame.div"><code class="docutils literal notranslate"><span class="pre">div()</span></code></a> 及 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.radd.html#pandas.DataFrame.radd"><code class="docutils literal notranslate"><span class="pre">radd()</span></code></a>、<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.rsub.html#pandas.DataFrame.rsub"><code class="docutils literal notranslate"><span class="pre">rsub()</span></code></a> 等方法执行二进制操作。广播机制重点关注输入的 Series。通过 <code class="docutils literal notranslate"><span class="pre">axis</span></code> 关键字，匹配 <em>index</em> 或 <em>columns</em> 即可调用这些函数。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
   <span class="o">....</span><span class="p">:</span>     <span class="s1">&#39;one&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">]),</span>
   <span class="o">....</span><span class="p">:</span>     <span class="s1">&#39;two&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">]),</span>
   <span class="o">....</span><span class="p">:</span>     <span class="s1">&#39;three&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">])})</span>
   <span class="o">....</span><span class="p">:</span> 

<span class="n">In</span> <span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="n">df</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">19</span><span class="p">]:</span> 
        <span class="n">one</span>       <span class="n">two</span>     <span class="n">three</span>
<span class="n">a</span>  <span class="mf">1.394981</span>  <span class="mf">1.772517</span>       <span class="n">NaN</span>
<span class="n">b</span>  <span class="mf">0.343054</span>  <span class="mf">1.912123</span> <span class="o">-</span><span class="mf">0.050390</span>
<span class="n">c</span>  <span class="mf">0.695246</span>  <span class="mf">1.478369</span>  <span class="mf">1.227435</span>
<span class="n">d</span>       <span class="n">NaN</span>  <span class="mf">0.279344</span> <span class="o">-</span><span class="mf">0.613172</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="n">row</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="n">column</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;two&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">22</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;columns&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">22</span><span class="p">]:</span> 
        <span class="n">one</span>       <span class="n">two</span>     <span class="n">three</span>
<span class="n">a</span>  <span class="mf">1.051928</span> <span class="o">-</span><span class="mf">0.139606</span>       <span class="n">NaN</span>
<span class="n">b</span>  <span class="mf">0.000000</span>  <span class="mf">0.000000</span>  <span class="mf">0.000000</span>
<span class="n">c</span>  <span class="mf">0.352192</span> <span class="o">-</span><span class="mf">0.433754</span>  <span class="mf">1.277825</span>
<span class="n">d</span>       <span class="n">NaN</span> <span class="o">-</span><span class="mf">1.632779</span> <span class="o">-</span><span class="mf">0.562782</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">23</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">23</span><span class="p">]:</span> 
        <span class="n">one</span>       <span class="n">two</span>     <span class="n">three</span>
<span class="n">a</span>  <span class="mf">1.051928</span> <span class="o">-</span><span class="mf">0.139606</span>       <span class="n">NaN</span>
<span class="n">b</span>  <span class="mf">0.000000</span>  <span class="mf">0.000000</span>  <span class="mf">0.000000</span>
<span class="n">c</span>  <span class="mf">0.352192</span> <span class="o">-</span><span class="mf">0.433754</span>  <span class="mf">1.277825</span>
<span class="n">d</span>       <span class="n">NaN</span> <span class="o">-</span><span class="mf">1.632779</span> <span class="o">-</span><span class="mf">0.562782</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">24</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">24</span><span class="p">]:</span> 
        <span class="n">one</span>  <span class="n">two</span>     <span class="n">three</span>
<span class="n">a</span> <span class="o">-</span><span class="mf">0.377535</span>  <span class="mf">0.0</span>       <span class="n">NaN</span>
<span class="n">b</span> <span class="o">-</span><span class="mf">1.569069</span>  <span class="mf">0.0</span> <span class="o">-</span><span class="mf">1.962513</span>
<span class="n">c</span> <span class="o">-</span><span class="mf">0.783123</span>  <span class="mf">0.0</span> <span class="o">-</span><span class="mf">0.250933</span>
<span class="n">d</span>       <span class="n">NaN</span>  <span class="mf">0.0</span> <span class="o">-</span><span class="mf">0.892516</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">25</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">25</span><span class="p">]:</span> 
        <span class="n">one</span>  <span class="n">two</span>     <span class="n">three</span>
<span class="n">a</span> <span class="o">-</span><span class="mf">0.377535</span>  <span class="mf">0.0</span>       <span class="n">NaN</span>
<span class="n">b</span> <span class="o">-</span><span class="mf">1.569069</span>  <span class="mf">0.0</span> <span class="o">-</span><span class="mf">1.962513</span>
<span class="n">c</span> <span class="o">-</span><span class="mf">0.783123</span>  <span class="mf">0.0</span> <span class="o">-</span><span class="mf">0.250933</span>
<span class="n">d</span>       <span class="n">NaN</span>  <span class="mf">0.0</span> <span class="o">-</span><span class="mf">0.892516</span>
</pre></div>
</div>
<p>还可以用 Series 对齐多层索引 DataFrame 的某一层级。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">26</span><span class="p">]:</span> <span class="n">dfmi</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">27</span><span class="p">]:</span> <span class="n">dfmi</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">([(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">),</span>
   <span class="o">....</span><span class="p">:</span>                                         <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)],</span>
   <span class="o">....</span><span class="p">:</span>                                        <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="s1">&#39;second&#39;</span><span class="p">])</span>
   <span class="o">....</span><span class="p">:</span> 

<span class="n">In</span> <span class="p">[</span><span class="mi">28</span><span class="p">]:</span> <span class="n">dfmi</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;second&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">28</span><span class="p">]:</span> 
                   <span class="n">one</span>       <span class="n">two</span>     <span class="n">three</span>
<span class="n">first</span> <span class="n">second</span>                              
<span class="mi">1</span>     <span class="n">a</span>      <span class="o">-</span><span class="mf">0.377535</span>  <span class="mf">0.000000</span>       <span class="n">NaN</span>
      <span class="n">b</span>      <span class="o">-</span><span class="mf">1.569069</span>  <span class="mf">0.000000</span> <span class="o">-</span><span class="mf">1.962513</span>
      <span class="n">c</span>      <span class="o">-</span><span class="mf">0.783123</span>  <span class="mf">0.000000</span> <span class="o">-</span><span class="mf">0.250933</span>
<span class="mi">2</span>     <span class="n">a</span>            <span class="n">NaN</span> <span class="o">-</span><span class="mf">1.493173</span> <span class="o">-</span><span class="mf">2.385688</span>
</pre></div>
</div>
<p>Series 与 Index 还支持 <a class="reference external" href="https://docs.python.org/3/library/functions.html#divmod"><code class="docutils literal notranslate"><span class="pre">divmod()</span></code></a> 内置函数，该函数同时执行向下取整除与模运算，返回两个与左侧类型相同的元组。示例如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">29</span><span class="p">]:</span> <span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">30</span><span class="p">]:</span> <span class="n">s</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">30</span><span class="p">]:</span> 
<span class="mi">0</span>    <span class="mi">0</span>
<span class="mi">1</span>    <span class="mi">1</span>
<span class="mi">2</span>    <span class="mi">2</span>
<span class="mi">3</span>    <span class="mi">3</span>
<span class="mi">4</span>    <span class="mi">4</span>
<span class="mi">5</span>    <span class="mi">5</span>
<span class="mi">6</span>    <span class="mi">6</span>
<span class="mi">7</span>    <span class="mi">7</span>
<span class="mi">8</span>    <span class="mi">8</span>
<span class="mi">9</span>    <span class="mi">9</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">31</span><span class="p">]:</span> <span class="n">div</span><span class="p">,</span> <span class="n">rem</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">32</span><span class="p">]:</span> <span class="n">div</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">32</span><span class="p">]:</span> 
<span class="mi">0</span>    <span class="mi">0</span>
<span class="mi">1</span>    <span class="mi">0</span>
<span class="mi">2</span>    <span class="mi">0</span>
<span class="mi">3</span>    <span class="mi">1</span>
<span class="mi">4</span>    <span class="mi">1</span>
<span class="mi">5</span>    <span class="mi">1</span>
<span class="mi">6</span>    <span class="mi">2</span>
<span class="mi">7</span>    <span class="mi">2</span>
<span class="mi">8</span>    <span class="mi">2</span>
<span class="mi">9</span>    <span class="mi">3</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">33</span><span class="p">]:</span> <span class="n">rem</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">33</span><span class="p">]:</span> 
<span class="mi">0</span>    <span class="mi">0</span>
<span class="mi">1</span>    <span class="mi">1</span>
<span class="mi">2</span>    <span class="mi">2</span>
<span class="mi">3</span>    <span class="mi">0</span>
<span class="mi">4</span>    <span class="mi">1</span>
<span class="mi">5</span>    <span class="mi">2</span>
<span class="mi">6</span>    <span class="mi">0</span>
<span class="mi">7</span>    <span class="mi">1</span>
<span class="mi">8</span>    <span class="mi">2</span>
<span class="mi">9</span>    <span class="mi">0</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">34</span><span class="p">]:</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">35</span><span class="p">]:</span> <span class="n">idx</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">35</span><span class="p">]:</span> <span class="n">Int64Index</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int64&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">36</span><span class="p">]:</span> <span class="n">div</span><span class="p">,</span> <span class="n">rem</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">37</span><span class="p">]:</span> <span class="n">div</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">37</span><span class="p">]:</span> <span class="n">Int64Index</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int64&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">38</span><span class="p">]:</span> <span class="n">rem</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">38</span><span class="p">]:</span> <span class="n">Int64Index</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int64&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference external" href="https://docs.python.org/3/library/functions.html#divmod"><code class="docutils literal notranslate"><span class="pre">divmod()</span></code></a> 还支持元素级运算：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">39</span><span class="p">]:</span> <span class="n">div</span><span class="p">,</span> <span class="n">rem</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">40</span><span class="p">]:</span> <span class="n">div</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">40</span><span class="p">]:</span> 
<span class="mi">0</span>    <span class="mi">0</span>
<span class="mi">1</span>    <span class="mi">0</span>
<span class="mi">2</span>    <span class="mi">0</span>
<span class="mi">3</span>    <span class="mi">1</span>
<span class="mi">4</span>    <span class="mi">1</span>
<span class="mi">5</span>    <span class="mi">1</span>
<span class="mi">6</span>    <span class="mi">1</span>
<span class="mi">7</span>    <span class="mi">1</span>
<span class="mi">8</span>    <span class="mi">1</span>
<span class="mi">9</span>    <span class="mi">1</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">41</span><span class="p">]:</span> <span class="n">rem</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">41</span><span class="p">]:</span> 
<span class="mi">0</span>    <span class="mi">0</span>
<span class="mi">1</span>    <span class="mi">1</span>
<span class="mi">2</span>    <span class="mi">2</span>
<span class="mi">3</span>    <span class="mi">0</span>
<span class="mi">4</span>    <span class="mi">0</span>
<span class="mi">5</span>    <span class="mi">1</span>
<span class="mi">6</span>    <span class="mi">1</span>
<span class="mi">7</span>    <span class="mi">2</span>
<span class="mi">8</span>    <span class="mi">2</span>
<span class="mi">9</span>    <span class="mi">3</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h3>缺失值与填充缺失值操作<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h3>
<p>Series 与 DataFrame 的算数函数支持 <code class="docutils literal notranslate"><span class="pre">fill_value</span></code> 选项，即用指定值替换某个位置的缺失值。比如，两个 DataFrame 相加，除非两个 DataFrame 里同一个位置都有缺失值，其相加的和仍为 <code class="docutils literal notranslate"><span class="pre">NaN</span></code>，如果只有一个 DataFrame 里存在缺失值，则可以用 <code class="docutils literal notranslate"><span class="pre">fill_value</span></code> 指定一个值来替代 <code class="docutils literal notranslate"><span class="pre">NaN</span></code>，当然，也可以用 <code class="docutils literal notranslate"><span class="pre">fillna</span></code> 把 <code class="docutils literal notranslate"><span class="pre">NaN</span></code> 替换为想要的值。</p>
<p>::: tip 注意</p>
<p>下面第 43 条代码里，Pandas 官档没有写 df2 是哪里来的，这里补上，与 df 类似。 ```
df2 = pd.DataFrame({
….:     ‘one’: pd.Series(np.random.randn(3), index=[‘a’, ‘b’, ‘c’]),
….:     ‘two’: pd.Series(np.random.randn(4), index=[‘a’, ‘b’, ‘c’, ‘d’]),
….:     ‘three’: pd.Series(np.random.randn(3), index=[‘a’, ‘b’, ‘c’, ‘d’])})
….:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>:::

​```
In [42]: df
Out[42]: 
        one       two     three
a  1.394981  1.772517       NaN
b  0.343054  1.912123 -0.050390
c  0.695246  1.478369  1.227435
d       NaN  0.279344 -0.613172

In [43]: df2
Out[43]: 
        one       two     three
a  1.394981  1.772517  1.000000
b  0.343054  1.912123 -0.050390
c  0.695246  1.478369  1.227435
d       NaN  0.279344 -0.613172

In [44]: df + df2
Out[44]: 
        one       two     three
a  2.789963  3.545034       NaN
b  0.686107  3.824246 -0.100780
c  1.390491  2.956737  2.454870
d       NaN  0.558688 -1.226343

In [45]: df.add(df2, fill_value=0)
Out[45]: 
        one       two     three
a  2.789963  3.545034  1.000000
b  0.686107  3.824246 -0.100780
c  1.390491  2.956737  2.454870
d       NaN  0.558688 -1.226343
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h3>比较操作<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h3>
<p>与上一小节的算数运算类似，Series 与 DataFrame 还支持 <code class="docutils literal notranslate"><span class="pre">eq</span></code>、<code class="docutils literal notranslate"><span class="pre">ne</span></code>、<code class="docutils literal notranslate"><span class="pre">lt</span></code>、<code class="docutils literal notranslate"><span class="pre">gt</span></code>、<code class="docutils literal notranslate"><span class="pre">le</span></code>、<code class="docutils literal notranslate"><span class="pre">ge</span></code> 等二进制比较操作的方法：</p>
<table border="1" class="docutils">
<thead>
<tr>
<th align="center">序号</th>
<th align="center">缩写</th>
<th align="center">英文</th>
<th align="center">中文</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">1</td>
<td align="center">eq</td>
<td align="center">equal to</td>
<td align="center">等于</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">ne</td>
<td align="center">not equal to</td>
<td align="center">不等于</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">lt</td>
<td align="center">less than</td>
<td align="center">小于</td>
</tr>
<tr>
<td align="center">4</td>
<td align="center">gt</td>
<td align="center">greater than</td>
<td align="center">大于</td>
</tr>
<tr>
<td align="center">5</td>
<td align="center">le</td>
<td align="center">less than or equal to</td>
<td align="center">小于等于</td>
</tr>
<tr>
<td align="center">6</td>
<td align="center">ge</td>
<td align="center">greater than or equal to</td>
<td align="center">大于等于</td>
</tr>
</tbody>
</table><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">46</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">gt</span><span class="p">(</span><span class="n">df2</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">46</span><span class="p">]:</span> 
     <span class="n">one</span>    <span class="n">two</span>  <span class="n">three</span>
<span class="n">a</span>  <span class="kc">False</span>  <span class="kc">False</span>  <span class="kc">False</span>
<span class="n">b</span>  <span class="kc">False</span>  <span class="kc">False</span>  <span class="kc">False</span>
<span class="n">c</span>  <span class="kc">False</span>  <span class="kc">False</span>  <span class="kc">False</span>
<span class="n">d</span>  <span class="kc">False</span>  <span class="kc">False</span>  <span class="kc">False</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">47</span><span class="p">]:</span> <span class="n">df2</span><span class="o">.</span><span class="n">ne</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">47</span><span class="p">]:</span> 
     <span class="n">one</span>    <span class="n">two</span>  <span class="n">three</span>
<span class="n">a</span>  <span class="kc">False</span>  <span class="kc">False</span>   <span class="kc">True</span>
<span class="n">b</span>  <span class="kc">False</span>  <span class="kc">False</span>  <span class="kc">False</span>
<span class="n">c</span>  <span class="kc">False</span>  <span class="kc">False</span>  <span class="kc">False</span>
<span class="n">d</span>   <span class="kc">True</span>  <span class="kc">False</span>  <span class="kc">False</span>
</pre></div>
</div>
<p>这些操作生成一个与左侧输入对象类型相同的 Pandas 对象，即，dtype 为 <code class="docutils literal notranslate"><span class="pre">bool</span></code>。<code class="docutils literal notranslate"><span class="pre">boolean</span></code> 对象可用于索引操作，参阅<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#indexing-boolean">布尔索引</a>。</p>
</div>
<div class="section" id="id7">
<h3>布尔简化<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h3>
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.empty.html#pandas.DataFrame.empty"><code class="docutils literal notranslate"><span class="pre">empty</span></code></a>、<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.any.html#pandas.DataFrame.any"><code class="docutils literal notranslate"><span class="pre">any()</span></code></a>、<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.all.html#pandas.DataFrame.all"><code class="docutils literal notranslate"><span class="pre">all()</span></code></a>、<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.bool.html#pandas.DataFrame.bool"><code class="docutils literal notranslate"><span class="pre">bool()</span></code></a> 可以把数据汇总简化至单个布尔值。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">48</span><span class="p">]:</span> <span class="p">(</span><span class="n">df</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">48</span><span class="p">]:</span> 
<span class="n">one</span>      <span class="kc">False</span>
<span class="n">two</span>       <span class="kc">True</span>
<span class="n">three</span>    <span class="kc">False</span>
<span class="n">dtype</span><span class="p">:</span> <span class="nb">bool</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">49</span><span class="p">]:</span> <span class="p">(</span><span class="n">df</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">49</span><span class="p">]:</span> 
<span class="n">one</span>      <span class="kc">True</span>
<span class="n">two</span>      <span class="kc">True</span>
<span class="n">three</span>    <span class="kc">True</span>
<span class="n">dtype</span><span class="p">:</span> <span class="nb">bool</span>
</pre></div>
</div>
<p>还可以进一步把上面的结果简化为单个布尔值。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">50</span><span class="p">]:</span> <span class="p">(</span><span class="n">df</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">50</span><span class="p">]:</span> <span class="kc">True</span>
</pre></div>
</div>
<p>通过 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.empty.html#pandas.DataFrame.empty"><code class="docutils literal notranslate"><span class="pre">empty</span></code></a> 属性，可以验证 Pandas 对象是否为<strong>空</strong>。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">51</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">51</span><span class="p">]:</span> <span class="kc">False</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">52</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="s1">&#39;ABC&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">empty</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">52</span><span class="p">]:</span> <span class="kc">True</span>
</pre></div>
</div>
<p>用 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.bool.html#pandas.DataFrame.bool"><code class="docutils literal notranslate"><span class="pre">bool()</span></code></a> 方法验证单元素 pandas 对象的布尔值。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">53</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="kc">True</span><span class="p">])</span><span class="o">.</span><span class="n">bool</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">53</span><span class="p">]:</span> <span class="kc">True</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">54</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="kc">False</span><span class="p">])</span><span class="o">.</span><span class="n">bool</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">54</span><span class="p">]:</span> <span class="kc">False</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">55</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="kc">True</span><span class="p">]])</span><span class="o">.</span><span class="n">bool</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">55</span><span class="p">]:</span> <span class="kc">True</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">56</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="kc">False</span><span class="p">]])</span><span class="o">.</span><span class="n">bool</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">56</span><span class="p">]:</span> <span class="kc">False</span>
</pre></div>
</div>
<p>::: danger 警告</p>
<p>以下代码：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="n">df</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">pass</span>
</pre></div>
</div>
<p>或</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df</span> <span class="ow">and</span> <span class="n">df2</span>
</pre></div>
</div>
<p>上述代码试图比对多个值，因此，这两种操作都会触发错误：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ne">ValueError</span><span class="p">:</span> <span class="n">The</span> <span class="n">truth</span> <span class="n">value</span> <span class="n">of</span> <span class="n">an</span> <span class="n">array</span> <span class="ow">is</span> <span class="n">ambiguous</span><span class="o">.</span> <span class="n">Use</span> <span class="n">a</span><span class="o">.</span><span class="n">empty</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">any</span><span class="p">()</span> <span class="ow">or</span> <span class="n">a</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span>
</pre></div>
</div>
<p>:::</p>
<p>了解详情，请参阅<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/gotchas.html#gotchas-truth">各种坑</a>小节的内容。</p>
</div>
<div class="section" id="id8">
<h3>比较对象是否等效<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h3>
<p>一般情况下，多种方式都能得出相同的结果。以 <code class="docutils literal notranslate"><span class="pre">df</span> <span class="pre">+</span> <span class="pre">df</span></code> 与 <code class="docutils literal notranslate"><span class="pre">df</span> <span class="pre">*</span> <span class="pre">2</span></code> 为例。应用上一小节学到的知识，测试这两种计算方式的结果是否一致，一般人都会用 <code class="docutils literal notranslate"><span class="pre">(df</span> <span class="pre">+</span> <span class="pre">df</span> <span class="pre">==</span> <span class="pre">df</span> <span class="pre">*</span> <span class="pre">2).all()</span></code>，不过，这个表达式的结果是 <code class="docutils literal notranslate"><span class="pre">False</span></code>：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">57</span><span class="p">]:</span> <span class="n">df</span> <span class="o">+</span> <span class="n">df</span> <span class="o">==</span> <span class="n">df</span> <span class="o">*</span> <span class="mi">2</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">57</span><span class="p">]:</span> 
     <span class="n">one</span>   <span class="n">two</span>  <span class="n">three</span>
<span class="n">a</span>   <span class="kc">True</span>  <span class="kc">True</span>  <span class="kc">False</span>
<span class="n">b</span>   <span class="kc">True</span>  <span class="kc">True</span>   <span class="kc">True</span>
<span class="n">c</span>   <span class="kc">True</span>  <span class="kc">True</span>   <span class="kc">True</span>
<span class="n">d</span>  <span class="kc">False</span>  <span class="kc">True</span>   <span class="kc">True</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">58</span><span class="p">]:</span> <span class="p">(</span><span class="n">df</span> <span class="o">+</span> <span class="n">df</span> <span class="o">==</span> <span class="n">df</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">58</span><span class="p">]:</span> 
<span class="n">one</span>      <span class="kc">False</span>
<span class="n">two</span>       <span class="kc">True</span>
<span class="n">three</span>    <span class="kc">False</span>
<span class="n">dtype</span><span class="p">:</span> <span class="nb">bool</span>
</pre></div>
</div>
<p>注意：布尔型 DataFrame <code class="docutils literal notranslate"><span class="pre">df</span> <span class="pre">+</span> <span class="pre">df</span> <span class="pre">==</span> <span class="pre">df</span> <span class="pre">*</span> <span class="pre">2</span></code> 中有 <code class="docutils literal notranslate"><span class="pre">False</span></code> 值！这是因为两个 <code class="docutils literal notranslate"><span class="pre">NaN</span></code> 值的比较结果为<strong>不等</strong>：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">59</span><span class="p">]:</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">59</span><span class="p">]:</span> <span class="kc">False</span>
</pre></div>
</div>
<p>为了验证数据是否等效，Series 与 DataFrame 等 N 维框架提供了 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.equals.html#pandas.DataFrame.equals"><code class="docutils literal notranslate"><span class="pre">equals()</span></code></a> 方法，用这个方法验证 <code class="docutils literal notranslate"><span class="pre">NaN</span></code> 值的结果为<strong>相等</strong>。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">60</span><span class="p">]:</span> <span class="p">(</span><span class="n">df</span> <span class="o">+</span> <span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">df</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">60</span><span class="p">]:</span> <span class="kc">True</span>
</pre></div>
</div>
<p>注意：Series 与 DataFrame 索引的顺序必须一致，验证结果才能为 <code class="docutils literal notranslate"><span class="pre">True</span></code>：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">61</span><span class="p">]:</span> <span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;col&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]})</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">62</span><span class="p">]:</span> <span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;col&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">]},</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">63</span><span class="p">]:</span> <span class="n">df1</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">df2</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">63</span><span class="p">]:</span> <span class="kc">False</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">64</span><span class="p">]:</span> <span class="n">df1</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">df2</span><span class="o">.</span><span class="n">sort_index</span><span class="p">())</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">64</span><span class="p">]:</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
<div class="section" id="array">
<h3>比较 array 型对象<a class="headerlink" href="#array" title="永久链接至标题">¶</a></h3>
<p>用标量值与 Pandas 数据结构对比数据元素非常简单：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">65</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;baz&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="s1">&#39;foo&#39;</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">65</span><span class="p">]:</span> 
<span class="mi">0</span>     <span class="kc">True</span>
<span class="mi">1</span>    <span class="kc">False</span>
<span class="mi">2</span>    <span class="kc">False</span>
<span class="n">dtype</span><span class="p">:</span> <span class="nb">bool</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">66</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">([</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;baz&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="s1">&#39;foo&#39;</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">66</span><span class="p">]:</span> <span class="n">array</span><span class="p">([</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">])</span>
</pre></div>
</div>
<p>Pandas 还能对比两个等长 <code class="docutils literal notranslate"><span class="pre">array</span></code> 对象里的数据元素：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">67</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;baz&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">([</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;qux&#39;</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">67</span><span class="p">]:</span> 
<span class="mi">0</span>     <span class="kc">True</span>
<span class="mi">1</span>     <span class="kc">True</span>
<span class="mi">2</span>    <span class="kc">False</span>
<span class="n">dtype</span><span class="p">:</span> <span class="nb">bool</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">68</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;baz&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;qux&#39;</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">68</span><span class="p">]:</span> 
<span class="mi">0</span>     <span class="kc">True</span>
<span class="mi">1</span>     <span class="kc">True</span>
<span class="mi">2</span>    <span class="kc">False</span>
<span class="n">dtype</span><span class="p">:</span> <span class="nb">bool</span>
</pre></div>
</div>
<p>对比不等长的 <code class="docutils literal notranslate"><span class="pre">Index</span></code> 或 <code class="docutils literal notranslate"><span class="pre">Series</span></code> 对象会触发 <code class="docutils literal notranslate"><span class="pre">ValueError</span></code>：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">55</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;baz&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">])</span>
<span class="ne">ValueError</span><span class="p">:</span> <span class="n">Series</span> <span class="n">lengths</span> <span class="n">must</span> <span class="n">match</span> <span class="n">to</span> <span class="n">compare</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">56</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;baz&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="s1">&#39;foo&#39;</span><span class="p">])</span>
<span class="ne">ValueError</span><span class="p">:</span> <span class="n">Series</span> <span class="n">lengths</span> <span class="n">must</span> <span class="n">match</span> <span class="n">to</span> <span class="n">compare</span>
</pre></div>
</div>
<p>注意： 这里的操作与 NumPy 的广播机制不同：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">69</span><span class="p">]:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">69</span><span class="p">]:</span> <span class="n">array</span><span class="p">([</span><span class="kc">False</span><span class="p">,</span>  <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">])</span>
</pre></div>
</div>
<p>NumPy 无法执行广播操作时，返回 <code class="docutils literal notranslate"><span class="pre">False</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">70</span><span class="p">]:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">70</span><span class="p">]:</span> <span class="kc">False</span>
</pre></div>
</div>
</div>
<div class="section" id="id9">
<h3>合并重叠数据集<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h3>
<p>有时，要合并两个相似的数据集，两个数据集里的其中一个的数据比另一个多。比如，展示特定经济指标的两个数据序列，其中一个是“高质量”指标，另一个是“低质量”指标。一般来说，低质量序列可能包含更多的历史数据，或覆盖更广的数据。因此，要合并这两个 DataFrame 对象，其中一个 DataFrame 中的缺失值将按指定条件用另一个 DataFrame 里类似标签中的数据进行填充。要实现这一操作，请用下列代码中的 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.combine_first.html#pandas.DataFrame.combine_first"><code class="docutils literal notranslate"><span class="pre">combine_first()</span></code></a> 函数。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">71</span><span class="p">]:</span> <span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mf">3.</span><span class="p">,</span> <span class="mf">5.</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span>
   <span class="o">....</span><span class="p">:</span>                     <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mf">6.</span><span class="p">]})</span>
   <span class="o">....</span><span class="p">:</span> 

<span class="n">In</span> <span class="p">[</span><span class="mi">72</span><span class="p">]:</span> <span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">5.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mf">3.</span><span class="p">,</span> <span class="mf">7.</span><span class="p">],</span>
   <span class="o">....</span><span class="p">:</span>                     <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mf">3.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">,</span> <span class="mf">6.</span><span class="p">,</span> <span class="mf">8.</span><span class="p">]})</span>
   <span class="o">....</span><span class="p">:</span> 

<span class="n">In</span> <span class="p">[</span><span class="mi">73</span><span class="p">]:</span> <span class="n">df1</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">73</span><span class="p">]:</span> 
     <span class="n">A</span>    <span class="n">B</span>
<span class="mi">0</span>  <span class="mf">1.0</span>  <span class="n">NaN</span>
<span class="mi">1</span>  <span class="n">NaN</span>  <span class="mf">2.0</span>
<span class="mi">2</span>  <span class="mf">3.0</span>  <span class="mf">3.0</span>
<span class="mi">3</span>  <span class="mf">5.0</span>  <span class="n">NaN</span>
<span class="mi">4</span>  <span class="n">NaN</span>  <span class="mf">6.0</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">74</span><span class="p">]:</span> <span class="n">df2</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">74</span><span class="p">]:</span> 
     <span class="n">A</span>    <span class="n">B</span>
<span class="mi">0</span>  <span class="mf">5.0</span>  <span class="n">NaN</span>
<span class="mi">1</span>  <span class="mf">2.0</span>  <span class="n">NaN</span>
<span class="mi">2</span>  <span class="mf">4.0</span>  <span class="mf">3.0</span>
<span class="mi">3</span>  <span class="n">NaN</span>  <span class="mf">4.0</span>
<span class="mi">4</span>  <span class="mf">3.0</span>  <span class="mf">6.0</span>
<span class="mi">5</span>  <span class="mf">7.0</span>  <span class="mf">8.0</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">75</span><span class="p">]:</span> <span class="n">df1</span><span class="o">.</span><span class="n">combine_first</span><span class="p">(</span><span class="n">df2</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">75</span><span class="p">]:</span> 
     <span class="n">A</span>    <span class="n">B</span>
<span class="mi">0</span>  <span class="mf">1.0</span>  <span class="n">NaN</span>
<span class="mi">1</span>  <span class="mf">2.0</span>  <span class="mf">2.0</span>
<span class="mi">2</span>  <span class="mf">3.0</span>  <span class="mf">3.0</span>
<span class="mi">3</span>  <span class="mf">5.0</span>  <span class="mf">4.0</span>
<span class="mi">4</span>  <span class="mf">3.0</span>  <span class="mf">6.0</span>
<span class="mi">5</span>  <span class="mf">7.0</span>  <span class="mf">8.0</span>
</pre></div>
</div>
</div>
<div class="section" id="dataframe">
<h3>DataFrame 通用合并方法<a class="headerlink" href="#dataframe" title="永久链接至标题">¶</a></h3>
<p>上述 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.combine_first.html#pandas.DataFrame.combine_first"><code class="docutils literal notranslate"><span class="pre">combine_first()</span></code></a> 方法调用了更普适的 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.combine.html#pandas.DataFrame.combine"><code class="docutils literal notranslate"><span class="pre">DataFrame.combine()</span></code></a> 方法。该方法提取另一个 DataFrame 及合并器函数，并将之与输入的 DataFrame 对齐，再传递与 Series 配对的合并器函数（比如，名称相同的列）。</p>
<p>下面的代码复现了上述的 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.combine_first.html#pandas.DataFrame.combine_first"><code class="docutils literal notranslate"><span class="pre">combine_first()</span></code></a> 函数：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">76</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">combiner</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
   <span class="o">....</span><span class="p">:</span>     <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
   <span class="o">....</span><span class="p">:</span> 
</pre></div>
</div>
</div>
</div>
<div class="section" id="id10">
<h2><span class="section-number">2.5. </span>描述性统计<a class="headerlink" href="#id10" title="永久链接至标题">¶</a></h2>
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/series.html#api-series-stats">Series</a> 与 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/frame.html#api-dataframe-stats">DataFrame</a> 支持大量计算描述性统计的方法与操作。这些方法大部分都是  <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.sum.html#pandas.DataFrame.sum"><code class="docutils literal notranslate"><span class="pre">sum()</span></code></a>、<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.mean.html#pandas.DataFrame.mean"><code class="docutils literal notranslate"><span class="pre">mean()</span></code></a>、<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.quantile.html#pandas.DataFrame.quantile"><code class="docutils literal notranslate"><span class="pre">quantile()</span></code></a> 等聚合函数，其输出结果比原始数据集小；此外，还有输出结果与原始数据集同样大小的 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.cumsum.html#pandas.DataFrame.cumsum"><code class="docutils literal notranslate"><span class="pre">cumsum()</span></code></a> 、 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.cumprod.html#pandas.DataFrame.cumprod"><code class="docutils literal notranslate"><span class="pre">cumprod()</span></code></a> 等函数。这些方法都基本上都接受 <code class="docutils literal notranslate"><span class="pre">axis</span></code> 参数，如， <code class="docutils literal notranslate"><span class="pre">ndarray.{sum,std,…}</span></code>，但这里的 <code class="docutils literal notranslate"><span class="pre">axis</span></code> 可以用名称或整数指定：</p>
<ul class="simple">
<li><p><strong>Series</strong>：无需 <code class="docutils literal notranslate"><span class="pre">axis</span></code> 参数</p></li>
<li><p><strong>DataFrame</strong>：</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">index</span></code>，即 <code class="docutils literal notranslate"><span class="pre">axis=0</span></code>，默认值</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">columns</span></code>, 即 <code class="docutils literal notranslate"><span class="pre">axis=1</span></code></p></li>
</ul>
</li>
</ul>
<p>示例如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">77</span><span class="p">]:</span> <span class="n">df</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">77</span><span class="p">]:</span> 
        <span class="n">one</span>       <span class="n">two</span>     <span class="n">three</span>
<span class="n">a</span>  <span class="mf">1.394981</span>  <span class="mf">1.772517</span>       <span class="n">NaN</span>
<span class="n">b</span>  <span class="mf">0.343054</span>  <span class="mf">1.912123</span> <span class="o">-</span><span class="mf">0.050390</span>
<span class="n">c</span>  <span class="mf">0.695246</span>  <span class="mf">1.478369</span>  <span class="mf">1.227435</span>
<span class="n">d</span>       <span class="n">NaN</span>  <span class="mf">0.279344</span> <span class="o">-</span><span class="mf">0.613172</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">78</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">78</span><span class="p">]:</span> 
<span class="n">one</span>      <span class="mf">0.811094</span>
<span class="n">two</span>      <span class="mf">1.360588</span>
<span class="n">three</span>    <span class="mf">0.187958</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">79</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">79</span><span class="p">]:</span> 
<span class="n">a</span>    <span class="mf">1.583749</span>
<span class="n">b</span>    <span class="mf">0.734929</span>
<span class="n">c</span>    <span class="mf">1.133683</span>
<span class="n">d</span>   <span class="o">-</span><span class="mf">0.166914</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</pre></div>
</div>
<p>上述方法都支持 <code class="docutils literal notranslate"><span class="pre">skipna</span></code> 关键字，指定是否要排除缺失数据，默认值为 <code class="docutils literal notranslate"><span class="pre">True</span></code>。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">80</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">80</span><span class="p">]:</span> 
<span class="n">one</span>           <span class="n">NaN</span>
<span class="n">two</span>      <span class="mf">5.442353</span>
<span class="n">three</span>         <span class="n">NaN</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">81</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">81</span><span class="p">]:</span> 
<span class="n">a</span>    <span class="mf">3.167498</span>
<span class="n">b</span>    <span class="mf">2.204786</span>
<span class="n">c</span>    <span class="mf">3.401050</span>
<span class="n">d</span>   <span class="o">-</span><span class="mf">0.333828</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</pre></div>
</div>
<p>结合广播机制或算数操作，可以描述不同统计过程，比如标准化，即渲染数据零均值与标准差 1，这种操作非常简单：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">82</span><span class="p">]:</span> <span class="n">ts_stand</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span> <span class="o">/</span> <span class="n">df</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">83</span><span class="p">]:</span> <span class="n">ts_stand</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">83</span><span class="p">]:</span> 
<span class="n">one</span>      <span class="mf">1.0</span>
<span class="n">two</span>      <span class="mf">1.0</span>
<span class="n">three</span>    <span class="mf">1.0</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">84</span><span class="p">]:</span> <span class="n">xs_stand</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">85</span><span class="p">]:</span> <span class="n">xs_stand</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">85</span><span class="p">]:</span> 
<span class="n">a</span>    <span class="mf">1.0</span>
<span class="n">b</span>    <span class="mf">1.0</span>
<span class="n">c</span>    <span class="mf">1.0</span>
<span class="n">d</span>    <span class="mf">1.0</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</pre></div>
</div>
<p>注 ： <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.cumsum.html#pandas.DataFrame.cumsum"><code class="docutils literal notranslate"><span class="pre">cumsum()</span></code></a> 与 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.cumprod.html#pandas.DataFrame.cumprod"><code class="docutils literal notranslate"><span class="pre">cumprod()</span></code></a> 等方法保留 <code class="docutils literal notranslate"><span class="pre">NaN</span></code>  值的位置。这与 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.expanding.html#pandas.DataFrame.expanding"><code class="docutils literal notranslate"><span class="pre">expanding()</span></code></a> 和 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.rolling.html#pandas.DataFrame.rolling"><code class="docutils literal notranslate"><span class="pre">rolling()</span></code></a> 略显不同，详情请参阅<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/computation.html#stats-moments-expanding-note">本文</a>。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">86</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">86</span><span class="p">]:</span> 
        <span class="n">one</span>       <span class="n">two</span>     <span class="n">three</span>
<span class="n">a</span>  <span class="mf">1.394981</span>  <span class="mf">1.772517</span>       <span class="n">NaN</span>
<span class="n">b</span>  <span class="mf">1.738035</span>  <span class="mf">3.684640</span> <span class="o">-</span><span class="mf">0.050390</span>
<span class="n">c</span>  <span class="mf">2.433281</span>  <span class="mf">5.163008</span>  <span class="mf">1.177045</span>
<span class="n">d</span>       <span class="n">NaN</span>  <span class="mf">5.442353</span>  <span class="mf">0.563873</span>
</pre></div>
</div>
<p>下表为常用函数汇总表。每个函数都支持 <code class="docutils literal notranslate"><span class="pre">level</span></code> 参数，仅在数据对象为<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/advanced.html#advanced-hierarchical">结构化 Index</a> 时使用。</p>
<table border="1" class="docutils">
<thead>
<tr>
<th align="center">函数</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><code>count</code></td>
<td align="center">统计非空值数量</td>
</tr>
<tr>
<td align="center"><code>sum</code></td>
<td align="center">汇总值</td>
</tr>
<tr>
<td align="center"><code>mean</code></td>
<td align="center">平均值</td>
</tr>
<tr>
<td align="center"><code>mad</code></td>
<td align="center">平均绝对偏差</td>
</tr>
<tr>
<td align="center"><code>median</code></td>
<td align="center">算数中位数</td>
</tr>
<tr>
<td align="center"><code>min</code></td>
<td align="center">最小值</td>
</tr>
<tr>
<td align="center"><code>max</code></td>
<td align="center">最大值</td>
</tr>
<tr>
<td align="center"><code>mode</code></td>
<td align="center">众数</td>
</tr>
<tr>
<td align="center"><code>abs</code></td>
<td align="center">绝对值</td>
</tr>
<tr>
<td align="center"><code>prod</code></td>
<td align="center">乘积</td>
</tr>
<tr>
<td align="center"><code>std</code></td>
<td align="center">贝塞尔校正的样本标准偏差</td>
</tr>
<tr>
<td align="center"><code>var</code></td>
<td align="center">无偏方差</td>
</tr>
<tr>
<td align="center"><code>sem</code></td>
<td align="center">平均值的标准误差</td>
</tr>
<tr>
<td align="center"><code>skew</code></td>
<td align="center">样本偏度 (第三阶)</td>
</tr>
<tr>
<td align="center"><code>kurt</code></td>
<td align="center">样本峰度 (第四阶)</td>
</tr>
<tr>
<td align="center"><code>quantile</code></td>
<td align="center">样本分位数 (不同 % 的值)</td>
</tr>
<tr>
<td align="center"><code>cumsum</code></td>
<td align="center">累加</td>
</tr>
<tr>
<td align="center"><code>cumprod</code></td>
<td align="center">累乘</td>
</tr>
<tr>
<td align="center"><code>cummax</code></td>
<td align="center">累积最大值</td>
</tr>
<tr>
<td align="center"><code>cummin</code></td>
<td align="center">累积最小值</td>
</tr>
</tbody>
</table><p>注意：NumPy 的 <code class="docutils literal notranslate"><span class="pre">mean</span></code>、<code class="docutils literal notranslate"><span class="pre">std</span></code>、<code class="docutils literal notranslate"><span class="pre">sum</span></code> 等方法默认不统计 Series 里的空值。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">87</span><span class="p">]:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">87</span><span class="p">]:</span> <span class="mf">0.8110935116651192</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">88</span><span class="p">]:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">88</span><span class="p">]:</span> <span class="n">nan</span>
</pre></div>
</div>
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.nunique.html#pandas.Series.nunique"><code class="docutils literal notranslate"><span class="pre">Series.nunique()</span></code></a> 返回 Series 里所有非空值的唯一值。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">89</span><span class="p">]:</span> <span class="n">series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">500</span><span class="p">))</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">90</span><span class="p">]:</span> <span class="n">series</span><span class="p">[</span><span class="mi">20</span><span class="p">:</span><span class="mi">500</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">91</span><span class="p">]:</span> <span class="n">series</span><span class="p">[</span><span class="mi">10</span><span class="p">:</span><span class="mi">20</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">92</span><span class="p">]:</span> <span class="n">series</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">92</span><span class="p">]:</span> <span class="mi">11</span>
</pre></div>
</div>
<div class="section" id="describe">
<h3>数据总结：<code class="docutils literal notranslate"><span class="pre">describe</span></code><a class="headerlink" href="#describe" title="永久链接至标题">¶</a></h3>
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.describe.html#pandas.DataFrame.describe"><code class="docutils literal notranslate"><span class="pre">describe()</span></code></a>  函数计算 Series 与 DataFrame 数据列的各种数据统计量，注意，这里排除了<strong>空值</strong>。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">93</span><span class="p">]:</span> <span class="n">series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">94</span><span class="p">]:</span> <span class="n">series</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">95</span><span class="p">]:</span> <span class="n">series</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">95</span><span class="p">]:</span> 
<span class="n">count</span>    <span class="mf">500.000000</span>
<span class="n">mean</span>      <span class="o">-</span><span class="mf">0.021292</span>
<span class="n">std</span>        <span class="mf">1.015906</span>
<span class="nb">min</span>       <span class="o">-</span><span class="mf">2.683763</span>
<span class="mi">25</span><span class="o">%</span>       <span class="o">-</span><span class="mf">0.699070</span>
<span class="mi">50</span><span class="o">%</span>       <span class="o">-</span><span class="mf">0.069718</span>
<span class="mi">75</span><span class="o">%</span>        <span class="mf">0.714483</span>
<span class="nb">max</span>        <span class="mf">3.160915</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">96</span><span class="p">]:</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
   <span class="o">....</span><span class="p">:</span>                      <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">])</span>
   <span class="o">....</span><span class="p">:</span> 

<span class="n">In</span> <span class="p">[</span><span class="mi">97</span><span class="p">]:</span> <span class="n">frame</span><span class="o">.</span><span class="n">iloc</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">98</span><span class="p">]:</span> <span class="n">frame</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">98</span><span class="p">]:</span> 
                <span class="n">a</span>           <span class="n">b</span>           <span class="n">c</span>           <span class="n">d</span>           <span class="n">e</span>
<span class="n">count</span>  <span class="mf">500.000000</span>  <span class="mf">500.000000</span>  <span class="mf">500.000000</span>  <span class="mf">500.000000</span>  <span class="mf">500.000000</span>
<span class="n">mean</span>     <span class="mf">0.033387</span>    <span class="mf">0.030045</span>   <span class="o">-</span><span class="mf">0.043719</span>   <span class="o">-</span><span class="mf">0.051686</span>    <span class="mf">0.005979</span>
<span class="n">std</span>      <span class="mf">1.017152</span>    <span class="mf">0.978743</span>    <span class="mf">1.025270</span>    <span class="mf">1.015988</span>    <span class="mf">1.006695</span>
<span class="nb">min</span>     <span class="o">-</span><span class="mf">3.000951</span>   <span class="o">-</span><span class="mf">2.637901</span>   <span class="o">-</span><span class="mf">3.303099</span>   <span class="o">-</span><span class="mf">3.159200</span>   <span class="o">-</span><span class="mf">3.188821</span>
<span class="mi">25</span><span class="o">%</span>     <span class="o">-</span><span class="mf">0.647623</span>   <span class="o">-</span><span class="mf">0.576449</span>   <span class="o">-</span><span class="mf">0.712369</span>   <span class="o">-</span><span class="mf">0.691338</span>   <span class="o">-</span><span class="mf">0.691115</span>
<span class="mi">50</span><span class="o">%</span>      <span class="mf">0.047578</span>   <span class="o">-</span><span class="mf">0.021499</span>   <span class="o">-</span><span class="mf">0.023888</span>   <span class="o">-</span><span class="mf">0.032652</span>   <span class="o">-</span><span class="mf">0.025363</span>
<span class="mi">75</span><span class="o">%</span>      <span class="mf">0.729907</span>    <span class="mf">0.775880</span>    <span class="mf">0.618896</span>    <span class="mf">0.670047</span>    <span class="mf">0.649748</span>
<span class="nb">max</span>      <span class="mf">2.740139</span>    <span class="mf">2.752332</span>    <span class="mf">3.004229</span>    <span class="mf">2.728702</span>    <span class="mf">3.240991</span>
</pre></div>
</div>
<p>此外，还可以指定输出结果包含的分位数：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">99</span><span class="p">]:</span> <span class="n">series</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">percentiles</span><span class="o">=</span><span class="p">[</span><span class="o">.</span><span class="mi">05</span><span class="p">,</span> <span class="o">.</span><span class="mi">25</span><span class="p">,</span> <span class="o">.</span><span class="mi">75</span><span class="p">,</span> <span class="o">.</span><span class="mi">95</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">99</span><span class="p">]:</span> 
<span class="n">count</span>    <span class="mf">500.000000</span>
<span class="n">mean</span>      <span class="o">-</span><span class="mf">0.021292</span>
<span class="n">std</span>        <span class="mf">1.015906</span>
<span class="nb">min</span>       <span class="o">-</span><span class="mf">2.683763</span>
<span class="mi">5</span><span class="o">%</span>        <span class="o">-</span><span class="mf">1.645423</span>
<span class="mi">25</span><span class="o">%</span>       <span class="o">-</span><span class="mf">0.699070</span>
<span class="mi">50</span><span class="o">%</span>       <span class="o">-</span><span class="mf">0.069718</span>
<span class="mi">75</span><span class="o">%</span>        <span class="mf">0.714483</span>
<span class="mi">95</span><span class="o">%</span>        <span class="mf">1.711409</span>
<span class="nb">max</span>        <span class="mf">3.160915</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</pre></div>
</div>
<p>一般情况下，默认值包含<strong>中位数</strong>。</p>
<p>对于非数值型 Series 对象， <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.describe.html#pandas.Series.describe"><code class="docutils literal notranslate"><span class="pre">describe()</span></code></a>  返回值的总数、唯一值数量、出现次数最多的值及出现的次数。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">100</span><span class="p">]:</span> <span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">])</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">101</span><span class="p">]:</span> <span class="n">s</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">101</span><span class="p">]:</span> 
<span class="n">count</span>     <span class="mi">9</span>
<span class="n">unique</span>    <span class="mi">4</span>
<span class="n">top</span>       <span class="n">a</span>
<span class="n">freq</span>      <span class="mi">5</span>
<span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>
</pre></div>
</div>
<p>注意：对于混合型的 DataFrame 对象， <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.describe.html#pandas.Series.describe"><code class="docutils literal notranslate"><span class="pre">describe()</span></code></a>  只返回数值列的汇总统计量，如果没有数值列，则只显示类别型的列。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">102</span><span class="p">]:</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Yes&#39;</span><span class="p">,</span> <span class="s1">&#39;Yes&#39;</span><span class="p">,</span> <span class="s1">&#39;No&#39;</span><span class="p">,</span> <span class="s1">&#39;No&#39;</span><span class="p">],</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)})</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">103</span><span class="p">]:</span> <span class="n">frame</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">103</span><span class="p">]:</span> 
              <span class="n">b</span>
<span class="n">count</span>  <span class="mf">4.000000</span>
<span class="n">mean</span>   <span class="mf">1.500000</span>
<span class="n">std</span>    <span class="mf">1.290994</span>
<span class="nb">min</span>    <span class="mf">0.000000</span>
<span class="mi">25</span><span class="o">%</span>    <span class="mf">0.750000</span>
<span class="mi">50</span><span class="o">%</span>    <span class="mf">1.500000</span>
<span class="mi">75</span><span class="o">%</span>    <span class="mf">2.250000</span>
<span class="nb">max</span>    <span class="mf">3.000000</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">include/exclude</span></code> 参数的值为列表，用该参数可以控制包含或排除的数据类型。这里还有一个特殊值，<code class="docutils literal notranslate"><span class="pre">all</span></code>：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">104</span><span class="p">]:</span> <span class="n">frame</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;object&#39;</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">104</span><span class="p">]:</span> 
          <span class="n">a</span>
<span class="n">count</span>     <span class="mi">4</span>
<span class="n">unique</span>    <span class="mi">2</span>
<span class="n">top</span>     <span class="n">Yes</span>
<span class="n">freq</span>      <span class="mi">2</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">105</span><span class="p">]:</span> <span class="n">frame</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;number&#39;</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">105</span><span class="p">]:</span> 
              <span class="n">b</span>
<span class="n">count</span>  <span class="mf">4.000000</span>
<span class="n">mean</span>   <span class="mf">1.500000</span>
<span class="n">std</span>    <span class="mf">1.290994</span>
<span class="nb">min</span>    <span class="mf">0.000000</span>
<span class="mi">25</span><span class="o">%</span>    <span class="mf">0.750000</span>
<span class="mi">50</span><span class="o">%</span>    <span class="mf">1.500000</span>
<span class="mi">75</span><span class="o">%</span>    <span class="mf">2.250000</span>
<span class="nb">max</span>    <span class="mf">3.000000</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">106</span><span class="p">]:</span> <span class="n">frame</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">106</span><span class="p">]:</span> 
          <span class="n">a</span>         <span class="n">b</span>
<span class="n">count</span>     <span class="mi">4</span>  <span class="mf">4.000000</span>
<span class="n">unique</span>    <span class="mi">2</span>       <span class="n">NaN</span>
<span class="n">top</span>     <span class="n">Yes</span>       <span class="n">NaN</span>
<span class="n">freq</span>      <span class="mi">2</span>       <span class="n">NaN</span>
<span class="n">mean</span>    <span class="n">NaN</span>  <span class="mf">1.500000</span>
<span class="n">std</span>     <span class="n">NaN</span>  <span class="mf">1.290994</span>
<span class="nb">min</span>     <span class="n">NaN</span>  <span class="mf">0.000000</span>
<span class="mi">25</span><span class="o">%</span>     <span class="n">NaN</span>  <span class="mf">0.750000</span>
<span class="mi">50</span><span class="o">%</span>     <span class="n">NaN</span>  <span class="mf">1.500000</span>
<span class="mi">75</span><span class="o">%</span>     <span class="n">NaN</span>  <span class="mf">2.250000</span>
<span class="nb">max</span>     <span class="n">NaN</span>  <span class="mf">3.000000</span>
</pre></div>
</div>
<p>本功能依托于 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/getting_started/basics.html#basics-selectdtypes"><code class="docutils literal notranslate"><span class="pre">select_dtypes</span></code></a>，要了解该参数接受哪些输入内容请参阅<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/getting_started/basics.html#basics-selectdtypes">本文</a>。</p>
</div>
<div class="section" id="id11">
<h3>最大值与最小值对应的索引<a class="headerlink" href="#id11" title="永久链接至标题">¶</a></h3>
<p>Series 与 DataFrame 的 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.idxmax.html#pandas.DataFrame.idxmax"><code class="docutils literal notranslate"><span class="pre">idxmax()</span></code></a>  与 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.idxmin.html#pandas.DataFrame.idxmin"><code class="docutils literal notranslate"><span class="pre">idxmin()</span></code></a> 函数计算最大值与最小值对应的索引。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">107</span><span class="p">]:</span> <span class="n">s1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">108</span><span class="p">]:</span> <span class="n">s1</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">108</span><span class="p">]:</span> 
<span class="mi">0</span>    <span class="mf">1.118076</span>
<span class="mi">1</span>   <span class="o">-</span><span class="mf">0.352051</span>
<span class="mi">2</span>   <span class="o">-</span><span class="mf">1.242883</span>
<span class="mi">3</span>   <span class="o">-</span><span class="mf">1.277155</span>
<span class="mi">4</span>   <span class="o">-</span><span class="mf">0.641184</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">109</span><span class="p">]:</span> <span class="n">s1</span><span class="o">.</span><span class="n">idxmin</span><span class="p">(),</span> <span class="n">s1</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">109</span><span class="p">]:</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">110</span><span class="p">]:</span> <span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">])</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">111</span><span class="p">]:</span> <span class="n">df1</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">111</span><span class="p">]:</span> 
          <span class="n">A</span>         <span class="n">B</span>         <span class="n">C</span>
<span class="mi">0</span> <span class="o">-</span><span class="mf">0.327863</span> <span class="o">-</span><span class="mf">0.946180</span> <span class="o">-</span><span class="mf">0.137570</span>
<span class="mi">1</span> <span class="o">-</span><span class="mf">0.186235</span> <span class="o">-</span><span class="mf">0.257213</span> <span class="o">-</span><span class="mf">0.486567</span>
<span class="mi">2</span> <span class="o">-</span><span class="mf">0.507027</span> <span class="o">-</span><span class="mf">0.871259</span> <span class="o">-</span><span class="mf">0.111110</span>
<span class="mi">3</span>  <span class="mf">2.000339</span> <span class="o">-</span><span class="mf">2.430505</span>  <span class="mf">0.089759</span>
<span class="mi">4</span> <span class="o">-</span><span class="mf">0.321434</span> <span class="o">-</span><span class="mf">0.033695</span>  <span class="mf">0.096271</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">112</span><span class="p">]:</span> <span class="n">df1</span><span class="o">.</span><span class="n">idxmin</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">112</span><span class="p">]:</span> 
<span class="n">A</span>    <span class="mi">2</span>
<span class="n">B</span>    <span class="mi">3</span>
<span class="n">C</span>    <span class="mi">1</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">113</span><span class="p">]:</span> <span class="n">df1</span><span class="o">.</span><span class="n">idxmax</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">113</span><span class="p">]:</span> 
<span class="mi">0</span>    <span class="n">C</span>
<span class="mi">1</span>    <span class="n">A</span>
<span class="mi">2</span>    <span class="n">C</span>
<span class="mi">3</span>    <span class="n">A</span>
<span class="mi">4</span>    <span class="n">C</span>
<span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>
</pre></div>
</div>
<p>多行或多列中存在多个最大值或最小值时，<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.idxmax.html#pandas.DataFrame.idxmax"><code class="docutils literal notranslate"><span class="pre">idxmax()</span></code></a> 与 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.idxmin.html#pandas.DataFrame.idxmin"><code class="docutils literal notranslate"><span class="pre">idxmin()</span></code></a> 只返回匹配到的第一个值的 <code class="docutils literal notranslate"><span class="pre">Index</span></code>：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">114</span><span class="p">]:</span> <span class="n">df3</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="s1">&#39;edcba&#39;</span><span class="p">))</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">115</span><span class="p">]:</span> <span class="n">df3</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">115</span><span class="p">]:</span> 
     <span class="n">A</span>
<span class="n">e</span>  <span class="mf">2.0</span>
<span class="n">d</span>  <span class="mf">1.0</span>
<span class="n">c</span>  <span class="mf">1.0</span>
<span class="n">b</span>  <span class="mf">3.0</span>
<span class="n">a</span>  <span class="n">NaN</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">116</span><span class="p">]:</span> <span class="n">df3</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">116</span><span class="p">]:</span> <span class="s1">&#39;d&#39;</span>
</pre></div>
</div>
<p>::: tip 注意</p>
<p><code class="docutils literal notranslate"><span class="pre">idxmin</span></code> 与 <code class="docutils literal notranslate"><span class="pre">idxmax</span></code> 对应 NumPy 里的 <code class="docutils literal notranslate"><span class="pre">argmin</span></code> 与 <code class="docutils literal notranslate"><span class="pre">argmax</span></code>。</p>
<p>:::</p>
</div>
<div class="section" id="id12">
<h3>值计数（直方图）与众数<a class="headerlink" href="#id12" title="永久链接至标题">¶</a></h3>
<p>Series 的 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.value_counts.html#pandas.Series.value_counts"><code class="docutils literal notranslate"><span class="pre">value_counts()</span></code></a> 方法及顶级函数计算一维数组中数据值的直方图，还可以用作常规数组的函数：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">117</span><span class="p">]:</span> <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">118</span><span class="p">]:</span> <span class="n">data</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">118</span><span class="p">]:</span> 
<span class="n">array</span><span class="p">([</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>
       <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
       <span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">119</span><span class="p">]:</span> <span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">120</span><span class="p">]:</span> <span class="n">s</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">120</span><span class="p">]:</span> 
<span class="mi">6</span>    <span class="mi">10</span>
<span class="mi">2</span>    <span class="mi">10</span>
<span class="mi">4</span>     <span class="mi">9</span>
<span class="mi">5</span>     <span class="mi">8</span>
<span class="mi">3</span>     <span class="mi">8</span>
<span class="mi">0</span>     <span class="mi">3</span>
<span class="mi">1</span>     <span class="mi">2</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">121</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">121</span><span class="p">]:</span> 
<span class="mi">6</span>    <span class="mi">10</span>
<span class="mi">2</span>    <span class="mi">10</span>
<span class="mi">4</span>     <span class="mi">9</span>
<span class="mi">5</span>     <span class="mi">8</span>
<span class="mi">3</span>     <span class="mi">8</span>
<span class="mi">0</span>     <span class="mi">3</span>
<span class="mi">1</span>     <span class="mi">2</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>
</pre></div>
</div>
<p>与上述操作类似，还可以统计 Series 或 DataFrame 的众数，即出现频率最高的值：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">122</span><span class="p">]:</span> <span class="n">s5</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">])</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">123</span><span class="p">]:</span> <span class="n">s5</span><span class="o">.</span><span class="n">mode</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">123</span><span class="p">]:</span> 
<span class="mi">0</span>    <span class="mi">3</span>
<span class="mi">1</span>    <span class="mi">7</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">124</span><span class="p">]:</span> <span class="n">df5</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;A&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">50</span><span class="p">),</span>
   <span class="o">.....</span><span class="p">:</span>                     <span class="s2">&quot;B&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">50</span><span class="p">)})</span>
   <span class="o">.....</span><span class="p">:</span> 

<span class="n">In</span> <span class="p">[</span><span class="mi">125</span><span class="p">]:</span> <span class="n">df5</span><span class="o">.</span><span class="n">mode</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">125</span><span class="p">]:</span> 
     <span class="n">A</span>   <span class="n">B</span>
<span class="mi">0</span>  <span class="mf">1.0</span>  <span class="o">-</span><span class="mi">9</span>
<span class="mi">1</span>  <span class="n">NaN</span>  <span class="mi">10</span>
<span class="mi">2</span>  <span class="n">NaN</span>  <span class="mi">13</span>
</pre></div>
</div>
</div>
<div class="section" id="id13">
<h3>离散化与分位数<a class="headerlink" href="#id13" title="永久链接至标题">¶</a></h3>
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.cut.html#pandas.cut"><code class="docutils literal notranslate"><span class="pre">cut()</span> <span class="pre">函数</span></code></a>（以值为依据实现分箱）及 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.qcut.html#pandas.qcut"><code class="docutils literal notranslate"><span class="pre">qcut()</span> <span class="pre">函数</span></code></a>（以样本分位数为依据实现分箱）用于连续值的离散化：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">126</span><span class="p">]:</span> <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">127</span><span class="p">]:</span> <span class="n">factor</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">128</span><span class="p">]:</span> <span class="n">factor</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">128</span><span class="p">]:</span> 
<span class="p">[(</span><span class="o">-</span><span class="mf">0.251</span><span class="p">,</span> <span class="mf">0.464</span><span class="p">],</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.968</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.251</span><span class="p">],</span> <span class="p">(</span><span class="mf">0.464</span><span class="p">,</span> <span class="mf">1.179</span><span class="p">],</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.251</span><span class="p">,</span> <span class="mf">0.464</span><span class="p">],</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.968</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.251</span><span class="p">],</span> <span class="o">...</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.251</span><span class="p">,</span> <span class="mf">0.464</span><span class="p">],</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.968</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.251</span><span class="p">],</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.968</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.251</span><span class="p">],</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.968</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.251</span><span class="p">],</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.968</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.251</span><span class="p">]]</span>
<span class="n">Length</span><span class="p">:</span> <span class="mi">20</span>
<span class="n">Categories</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">interval</span><span class="p">[</span><span class="n">float64</span><span class="p">]):</span> <span class="p">[(</span><span class="o">-</span><span class="mf">0.968</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.251</span><span class="p">]</span> <span class="o">&lt;</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.251</span><span class="p">,</span> <span class="mf">0.464</span><span class="p">]</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mf">0.464</span><span class="p">,</span> <span class="mf">1.179</span><span class="p">]</span> <span class="o">&lt;</span>
                                    <span class="p">(</span><span class="mf">1.179</span><span class="p">,</span> <span class="mf">1.893</span><span class="p">]]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">129</span><span class="p">]:</span> <span class="n">factor</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">130</span><span class="p">]:</span> <span class="n">factor</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">130</span><span class="p">]:</span> 
<span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="o">...</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]</span>
<span class="n">Length</span><span class="p">:</span> <span class="mi">20</span>
<span class="n">Categories</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">interval</span><span class="p">[</span><span class="n">int64</span><span class="p">]):</span> <span class="p">[(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">]]</span>
</pre></div>
</div>
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.qcut.html#pandas.qcut"><code class="docutils literal notranslate"><span class="pre">qcut()</span></code></a> 计算样本分位数。比如，下列代码按等距分位数分割正态分布的数据：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">131</span><span class="p">]:</span> <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">132</span><span class="p">]:</span> <span class="n">factor</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">.</span><span class="mi">25</span><span class="p">,</span> <span class="o">.</span><span class="mi">5</span><span class="p">,</span> <span class="o">.</span><span class="mi">75</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">133</span><span class="p">]:</span> <span class="n">factor</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">133</span><span class="p">]:</span> 
<span class="p">[(</span><span class="mf">0.569</span><span class="p">,</span> <span class="mf">1.184</span><span class="p">],</span> <span class="p">(</span><span class="o">-</span><span class="mf">2.278</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.301</span><span class="p">],</span> <span class="p">(</span><span class="o">-</span><span class="mf">2.278</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.301</span><span class="p">],</span> <span class="p">(</span><span class="mf">0.569</span><span class="p">,</span> <span class="mf">1.184</span><span class="p">],</span> <span class="p">(</span><span class="mf">0.569</span><span class="p">,</span> <span class="mf">1.184</span><span class="p">],</span> <span class="o">...</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.301</span><span class="p">,</span> <span class="mf">0.569</span><span class="p">],</span> <span class="p">(</span><span class="mf">1.184</span><span class="p">,</span> <span class="mf">2.346</span><span class="p">],</span> <span class="p">(</span><span class="mf">1.184</span><span class="p">,</span> <span class="mf">2.346</span><span class="p">],</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.301</span><span class="p">,</span> <span class="mf">0.569</span><span class="p">],</span> <span class="p">(</span><span class="o">-</span><span class="mf">2.278</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.301</span><span class="p">]]</span>
<span class="n">Length</span><span class="p">:</span> <span class="mi">30</span>
<span class="n">Categories</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">interval</span><span class="p">[</span><span class="n">float64</span><span class="p">]):</span> <span class="p">[(</span><span class="o">-</span><span class="mf">2.278</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.301</span><span class="p">]</span> <span class="o">&lt;</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.301</span><span class="p">,</span> <span class="mf">0.569</span><span class="p">]</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mf">0.569</span><span class="p">,</span> <span class="mf">1.184</span><span class="p">]</span> <span class="o">&lt;</span>
                                    <span class="p">(</span><span class="mf">1.184</span><span class="p">,</span> <span class="mf">2.346</span><span class="p">]]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">134</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">factor</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">134</span><span class="p">]:</span> 
<span class="p">(</span><span class="mf">1.184</span><span class="p">,</span> <span class="mf">2.346</span><span class="p">]</span>      <span class="mi">8</span>
<span class="p">(</span><span class="o">-</span><span class="mf">2.278</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.301</span><span class="p">]</span>    <span class="mi">8</span>
<span class="p">(</span><span class="mf">0.569</span><span class="p">,</span> <span class="mf">1.184</span><span class="p">]</span>      <span class="mi">7</span>
<span class="p">(</span><span class="o">-</span><span class="mf">0.301</span><span class="p">,</span> <span class="mf">0.569</span><span class="p">]</span>     <span class="mi">7</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>
</pre></div>
</div>
<p>定义分箱时，还可以传递无穷值：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">135</span><span class="p">]:</span> <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">136</span><span class="p">]:</span> <span class="n">factor</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">])</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">137</span><span class="p">]:</span> <span class="n">factor</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">137</span><span class="p">]:</span> 
<span class="p">[(</span><span class="o">-</span><span class="n">inf</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">inf</span><span class="p">],</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">inf</span><span class="p">],</span> <span class="p">(</span><span class="o">-</span><span class="n">inf</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">(</span><span class="o">-</span><span class="n">inf</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="o">...</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="n">inf</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">(</span><span class="o">-</span><span class="n">inf</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">(</span><span class="o">-</span><span class="n">inf</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">inf</span><span class="p">],</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">inf</span><span class="p">]]</span>
<span class="n">Length</span><span class="p">:</span> <span class="mi">20</span>
<span class="n">Categories</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">interval</span><span class="p">[</span><span class="n">float64</span><span class="p">]):</span> <span class="p">[(</span><span class="o">-</span><span class="n">inf</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">inf</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id14">
<h2><span class="section-number">2.6. </span>函数应用<a class="headerlink" href="#id14" title="永久链接至标题">¶</a></h2>
<p>不管是为 Pandas 对象应用自定义函数，还是应用第三方函数，都离不开以下三种方法。用哪种方法取决于操作的对象是 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>，还是 <code class="docutils literal notranslate"><span class="pre">Series</span></code> ；是行、列，还是元素。</p>
<ol class="simple">
<li><p>表级函数应用：<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.pipe.html#pandas.DataFrame.pipe"><code class="docutils literal notranslate"><span class="pre">pipe()</span></code></a></p></li>
<li><p>行列级函数应用： <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.apply.html#pandas.DataFrame.apply"><code class="docutils literal notranslate"><span class="pre">apply()</span></code></a></p></li>
<li><p>聚合 API： <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.agg.html#pandas.DataFrame.agg"><code class="docutils literal notranslate"><span class="pre">agg()</span></code></a> 与 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.transform.html#pandas.DataFrame.transform"><code class="docutils literal notranslate"><span class="pre">transform()</span></code></a></p></li>
<li><p>元素级函数应用：<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.applymap.html#pandas.DataFrame.applymap"><code class="docutils literal notranslate"><span class="pre">applymap()</span></code></a></p></li>
</ol>
<div class="section" id="id15">
<h3>表级函数应用<a class="headerlink" href="#id15" title="永久链接至标题">¶</a></h3>
<p>虽然可以把 DataFrame 与 Series 传递给函数，不过链式调用函数时，最好使用 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.pipe.html#pandas.DataFrame.pipe"><code class="docutils literal notranslate"><span class="pre">pipe()</span></code></a> 方法。对比以下两种方式：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># f、g、h 是提取、返回 `DataFrames` 的函数</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">f</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">h</span><span class="p">(</span><span class="n">df</span><span class="p">),</span> <span class="n">arg1</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">arg2</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">arg3</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>下列代码与上述代码等效：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
<span class="gp">... </span>   <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">arg1</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">... </span>   <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">arg2</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">arg3</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>
</pre></div>
</div>
<p>Pandas 鼓励使用第二种方式，即链式方法。在链式方法中调用自定义函数或第三方支持库函数时，用 <code class="docutils literal notranslate"><span class="pre">pipe</span></code> 更容易，与用 Pandas 自身方法一样。</p>
<p>上例中，<code class="docutils literal notranslate"><span class="pre">f</span></code>、<code class="docutils literal notranslate"><span class="pre">g</span></code>  与 <code class="docutils literal notranslate"><span class="pre">h</span></code> 这几个函数都把 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 当作首位参数。要是想把数据作为第二个参数，该怎么办？本例中，<code class="docutils literal notranslate"><span class="pre">pipe</span></code> 为元组 （<code class="docutils literal notranslate"><span class="pre">callable,data_keyword</span></code>）形式。<code class="docutils literal notranslate"><span class="pre">.pipe</span></code> 把  <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>  作为元组里指定的参数。</p>
<p>下例用 statsmodels 拟合回归。该 API 先接收一个公式，<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 是第二个参数，<code class="docutils literal notranslate"><span class="pre">data</span></code>。要传递函数，则要用<code class="docutils literal notranslate"><span class="pre">pipe</span></code> 接收关键词对 (<code class="docutils literal notranslate"><span class="pre">sm.ols,'data'</span></code>)。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>In [138]: import statsmodels.formula.api as sm

In [139]: bb = pd.read_csv(&#39;data/baseball.csv&#39;, index_col=&#39;id&#39;)

In [140]: (bb.query(&#39;h &gt; 0&#39;)
   .....:    .assign(ln_h=lambda df: np.log(df.h))
   .....:    .pipe((sm.ols, &#39;data&#39;), &#39;hr ~ ln_h + year + g + C(lg)&#39;)
   .....:    .fit()
   .....:    .summary()
   .....:  )
   .....: 
Out[140]: 
&lt;class &#39;statsmodels.iolib.summary.Summary&#39;&gt;
&quot;&quot;&quot;
                            OLS Regression Results                            
==============================================================================
Dep. Variable:                     hr   R-squared:                       0.685
Model:                            OLS   Adj. R-squared:                  0.665
Method:                 Least Squares   F-statistic:                     34.28
Date:                Thu, 22 Aug 2019   Prob (F-statistic):           3.48e-15
Time:                        15:48:59   Log-Likelihood:                -205.92
No. Observations:                  68   AIC:                             421.8
Df Residuals:                      63   BIC:                             432.9
Df Model:                           4                                         
Covariance Type:            nonrobust                                         
===============================================================================
                  coef    std err          t      P&gt;|t|      [0.025      0.975]
-------------------------------------------------------------------------------
Intercept   -8484.7720   4664.146     -1.819      0.074   -1.78e+04     835.780
C(lg)[T.NL]    -2.2736      1.325     -1.716      0.091      -4.922       0.375
ln_h           -1.3542      0.875     -1.547      0.127      -3.103       0.395
year            4.2277      2.324      1.819      0.074      -0.417       8.872
g               0.1841      0.029      6.258      0.000       0.125       0.243
==============================================================================
Omnibus:                       10.875   Durbin-Watson:                   1.999
Prob(Omnibus):                  0.004   Jarque-Bera (JB):               17.298
Skew:                           0.537   Prob(JB):                     0.000175
Kurtosis:                       5.225   Cond. No.                     1.49e+07
==============================================================================

Warnings:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
[2] The condition number is large, 1.49e+07. This might indicate that there are
strong multicollinearity or other numerical problems.
&quot;&quot;&quot;
</pre></div>
</div>
<p>unix 的 <code class="docutils literal notranslate"><span class="pre">pipe</span></code>  与后来出现的 <a class="reference external" href="https://github.com/hadley/dplyr">dplyr</a> 及 <a class="reference external" href="https://github.com/smbache/magrittr">magrittr</a> 启发了<code class="docutils literal notranslate"><span class="pre">pipe</span></code> 方法，在此，引入了 R 语言里用于读取 pipe 的操作符 (<code class="docutils literal notranslate"><span class="pre">%&gt;%</span></code>)。<code class="docutils literal notranslate"><span class="pre">pipe</span></code> 的实现思路非常清晰，仿佛 Python 源生的一样。强烈建议大家阅读  <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.pipe.html#pandas.DataFrame.pipe"><code class="docutils literal notranslate"><span class="pre">pipe()</span></code></a>  的源代码。</p>
</div>
<div class="section" id="id16">
<h3>行列级函数应用<a class="headerlink" href="#id16" title="永久链接至标题">¶</a></h3>
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.apply.html#pandas.DataFrame.apply"><code class="docutils literal notranslate"><span class="pre">apply()</span></code></a> 方法沿着 DataFrame 的轴应用函数，比如，描述性统计方法，该方法支持  <code class="docutils literal notranslate"><span class="pre">axis</span></code> 参数。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">141</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">141</span><span class="p">]:</span> 
<span class="n">one</span>      <span class="mf">0.811094</span>
<span class="n">two</span>      <span class="mf">1.360588</span>
<span class="n">three</span>    <span class="mf">0.187958</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">142</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">142</span><span class="p">]:</span> 
<span class="n">a</span>    <span class="mf">1.583749</span>
<span class="n">b</span>    <span class="mf">0.734929</span>
<span class="n">c</span>    <span class="mf">1.133683</span>
<span class="n">d</span>   <span class="o">-</span><span class="mf">0.166914</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">143</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">143</span><span class="p">]:</span> 
<span class="n">one</span>      <span class="mf">1.051928</span>
<span class="n">two</span>      <span class="mf">1.632779</span>
<span class="n">three</span>    <span class="mf">1.840607</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">144</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">144</span><span class="p">]:</span> 
        <span class="n">one</span>       <span class="n">two</span>     <span class="n">three</span>
<span class="n">a</span>  <span class="mf">1.394981</span>  <span class="mf">1.772517</span>       <span class="n">NaN</span>
<span class="n">b</span>  <span class="mf">1.738035</span>  <span class="mf">3.684640</span> <span class="o">-</span><span class="mf">0.050390</span>
<span class="n">c</span>  <span class="mf">2.433281</span>  <span class="mf">5.163008</span>  <span class="mf">1.177045</span>
<span class="n">d</span>       <span class="n">NaN</span>  <span class="mf">5.442353</span>  <span class="mf">0.563873</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">145</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">145</span><span class="p">]:</span> 
        <span class="n">one</span>       <span class="n">two</span>     <span class="n">three</span>
<span class="n">a</span>  <span class="mf">4.034899</span>  <span class="mf">5.885648</span>       <span class="n">NaN</span>
<span class="n">b</span>  <span class="mf">1.409244</span>  <span class="mf">6.767440</span>  <span class="mf">0.950858</span>
<span class="n">c</span>  <span class="mf">2.004201</span>  <span class="mf">4.385785</span>  <span class="mf">3.412466</span>
<span class="n">d</span>       <span class="n">NaN</span>  <span class="mf">1.322262</span>  <span class="mf">0.541630</span>
</pre></div>
</div>
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.apply.html#pandas.DataFrame.apply"><code class="docutils literal notranslate"><span class="pre">apply()</span></code></a> 方法还支持通过函数名字符串调用函数。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">146</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">146</span><span class="p">]:</span> 
<span class="n">one</span>      <span class="mf">0.811094</span>
<span class="n">two</span>      <span class="mf">1.360588</span>
<span class="n">three</span>    <span class="mf">0.187958</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">147</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">147</span><span class="p">]:</span> 
<span class="n">a</span>    <span class="mf">1.583749</span>
<span class="n">b</span>    <span class="mf">0.734929</span>
<span class="n">c</span>    <span class="mf">1.133683</span>
<span class="n">d</span>   <span class="o">-</span><span class="mf">0.166914</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</pre></div>
</div>
<p>默认情况下，<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.apply.html#pandas.DataFrame.apply"><code class="docutils literal notranslate"><span class="pre">apply()</span></code></a> 调用的函数返回的类型会影响 <code class="docutils literal notranslate"><span class="pre">DataFrame.apply</span></code> 输出结果的类型。</p>
<ul class="simple">
<li><p>函数返回的是 <code class="docutils literal notranslate"><span class="pre">Series</span></code> 时，最终输出结果是 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>。输出的列与函数返回的 <code class="docutils literal notranslate"><span class="pre">Series</span></code> 索引相匹配。</p></li>
<li><p>函数返回其它任意类型时，输出结果是 <code class="docutils literal notranslate"><span class="pre">Series</span></code>。</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">result_type</span></code>  会覆盖默认行为，该参数有三个选项：<code class="docutils literal notranslate"><span class="pre">reduce</span></code>、<code class="docutils literal notranslate"><span class="pre">broadcast</span></code>、<code class="docutils literal notranslate"><span class="pre">expand</span></code>。这些选项决定了列表型返回值是否扩展为 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>。</p>
<p>用好 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.apply.html#pandas.DataFrame.apply"><code class="docutils literal notranslate"><span class="pre">apply()</span></code></a> 可以了解数据集的很多信息。比如可以提取每列的最大值对应的日期：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">148</span><span class="p">]:</span> <span class="n">tsdf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">],</span>
   <span class="o">.....</span><span class="p">:</span>                     <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;1/1/2000&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">1000</span><span class="p">))</span>
   <span class="o">.....</span><span class="p">:</span> 

<span class="n">In</span> <span class="p">[</span><span class="mi">149</span><span class="p">]:</span> <span class="n">tsdf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">idxmax</span><span class="p">())</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">149</span><span class="p">]:</span> 
<span class="n">A</span>   <span class="mi">2000</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">06</span>
<span class="n">B</span>   <span class="mi">2001</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">18</span>
<span class="n">C</span>   <span class="mi">2001</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">18</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">datetime64</span><span class="p">[</span><span class="n">ns</span><span class="p">]</span>
</pre></div>
</div>
<p>还可以向 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.apply.html#pandas.DataFrame.apply"><code class="docutils literal notranslate"><span class="pre">apply()</span></code></a> 方法传递额外的参数与关键字参数。比如下例中要应用的这个函数：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">subtract_and_divide</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">sub</span><span class="p">,</span> <span class="n">divide</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">sub</span><span class="p">)</span> <span class="o">/</span> <span class="n">divide</span>
</pre></div>
</div>
<p>可以用下列方式应用该函数：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">subtract_and_divide</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,),</span> <span class="n">divide</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>为每行或每列执行 <code class="docutils literal notranslate"><span class="pre">Series</span></code> 方法的功能也很实用：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">150</span><span class="p">]:</span> <span class="n">tsdf</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">150</span><span class="p">]:</span> 
                   <span class="n">A</span>         <span class="n">B</span>         <span class="n">C</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="o">-</span><span class="mf">0.158131</span> <span class="o">-</span><span class="mf">0.232466</span>  <span class="mf">0.321604</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span> <span class="o">-</span><span class="mf">1.810340</span> <span class="o">-</span><span class="mf">3.105758</span>  <span class="mf">0.433834</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span> <span class="o">-</span><span class="mf">1.209847</span> <span class="o">-</span><span class="mf">1.156793</span> <span class="o">-</span><span class="mf">0.136794</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">04</span>       <span class="n">NaN</span>       <span class="n">NaN</span>       <span class="n">NaN</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">05</span>       <span class="n">NaN</span>       <span class="n">NaN</span>       <span class="n">NaN</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">06</span>       <span class="n">NaN</span>       <span class="n">NaN</span>       <span class="n">NaN</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">07</span>       <span class="n">NaN</span>       <span class="n">NaN</span>       <span class="n">NaN</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span> <span class="o">-</span><span class="mf">0.653602</span>  <span class="mf">0.178875</span>  <span class="mf">1.008298</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">09</span>  <span class="mf">1.007996</span>  <span class="mf">0.462824</span>  <span class="mf">0.254472</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>  <span class="mf">0.307473</span>  <span class="mf">0.600337</span>  <span class="mf">1.643950</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">151</span><span class="p">]:</span> <span class="n">tsdf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="o">.</span><span class="n">interpolate</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">151</span><span class="p">]:</span> 
                   <span class="n">A</span>         <span class="n">B</span>         <span class="n">C</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="o">-</span><span class="mf">0.158131</span> <span class="o">-</span><span class="mf">0.232466</span>  <span class="mf">0.321604</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span> <span class="o">-</span><span class="mf">1.810340</span> <span class="o">-</span><span class="mf">3.105758</span>  <span class="mf">0.433834</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span> <span class="o">-</span><span class="mf">1.209847</span> <span class="o">-</span><span class="mf">1.156793</span> <span class="o">-</span><span class="mf">0.136794</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">04</span> <span class="o">-</span><span class="mf">1.098598</span> <span class="o">-</span><span class="mf">0.889659</span>  <span class="mf">0.092225</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">05</span> <span class="o">-</span><span class="mf">0.987349</span> <span class="o">-</span><span class="mf">0.622526</span>  <span class="mf">0.321243</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">06</span> <span class="o">-</span><span class="mf">0.876100</span> <span class="o">-</span><span class="mf">0.355392</span>  <span class="mf">0.550262</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">07</span> <span class="o">-</span><span class="mf">0.764851</span> <span class="o">-</span><span class="mf">0.088259</span>  <span class="mf">0.779280</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span> <span class="o">-</span><span class="mf">0.653602</span>  <span class="mf">0.178875</span>  <span class="mf">1.008298</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">09</span>  <span class="mf">1.007996</span>  <span class="mf">0.462824</span>  <span class="mf">0.254472</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>  <span class="mf">0.307473</span>  <span class="mf">0.600337</span>  <span class="mf">1.643950</span>
</pre></div>
</div>
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.apply.html#pandas.DataFrame.apply"><code class="docutils literal notranslate"><span class="pre">apply()</span></code></a> 有一个参数 <code class="docutils literal notranslate"><span class="pre">raw</span></code>，默认值为 <code class="docutils literal notranslate"><span class="pre">False</span></code>，在应用函数前，使用该参数可以将每行或列转换为 <code class="docutils literal notranslate"><span class="pre">Series</span></code>。该参数为 <code class="docutils literal notranslate"><span class="pre">True</span></code> 时，传递的函数接收 ndarray 对象，若不需要索引功能，这种操作能显著提高性能。</p>
</div>
<div class="section" id="api">
<h3>聚合 API<a class="headerlink" href="#api" title="永久链接至标题">¶</a></h3>
<p><em>0.20.0 版新增</em>。</p>
<p>聚合 API 可以快速、简洁地执行多个聚合操作。Pandas 对象支持多个类似的 API，如 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/groupby.html#groupby-aggregate">groupby API</a>、<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/computation.html#stats-aggregate">window functions API</a>、<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#timeseries-aggregate">resample API</a>。聚合函数为<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.aggregate.html#pandas.DataFrame.aggregate"><code class="docutils literal notranslate"><span class="pre">DataFrame.aggregate()</span></code></a>，它的别名是 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.agg.html#pandas.DataFrame.agg"><code class="docutils literal notranslate"><span class="pre">DataFrame.agg()</span></code></a>。</p>
<p>此处用与上例类似的 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">152</span><span class="p">]:</span> <span class="n">tsdf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">],</span>
   <span class="o">.....</span><span class="p">:</span>                     <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;1/1/2000&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>
   <span class="o">.....</span><span class="p">:</span> 

<span class="n">In</span> <span class="p">[</span><span class="mi">153</span><span class="p">]:</span> <span class="n">tsdf</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">154</span><span class="p">]:</span> <span class="n">tsdf</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">154</span><span class="p">]:</span> 
                   <span class="n">A</span>         <span class="n">B</span>         <span class="n">C</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span>  <span class="mf">1.257606</span>  <span class="mf">1.004194</span>  <span class="mf">0.167574</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span> <span class="o">-</span><span class="mf">0.749892</span>  <span class="mf">0.288112</span> <span class="o">-</span><span class="mf">0.757304</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span> <span class="o">-</span><span class="mf">0.207550</span> <span class="o">-</span><span class="mf">0.298599</span>  <span class="mf">0.116018</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">04</span>       <span class="n">NaN</span>       <span class="n">NaN</span>       <span class="n">NaN</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">05</span>       <span class="n">NaN</span>       <span class="n">NaN</span>       <span class="n">NaN</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">06</span>       <span class="n">NaN</span>       <span class="n">NaN</span>       <span class="n">NaN</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">07</span>       <span class="n">NaN</span>       <span class="n">NaN</span>       <span class="n">NaN</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span>  <span class="mf">0.814347</span> <span class="o">-</span><span class="mf">0.257623</span>  <span class="mf">0.869226</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">09</span> <span class="o">-</span><span class="mf">0.250663</span> <span class="o">-</span><span class="mf">1.206601</span>  <span class="mf">0.896839</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>  <span class="mf">2.169758</span> <span class="o">-</span><span class="mf">1.333363</span>  <span class="mf">0.283157</span>
</pre></div>
</div>
<p>应用单个函数时，该操作与 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.apply.html#pandas.DataFrame.apply"><code class="docutils literal notranslate"><span class="pre">apply()</span></code></a> 等效，这里也可以用字符串表示聚合函数名。下面的聚合函数输出的结果为 <code class="docutils literal notranslate"><span class="pre">Series</span></code>：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">155</span><span class="p">]:</span> <span class="n">tsdf</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">155</span><span class="p">]:</span> 
<span class="n">A</span>    <span class="mf">3.033606</span>
<span class="n">B</span>   <span class="o">-</span><span class="mf">1.803879</span>
<span class="n">C</span>    <span class="mf">1.575510</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">156</span><span class="p">]:</span> <span class="n">tsdf</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="s1">&#39;sum&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">156</span><span class="p">]:</span> 
<span class="n">A</span>    <span class="mf">3.033606</span>
<span class="n">B</span>   <span class="o">-</span><span class="mf">1.803879</span>
<span class="n">C</span>    <span class="mf">1.575510</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>

<span class="c1"># 因为应用的是单个函数，该操作与`.sum()` 是等效的</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">157</span><span class="p">]:</span> <span class="n">tsdf</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">157</span><span class="p">]:</span> 
<span class="n">A</span>    <span class="mf">3.033606</span>
<span class="n">B</span>   <span class="o">-</span><span class="mf">1.803879</span>
<span class="n">C</span>    <span class="mf">1.575510</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Series</span></code> 单个聚合操作返回标量值：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">158</span><span class="p">]:</span> <span class="n">tsdf</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="s1">&#39;sum&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">158</span><span class="p">]:</span> <span class="mf">3.033606102414146</span>
</pre></div>
</div>
</div>
<div class="section" id="id17">
<h3>多函数聚合<a class="headerlink" href="#id17" title="永久链接至标题">¶</a></h3>
<p>还可以用列表形式传递多个聚合函数。每个函数在输出结果 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 里以行的形式显示，行名是每个聚合函数的函数名。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">159</span><span class="p">]:</span> <span class="n">tsdf</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;sum&#39;</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">159</span><span class="p">]:</span> 
            <span class="n">A</span>         <span class="n">B</span>        <span class="n">C</span>
<span class="nb">sum</span>  <span class="mf">3.033606</span> <span class="o">-</span><span class="mf">1.803879</span>  <span class="mf">1.57551</span>
</pre></div>
</div>
<p>多个函数输出多行：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">160</span><span class="p">]:</span> <span class="n">tsdf</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;sum&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">160</span><span class="p">]:</span> 
             <span class="n">A</span>         <span class="n">B</span>         <span class="n">C</span>
<span class="nb">sum</span>   <span class="mf">3.033606</span> <span class="o">-</span><span class="mf">1.803879</span>  <span class="mf">1.575510</span>
<span class="n">mean</span>  <span class="mf">0.505601</span> <span class="o">-</span><span class="mf">0.300647</span>  <span class="mf">0.262585</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Series</span></code> 聚合多函数返回结果还是 <code class="docutils literal notranslate"><span class="pre">Series</span></code>，索引为函数名：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">161</span><span class="p">]:</span> <span class="n">tsdf</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;sum&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">161</span><span class="p">]:</span> 
<span class="nb">sum</span>     <span class="mf">3.033606</span>
<span class="n">mean</span>    <span class="mf">0.505601</span>
<span class="n">Name</span><span class="p">:</span> <span class="n">A</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</pre></div>
</div>
<p>传递 <code class="docutils literal notranslate"><span class="pre">lambda</span></code> 函数时，输出名为 <code class="docutils literal notranslate"><span class="pre">&lt;lambda&gt;</span></code> 的行：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">162</span><span class="p">]:</span> <span class="n">tsdf</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;sum&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">()])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">162</span><span class="p">]:</span> 
<span class="nb">sum</span>         <span class="mf">3.033606</span>
<span class="o">&lt;</span><span class="k">lambda</span><span class="o">&gt;</span>    <span class="mf">0.505601</span>
<span class="n">Name</span><span class="p">:</span> <span class="n">A</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</pre></div>
</div>
<p>应用自定义函数时，该函数名为输出结果的行名：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">163</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">mymean</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
   <span class="o">.....</span><span class="p">:</span>     <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
   <span class="o">.....</span><span class="p">:</span> 

<span class="n">In</span> <span class="p">[</span><span class="mi">164</span><span class="p">]:</span> <span class="n">tsdf</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;sum&#39;</span><span class="p">,</span> <span class="n">mymean</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">164</span><span class="p">]:</span> 
<span class="nb">sum</span>       <span class="mf">3.033606</span>
<span class="n">mymean</span>    <span class="mf">0.505601</span>
<span class="n">Name</span><span class="p">:</span> <span class="n">A</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</pre></div>
</div>
</div>
<div class="section" id="id18">
<h3>用字典实现聚合<a class="headerlink" href="#id18" title="永久链接至标题">¶</a></h3>
<p>指定为哪些列应用哪些聚合函数时，需要把包含列名与标量（或标量列表）的字典传递给 <code class="docutils literal notranslate"><span class="pre">DataFrame.agg</span></code>。</p>
<p>注意：这里输出结果的顺序不是固定的，要想让输出顺序与输入顺序一致，请使用 <code class="docutils literal notranslate"><span class="pre">OrderedDict</span></code>。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">165</span><span class="p">]:</span> <span class="n">tsdf</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="s1">&#39;sum&#39;</span><span class="p">})</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">165</span><span class="p">]:</span> 
<span class="n">A</span>    <span class="mf">0.505601</span>
<span class="n">B</span>   <span class="o">-</span><span class="mf">1.803879</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</pre></div>
</div>
<p>输入的参数是列表时，输出结果为  <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>，并以矩阵形式显示所有聚合函数的计算结果，且输出结果由所有唯一函数组成。未执行聚合操作的列输出结果为 <code class="docutils literal notranslate"><span class="pre">NaN</span></code> 值：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">166</span><span class="p">]:</span> <span class="n">tsdf</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span><span class="p">],</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="s1">&#39;sum&#39;</span><span class="p">})</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">166</span><span class="p">]:</span> 
             <span class="n">A</span>         <span class="n">B</span>
<span class="n">mean</span>  <span class="mf">0.505601</span>       <span class="n">NaN</span>
<span class="nb">min</span>  <span class="o">-</span><span class="mf">0.749892</span>       <span class="n">NaN</span>
<span class="nb">sum</span>        <span class="n">NaN</span> <span class="o">-</span><span class="mf">1.803879</span>
</pre></div>
</div>
</div>
<div class="section" id="dtype">
<h3>多种数据类型（Dtype）<a class="headerlink" href="#dtype" title="永久链接至标题">¶</a></h3>
<p>与 <code class="docutils literal notranslate"><span class="pre">groupby</span></code> 的 <code class="docutils literal notranslate"><span class="pre">.agg</span></code> 操作类似，DataFrame 含不能执行聚合的数据类型时，<code class="docutils literal notranslate"><span class="pre">.agg</span></code> 只计算可聚合的列：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">167</span><span class="p">]:</span> <span class="n">mdf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
   <span class="o">.....</span><span class="p">:</span>                     <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">],</span>
   <span class="o">.....</span><span class="p">:</span>                     <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;baz&#39;</span><span class="p">],</span>
   <span class="o">.....</span><span class="p">:</span>                     <span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;20130101&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">)})</span>
   <span class="o">.....</span><span class="p">:</span> 

<span class="n">In</span> <span class="p">[</span><span class="mi">168</span><span class="p">]:</span> <span class="n">mdf</span><span class="o">.</span><span class="n">dtypes</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">168</span><span class="p">]:</span> 
<span class="n">A</span>             <span class="n">int64</span>
<span class="n">B</span>           <span class="n">float64</span>
<span class="n">C</span>            <span class="nb">object</span>
<span class="n">D</span>    <span class="n">datetime64</span><span class="p">[</span><span class="n">ns</span><span class="p">]</span>
<span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">169</span><span class="p">]:</span> <span class="n">mdf</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">169</span><span class="p">]:</span> 
     <span class="n">A</span>    <span class="n">B</span>          <span class="n">C</span>          <span class="n">D</span>
<span class="nb">min</span>  <span class="mi">1</span>  <span class="mf">1.0</span>        <span class="n">bar</span> <span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span>
<span class="nb">sum</span>  <span class="mi">6</span>  <span class="mf">6.0</span>  <span class="n">foobarbaz</span>        <span class="n">NaT</span>
</pre></div>
</div>
</div>
<div class="section" id="id19">
<h3>自定义 Describe<a class="headerlink" href="#id19" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">.agg()</span></code> 可以创建类似于内置 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/getting_started/basics.html#basics-describe">describe 函数</a> 的自定义 describe 函数。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">170</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">171</span><span class="p">]:</span> <span class="n">q_25</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="o">.</span><span class="n">quantile</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">172</span><span class="p">]:</span> <span class="n">q_25</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="s1">&#39;25%&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">173</span><span class="p">]:</span> <span class="n">q_75</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="o">.</span><span class="n">quantile</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">174</span><span class="p">]:</span> <span class="n">q_75</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="s1">&#39;75%&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">175</span><span class="p">]:</span> <span class="n">tsdf</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="n">q_25</span><span class="p">,</span> <span class="s1">&#39;median&#39;</span><span class="p">,</span> <span class="n">q_75</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">175</span><span class="p">]:</span> 
               <span class="n">A</span>         <span class="n">B</span>         <span class="n">C</span>
<span class="n">count</span>   <span class="mf">6.000000</span>  <span class="mf">6.000000</span>  <span class="mf">6.000000</span>
<span class="n">mean</span>    <span class="mf">0.505601</span> <span class="o">-</span><span class="mf">0.300647</span>  <span class="mf">0.262585</span>
<span class="n">std</span>     <span class="mf">1.103362</span>  <span class="mf">0.887508</span>  <span class="mf">0.606860</span>
<span class="nb">min</span>    <span class="o">-</span><span class="mf">0.749892</span> <span class="o">-</span><span class="mf">1.333363</span> <span class="o">-</span><span class="mf">0.757304</span>
<span class="mi">25</span><span class="o">%</span>    <span class="o">-</span><span class="mf">0.239885</span> <span class="o">-</span><span class="mf">0.979600</span>  <span class="mf">0.128907</span>
<span class="n">median</span>  <span class="mf">0.303398</span> <span class="o">-</span><span class="mf">0.278111</span>  <span class="mf">0.225365</span>
<span class="mi">75</span><span class="o">%</span>     <span class="mf">1.146791</span>  <span class="mf">0.151678</span>  <span class="mf">0.722709</span>
<span class="nb">max</span>     <span class="mf">2.169758</span>  <span class="mf">1.004194</span>  <span class="mf">0.896839</span>
</pre></div>
</div>
</div>
<div class="section" id="transform-api">
<h3>Transform API<a class="headerlink" href="#transform-api" title="永久链接至标题">¶</a></h3>
<p><em>0.20.0 版新增</em>。</p>
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.transform.html#pandas.DataFrame.transform"><code class="docutils literal notranslate"><span class="pre">transform()</span></code></a> 方法的返回结果与原始数据的索引相同，大小相同。与 <code class="docutils literal notranslate"><span class="pre">.agg</span></code> API 类似，该 API 支持同时处理多种操作，不用一个一个操作。</p>
<p>下面，先创建一个 DataFrame：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">176</span><span class="p">]:</span> <span class="n">tsdf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">],</span>
   <span class="o">.....</span><span class="p">:</span>                     <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;1/1/2000&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>
   <span class="o">.....</span><span class="p">:</span> 

<span class="n">In</span> <span class="p">[</span><span class="mi">177</span><span class="p">]:</span> <span class="n">tsdf</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">178</span><span class="p">]:</span> <span class="n">tsdf</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">178</span><span class="p">]:</span> 
                   <span class="n">A</span>         <span class="n">B</span>         <span class="n">C</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="o">-</span><span class="mf">0.428759</span> <span class="o">-</span><span class="mf">0.864890</span> <span class="o">-</span><span class="mf">0.675341</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span> <span class="o">-</span><span class="mf">0.168731</span>  <span class="mf">1.338144</span> <span class="o">-</span><span class="mf">1.279321</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span> <span class="o">-</span><span class="mf">1.621034</span>  <span class="mf">0.438107</span>  <span class="mf">0.903794</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">04</span>       <span class="n">NaN</span>       <span class="n">NaN</span>       <span class="n">NaN</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">05</span>       <span class="n">NaN</span>       <span class="n">NaN</span>       <span class="n">NaN</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">06</span>       <span class="n">NaN</span>       <span class="n">NaN</span>       <span class="n">NaN</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">07</span>       <span class="n">NaN</span>       <span class="n">NaN</span>       <span class="n">NaN</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span>  <span class="mf">0.254374</span> <span class="o">-</span><span class="mf">1.240447</span> <span class="o">-</span><span class="mf">0.201052</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">09</span> <span class="o">-</span><span class="mf">0.157795</span>  <span class="mf">0.791197</span> <span class="o">-</span><span class="mf">1.144209</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span> <span class="o">-</span><span class="mf">0.030876</span>  <span class="mf">0.371900</span>  <span class="mf">0.061932</span>
</pre></div>
</div>
<p>这里转换的是整个 DataFrame。<code class="docutils literal notranslate"><span class="pre">.transform()</span></code> 支持 NumPy 函数、字符串函数及自定义函数。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">179</span><span class="p">]:</span> <span class="n">tsdf</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">179</span><span class="p">]:</span> 
                   <span class="n">A</span>         <span class="n">B</span>         <span class="n">C</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span>  <span class="mf">0.428759</span>  <span class="mf">0.864890</span>  <span class="mf">0.675341</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span>  <span class="mf">0.168731</span>  <span class="mf">1.338144</span>  <span class="mf">1.279321</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span>  <span class="mf">1.621034</span>  <span class="mf">0.438107</span>  <span class="mf">0.903794</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">04</span>       <span class="n">NaN</span>       <span class="n">NaN</span>       <span class="n">NaN</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">05</span>       <span class="n">NaN</span>       <span class="n">NaN</span>       <span class="n">NaN</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">06</span>       <span class="n">NaN</span>       <span class="n">NaN</span>       <span class="n">NaN</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">07</span>       <span class="n">NaN</span>       <span class="n">NaN</span>       <span class="n">NaN</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span>  <span class="mf">0.254374</span>  <span class="mf">1.240447</span>  <span class="mf">0.201052</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">09</span>  <span class="mf">0.157795</span>  <span class="mf">0.791197</span>  <span class="mf">1.144209</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>  <span class="mf">0.030876</span>  <span class="mf">0.371900</span>  <span class="mf">0.061932</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">180</span><span class="p">]:</span> <span class="n">tsdf</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="s1">&#39;abs&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">180</span><span class="p">]:</span> 
                   <span class="n">A</span>         <span class="n">B</span>         <span class="n">C</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span>  <span class="mf">0.428759</span>  <span class="mf">0.864890</span>  <span class="mf">0.675341</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span>  <span class="mf">0.168731</span>  <span class="mf">1.338144</span>  <span class="mf">1.279321</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span>  <span class="mf">1.621034</span>  <span class="mf">0.438107</span>  <span class="mf">0.903794</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">04</span>       <span class="n">NaN</span>       <span class="n">NaN</span>       <span class="n">NaN</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">05</span>       <span class="n">NaN</span>       <span class="n">NaN</span>       <span class="n">NaN</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">06</span>       <span class="n">NaN</span>       <span class="n">NaN</span>       <span class="n">NaN</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">07</span>       <span class="n">NaN</span>       <span class="n">NaN</span>       <span class="n">NaN</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span>  <span class="mf">0.254374</span>  <span class="mf">1.240447</span>  <span class="mf">0.201052</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">09</span>  <span class="mf">0.157795</span>  <span class="mf">0.791197</span>  <span class="mf">1.144209</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>  <span class="mf">0.030876</span>  <span class="mf">0.371900</span>  <span class="mf">0.061932</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">181</span><span class="p">]:</span> <span class="n">tsdf</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">abs</span><span class="p">())</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">181</span><span class="p">]:</span> 
                   <span class="n">A</span>         <span class="n">B</span>         <span class="n">C</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span>  <span class="mf">0.428759</span>  <span class="mf">0.864890</span>  <span class="mf">0.675341</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span>  <span class="mf">0.168731</span>  <span class="mf">1.338144</span>  <span class="mf">1.279321</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span>  <span class="mf">1.621034</span>  <span class="mf">0.438107</span>  <span class="mf">0.903794</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">04</span>       <span class="n">NaN</span>       <span class="n">NaN</span>       <span class="n">NaN</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">05</span>       <span class="n">NaN</span>       <span class="n">NaN</span>       <span class="n">NaN</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">06</span>       <span class="n">NaN</span>       <span class="n">NaN</span>       <span class="n">NaN</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">07</span>       <span class="n">NaN</span>       <span class="n">NaN</span>       <span class="n">NaN</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span>  <span class="mf">0.254374</span>  <span class="mf">1.240447</span>  <span class="mf">0.201052</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">09</span>  <span class="mf">0.157795</span>  <span class="mf">0.791197</span>  <span class="mf">1.144209</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>  <span class="mf">0.030876</span>  <span class="mf">0.371900</span>  <span class="mf">0.061932</span>
</pre></div>
</div>
<p>这里的 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.transform.html#pandas.DataFrame.transform"><code class="docutils literal notranslate"><span class="pre">transform()</span></code></a> 接受单个函数；与 ufunc 等效。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">182</span><span class="p">]:</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">tsdf</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">182</span><span class="p">]:</span> 
                   <span class="n">A</span>         <span class="n">B</span>         <span class="n">C</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span>  <span class="mf">0.428759</span>  <span class="mf">0.864890</span>  <span class="mf">0.675341</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span>  <span class="mf">0.168731</span>  <span class="mf">1.338144</span>  <span class="mf">1.279321</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span>  <span class="mf">1.621034</span>  <span class="mf">0.438107</span>  <span class="mf">0.903794</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">04</span>       <span class="n">NaN</span>       <span class="n">NaN</span>       <span class="n">NaN</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">05</span>       <span class="n">NaN</span>       <span class="n">NaN</span>       <span class="n">NaN</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">06</span>       <span class="n">NaN</span>       <span class="n">NaN</span>       <span class="n">NaN</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">07</span>       <span class="n">NaN</span>       <span class="n">NaN</span>       <span class="n">NaN</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span>  <span class="mf">0.254374</span>  <span class="mf">1.240447</span>  <span class="mf">0.201052</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">09</span>  <span class="mf">0.157795</span>  <span class="mf">0.791197</span>  <span class="mf">1.144209</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>  <span class="mf">0.030876</span>  <span class="mf">0.371900</span>  <span class="mf">0.061932</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">.transform()</span></code> 向 <code class="docutils literal notranslate"><span class="pre">Series</span></code> 传递单个函数时，返回的结果也是单个 <code class="docutils literal notranslate"><span class="pre">Series</span></code>。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">183</span><span class="p">]:</span> <span class="n">tsdf</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">183</span><span class="p">]:</span> 
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span>    <span class="mf">0.428759</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span>    <span class="mf">0.168731</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span>    <span class="mf">1.621034</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">04</span>         <span class="n">NaN</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">05</span>         <span class="n">NaN</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">06</span>         <span class="n">NaN</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">07</span>         <span class="n">NaN</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span>    <span class="mf">0.254374</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">09</span>    <span class="mf">0.157795</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>    <span class="mf">0.030876</span>
<span class="n">Freq</span><span class="p">:</span> <span class="n">D</span><span class="p">,</span> <span class="n">Name</span><span class="p">:</span> <span class="n">A</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</pre></div>
</div>
</div>
<div class="section" id="transform">
<h3>多函数 Transform<a class="headerlink" href="#transform" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">transform()</span></code> 调用多个函数时，生成多层索引 DataFrame。第一层是原始数据集的列名；第二层是 <code class="docutils literal notranslate"><span class="pre">transform()</span></code> 调用的函数名。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">184</span><span class="p">]:</span> <span class="n">tsdf</span><span class="o">.</span><span class="n">transform</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">184</span><span class="p">]:</span> 
                   <span class="n">A</span>                   <span class="n">B</span>                   <span class="n">C</span>          
            <span class="n">absolute</span>  <span class="o">&lt;</span><span class="k">lambda</span><span class="o">&gt;</span>  <span class="n">absolute</span>  <span class="o">&lt;</span><span class="k">lambda</span><span class="o">&gt;</span>  <span class="n">absolute</span>  <span class="o">&lt;</span><span class="k">lambda</span><span class="o">&gt;</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span>  <span class="mf">0.428759</span>  <span class="mf">0.571241</span>  <span class="mf">0.864890</span>  <span class="mf">0.135110</span>  <span class="mf">0.675341</span>  <span class="mf">0.324659</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span>  <span class="mf">0.168731</span>  <span class="mf">0.831269</span>  <span class="mf">1.338144</span>  <span class="mf">2.338144</span>  <span class="mf">1.279321</span> <span class="o">-</span><span class="mf">0.279321</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span>  <span class="mf">1.621034</span> <span class="o">-</span><span class="mf">0.621034</span>  <span class="mf">0.438107</span>  <span class="mf">1.438107</span>  <span class="mf">0.903794</span>  <span class="mf">1.903794</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">04</span>       <span class="n">NaN</span>       <span class="n">NaN</span>       <span class="n">NaN</span>       <span class="n">NaN</span>       <span class="n">NaN</span>       <span class="n">NaN</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">05</span>       <span class="n">NaN</span>       <span class="n">NaN</span>       <span class="n">NaN</span>       <span class="n">NaN</span>       <span class="n">NaN</span>       <span class="n">NaN</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">06</span>       <span class="n">NaN</span>       <span class="n">NaN</span>       <span class="n">NaN</span>       <span class="n">NaN</span>       <span class="n">NaN</span>       <span class="n">NaN</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">07</span>       <span class="n">NaN</span>       <span class="n">NaN</span>       <span class="n">NaN</span>       <span class="n">NaN</span>       <span class="n">NaN</span>       <span class="n">NaN</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span>  <span class="mf">0.254374</span>  <span class="mf">1.254374</span>  <span class="mf">1.240447</span> <span class="o">-</span><span class="mf">0.240447</span>  <span class="mf">0.201052</span>  <span class="mf">0.798948</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">09</span>  <span class="mf">0.157795</span>  <span class="mf">0.842205</span>  <span class="mf">0.791197</span>  <span class="mf">1.791197</span>  <span class="mf">1.144209</span> <span class="o">-</span><span class="mf">0.144209</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>  <span class="mf">0.030876</span>  <span class="mf">0.969124</span>  <span class="mf">0.371900</span>  <span class="mf">1.371900</span>  <span class="mf">0.061932</span>  <span class="mf">1.061932</span>
</pre></div>
</div>
<p>为 Series 应用多个函数时，输出结果是 DataFrame，列名是 <code class="docutils literal notranslate"><span class="pre">transform()</span></code> 调用的函数名。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">185</span><span class="p">]:</span> <span class="n">tsdf</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">transform</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">185</span><span class="p">]:</span> 
            <span class="n">absolute</span>  <span class="o">&lt;</span><span class="k">lambda</span><span class="o">&gt;</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span>  <span class="mf">0.428759</span>  <span class="mf">0.571241</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span>  <span class="mf">0.168731</span>  <span class="mf">0.831269</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span>  <span class="mf">1.621034</span> <span class="o">-</span><span class="mf">0.621034</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">04</span>       <span class="n">NaN</span>       <span class="n">NaN</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">05</span>       <span class="n">NaN</span>       <span class="n">NaN</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">06</span>       <span class="n">NaN</span>       <span class="n">NaN</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">07</span>       <span class="n">NaN</span>       <span class="n">NaN</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span>  <span class="mf">0.254374</span>  <span class="mf">1.254374</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">09</span>  <span class="mf">0.157795</span>  <span class="mf">0.842205</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>  <span class="mf">0.030876</span>  <span class="mf">0.969124</span>
</pre></div>
</div>
</div>
<div class="section" id="id20">
<h3>用字典执行 <code class="docutils literal notranslate"><span class="pre">transform</span></code> 操作<a class="headerlink" href="#id20" title="永久链接至标题">¶</a></h3>
<p>函数字典可以为每列执行指定 <code class="docutils literal notranslate"><span class="pre">transform()</span></code> 操作。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">186</span><span class="p">]:</span> <span class="n">tsdf</span><span class="o">.</span><span class="n">transform</span><span class="p">({</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">})</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">186</span><span class="p">]:</span> 
                   <span class="n">A</span>         <span class="n">B</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span>  <span class="mf">0.428759</span>  <span class="mf">0.135110</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span>  <span class="mf">0.168731</span>  <span class="mf">2.338144</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span>  <span class="mf">1.621034</span>  <span class="mf">1.438107</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">04</span>       <span class="n">NaN</span>       <span class="n">NaN</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">05</span>       <span class="n">NaN</span>       <span class="n">NaN</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">06</span>       <span class="n">NaN</span>       <span class="n">NaN</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">07</span>       <span class="n">NaN</span>       <span class="n">NaN</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span>  <span class="mf">0.254374</span> <span class="o">-</span><span class="mf">0.240447</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">09</span>  <span class="mf">0.157795</span>  <span class="mf">1.791197</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>  <span class="mf">0.030876</span>  <span class="mf">1.371900</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">transform()</span></code> 的参数是列表字典时，生成的是以 <code class="docutils literal notranslate"><span class="pre">transform()</span></code> 调用的函数为名的多层索引 DataFrame。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">187</span><span class="p">]:</span> <span class="n">tsdf</span><span class="o">.</span><span class="n">transform</span><span class="p">({</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="p">[</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;sqrt&#39;</span><span class="p">]})</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">187</span><span class="p">]:</span> 
                   <span class="n">A</span>         <span class="n">B</span>          
            <span class="n">absolute</span>  <span class="o">&lt;</span><span class="k">lambda</span><span class="o">&gt;</span>      <span class="n">sqrt</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span>  <span class="mf">0.428759</span>  <span class="mf">0.135110</span>       <span class="n">NaN</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span>  <span class="mf">0.168731</span>  <span class="mf">2.338144</span>  <span class="mf">1.156782</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span>  <span class="mf">1.621034</span>  <span class="mf">1.438107</span>  <span class="mf">0.661897</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">04</span>       <span class="n">NaN</span>       <span class="n">NaN</span>       <span class="n">NaN</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">05</span>       <span class="n">NaN</span>       <span class="n">NaN</span>       <span class="n">NaN</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">06</span>       <span class="n">NaN</span>       <span class="n">NaN</span>       <span class="n">NaN</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">07</span>       <span class="n">NaN</span>       <span class="n">NaN</span>       <span class="n">NaN</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span>  <span class="mf">0.254374</span> <span class="o">-</span><span class="mf">0.240447</span>       <span class="n">NaN</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">09</span>  <span class="mf">0.157795</span>  <span class="mf">1.791197</span>  <span class="mf">0.889493</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>  <span class="mf">0.030876</span>  <span class="mf">1.371900</span>  <span class="mf">0.609836</span>
</pre></div>
</div>
</div>
<div class="section" id="id21">
<h3>元素级函数应用<a class="headerlink" href="#id21" title="永久链接至标题">¶</a></h3>
<p>并非所有函数都能矢量化，即接受 NumPy 数组，返回另一个数组或值，DataFrame 的 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.applymap.html#pandas.DataFrame.applymap"><code class="docutils literal notranslate"><span class="pre">applymap()</span></code></a> 及 Series 的 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.map.html#pandas.Series.map"><code class="docutils literal notranslate"><span class="pre">map()</span></code></a> ，支持任何接收单个值并返回单个值的 Python 函数。</p>
<p>示例如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">188</span><span class="p">]:</span> <span class="n">df4</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">188</span><span class="p">]:</span> 
        <span class="n">one</span>       <span class="n">two</span>     <span class="n">three</span>
<span class="n">a</span>  <span class="mf">1.394981</span>  <span class="mf">1.772517</span>       <span class="n">NaN</span>
<span class="n">b</span>  <span class="mf">0.343054</span>  <span class="mf">1.912123</span> <span class="o">-</span><span class="mf">0.050390</span>
<span class="n">c</span>  <span class="mf">0.695246</span>  <span class="mf">1.478369</span>  <span class="mf">1.227435</span>
<span class="n">d</span>       <span class="n">NaN</span>  <span class="mf">0.279344</span> <span class="o">-</span><span class="mf">0.613172</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">189</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
   <span class="o">.....</span><span class="p">:</span>     <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
   <span class="o">.....</span><span class="p">:</span> 

<span class="n">In</span> <span class="p">[</span><span class="mi">190</span><span class="p">]:</span> <span class="n">df4</span><span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">190</span><span class="p">]:</span> 
<span class="n">a</span>    <span class="mi">18</span>
<span class="n">b</span>    <span class="mi">19</span>
<span class="n">c</span>    <span class="mi">18</span>
<span class="n">d</span>     <span class="mi">3</span>
<span class="n">Name</span><span class="p">:</span> <span class="n">one</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">191</span><span class="p">]:</span> <span class="n">df4</span><span class="o">.</span><span class="n">applymap</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">191</span><span class="p">]:</span> 
   <span class="n">one</span>  <span class="n">two</span>  <span class="n">three</span>
<span class="n">a</span>   <span class="mi">18</span>   <span class="mi">17</span>      <span class="mi">3</span>
<span class="n">b</span>   <span class="mi">19</span>   <span class="mi">18</span>     <span class="mi">20</span>
<span class="n">c</span>   <span class="mi">18</span>   <span class="mi">18</span>     <span class="mi">16</span>
<span class="n">d</span>    <span class="mi">3</span>   <span class="mi">19</span>     <span class="mi">19</span>
</pre></div>
</div>
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.map.html#pandas.Series.map"><code class="docutils literal notranslate"><span class="pre">Series.map()</span></code></a> 还有个功能，可以“连接”或“映射”第二个 Series 定义的值。这与 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/merging.html#merging">merging / joining 功能</a>联系非常紧密：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">192</span><span class="p">]:</span> <span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="s1">&#39;six&#39;</span><span class="p">,</span> <span class="s1">&#39;seven&#39;</span><span class="p">,</span> <span class="s1">&#39;six&#39;</span><span class="p">,</span> <span class="s1">&#39;seven&#39;</span><span class="p">,</span> <span class="s1">&#39;six&#39;</span><span class="p">],</span>
   <span class="o">.....</span><span class="p">:</span>               <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">])</span>
   <span class="o">.....</span><span class="p">:</span> 

<span class="n">In</span> <span class="p">[</span><span class="mi">193</span><span class="p">]:</span> <span class="n">t</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">({</span><span class="s1">&#39;six&#39;</span><span class="p">:</span> <span class="mf">6.</span><span class="p">,</span> <span class="s1">&#39;seven&#39;</span><span class="p">:</span> <span class="mf">7.</span><span class="p">})</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">194</span><span class="p">]:</span> <span class="n">s</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">194</span><span class="p">]:</span> 
<span class="n">a</span>      <span class="n">six</span>
<span class="n">b</span>    <span class="n">seven</span>
<span class="n">c</span>      <span class="n">six</span>
<span class="n">d</span>    <span class="n">seven</span>
<span class="n">e</span>      <span class="n">six</span>
<span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">195</span><span class="p">]:</span> <span class="n">s</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">195</span><span class="p">]:</span> 
<span class="n">a</span>    <span class="mf">6.0</span>
<span class="n">b</span>    <span class="mf">7.0</span>
<span class="n">c</span>    <span class="mf">6.0</span>
<span class="n">d</span>    <span class="mf">7.0</span>
<span class="n">e</span>    <span class="mf">6.0</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id22">
<h2><span class="section-number">2.7. </span>重置索引与更换标签<a class="headerlink" href="#id22" title="永久链接至标题">¶</a></h2>
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.reindex.html#pandas.Series.reindex"><code class="docutils literal notranslate"><span class="pre">reindex()</span></code></a> 是 Pandas 里实现数据对齐的基本方法，该方法执行几乎所有功能都要用到的标签对齐功能。 <code class="docutils literal notranslate"><span class="pre">reindex</span></code> 指的是沿着指定轴，让数据与给定的一组标签进行匹配。该功能完成以下几项操作：</p>
<ul class="simple">
<li><p>让现有数据匹配一组新标签，并重新排序；</p></li>
<li><p>在无数据但有标签的位置插入缺失值（<code class="docutils literal notranslate"><span class="pre">NA</span></code>）标记；</p></li>
<li><p>如果指定，则按逻辑<strong>填充</strong>无标签的数据，该操作多见于时间序列数据。</p></li>
</ul>
<p>示例如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">196</span><span class="p">]:</span> <span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">])</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">197</span><span class="p">]:</span> <span class="n">s</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">197</span><span class="p">]:</span> 
<span class="n">a</span>    <span class="mf">1.695148</span>
<span class="n">b</span>    <span class="mf">1.328614</span>
<span class="n">c</span>    <span class="mf">1.234686</span>
<span class="n">d</span>   <span class="o">-</span><span class="mf">0.385845</span>
<span class="n">e</span>   <span class="o">-</span><span class="mf">1.326508</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">198</span><span class="p">]:</span> <span class="n">s</span><span class="o">.</span><span class="n">reindex</span><span class="p">([</span><span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">198</span><span class="p">]:</span> 
<span class="n">e</span>   <span class="o">-</span><span class="mf">1.326508</span>
<span class="n">b</span>    <span class="mf">1.328614</span>
<span class="n">f</span>         <span class="n">NaN</span>
<span class="n">d</span>   <span class="o">-</span><span class="mf">0.385845</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</pre></div>
</div>
<p>本例中，原 Series 里没有标签 <code class="docutils literal notranslate"><span class="pre">f</span></code> ，因此，输出结果里 <code class="docutils literal notranslate"><span class="pre">f</span></code> 对应的值为 <code class="docutils literal notranslate"><span class="pre">NaN</span></code>。</p>
<p>DataFrame 支持同时 <code class="docutils literal notranslate"><span class="pre">reindex</span></code> 索引与列：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">199</span><span class="p">]:</span> <span class="n">df</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">199</span><span class="p">]:</span> 
        <span class="n">one</span>       <span class="n">two</span>     <span class="n">three</span>
<span class="n">a</span>  <span class="mf">1.394981</span>  <span class="mf">1.772517</span>       <span class="n">NaN</span>
<span class="n">b</span>  <span class="mf">0.343054</span>  <span class="mf">1.912123</span> <span class="o">-</span><span class="mf">0.050390</span>
<span class="n">c</span>  <span class="mf">0.695246</span>  <span class="mf">1.478369</span>  <span class="mf">1.227435</span>
<span class="n">d</span>       <span class="n">NaN</span>  <span class="mf">0.279344</span> <span class="o">-</span><span class="mf">0.613172</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">200</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;three&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;one&#39;</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">200</span><span class="p">]:</span> 
      <span class="n">three</span>       <span class="n">two</span>       <span class="n">one</span>
<span class="n">c</span>  <span class="mf">1.227435</span>  <span class="mf">1.478369</span>  <span class="mf">0.695246</span>
<span class="n">f</span>       <span class="n">NaN</span>       <span class="n">NaN</span>       <span class="n">NaN</span>
<span class="n">b</span> <span class="o">-</span><span class="mf">0.050390</span>  <span class="mf">1.912123</span>  <span class="mf">0.343054</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">reindex</span></code> 还支持 <code class="docutils literal notranslate"><span class="pre">axis</span></code> 关键字：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">201</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">reindex</span><span class="p">([</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">201</span><span class="p">]:</span> 
        <span class="n">one</span>       <span class="n">two</span>     <span class="n">three</span>
<span class="n">c</span>  <span class="mf">0.695246</span>  <span class="mf">1.478369</span>  <span class="mf">1.227435</span>
<span class="n">f</span>       <span class="n">NaN</span>       <span class="n">NaN</span>       <span class="n">NaN</span>
<span class="n">b</span>  <span class="mf">0.343054</span>  <span class="mf">1.912123</span> <span class="o">-</span><span class="mf">0.050390</span>
</pre></div>
</div>
<p>注意：不同对象可以<strong>共享</strong> <code class="docutils literal notranslate"><span class="pre">Index</span></code> 包含的轴标签。比如，有一个 Series，还有一个 DataFrame，可以执行下列操作：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">202</span><span class="p">]:</span> <span class="n">rs</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">203</span><span class="p">]:</span> <span class="n">rs</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">203</span><span class="p">]:</span> 
<span class="n">a</span>    <span class="mf">1.695148</span>
<span class="n">b</span>    <span class="mf">1.328614</span>
<span class="n">c</span>    <span class="mf">1.234686</span>
<span class="n">d</span>   <span class="o">-</span><span class="mf">0.385845</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">204</span><span class="p">]:</span> <span class="n">rs</span><span class="o">.</span><span class="n">index</span> <span class="ow">is</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">204</span><span class="p">]:</span> <span class="kc">True</span>
</pre></div>
</div>
<p>这里指的是，重置后，Series 的索引与 DataFrame 的索引是同一个 Python 对象。</p>
<p><em>0.21.0 版新增</em>。</p>
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.reindex.html#pandas.DataFrame.reindex"><code class="docutils literal notranslate"><span class="pre">DataFrame.reindex()</span></code></a> 还支持 “轴样式”调用习语，可以指定单个 <code class="docutils literal notranslate"><span class="pre">labels</span></code> 参数，并指定应用于哪个 <code class="docutils literal notranslate"><span class="pre">axis</span></code>。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">205</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">reindex</span><span class="p">([</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">205</span><span class="p">]:</span> 
        <span class="n">one</span>       <span class="n">two</span>     <span class="n">three</span>
<span class="n">c</span>  <span class="mf">0.695246</span>  <span class="mf">1.478369</span>  <span class="mf">1.227435</span>
<span class="n">f</span>       <span class="n">NaN</span>       <span class="n">NaN</span>       <span class="n">NaN</span>
<span class="n">b</span>  <span class="mf">0.343054</span>  <span class="mf">1.912123</span> <span class="o">-</span><span class="mf">0.050390</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">206</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">reindex</span><span class="p">([</span><span class="s1">&#39;three&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;one&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;columns&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">206</span><span class="p">]:</span> 
      <span class="n">three</span>       <span class="n">two</span>       <span class="n">one</span>
<span class="n">a</span>       <span class="n">NaN</span>  <span class="mf">1.772517</span>  <span class="mf">1.394981</span>
<span class="n">b</span> <span class="o">-</span><span class="mf">0.050390</span>  <span class="mf">1.912123</span>  <span class="mf">0.343054</span>
<span class="n">c</span>  <span class="mf">1.227435</span>  <span class="mf">1.478369</span>  <span class="mf">0.695246</span>
<span class="n">d</span> <span class="o">-</span><span class="mf">0.613172</span>  <span class="mf">0.279344</span>       <span class="n">NaN</span>
</pre></div>
</div>
<p>::: tip 注意</p>
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/advanced.html#advanced">多层索引与高级索引</a>介绍了怎样用更简洁的方式重置索引。</p>
<p>:::</p>
<p>::: tip 注意</p>
<p>编写注重性能的代码时，最好花些时间深入理解 <code class="docutils literal notranslate"><span class="pre">reindex</span></code>：<strong>预对齐数据后，操作会更快</strong>。两个未对齐的 DataFrame 相加，后台操作会执行 <code class="docutils literal notranslate"><span class="pre">reindex</span></code>。探索性分析时很难注意到这点有什么不同，这是因为 <code class="docutils literal notranslate"><span class="pre">reindex</span></code> 已经进行了高度优化，但需要注重 CPU 周期时，显式调用 <code class="docutils literal notranslate"><span class="pre">reindex</span></code> 还是有一些影响的。</p>
<p>:::</p>
<div class="section" id="id23">
<h3>重置索引，并与其它对象对齐<a class="headerlink" href="#id23" title="永久链接至标题">¶</a></h3>
<p>提取一个对象，并用另一个具有相同标签的对象 <code class="docutils literal notranslate"><span class="pre">reindex</span></code> 该对象的轴。这种操作的语法虽然简单，但未免有些啰嗦。这时，最好用 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.reindex_like.html#pandas.DataFrame.reindex_like"><code class="docutils literal notranslate"><span class="pre">reindex_like()</span></code></a> 方法，这是一种既有效，又简单的方式：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">207</span><span class="p">]:</span> <span class="n">df2</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">207</span><span class="p">]:</span> 
        <span class="n">one</span>       <span class="n">two</span>
<span class="n">a</span>  <span class="mf">1.394981</span>  <span class="mf">1.772517</span>
<span class="n">b</span>  <span class="mf">0.343054</span>  <span class="mf">1.912123</span>
<span class="n">c</span>  <span class="mf">0.695246</span>  <span class="mf">1.478369</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">208</span><span class="p">]:</span> <span class="n">df3</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">208</span><span class="p">]:</span> 
        <span class="n">one</span>       <span class="n">two</span>
<span class="n">a</span>  <span class="mf">0.583888</span>  <span class="mf">0.051514</span>
<span class="n">b</span> <span class="o">-</span><span class="mf">0.468040</span>  <span class="mf">0.191120</span>
<span class="n">c</span> <span class="o">-</span><span class="mf">0.115848</span> <span class="o">-</span><span class="mf">0.242634</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">209</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">reindex_like</span><span class="p">(</span><span class="n">df2</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">209</span><span class="p">]:</span> 
        <span class="n">one</span>       <span class="n">two</span>
<span class="n">a</span>  <span class="mf">1.394981</span>  <span class="mf">1.772517</span>
<span class="n">b</span>  <span class="mf">0.343054</span>  <span class="mf">1.912123</span>
<span class="n">c</span>  <span class="mf">0.695246</span>  <span class="mf">1.478369</span>
</pre></div>
</div>
</div>
<div class="section" id="align">
<h3>用 <code class="docutils literal notranslate"><span class="pre">align</span></code> 对齐多个对象<a class="headerlink" href="#align" title="永久链接至标题">¶</a></h3>
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.align.html#pandas.Series.align"><code class="docutils literal notranslate"><span class="pre">align()</span></code></a> 方法是对齐两个对象最快的方式，该方法支持 <code class="docutils literal notranslate"><span class="pre">join</span></code> 参数（请参阅 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/merging.html#merging">joining 与 merging</a>）：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">join='outer'</span></code>：使用两个对象索引的合集，默认值</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">join='left'</span></code>：使用左侧调用对象的索引</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">join='right'</span></code>：使用右侧传递对象的索引</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">join='inner'</span></code>：使用两个对象索引的交集</p></li>
</ul>
<p>该方法返回重置索引后的两个 Series 元组：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">210</span><span class="p">]:</span> <span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">])</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">211</span><span class="p">]:</span> <span class="n">s1</span> <span class="o">=</span> <span class="n">s</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">212</span><span class="p">]:</span> <span class="n">s2</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">213</span><span class="p">]:</span> <span class="n">s1</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="n">s2</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">213</span><span class="p">]:</span> 
<span class="p">(</span><span class="n">a</span>   <span class="o">-</span><span class="mf">0.186646</span>
 <span class="n">b</span>   <span class="o">-</span><span class="mf">1.692424</span>
 <span class="n">c</span>   <span class="o">-</span><span class="mf">0.303893</span>
 <span class="n">d</span>   <span class="o">-</span><span class="mf">1.425662</span>
 <span class="n">e</span>         <span class="n">NaN</span>
 <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span><span class="p">,</span> <span class="n">a</span>         <span class="n">NaN</span>
 <span class="n">b</span>   <span class="o">-</span><span class="mf">1.692424</span>
 <span class="n">c</span>   <span class="o">-</span><span class="mf">0.303893</span>
 <span class="n">d</span>   <span class="o">-</span><span class="mf">1.425662</span>
 <span class="n">e</span>    <span class="mf">1.114285</span>
 <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">214</span><span class="p">]:</span> <span class="n">s1</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="n">s2</span><span class="p">,</span> <span class="n">join</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">214</span><span class="p">]:</span> 
<span class="p">(</span><span class="n">b</span>   <span class="o">-</span><span class="mf">1.692424</span>
 <span class="n">c</span>   <span class="o">-</span><span class="mf">0.303893</span>
 <span class="n">d</span>   <span class="o">-</span><span class="mf">1.425662</span>
 <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span><span class="p">,</span> <span class="n">b</span>   <span class="o">-</span><span class="mf">1.692424</span>
 <span class="n">c</span>   <span class="o">-</span><span class="mf">0.303893</span>
 <span class="n">d</span>   <span class="o">-</span><span class="mf">1.425662</span>
 <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">215</span><span class="p">]:</span> <span class="n">s1</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="n">s2</span><span class="p">,</span> <span class="n">join</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">215</span><span class="p">]:</span> 
<span class="p">(</span><span class="n">a</span>   <span class="o">-</span><span class="mf">0.186646</span>
 <span class="n">b</span>   <span class="o">-</span><span class="mf">1.692424</span>
 <span class="n">c</span>   <span class="o">-</span><span class="mf">0.303893</span>
 <span class="n">d</span>   <span class="o">-</span><span class="mf">1.425662</span>
 <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span><span class="p">,</span> <span class="n">a</span>         <span class="n">NaN</span>
 <span class="n">b</span>   <span class="o">-</span><span class="mf">1.692424</span>
 <span class="n">c</span>   <span class="o">-</span><span class="mf">0.303893</span>
 <span class="n">d</span>   <span class="o">-</span><span class="mf">1.425662</span>
 <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span><span class="p">)</span>
</pre></div>
</div>
<p>默认条件下，  <code class="docutils literal notranslate"><span class="pre">join</span></code> 方法既应用于索引，也应用于列：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">216</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="n">df2</span><span class="p">,</span> <span class="n">join</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">216</span><span class="p">]:</span> 
<span class="p">(</span>        <span class="n">one</span>       <span class="n">two</span>
 <span class="n">a</span>  <span class="mf">1.394981</span>  <span class="mf">1.772517</span>
 <span class="n">b</span>  <span class="mf">0.343054</span>  <span class="mf">1.912123</span>
 <span class="n">c</span>  <span class="mf">0.695246</span>  <span class="mf">1.478369</span><span class="p">,</span>         <span class="n">one</span>       <span class="n">two</span>
 <span class="n">a</span>  <span class="mf">1.394981</span>  <span class="mf">1.772517</span>
 <span class="n">b</span>  <span class="mf">0.343054</span>  <span class="mf">1.912123</span>
 <span class="n">c</span>  <span class="mf">0.695246</span>  <span class="mf">1.478369</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">align</span></code> 方法还支持 <code class="docutils literal notranslate"><span class="pre">axis</span></code> 选项，用来指定要对齐的轴：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">217</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="n">df2</span><span class="p">,</span> <span class="n">join</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">217</span><span class="p">]:</span> 
<span class="p">(</span>        <span class="n">one</span>       <span class="n">two</span>     <span class="n">three</span>
 <span class="n">a</span>  <span class="mf">1.394981</span>  <span class="mf">1.772517</span>       <span class="n">NaN</span>
 <span class="n">b</span>  <span class="mf">0.343054</span>  <span class="mf">1.912123</span> <span class="o">-</span><span class="mf">0.050390</span>
 <span class="n">c</span>  <span class="mf">0.695246</span>  <span class="mf">1.478369</span>  <span class="mf">1.227435</span><span class="p">,</span>         <span class="n">one</span>       <span class="n">two</span>
 <span class="n">a</span>  <span class="mf">1.394981</span>  <span class="mf">1.772517</span>
 <span class="n">b</span>  <span class="mf">0.343054</span>  <span class="mf">1.912123</span>
 <span class="n">c</span>  <span class="mf">0.695246</span>  <span class="mf">1.478369</span><span class="p">)</span>
</pre></div>
</div>
<p>如果把 Series 传递给 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.align.html#pandas.DataFrame.align"><code class="docutils literal notranslate"><span class="pre">DataFrame.align()</span></code></a>，可以用 <code class="docutils literal notranslate"><span class="pre">axis</span></code> 参数选择是在 DataFrame 的索引，还是列上对齐两个对象：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">218</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="n">df2</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">218</span><span class="p">]:</span> 
<span class="p">(</span>        <span class="n">one</span>     <span class="n">three</span>       <span class="n">two</span>
 <span class="n">a</span>  <span class="mf">1.394981</span>       <span class="n">NaN</span>  <span class="mf">1.772517</span>
 <span class="n">b</span>  <span class="mf">0.343054</span> <span class="o">-</span><span class="mf">0.050390</span>  <span class="mf">1.912123</span>
 <span class="n">c</span>  <span class="mf">0.695246</span>  <span class="mf">1.227435</span>  <span class="mf">1.478369</span>
 <span class="n">d</span>       <span class="n">NaN</span> <span class="o">-</span><span class="mf">0.613172</span>  <span class="mf">0.279344</span><span class="p">,</span> <span class="n">one</span>      <span class="mf">1.394981</span>
 <span class="n">three</span>         <span class="n">NaN</span>
 <span class="n">two</span>      <span class="mf">1.772517</span>
 <span class="n">Name</span><span class="p">:</span> <span class="n">a</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span><span class="p">)</span>
</pre></div>
</div>
<table border="1" class="docutils">
<thead>
<tr>
<th align="left">方法</th>
<th align="left">动作</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">pad / ffill</td>
<td align="left">先前填充</td>
</tr>
<tr>
<td align="left">bfill / backfill</td>
<td align="left">向后填充</td>
</tr>
<tr>
<td align="left">nearest</td>
<td align="left">从最近的索引值填充</td>
</tr>
</tbody>
</table><p>下面用一个简单的 Series 展示 <code class="docutils literal notranslate"><span class="pre">fill</span></code> 方法：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">219</span><span class="p">]:</span> <span class="n">rng</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;1/3/2000&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">220</span><span class="p">]:</span> <span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">rng</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">221</span><span class="p">]:</span> <span class="n">ts2</span> <span class="o">=</span> <span class="n">ts</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">]]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">222</span><span class="p">]:</span> <span class="n">ts</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">222</span><span class="p">]:</span> 
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span>    <span class="mf">0.183051</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">04</span>    <span class="mf">0.400528</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">05</span>   <span class="o">-</span><span class="mf">0.015083</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">06</span>    <span class="mf">2.395489</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">07</span>    <span class="mf">1.414806</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span>    <span class="mf">0.118428</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">09</span>    <span class="mf">0.733639</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>   <span class="o">-</span><span class="mf">0.936077</span>
<span class="n">Freq</span><span class="p">:</span> <span class="n">D</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">223</span><span class="p">]:</span> <span class="n">ts2</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">223</span><span class="p">]:</span> 
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span>    <span class="mf">0.183051</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">06</span>    <span class="mf">2.395489</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">09</span>    <span class="mf">0.733639</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">224</span><span class="p">]:</span> <span class="n">ts2</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">224</span><span class="p">]:</span> 
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span>    <span class="mf">0.183051</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">04</span>         <span class="n">NaN</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">05</span>         <span class="n">NaN</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">06</span>    <span class="mf">2.395489</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">07</span>         <span class="n">NaN</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span>         <span class="n">NaN</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">09</span>    <span class="mf">0.733639</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>         <span class="n">NaN</span>
<span class="n">Freq</span><span class="p">:</span> <span class="n">D</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">225</span><span class="p">]:</span> <span class="n">ts2</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;ffill&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">225</span><span class="p">]:</span> 
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span>    <span class="mf">0.183051</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">04</span>    <span class="mf">0.183051</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">05</span>    <span class="mf">0.183051</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">06</span>    <span class="mf">2.395489</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">07</span>    <span class="mf">2.395489</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span>    <span class="mf">2.395489</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">09</span>    <span class="mf">0.733639</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>    <span class="mf">0.733639</span>
<span class="n">Freq</span><span class="p">:</span> <span class="n">D</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">226</span><span class="p">]:</span> <span class="n">ts2</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;bfill&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">226</span><span class="p">]:</span> 
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span>    <span class="mf">0.183051</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">04</span>    <span class="mf">2.395489</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">05</span>    <span class="mf">2.395489</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">06</span>    <span class="mf">2.395489</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">07</span>    <span class="mf">0.733639</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span>    <span class="mf">0.733639</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">09</span>    <span class="mf">0.733639</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>         <span class="n">NaN</span>
<span class="n">Freq</span><span class="p">:</span> <span class="n">D</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">227</span><span class="p">]:</span> <span class="n">ts2</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">227</span><span class="p">]:</span> 
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span>    <span class="mf">0.183051</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">04</span>    <span class="mf">0.183051</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">05</span>    <span class="mf">2.395489</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">06</span>    <span class="mf">2.395489</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">07</span>    <span class="mf">2.395489</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span>    <span class="mf">0.733639</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">09</span>    <span class="mf">0.733639</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>    <span class="mf">0.733639</span>
<span class="n">Freq</span><span class="p">:</span> <span class="n">D</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</pre></div>
</div>
<p>上述操作要求索引按递增或递减<strong>排序</strong>。</p>
<p>注意：除了 <code class="docutils literal notranslate"><span class="pre">method='nearest'</span></code>，用 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/missing_data.html#missing-data-fillna"><code class="docutils literal notranslate"><span class="pre">fillna</span></code></a> 或 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/missing_data.html#missing-data-interpolate"><code class="docutils literal notranslate"><span class="pre">interpolate</span></code></a> 也能实现同样的效果：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">228</span><span class="p">]:</span> <span class="n">ts2</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;ffill&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">228</span><span class="p">]:</span> 
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span>    <span class="mf">0.183051</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">04</span>    <span class="mf">0.183051</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">05</span>    <span class="mf">0.183051</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">06</span>    <span class="mf">2.395489</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">07</span>    <span class="mf">2.395489</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span>    <span class="mf">2.395489</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">09</span>    <span class="mf">0.733639</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>    <span class="mf">0.733639</span>
<span class="n">Freq</span><span class="p">:</span> <span class="n">D</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</pre></div>
</div>
<p>如果索引不是按递增或递减排序，<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.reindex.html#pandas.Series.reindex"><code class="docutils literal notranslate"><span class="pre">reindex()</span></code></a> 会触发 ValueError 错误。<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.fillna.html#pandas.Series.fillna"><code class="docutils literal notranslate"><span class="pre">fillna()</span></code></a> 与 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.interpolate.html#pandas.Series.interpolate"><code class="docutils literal notranslate"><span class="pre">interpolate()</span></code></a> 则不检查索引的排序。</p>
</div>
<div class="section" id="id24">
<h3>重置索引填充的限制<a class="headerlink" href="#id24" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">limit</span></code> 与 <code class="docutils literal notranslate"><span class="pre">tolerance</span></code> 参数可以控制 <code class="docutils literal notranslate"><span class="pre">reindex</span></code> 的填充操作。<code class="docutils literal notranslate"><span class="pre">limit</span></code> 限定了连续匹配的最大数量：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">229</span><span class="p">]:</span> <span class="n">ts2</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;ffill&#39;</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">229</span><span class="p">]:</span> 
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span>    <span class="mf">0.183051</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">04</span>    <span class="mf">0.183051</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">05</span>         <span class="n">NaN</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">06</span>    <span class="mf">2.395489</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">07</span>    <span class="mf">2.395489</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span>         <span class="n">NaN</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">09</span>    <span class="mf">0.733639</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>    <span class="mf">0.733639</span>
<span class="n">Freq</span><span class="p">:</span> <span class="n">D</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</pre></div>
</div>
<p>反之，<code class="docutils literal notranslate"><span class="pre">tolerance</span></code> 限定了索引与索引器值之间的最大距离：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">230</span><span class="p">]:</span> <span class="n">ts2</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;ffill&#39;</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="s1">&#39;1 day&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">230</span><span class="p">]:</span> 
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span>    <span class="mf">0.183051</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">04</span>    <span class="mf">0.183051</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">05</span>         <span class="n">NaN</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">06</span>    <span class="mf">2.395489</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">07</span>    <span class="mf">2.395489</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">08</span>         <span class="n">NaN</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">09</span>    <span class="mf">0.733639</span>
<span class="mi">2000</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span>    <span class="mf">0.733639</span>
<span class="n">Freq</span><span class="p">:</span> <span class="n">D</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</pre></div>
</div>
<p>注意：索引为 <code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code>、<code class="docutils literal notranslate"><span class="pre">TimedeltaIndex</span></code> 或 <code class="docutils literal notranslate"><span class="pre">PeriodIndex</span></code> 时，<code class="docutils literal notranslate"><span class="pre">tolerance</span></code> 会尽可能将这些索引强制转换为 <code class="docutils literal notranslate"><span class="pre">Timedelta</span></code>，这里要求用户用恰当的字符串设定 <code class="docutils literal notranslate"><span class="pre">tolerance</span></code> 参数。</p>
</div>
<div class="section" id="id25">
<h3>去掉轴上的标签<a class="headerlink" href="#id25" title="永久链接至标题">¶</a></h3>
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.drop.html#pandas.DataFrame.drop"><code class="docutils literal notranslate"><span class="pre">drop()</span></code></a> 函数与 <code class="docutils literal notranslate"><span class="pre">reindex</span></code> 经常配合使用，该函数用于删除轴上的一组标签：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">231</span><span class="p">]:</span> <span class="n">df</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">231</span><span class="p">]:</span> 
        <span class="n">one</span>       <span class="n">two</span>     <span class="n">three</span>
<span class="n">a</span>  <span class="mf">1.394981</span>  <span class="mf">1.772517</span>       <span class="n">NaN</span>
<span class="n">b</span>  <span class="mf">0.343054</span>  <span class="mf">1.912123</span> <span class="o">-</span><span class="mf">0.050390</span>
<span class="n">c</span>  <span class="mf">0.695246</span>  <span class="mf">1.478369</span>  <span class="mf">1.227435</span>
<span class="n">d</span>       <span class="n">NaN</span>  <span class="mf">0.279344</span> <span class="o">-</span><span class="mf">0.613172</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">232</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">232</span><span class="p">]:</span> 
        <span class="n">one</span>       <span class="n">two</span>     <span class="n">three</span>
<span class="n">b</span>  <span class="mf">0.343054</span>  <span class="mf">1.912123</span> <span class="o">-</span><span class="mf">0.050390</span>
<span class="n">c</span>  <span class="mf">0.695246</span>  <span class="mf">1.478369</span>  <span class="mf">1.227435</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">233</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;one&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">233</span><span class="p">]:</span> 
        <span class="n">two</span>     <span class="n">three</span>
<span class="n">a</span>  <span class="mf">1.772517</span>       <span class="n">NaN</span>
<span class="n">b</span>  <span class="mf">1.912123</span> <span class="o">-</span><span class="mf">0.050390</span>
<span class="n">c</span>  <span class="mf">1.478369</span>  <span class="mf">1.227435</span>
<span class="n">d</span>  <span class="mf">0.279344</span> <span class="o">-</span><span class="mf">0.613172</span>
</pre></div>
</div>
<p>注意：下面的代码可以运行，但不够清晰：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">234</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">difference</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">]))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">234</span><span class="p">]:</span> 
        <span class="n">one</span>       <span class="n">two</span>     <span class="n">three</span>
<span class="n">b</span>  <span class="mf">0.343054</span>  <span class="mf">1.912123</span> <span class="o">-</span><span class="mf">0.050390</span>
<span class="n">c</span>  <span class="mf">0.695246</span>  <span class="mf">1.478369</span>  <span class="mf">1.227435</span>
</pre></div>
</div>
</div>
<div class="section" id="id26">
<h3>重命名或映射标签<a class="headerlink" href="#id26" title="永久链接至标题">¶</a></h3>
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.rename.html#pandas.DataFrame.rename"><code class="docutils literal notranslate"><span class="pre">rename()</span></code></a> 方法支持按不同的轴基于映射（字典或 Series）调整标签。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">235</span><span class="p">]:</span> <span class="n">s</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">235</span><span class="p">]:</span> 
<span class="n">a</span>   <span class="o">-</span><span class="mf">0.186646</span>
<span class="n">b</span>   <span class="o">-</span><span class="mf">1.692424</span>
<span class="n">c</span>   <span class="o">-</span><span class="mf">0.303893</span>
<span class="n">d</span>   <span class="o">-</span><span class="mf">1.425662</span>
<span class="n">e</span>    <span class="mf">1.114285</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">236</span><span class="p">]:</span> <span class="n">s</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">upper</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">236</span><span class="p">]:</span> 
<span class="n">A</span>   <span class="o">-</span><span class="mf">0.186646</span>
<span class="n">B</span>   <span class="o">-</span><span class="mf">1.692424</span>
<span class="n">C</span>   <span class="o">-</span><span class="mf">0.303893</span>
<span class="n">D</span>   <span class="o">-</span><span class="mf">1.425662</span>
<span class="n">E</span>    <span class="mf">1.114285</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</pre></div>
</div>
<p>如果调用的是函数，该函数在处理标签时，必须返回一个值，而且生成的必须是一组唯一值。此外，<code class="docutils literal notranslate"><span class="pre">rename()</span></code> 还可以调用字典或 Series。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">237</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;one&#39;</span><span class="p">:</span> <span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">:</span> <span class="s1">&#39;bar&#39;</span><span class="p">},</span>
   <span class="o">.....</span><span class="p">:</span>           <span class="n">index</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="s1">&#39;apple&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="s1">&#39;banana&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">:</span> <span class="s1">&#39;durian&#39;</span><span class="p">})</span>
   <span class="o">.....</span><span class="p">:</span> 
<span class="n">Out</span><span class="p">[</span><span class="mi">237</span><span class="p">]:</span> 
             <span class="n">foo</span>       <span class="n">bar</span>     <span class="n">three</span>
<span class="n">apple</span>   <span class="mf">1.394981</span>  <span class="mf">1.772517</span>       <span class="n">NaN</span>
<span class="n">banana</span>  <span class="mf">0.343054</span>  <span class="mf">1.912123</span> <span class="o">-</span><span class="mf">0.050390</span>
<span class="n">c</span>       <span class="mf">0.695246</span>  <span class="mf">1.478369</span>  <span class="mf">1.227435</span>
<span class="n">durian</span>       <span class="n">NaN</span>  <span class="mf">0.279344</span> <span class="o">-</span><span class="mf">0.613172</span>
</pre></div>
</div>
<p>Pandas 不会重命名标签未包含在映射里的列或索引。注意，映射里多出的标签不会触发错误。</p>
<p><em>0.21.0 版新增</em>。</p>
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.rename.html#pandas.DataFrame.rename"><code class="docutils literal notranslate"><span class="pre">DataFrame.rename()</span></code></a> 还支持“轴式”习语，用这种方式可以指定单个 <code class="docutils literal notranslate"><span class="pre">mapper</span></code>，及执行映射的 <code class="docutils literal notranslate"><span class="pre">axis</span></code>。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">238</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;one&#39;</span><span class="p">:</span> <span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">:</span> <span class="s1">&#39;bar&#39;</span><span class="p">},</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;columns&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">238</span><span class="p">]:</span> 
        <span class="n">foo</span>       <span class="n">bar</span>     <span class="n">three</span>
<span class="n">a</span>  <span class="mf">1.394981</span>  <span class="mf">1.772517</span>       <span class="n">NaN</span>
<span class="n">b</span>  <span class="mf">0.343054</span>  <span class="mf">1.912123</span> <span class="o">-</span><span class="mf">0.050390</span>
<span class="n">c</span>  <span class="mf">0.695246</span>  <span class="mf">1.478369</span>  <span class="mf">1.227435</span>
<span class="n">d</span>       <span class="n">NaN</span>  <span class="mf">0.279344</span> <span class="o">-</span><span class="mf">0.613172</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">239</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="s1">&#39;apple&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="s1">&#39;banana&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">:</span> <span class="s1">&#39;durian&#39;</span><span class="p">},</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">239</span><span class="p">]:</span> 
             <span class="n">one</span>       <span class="n">two</span>     <span class="n">three</span>
<span class="n">apple</span>   <span class="mf">1.394981</span>  <span class="mf">1.772517</span>       <span class="n">NaN</span>
<span class="n">banana</span>  <span class="mf">0.343054</span>  <span class="mf">1.912123</span> <span class="o">-</span><span class="mf">0.050390</span>
<span class="n">c</span>       <span class="mf">0.695246</span>  <span class="mf">1.478369</span>  <span class="mf">1.227435</span>
<span class="n">durian</span>       <span class="n">NaN</span>  <span class="mf">0.279344</span> <span class="o">-</span><span class="mf">0.613172</span>
</pre></div>
</div>
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.rename.html#pandas.Series.rename"><code class="docutils literal notranslate"><span class="pre">rename()</span></code></a> 方法还提供了 <code class="docutils literal notranslate"><span class="pre">inplace</span></code> 命名参数，默认为 <code class="docutils literal notranslate"><span class="pre">False</span></code>，并会复制底层数据。<code class="docutils literal notranslate"><span class="pre">inplace=True</span></code> 时，会直接在原数据上重命名。</p>
<p><em>0.18.0 版新增</em>。</p>
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.rename.html#pandas.Series.rename"><code class="docutils literal notranslate"><span class="pre">rename()</span></code></a> 还支持用标量或列表更改 <code class="docutils literal notranslate"><span class="pre">Series.name</span></code> 属性。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">240</span><span class="p">]:</span> <span class="n">s</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">&quot;scalar-name&quot;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">240</span><span class="p">]:</span> 
<span class="n">a</span>   <span class="o">-</span><span class="mf">0.186646</span>
<span class="n">b</span>   <span class="o">-</span><span class="mf">1.692424</span>
<span class="n">c</span>   <span class="o">-</span><span class="mf">0.303893</span>
<span class="n">d</span>   <span class="o">-</span><span class="mf">1.425662</span>
<span class="n">e</span>    <span class="mf">1.114285</span>
<span class="n">Name</span><span class="p">:</span> <span class="n">scalar</span><span class="o">-</span><span class="n">name</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</pre></div>
</div>
<p><em>0.24.0 版新增</em>。</p>
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.rename_axis.html#pandas.Series.rename_axis"><code class="docutils literal notranslate"><span class="pre">rename_axis()</span></code></a> 方法支持指定 <code class="docutils literal notranslate"><span class="pre">多层索引</span></code> 名称，与标签相对应。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">241</span><span class="p">]:</span> <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
   <span class="o">.....</span><span class="p">:</span>                    <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">60</span><span class="p">]},</span>
   <span class="o">.....</span><span class="p">:</span>                   <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_product</span><span class="p">([[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]],</span>
   <span class="o">.....</span><span class="p">:</span>                   <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;let&#39;</span><span class="p">,</span> <span class="s1">&#39;num&#39;</span><span class="p">]))</span>
   <span class="o">.....</span><span class="p">:</span> 

<span class="n">In</span> <span class="p">[</span><span class="mi">242</span><span class="p">]:</span> <span class="n">df</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">242</span><span class="p">]:</span> 
         <span class="n">x</span>   <span class="n">y</span>
<span class="n">let</span> <span class="n">num</span>       
<span class="n">a</span>   <span class="mi">1</span>    <span class="mi">1</span>  <span class="mi">10</span>
    <span class="mi">2</span>    <span class="mi">2</span>  <span class="mi">20</span>
<span class="n">b</span>   <span class="mi">1</span>    <span class="mi">3</span>  <span class="mi">30</span>
    <span class="mi">2</span>    <span class="mi">4</span>  <span class="mi">40</span>
<span class="n">c</span>   <span class="mi">1</span>    <span class="mi">5</span>  <span class="mi">50</span>
    <span class="mi">2</span>    <span class="mi">6</span>  <span class="mi">60</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">243</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;let&#39;</span><span class="p">:</span> <span class="s1">&#39;abc&#39;</span><span class="p">})</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">243</span><span class="p">]:</span> 
         <span class="n">x</span>   <span class="n">y</span>
<span class="n">abc</span> <span class="n">num</span>       
<span class="n">a</span>   <span class="mi">1</span>    <span class="mi">1</span>  <span class="mi">10</span>
    <span class="mi">2</span>    <span class="mi">2</span>  <span class="mi">20</span>
<span class="n">b</span>   <span class="mi">1</span>    <span class="mi">3</span>  <span class="mi">30</span>
    <span class="mi">2</span>    <span class="mi">4</span>  <span class="mi">40</span>
<span class="n">c</span>   <span class="mi">1</span>    <span class="mi">5</span>  <span class="mi">50</span>
    <span class="mi">2</span>    <span class="mi">6</span>  <span class="mi">60</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">244</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="nb">str</span><span class="o">.</span><span class="n">upper</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">244</span><span class="p">]:</span> 
         <span class="n">x</span>   <span class="n">y</span>
<span class="n">LET</span> <span class="n">NUM</span>       
<span class="n">a</span>   <span class="mi">1</span>    <span class="mi">1</span>  <span class="mi">10</span>
    <span class="mi">2</span>    <span class="mi">2</span>  <span class="mi">20</span>
<span class="n">b</span>   <span class="mi">1</span>    <span class="mi">3</span>  <span class="mi">30</span>
    <span class="mi">2</span>    <span class="mi">4</span>  <span class="mi">40</span>
<span class="n">c</span>   <span class="mi">1</span>    <span class="mi">5</span>  <span class="mi">50</span>
    <span class="mi">2</span>    <span class="mi">6</span>  <span class="mi">60</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id27">
<h2><span class="section-number">2.8. </span>迭代<a class="headerlink" href="#id27" title="永久链接至标题">¶</a></h2>
<p>Pandas 对象基于类型进行迭代操作。Series 迭代时被视为数组，基础迭代生成值。DataFrame 则遵循字典式习语，用对象的 <code class="docutils literal notranslate"><span class="pre">key</span></code> 实现迭代操作。</p>
<p>简言之，基础迭代（<code class="docutils literal notranslate"><span class="pre">for</span> <span class="pre">i</span> <span class="pre">in</span> <span class="pre">object</span></code>）生成：</p>
<ul class="simple">
<li><p><strong>Series</strong> ：值</p></li>
<li><p><strong>DataFrame</strong>：列标签</p></li>
</ul>
<p>例如，DataFrame 迭代时输出列名：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">245</span><span class="p">]:</span> <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;col1&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
   <span class="o">.....</span><span class="p">:</span>                    <span class="s1">&#39;col2&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">3</span><span class="p">)},</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">])</span>
   <span class="o">.....</span><span class="p">:</span> 

<span class="n">In</span> <span class="p">[</span><span class="mi">246</span><span class="p">]:</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="p">:</span>
   <span class="o">.....</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
   <span class="o">.....</span><span class="p">:</span> 
<span class="n">col1</span>
<span class="n">col2</span>
</pre></div>
</div>
<p>Pandas 对象还支持字典式的 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.items.html#pandas.DataFrame.items"><code class="docutils literal notranslate"><span class="pre">items()</span></code></a> 方法，通过键值对迭代。</p>
<p>用下列方法可以迭代 DataFrame 里的行：</p>
<ul class="simple">
<li><p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.iterrows.html#pandas.DataFrame.iterrows"><code class="docutils literal notranslate"><span class="pre">iterrows()</span></code></a>：把 DataFrame 里的行当作 （index， Series）对进行迭代。该操作把行转为 Series，同时改变数据类型，并对性能有影响。</p></li>
<li><p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.itertuples.html#pandas.DataFrame.itertuples"><code class="docutils literal notranslate"><span class="pre">itertuples()</span></code></a> 把 DataFrame 的行当作值的命名元组进行迭代。该操作比  <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.iterrows.html#pandas.DataFrame.iterrows"><code class="docutils literal notranslate"><span class="pre">iterrows()</span></code></a> 快的多，建议尽量用这种方法迭代 DataFrame 的值。</p></li>
</ul>
<p>::: danger 警告</p>
<p>Pandas 对象迭代的速度较慢。大部分情况下，没必要对行执行迭代操作，建议用以下几种替代方式：</p>
<ul class="simple">
<li><p>矢量化：很多操作可以用内置方法或 NumPy 函数，布尔索引……</p></li>
<li><p>调用的函数不能在完整的 DataFrame / Series 上运行时，最好用 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.apply.html#pandas.DataFrame.apply"><code class="docutils literal notranslate"><span class="pre">apply()</span></code></a>，不要对值进行迭代操作。请参阅<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/getting_started/basics.html#basics-apply">函数应用</a>文档。</p></li>
<li><p>如果必须对值进行迭代，请务必注意代码的性能，建议在 cython 或 numba 环境下实现内循环。参阅<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/enhancingperf.html#enhancingperf">性能优化</a>一节，查看这种操作方法的示例。</p></li>
</ul>
<p>:::</p>
<p>::: danger 警告</p>
<p><strong>永远不要修改</strong>迭代的内容，这种方式不能确保所有操作都能正常运作。基于数据类型，迭代器返回的是复制（copy）的结果，不是视图（view），这种写入可能不会生效！</p>
<p>下例中的赋值就不会生效：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">247</span><span class="p">]:</span> <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">]})</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">248</span><span class="p">]:</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
<span class="o">.....</span><span class="p">:</span>     <span class="n">row</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
<span class="o">.....</span><span class="p">:</span> 

<span class="n">In</span> <span class="p">[</span><span class="mi">249</span><span class="p">]:</span> <span class="n">df</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">249</span><span class="p">]:</span> 
<span class="n">a</span>  <span class="n">b</span>
<span class="mi">0</span>  <span class="mi">1</span>  <span class="n">a</span>
<span class="mi">1</span>  <span class="mi">2</span>  <span class="n">b</span>
<span class="mi">2</span>  <span class="mi">3</span>  <span class="n">c</span>
</pre></div>
</div>
<p>:::</p>
<div class="section" id="items">
<h3>项目（items）<a class="headerlink" href="#items" title="永久链接至标题">¶</a></h3>
<p>与字典型接口类似，<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.items.html#pandas.DataFrame.items"><code class="docutils literal notranslate"><span class="pre">items()</span></code></a> 通过键值对进行迭代：</p>
<ul class="simple">
<li><p><strong>Series</strong>：（Index，标量值）对</p></li>
<li><p><strong>DataFrame</strong>：（列，Series）对</p></li>
</ul>
<p>示例如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">250</span><span class="p">]:</span> <span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">ser</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
   <span class="o">.....</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
   <span class="o">.....</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="n">ser</span><span class="p">)</span>
   <span class="o">.....</span><span class="p">:</span> 
<span class="n">a</span>
<span class="mi">0</span>    <span class="mi">1</span>
<span class="mi">1</span>    <span class="mi">2</span>
<span class="mi">2</span>    <span class="mi">3</span>
<span class="n">Name</span><span class="p">:</span> <span class="n">a</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>
<span class="n">b</span>
<span class="mi">0</span>    <span class="n">a</span>
<span class="mi">1</span>    <span class="n">b</span>
<span class="mi">2</span>    <span class="n">c</span>
<span class="n">Name</span><span class="p">:</span> <span class="n">b</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>
</pre></div>
</div>
</div>
<div class="section" id="iterrows">
<h3>iterrows<a class="headerlink" href="#iterrows" title="永久链接至标题">¶</a></h3>
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.iterrows.html#pandas.DataFrame.iterrows"><code class="docutils literal notranslate"><span class="pre">iterrows()</span></code></a> 迭代 DataFrame 或 Series 里的每一行数据。这个操作返回一个迭代器，生成索引值及包含每行数据的 Series：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">251</span><span class="p">]:</span> <span class="k">for</span> <span class="n">row_index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
   <span class="o">.....</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="n">row_index</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
   <span class="o">.....</span><span class="p">:</span> 
<span class="mi">0</span>
<span class="n">a</span>    <span class="mi">1</span>
<span class="n">b</span>    <span class="n">a</span>
<span class="n">Name</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>
<span class="mi">1</span>
<span class="n">a</span>    <span class="mi">2</span>
<span class="n">b</span>    <span class="n">b</span>
<span class="n">Name</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>
<span class="mi">2</span>
<span class="n">a</span>    <span class="mi">3</span>
<span class="n">b</span>    <span class="n">c</span>
<span class="n">Name</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>
</pre></div>
</div>
<p>::: tip 注意</p>
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.iterrows.html#pandas.DataFrame.iterrows"><code class="docutils literal notranslate"><span class="pre">iterrows()</span></code></a> 返回的是 Series 里的每一行数据，该操作<strong>不</strong>保留每行数据的数据类型，因为数据类型是通过 DataFrame 的列界定的。</p>
<p>示例如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">252</span><span class="p">]:</span> <span class="n">df_orig</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">]],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;int&#39;</span><span class="p">,</span> <span class="s1">&#39;float&#39;</span><span class="p">])</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">253</span><span class="p">]:</span> <span class="n">df_orig</span><span class="o">.</span><span class="n">dtypes</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">253</span><span class="p">]:</span> 
<span class="nb">int</span>        <span class="n">int64</span>
<span class="nb">float</span>    <span class="n">float64</span>
<span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">254</span><span class="p">]:</span> <span class="n">row</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">df_orig</span><span class="o">.</span><span class="n">iterrows</span><span class="p">())[</span><span class="mi">1</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">255</span><span class="p">]:</span> <span class="n">row</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">255</span><span class="p">]:</span> 
<span class="nb">int</span>      <span class="mf">1.0</span>
<span class="nb">float</span>    <span class="mf">1.5</span>
<span class="n">Name</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">row</span></code> 里的值以 Series 形式返回，并被转换为浮点数，原始的整数值则在列 X：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">256</span><span class="p">]:</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;int&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">256</span><span class="p">]:</span> <span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">257</span><span class="p">]:</span> <span class="n">df_orig</span><span class="p">[</span><span class="s1">&#39;int&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">257</span><span class="p">]:</span> <span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;int64&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>要想在行迭代时保存数据类型，最好用 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.itertuples.html#pandas.DataFrame.itertuples"><code class="docutils literal notranslate"><span class="pre">itertuples()</span></code></a>，这个函数返回值的命名元组，总的来说，该操作比 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.iterrows.html#pandas.DataFrame.iterrows"><code class="docutils literal notranslate"><span class="pre">iterrows()</span></code></a> 速度更快。</p>
<p>:::</p>
<p>下例展示了怎样转置 DataFrame：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">258</span><span class="p">]:</span> <span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]})</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">259</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">df2</span><span class="p">)</span>
   <span class="n">x</span>  <span class="n">y</span>
<span class="mi">0</span>  <span class="mi">1</span>  <span class="mi">4</span>
<span class="mi">1</span>  <span class="mi">2</span>  <span class="mi">5</span>
<span class="mi">2</span>  <span class="mi">3</span>  <span class="mi">6</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">260</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">df2</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
   <span class="mi">0</span>  <span class="mi">1</span>  <span class="mi">2</span>
<span class="n">x</span>  <span class="mi">1</span>  <span class="mi">2</span>  <span class="mi">3</span>
<span class="n">y</span>  <span class="mi">4</span>  <span class="mi">5</span>  <span class="mi">6</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">261</span><span class="p">]:</span> <span class="n">df2_t</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="n">idx</span><span class="p">:</span> <span class="n">values</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">df2</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()})</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">262</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">df2_t</span><span class="p">)</span>
   <span class="mi">0</span>  <span class="mi">1</span>  <span class="mi">2</span>
<span class="n">x</span>  <span class="mi">1</span>  <span class="mi">2</span>  <span class="mi">3</span>
<span class="n">y</span>  <span class="mi">4</span>  <span class="mi">5</span>  <span class="mi">6</span>
</pre></div>
</div>
</div>
<div class="section" id="itertuples">
<h3>itertuples<a class="headerlink" href="#itertuples" title="永久链接至标题">¶</a></h3>
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.itertuples.html#pandas.DataFrame.itertuples"><code class="docutils literal notranslate"><span class="pre">itertuples()</span></code></a> 方法返回为 DataFrame 里每行数据生成命名元组的迭代器。该元组的第一个元素是行的索引值，其余的值则是行的值。</p>
<p>示例如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">263</span><span class="p">]:</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">itertuples</span><span class="p">():</span>
   <span class="o">.....</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
   <span class="o">.....</span><span class="p">:</span> 
<span class="n">Pandas</span><span class="p">(</span><span class="n">Index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
<span class="n">Pandas</span><span class="p">(</span><span class="n">Index</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="n">Pandas</span><span class="p">(</span><span class="n">Index</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>该方法不会把行转换为 Series，只是返回命名元组里的值。<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.itertuples.html#pandas.DataFrame.itertuples"><code class="docutils literal notranslate"><span class="pre">itertuples()</span></code></a> 保存值的数据类型，而且比 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.iterrows.html#pandas.DataFrame.iterrows"><code class="docutils literal notranslate"><span class="pre">iterrows()</span></code></a> 快。</p>
<p>::: tip 注意</p>
<p>包含无效 Python 识别符的列名、重复的列名及以下划线开头的列名，会被重命名为位置名称。如果列数较大，比如大于 255 列，则返回正则元组。</p>
<p>:::</p>
</div>
</div>
<div class="section" id="dt">
<h2><span class="section-number">2.9. </span>.dt 访问器<a class="headerlink" href="#dt" title="永久链接至标题">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">Series</span></code> 提供一个可以简单、快捷地返回 <code class="docutils literal notranslate"><span class="pre">datetime</span></code> 属性值的访问器。这个访问器返回的也是 Series，索引与现有的 Series 一样。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># datetime</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">264</span><span class="p">]:</span> <span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;20130101 09:10:12&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">265</span><span class="p">]:</span> <span class="n">s</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">265</span><span class="p">]:</span> 
<span class="mi">0</span>   <span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">09</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mi">12</span>
<span class="mi">1</span>   <span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span> <span class="mi">09</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mi">12</span>
<span class="mi">2</span>   <span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span> <span class="mi">09</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mi">12</span>
<span class="mi">3</span>   <span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">04</span> <span class="mi">09</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mi">12</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">datetime64</span><span class="p">[</span><span class="n">ns</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">266</span><span class="p">]:</span> <span class="n">s</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">266</span><span class="p">]:</span> 
<span class="mi">0</span>    <span class="mi">9</span>
<span class="mi">1</span>    <span class="mi">9</span>
<span class="mi">2</span>    <span class="mi">9</span>
<span class="mi">3</span>    <span class="mi">9</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">267</span><span class="p">]:</span> <span class="n">s</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">second</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">267</span><span class="p">]:</span> 
<span class="mi">0</span>    <span class="mi">12</span>
<span class="mi">1</span>    <span class="mi">12</span>
<span class="mi">2</span>    <span class="mi">12</span>
<span class="mi">3</span>    <span class="mi">12</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">268</span><span class="p">]:</span> <span class="n">s</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">day</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">268</span><span class="p">]:</span> 
<span class="mi">0</span>    <span class="mi">1</span>
<span class="mi">1</span>    <span class="mi">2</span>
<span class="mi">2</span>    <span class="mi">3</span>
<span class="mi">3</span>    <span class="mi">4</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>
</pre></div>
</div>
<p>用下列表达式进行筛选非常方便：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">269</span><span class="p">]:</span> <span class="n">s</span><span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">day</span> <span class="o">==</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">269</span><span class="p">]:</span> 
<span class="mi">1</span>   <span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span> <span class="mi">09</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mi">12</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">datetime64</span><span class="p">[</span><span class="n">ns</span><span class="p">]</span>
</pre></div>
</div>
<p>时区转换也很轻松：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">270</span><span class="p">]:</span> <span class="n">stz</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="s1">&#39;US/Eastern&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">271</span><span class="p">]:</span> <span class="n">stz</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">271</span><span class="p">]:</span> 
<span class="mi">0</span>   <span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">09</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mi">12</span><span class="o">-</span><span class="mi">05</span><span class="p">:</span><span class="mi">00</span>
<span class="mi">1</span>   <span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span> <span class="mi">09</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mi">12</span><span class="o">-</span><span class="mi">05</span><span class="p">:</span><span class="mi">00</span>
<span class="mi">2</span>   <span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span> <span class="mi">09</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mi">12</span><span class="o">-</span><span class="mi">05</span><span class="p">:</span><span class="mi">00</span>
<span class="mi">3</span>   <span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">04</span> <span class="mi">09</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mi">12</span><span class="o">-</span><span class="mi">05</span><span class="p">:</span><span class="mi">00</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">datetime64</span><span class="p">[</span><span class="n">ns</span><span class="p">,</span> <span class="n">US</span><span class="o">/</span><span class="n">Eastern</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">272</span><span class="p">]:</span> <span class="n">stz</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">272</span><span class="p">]:</span> <span class="o">&lt;</span><span class="n">DstTzInfo</span> <span class="s1">&#39;US/Eastern&#39;</span> <span class="n">LMT</span><span class="o">-</span><span class="mi">1</span> <span class="n">day</span><span class="p">,</span> <span class="mi">19</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mi">00</span> <span class="n">STD</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>可以把这些操作连在一起：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">273</span><span class="p">]:</span> <span class="n">s</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="s1">&#39;UTC&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz_convert</span><span class="p">(</span><span class="s1">&#39;US/Eastern&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">273</span><span class="p">]:</span> 
<span class="mi">0</span>   <span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">04</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mi">12</span><span class="o">-</span><span class="mi">05</span><span class="p">:</span><span class="mi">00</span>
<span class="mi">1</span>   <span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span> <span class="mi">04</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mi">12</span><span class="o">-</span><span class="mi">05</span><span class="p">:</span><span class="mi">00</span>
<span class="mi">2</span>   <span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span> <span class="mi">04</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mi">12</span><span class="o">-</span><span class="mi">05</span><span class="p">:</span><span class="mi">00</span>
<span class="mi">3</span>   <span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">04</span> <span class="mi">04</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mi">12</span><span class="o">-</span><span class="mi">05</span><span class="p">:</span><span class="mi">00</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">datetime64</span><span class="p">[</span><span class="n">ns</span><span class="p">,</span> <span class="n">US</span><span class="o">/</span><span class="n">Eastern</span><span class="p">]</span>
</pre></div>
</div>
<p>还可以用 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.dt.strftime.html#pandas.Series.dt.strftime"><code class="docutils literal notranslate"><span class="pre">Series.dt.strftime()</span></code></a> 把 <code class="docutils literal notranslate"><span class="pre">datetime</span></code> 的值当成字符串进行格式化，支持与标准 <a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime.strftime"><code class="docutils literal notranslate"><span class="pre">strftime()</span></code></a> 同样的格式。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># DatetimeIndex</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">274</span><span class="p">]:</span> <span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;20130101&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">275</span><span class="p">]:</span> <span class="n">s</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">275</span><span class="p">]:</span> 
<span class="mi">0</span>   <span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span>
<span class="mi">1</span>   <span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span>
<span class="mi">2</span>   <span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span>
<span class="mi">3</span>   <span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">04</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">datetime64</span><span class="p">[</span><span class="n">ns</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">276</span><span class="p">]:</span> <span class="n">s</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y/%m/</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">276</span><span class="p">]:</span> 
<span class="mi">0</span>    <span class="mi">2013</span><span class="o">/</span><span class="mi">01</span><span class="o">/</span><span class="mi">01</span>
<span class="mi">1</span>    <span class="mi">2013</span><span class="o">/</span><span class="mi">01</span><span class="o">/</span><span class="mi">02</span>
<span class="mi">2</span>    <span class="mi">2013</span><span class="o">/</span><span class="mi">01</span><span class="o">/</span><span class="mi">03</span>
<span class="mi">3</span>    <span class="mi">2013</span><span class="o">/</span><span class="mi">01</span><span class="o">/</span><span class="mi">04</span>
<span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># PeriodIndex</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">277</span><span class="p">]:</span> <span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">period_range</span><span class="p">(</span><span class="s1">&#39;20130101&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">278</span><span class="p">]:</span> <span class="n">s</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">278</span><span class="p">]:</span> 
<span class="mi">0</span>    <span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span>
<span class="mi">1</span>    <span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span>
<span class="mi">2</span>    <span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span>
<span class="mi">3</span>    <span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">04</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">period</span><span class="p">[</span><span class="n">D</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">279</span><span class="p">]:</span> <span class="n">s</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y/%m/</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">279</span><span class="p">]:</span> 
<span class="mi">0</span>    <span class="mi">2013</span><span class="o">/</span><span class="mi">01</span><span class="o">/</span><span class="mi">01</span>
<span class="mi">1</span>    <span class="mi">2013</span><span class="o">/</span><span class="mi">01</span><span class="o">/</span><span class="mi">02</span>
<span class="mi">2</span>    <span class="mi">2013</span><span class="o">/</span><span class="mi">01</span><span class="o">/</span><span class="mi">03</span>
<span class="mi">3</span>    <span class="mi">2013</span><span class="o">/</span><span class="mi">01</span><span class="o">/</span><span class="mi">04</span>
<span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">.dt</span></code> 访问器还支持 <code class="docutils literal notranslate"><span class="pre">period</span></code> 与 <code class="docutils literal notranslate"><span class="pre">timedelta</span></code>。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># period</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">280</span><span class="p">]:</span> <span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">period_range</span><span class="p">(</span><span class="s1">&#39;20130101&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">))</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">281</span><span class="p">]:</span> <span class="n">s</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">281</span><span class="p">]:</span> 
<span class="mi">0</span>    <span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span>
<span class="mi">1</span>    <span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span>
<span class="mi">2</span>    <span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span>
<span class="mi">3</span>    <span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">04</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">period</span><span class="p">[</span><span class="n">D</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">282</span><span class="p">]:</span> <span class="n">s</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">282</span><span class="p">]:</span> 
<span class="mi">0</span>    <span class="mi">2013</span>
<span class="mi">1</span>    <span class="mi">2013</span>
<span class="mi">2</span>    <span class="mi">2013</span>
<span class="mi">3</span>    <span class="mi">2013</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">283</span><span class="p">]:</span> <span class="n">s</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">day</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">283</span><span class="p">]:</span> 
<span class="mi">0</span>    <span class="mi">1</span>
<span class="mi">1</span>    <span class="mi">2</span>
<span class="mi">2</span>    <span class="mi">3</span>
<span class="mi">3</span>    <span class="mi">4</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># timedelta</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">284</span><span class="p">]:</span> <span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">timedelta_range</span><span class="p">(</span><span class="s1">&#39;1 day 00:00:05&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">))</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">285</span><span class="p">]:</span> <span class="n">s</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">285</span><span class="p">]:</span> 
<span class="mi">0</span>   <span class="mi">1</span> <span class="n">days</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">05</span>
<span class="mi">1</span>   <span class="mi">1</span> <span class="n">days</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">06</span>
<span class="mi">2</span>   <span class="mi">1</span> <span class="n">days</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">07</span>
<span class="mi">3</span>   <span class="mi">1</span> <span class="n">days</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">08</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">timedelta64</span><span class="p">[</span><span class="n">ns</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">286</span><span class="p">]:</span> <span class="n">s</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">days</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">286</span><span class="p">]:</span> 
<span class="mi">0</span>    <span class="mi">1</span>
<span class="mi">1</span>    <span class="mi">1</span>
<span class="mi">2</span>    <span class="mi">1</span>
<span class="mi">3</span>    <span class="mi">1</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">287</span><span class="p">]:</span> <span class="n">s</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">seconds</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">287</span><span class="p">]:</span> 
<span class="mi">0</span>    <span class="mi">5</span>
<span class="mi">1</span>    <span class="mi">6</span>
<span class="mi">2</span>    <span class="mi">7</span>
<span class="mi">3</span>    <span class="mi">8</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">288</span><span class="p">]:</span> <span class="n">s</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">components</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">288</span><span class="p">]:</span> 
   <span class="n">days</span>  <span class="n">hours</span>  <span class="n">minutes</span>  <span class="n">seconds</span>  <span class="n">milliseconds</span>  <span class="n">microseconds</span>  <span class="n">nanoseconds</span>
<span class="mi">0</span>     <span class="mi">1</span>      <span class="mi">0</span>        <span class="mi">0</span>        <span class="mi">5</span>             <span class="mi">0</span>             <span class="mi">0</span>            <span class="mi">0</span>
<span class="mi">1</span>     <span class="mi">1</span>      <span class="mi">0</span>        <span class="mi">0</span>        <span class="mi">6</span>             <span class="mi">0</span>             <span class="mi">0</span>            <span class="mi">0</span>
<span class="mi">2</span>     <span class="mi">1</span>      <span class="mi">0</span>        <span class="mi">0</span>        <span class="mi">7</span>             <span class="mi">0</span>             <span class="mi">0</span>            <span class="mi">0</span>
<span class="mi">3</span>     <span class="mi">1</span>      <span class="mi">0</span>        <span class="mi">0</span>        <span class="mi">8</span>             <span class="mi">0</span>             <span class="mi">0</span>            <span class="mi">0</span>
</pre></div>
</div>
<p>::: tip 注意</p>
<p>用这个访问器处理不是 <code class="docutils literal notranslate"><span class="pre">datetime</span></code> 类型的值时，<code class="docutils literal notranslate"><span class="pre">Series.dt</span></code> 会触发 <code class="docutils literal notranslate"><span class="pre">TypeError</span></code> 错误。</p>
<p>:::</p>
</div>
<div class="section" id="id28">
<h2><span class="section-number">2.10. </span>矢量化字符串方法<a class="headerlink" href="#id28" title="永久链接至标题">¶</a></h2>
<p>Series 支持字符串处理方法，可以非常方便地操作数组里的每个元素。这些方法会自动排除缺失值与空值，这也许是其最重要的特性。这些方法通过 Series 的 <code class="docutils literal notranslate"><span class="pre">str</span></code> 属性访问，一般情况下，这些操作的名称与内置的字符串方法一致。示例如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">289</span><span class="p">]:</span> <span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;Aaba&#39;</span><span class="p">,</span> <span class="s1">&#39;Baca&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="s1">&#39;CABA&#39;</span><span class="p">,</span> <span class="s1">&#39;dog&#39;</span><span class="p">,</span> <span class="s1">&#39;cat&#39;</span><span class="p">])</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">290</span><span class="p">]:</span> <span class="n">s</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">290</span><span class="p">]:</span> 
<span class="mi">0</span>       <span class="n">a</span>
<span class="mi">1</span>       <span class="n">b</span>
<span class="mi">2</span>       <span class="n">c</span>
<span class="mi">3</span>    <span class="n">aaba</span>
<span class="mi">4</span>    <span class="n">baca</span>
<span class="mi">5</span>     <span class="n">NaN</span>
<span class="mi">6</span>    <span class="n">caba</span>
<span class="mi">7</span>     <span class="n">dog</span>
<span class="mi">8</span>     <span class="n">cat</span>
<span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>
</pre></div>
</div>
<p>这里还提供了强大的模式匹配方法，但工业注意，模式匹配方法默认使用<a class="reference external" href="https://docs.python.org/3/library/re.html">正则表达式</a>。</p>
<p>参阅<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/text.html#text-string-methods">矢量化字符串方法</a>，了解完整内容。</p>
</div>
<div class="section" id="id29">
<h2><span class="section-number">2.11. </span>排序<a class="headerlink" href="#id29" title="永久链接至标题">¶</a></h2>
<p>Pandas 支持三种排序方式，按索引标签排序，按列里的值排序，按两种方式混合排序。</p>
<div class="section" id="id30">
<h3>按索引排序<a class="headerlink" href="#id30" title="永久链接至标题">¶</a></h3>
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.sort_index.html#pandas.Series.sort_index"><code class="docutils literal notranslate"><span class="pre">Series.sort_index()</span></code></a> 与 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.sort_index.html#pandas.DataFrame.sort_index"><code class="docutils literal notranslate"><span class="pre">DataFrame.sort_index()</span></code></a> 方法用于按索引层级对 Pandas 对象排序。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">291</span><span class="p">]:</span> <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
   <span class="o">.....</span><span class="p">:</span>     <span class="s1">&#39;one&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">]),</span>
   <span class="o">.....</span><span class="p">:</span>     <span class="s1">&#39;two&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">]),</span>
   <span class="o">.....</span><span class="p">:</span>     <span class="s1">&#39;three&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">])})</span>
   <span class="o">.....</span><span class="p">:</span> 

<span class="n">In</span> <span class="p">[</span><span class="mi">292</span><span class="p">]:</span> <span class="n">unsorted_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">],</span>
   <span class="o">.....</span><span class="p">:</span>                          <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;three&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;one&#39;</span><span class="p">])</span>
   <span class="o">.....</span><span class="p">:</span> 

<span class="n">In</span> <span class="p">[</span><span class="mi">293</span><span class="p">]:</span> <span class="n">unsorted_df</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">293</span><span class="p">]:</span> 
      <span class="n">three</span>       <span class="n">two</span>       <span class="n">one</span>
<span class="n">a</span>       <span class="n">NaN</span> <span class="o">-</span><span class="mf">1.152244</span>  <span class="mf">0.562973</span>
<span class="n">d</span> <span class="o">-</span><span class="mf">0.252916</span> <span class="o">-</span><span class="mf">0.109597</span>       <span class="n">NaN</span>
<span class="n">c</span>  <span class="mf">1.273388</span> <span class="o">-</span><span class="mf">0.167123</span>  <span class="mf">0.640382</span>
<span class="n">b</span> <span class="o">-</span><span class="mf">0.098217</span>  <span class="mf">0.009797</span> <span class="o">-</span><span class="mf">1.299504</span>

<span class="c1"># DataFrame</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">294</span><span class="p">]:</span> <span class="n">unsorted_df</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">294</span><span class="p">]:</span> 
      <span class="n">three</span>       <span class="n">two</span>       <span class="n">one</span>
<span class="n">a</span>       <span class="n">NaN</span> <span class="o">-</span><span class="mf">1.152244</span>  <span class="mf">0.562973</span>
<span class="n">b</span> <span class="o">-</span><span class="mf">0.098217</span>  <span class="mf">0.009797</span> <span class="o">-</span><span class="mf">1.299504</span>
<span class="n">c</span>  <span class="mf">1.273388</span> <span class="o">-</span><span class="mf">0.167123</span>  <span class="mf">0.640382</span>
<span class="n">d</span> <span class="o">-</span><span class="mf">0.252916</span> <span class="o">-</span><span class="mf">0.109597</span>       <span class="n">NaN</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">295</span><span class="p">]:</span> <span class="n">unsorted_df</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">295</span><span class="p">]:</span> 
      <span class="n">three</span>       <span class="n">two</span>       <span class="n">one</span>
<span class="n">d</span> <span class="o">-</span><span class="mf">0.252916</span> <span class="o">-</span><span class="mf">0.109597</span>       <span class="n">NaN</span>
<span class="n">c</span>  <span class="mf">1.273388</span> <span class="o">-</span><span class="mf">0.167123</span>  <span class="mf">0.640382</span>
<span class="n">b</span> <span class="o">-</span><span class="mf">0.098217</span>  <span class="mf">0.009797</span> <span class="o">-</span><span class="mf">1.299504</span>
<span class="n">a</span>       <span class="n">NaN</span> <span class="o">-</span><span class="mf">1.152244</span>  <span class="mf">0.562973</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">296</span><span class="p">]:</span> <span class="n">unsorted_df</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">296</span><span class="p">]:</span> 
        <span class="n">one</span>     <span class="n">three</span>       <span class="n">two</span>
<span class="n">a</span>  <span class="mf">0.562973</span>       <span class="n">NaN</span> <span class="o">-</span><span class="mf">1.152244</span>
<span class="n">d</span>       <span class="n">NaN</span> <span class="o">-</span><span class="mf">0.252916</span> <span class="o">-</span><span class="mf">0.109597</span>
<span class="n">c</span>  <span class="mf">0.640382</span>  <span class="mf">1.273388</span> <span class="o">-</span><span class="mf">0.167123</span>
<span class="n">b</span> <span class="o">-</span><span class="mf">1.299504</span> <span class="o">-</span><span class="mf">0.098217</span>  <span class="mf">0.009797</span>

<span class="c1"># Series</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">297</span><span class="p">]:</span> <span class="n">unsorted_df</span><span class="p">[</span><span class="s1">&#39;three&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">297</span><span class="p">]:</span> 
<span class="n">a</span>         <span class="n">NaN</span>
<span class="n">b</span>   <span class="o">-</span><span class="mf">0.098217</span>
<span class="n">c</span>    <span class="mf">1.273388</span>
<span class="n">d</span>   <span class="o">-</span><span class="mf">0.252916</span>
<span class="n">Name</span><span class="p">:</span> <span class="n">three</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</pre></div>
</div>
</div>
<div class="section" id="id31">
<h3>按值排序<a class="headerlink" href="#id31" title="永久链接至标题">¶</a></h3>
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.sort_values.html#pandas.Series.sort_values"><code class="docutils literal notranslate"><span class="pre">Series.sort_values()</span></code></a> 方法用于按值对 Series 排序。<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.sort_values.html#pandas.DataFrame.sort_values"><code class="docutils literal notranslate"><span class="pre">DataFrame.sort_values()</span></code></a> 方法用于按行列的值对 DataFrame 排序。<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.sort_values.html#pandas.DataFrame.sort_values"><code class="docutils literal notranslate"><span class="pre">DataFrame.sort_values()</span></code></a> 的可选参数 <code class="docutils literal notranslate"><span class="pre">by</span></code> 用于指定按哪列排序，该参数的值可以是一列或多列数据。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">298</span><span class="p">]:</span> <span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;one&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
   <span class="o">.....</span><span class="p">:</span>                     <span class="s1">&#39;two&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
   <span class="o">.....</span><span class="p">:</span>                     <span class="s1">&#39;three&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]})</span>
   <span class="o">.....</span><span class="p">:</span> 

<span class="n">In</span> <span class="p">[</span><span class="mi">299</span><span class="p">]:</span> <span class="n">df1</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;two&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">299</span><span class="p">]:</span> 
   <span class="n">one</span>  <span class="n">two</span>  <span class="n">three</span>
<span class="mi">0</span>    <span class="mi">2</span>    <span class="mi">1</span>      <span class="mi">5</span>
<span class="mi">2</span>    <span class="mi">1</span>    <span class="mi">2</span>      <span class="mi">3</span>
<span class="mi">1</span>    <span class="mi">1</span>    <span class="mi">3</span>      <span class="mi">4</span>
<span class="mi">3</span>    <span class="mi">1</span>    <span class="mi">4</span>      <span class="mi">2</span>
</pre></div>
</div>
<p>参数 <code class="docutils literal notranslate"><span class="pre">by</span></code> 支持列名列表，示例如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">300</span><span class="p">]:</span> <span class="n">df1</span><span class="p">[[</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;three&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">300</span><span class="p">]:</span> 
   <span class="n">one</span>  <span class="n">two</span>  <span class="n">three</span>
<span class="mi">2</span>    <span class="mi">1</span>    <span class="mi">2</span>      <span class="mi">3</span>
<span class="mi">1</span>    <span class="mi">1</span>    <span class="mi">3</span>      <span class="mi">4</span>
<span class="mi">3</span>    <span class="mi">1</span>    <span class="mi">4</span>      <span class="mi">2</span>
<span class="mi">0</span>    <span class="mi">2</span>    <span class="mi">1</span>      <span class="mi">5</span>
</pre></div>
</div>
<p>这些方法支持用 <code class="docutils literal notranslate"><span class="pre">na_position</span></code> 参数处理空值。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">301</span><span class="p">]:</span> <span class="n">s</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">302</span><span class="p">]:</span> <span class="n">s</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">302</span><span class="p">]:</span> 
<span class="mi">0</span>       <span class="n">A</span>
<span class="mi">3</span>    <span class="n">Aaba</span>
<span class="mi">1</span>       <span class="n">B</span>
<span class="mi">4</span>    <span class="n">Baca</span>
<span class="mi">6</span>    <span class="n">CABA</span>
<span class="mi">8</span>     <span class="n">cat</span>
<span class="mi">7</span>     <span class="n">dog</span>
<span class="mi">2</span>     <span class="n">NaN</span>
<span class="mi">5</span>     <span class="n">NaN</span>
<span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">303</span><span class="p">]:</span> <span class="n">s</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">na_position</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">303</span><span class="p">]:</span> 
<span class="mi">2</span>     <span class="n">NaN</span>
<span class="mi">5</span>     <span class="n">NaN</span>
<span class="mi">0</span>       <span class="n">A</span>
<span class="mi">3</span>    <span class="n">Aaba</span>
<span class="mi">1</span>       <span class="n">B</span>
<span class="mi">4</span>    <span class="n">Baca</span>
<span class="mi">6</span>    <span class="n">CABA</span>
<span class="mi">8</span>     <span class="n">cat</span>
<span class="mi">7</span>     <span class="n">dog</span>
<span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>
</pre></div>
</div>
</div>
<div class="section" id="id32">
<h3>按索引与值排序<a class="headerlink" href="#id32" title="永久链接至标题">¶</a></h3>
<p><em>0.23.0 版新增</em>。</p>
<p>通过参数 <code class="docutils literal notranslate"><span class="pre">by</span></code> 传递给 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.sort_values.html#pandas.DataFrame.sort_values"><code class="docutils literal notranslate"><span class="pre">DataFrame.sort_values()</span></code></a> 的字符串可以引用列或索引层名。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># 创建 MultiIndex</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">304</span><span class="p">]:</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">([(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
   <span class="o">.....</span><span class="p">:</span>                                 <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)])</span>
   <span class="o">.....</span><span class="p">:</span> 

<span class="n">In</span> <span class="p">[</span><span class="mi">305</span><span class="p">]:</span> <span class="n">idx</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="s1">&#39;second&#39;</span><span class="p">]</span>

<span class="c1"># 创建 DataFrame</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">306</span><span class="p">]:</span> <span class="n">df_multi</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)},</span>
   <span class="o">.....</span><span class="p">:</span>                         <span class="n">index</span><span class="o">=</span><span class="n">idx</span><span class="p">)</span>
   <span class="o">.....</span><span class="p">:</span> 

<span class="n">In</span> <span class="p">[</span><span class="mi">307</span><span class="p">]:</span> <span class="n">df_multi</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">307</span><span class="p">]:</span> 
              <span class="n">A</span>
<span class="n">first</span> <span class="n">second</span>   
<span class="n">a</span>     <span class="mi">1</span>       <span class="mi">6</span>
      <span class="mi">2</span>       <span class="mi">5</span>
      <span class="mi">2</span>       <span class="mi">4</span>
<span class="n">b</span>     <span class="mi">2</span>       <span class="mi">3</span>
      <span class="mi">1</span>       <span class="mi">2</span>
      <span class="mi">1</span>       <span class="mi">1</span>
</pre></div>
</div>
<p>按 <code class="docutils literal notranslate"><span class="pre">second</span></code>（索引）与 <code class="docutils literal notranslate"><span class="pre">A</span></code>（列）排序。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">308</span><span class="p">]:</span> <span class="n">df_multi</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;second&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">308</span><span class="p">]:</span> 
              <span class="n">A</span>
<span class="n">first</span> <span class="n">second</span>   
<span class="n">b</span>     <span class="mi">1</span>       <span class="mi">1</span>
      <span class="mi">1</span>       <span class="mi">2</span>
<span class="n">a</span>     <span class="mi">1</span>       <span class="mi">6</span>
<span class="n">b</span>     <span class="mi">2</span>       <span class="mi">3</span>
<span class="n">a</span>     <span class="mi">2</span>       <span class="mi">4</span>
      <span class="mi">2</span>       <span class="mi">5</span>
</pre></div>
</div>
<p>::: tip 注意</p>
<p>字符串、列名、索引层名重名时，会触发警告提示，并以列名为准。后期版本中，这种情况将会触发模糊错误。</p>
<p>:::</p>
</div>
<div class="section" id="id33">
<h3>搜索排序<a class="headerlink" href="#id33" title="永久链接至标题">¶</a></h3>
<p>Series 支持 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.searchsorted.html#pandas.Series.searchsorted"><code class="docutils literal notranslate"><span class="pre">searchsorted()</span></code></a> 方法，这与<a class="reference external" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.ndarray.searchsorted.html#numpy.ndarray.searchsorted"><code class="docutils literal notranslate"><span class="pre">numpy.ndarray.searchsorted()</span></code></a> 的操作方式类似。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">309</span><span class="p">]:</span> <span class="n">ser</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">310</span><span class="p">]:</span> <span class="n">ser</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">310</span><span class="p">]:</span> <span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">311</span><span class="p">]:</span> <span class="n">ser</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">311</span><span class="p">]:</span> <span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">312</span><span class="p">]:</span> <span class="n">ser</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">side</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">312</span><span class="p">]:</span> <span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">313</span><span class="p">]:</span> <span class="n">ser</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">side</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">313</span><span class="p">]:</span> <span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">314</span><span class="p">]:</span> <span class="n">ser</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">315</span><span class="p">]:</span> <span class="n">ser</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">sorter</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">ser</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">315</span><span class="p">]:</span> <span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="id34">
<h3>最大值与最小值<a class="headerlink" href="#id34" title="永久链接至标题">¶</a></h3>
<p>Series 支持 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.nsmallest.html#pandas.Series.nsmallest"><code class="docutils literal notranslate"><span class="pre">nsmallest()</span></code></a> 与 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.nlargest.html#pandas.Series.nlargest"><code class="docutils literal notranslate"><span class="pre">nlargest()</span></code></a> 方法，本方法返回 N 个最大或最小的值。对于数据量大的 <code class="docutils literal notranslate"><span class="pre">Series</span></code> 来说，该方法比先为整个 Series 排序，再调用 <code class="docutils literal notranslate"><span class="pre">head(n)</span></code> 这种方式的速度要快得多。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">316</span><span class="p">]:</span> <span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">permutation</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">317</span><span class="p">]:</span> <span class="n">s</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">317</span><span class="p">]:</span> 
<span class="mi">0</span>    <span class="mi">2</span>
<span class="mi">1</span>    <span class="mi">0</span>
<span class="mi">2</span>    <span class="mi">3</span>
<span class="mi">3</span>    <span class="mi">7</span>
<span class="mi">4</span>    <span class="mi">1</span>
<span class="mi">5</span>    <span class="mi">5</span>
<span class="mi">6</span>    <span class="mi">9</span>
<span class="mi">7</span>    <span class="mi">6</span>
<span class="mi">8</span>    <span class="mi">8</span>
<span class="mi">9</span>    <span class="mi">4</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">318</span><span class="p">]:</span> <span class="n">s</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">318</span><span class="p">]:</span> 
<span class="mi">1</span>    <span class="mi">0</span>
<span class="mi">4</span>    <span class="mi">1</span>
<span class="mi">0</span>    <span class="mi">2</span>
<span class="mi">2</span>    <span class="mi">3</span>
<span class="mi">9</span>    <span class="mi">4</span>
<span class="mi">5</span>    <span class="mi">5</span>
<span class="mi">7</span>    <span class="mi">6</span>
<span class="mi">3</span>    <span class="mi">7</span>
<span class="mi">8</span>    <span class="mi">8</span>
<span class="mi">6</span>    <span class="mi">9</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">319</span><span class="p">]:</span> <span class="n">s</span><span class="o">.</span><span class="n">nsmallest</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">319</span><span class="p">]:</span> 
<span class="mi">1</span>    <span class="mi">0</span>
<span class="mi">4</span>    <span class="mi">1</span>
<span class="mi">0</span>    <span class="mi">2</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">320</span><span class="p">]:</span> <span class="n">s</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">320</span><span class="p">]:</span> 
<span class="mi">6</span>    <span class="mi">9</span>
<span class="mi">8</span>    <span class="mi">8</span>
<span class="mi">3</span>    <span class="mi">7</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 也支持 <code class="docutils literal notranslate"><span class="pre">nlargest</span></code> 与 <code class="docutils literal notranslate"><span class="pre">nsmallest</span></code> 方法。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">321</span><span class="p">]:</span> <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>
   <span class="o">.....</span><span class="p">:</span>                    <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="s1">&#39;abdceff&#39;</span><span class="p">),</span>
   <span class="o">.....</span><span class="p">:</span>                    <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">3.2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">]})</span>
   <span class="o">.....</span><span class="p">:</span> 

<span class="n">In</span> <span class="p">[</span><span class="mi">322</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">322</span><span class="p">]:</span> 
    <span class="n">a</span>  <span class="n">b</span>    <span class="n">c</span>
<span class="mi">5</span>  <span class="mi">11</span>  <span class="n">f</span>  <span class="mf">3.0</span>
<span class="mi">3</span>  <span class="mi">10</span>  <span class="n">c</span>  <span class="mf">3.2</span>
<span class="mi">4</span>   <span class="mi">8</span>  <span class="n">e</span>  <span class="n">NaN</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">323</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">323</span><span class="p">]:</span> 
    <span class="n">a</span>  <span class="n">b</span>    <span class="n">c</span>
<span class="mi">5</span>  <span class="mi">11</span>  <span class="n">f</span>  <span class="mf">3.0</span>
<span class="mi">3</span>  <span class="mi">10</span>  <span class="n">c</span>  <span class="mf">3.2</span>
<span class="mi">4</span>   <span class="mi">8</span>  <span class="n">e</span>  <span class="n">NaN</span>
<span class="mi">2</span>   <span class="mi">1</span>  <span class="n">d</span>  <span class="mf">4.0</span>
<span class="mi">6</span>  <span class="o">-</span><span class="mi">1</span>  <span class="n">f</span>  <span class="mf">4.0</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">324</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">nsmallest</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">324</span><span class="p">]:</span> 
   <span class="n">a</span>  <span class="n">b</span>    <span class="n">c</span>
<span class="mi">0</span> <span class="o">-</span><span class="mi">2</span>  <span class="n">a</span>  <span class="mf">1.0</span>
<span class="mi">1</span> <span class="o">-</span><span class="mi">1</span>  <span class="n">b</span>  <span class="mf">2.0</span>
<span class="mi">6</span> <span class="o">-</span><span class="mi">1</span>  <span class="n">f</span>  <span class="mf">4.0</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">325</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">nsmallest</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">325</span><span class="p">]:</span> 
   <span class="n">a</span>  <span class="n">b</span>    <span class="n">c</span>
<span class="mi">0</span> <span class="o">-</span><span class="mi">2</span>  <span class="n">a</span>  <span class="mf">1.0</span>
<span class="mi">1</span> <span class="o">-</span><span class="mi">1</span>  <span class="n">b</span>  <span class="mf">2.0</span>
<span class="mi">6</span> <span class="o">-</span><span class="mi">1</span>  <span class="n">f</span>  <span class="mf">4.0</span>
<span class="mi">2</span>  <span class="mi">1</span>  <span class="n">d</span>  <span class="mf">4.0</span>
<span class="mi">4</span>  <span class="mi">8</span>  <span class="n">e</span>  <span class="n">NaN</span>
</pre></div>
</div>
</div>
<div class="section" id="id35">
<h3>用多层索引的列排序<a class="headerlink" href="#id35" title="永久链接至标题">¶</a></h3>
<p>列为多层索引时，可以显式排序，用 <code class="docutils literal notranslate"><span class="pre">by</span></code> 指定所有层级。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">326</span><span class="p">]:</span> <span class="n">df1</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">([(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;one&#39;</span><span class="p">),</span>
   <span class="o">.....</span><span class="p">:</span>                                          <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">),</span>
   <span class="o">.....</span><span class="p">:</span>                                          <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;three&#39;</span><span class="p">)])</span>
   <span class="o">.....</span><span class="p">:</span> 

<span class="n">In</span> <span class="p">[</span><span class="mi">327</span><span class="p">]:</span> <span class="n">df1</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">327</span><span class="p">]:</span> 
    <span class="n">a</span>         <span class="n">b</span>
  <span class="n">one</span> <span class="n">two</span> <span class="n">three</span>
<span class="mi">0</span>   <span class="mi">2</span>   <span class="mi">1</span>     <span class="mi">5</span>
<span class="mi">2</span>   <span class="mi">1</span>   <span class="mi">2</span>     <span class="mi">3</span>
<span class="mi">1</span>   <span class="mi">1</span>   <span class="mi">3</span>     <span class="mi">4</span>
<span class="mi">3</span>   <span class="mi">1</span>   <span class="mi">4</span>     <span class="mi">2</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id36">
<h2><span class="section-number">2.12. </span>复制<a class="headerlink" href="#id36" title="永久链接至标题">¶</a></h2>
<p>在 Pandas 对象上执行 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.copy.html#pandas.DataFrame.copy"><code class="docutils literal notranslate"><span class="pre">copy()</span></code></a> 方法，将复制底层数据（但不包括轴索引，因为轴索引不可变），并返回一个新的对象。注意，<strong>复制对象这种操作一般来说不是必须的</strong>。比如说，以下几种方式可以<em><strong>就地（inplace）</strong></em> 改变 DataFrame：</p>
<ul class="simple">
<li><p>插入、删除、修改列</p></li>
<li><p>为 <code class="docutils literal notranslate"><span class="pre">index</span></code> 或 <code class="docutils literal notranslate"><span class="pre">columns</span></code> 属性赋值</p></li>
<li><p>对于同质数据，用 <code class="docutils literal notranslate"><span class="pre">values</span></code> 属性或高级索引即可直接修改值</p></li>
</ul>
<p>注意，用 Pandas 方法修改数据不会带来任何副作用，几乎所有方法都返回新的对象，不会修改原始数据对象。如果原始数据有所改动，唯一的可能就是用户显式指定了要修改原始数据。</p>
</div>
<div class="section" id="id37">
<h2><span class="section-number">2.13. </span>数据类型<a class="headerlink" href="#id37" title="永久链接至标题">¶</a></h2>
<p>大多数情况下，Pandas 使用 NumPy 数组、Series 或 DataFrame 里某列的数据类型。NumPy 支持 <code class="docutils literal notranslate"><span class="pre">float</span></code>、<code class="docutils literal notranslate"><span class="pre">int</span></code>、<code class="docutils literal notranslate"><span class="pre">bool</span></code>、<code class="docutils literal notranslate"><span class="pre">timedelta[ns]</span></code>、<code class="docutils literal notranslate"><span class="pre">datetime64[ns]</span></code>，注意，NumPy 不支持带时区信息的 <code class="docutils literal notranslate"><span class="pre">datetime</span></code>。</p>
<p>Pandas 与第三方支持库扩充了 NumPy 类型系统，本节只介绍 Pandas 的内部扩展。如需了解如何编写与 Pandas 扩展类型，请参阅<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/development/extending.html#extending-extension-types">扩展类型</a>，参阅<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/ecosystem.html#ecosystem-extensions">扩展数据类型</a>了解第三方支持库提供的扩展类型。</p>
<p>下表列出了 Pandas 扩展类型，参阅列出的文档内容，查看每种类型的详细说明。</p>
<table border="1" class="docutils">
<thead>
<tr>
<th align="center">数据种类</th>
<th align="center">数据类型</th>
<th align="center">标量</th>
<th align="center">数组</th>
<th align="center">文档</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">tz-aware datetime</td>
<td align="center"><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DatetimeTZDtype.html#pandas.DatetimeTZDtype"><code>DatetimeTZDtype</code></a></td>
<td align="center"><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Timestamp.html#pandas.Timestamp"><code>Timestamp</code></a></td>
<td align="center"><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.arrays.DatetimeArray.html#pandas.arrays.DatetimeArray"><code>arrays.DatetimeArray</code></a></td>
<td align="center"><a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#timeseries-timezone">Time zone handling</a></td>
</tr>
<tr>
<td align="center">Categorical</td>
<td align="center"><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.CategoricalDtype.html#pandas.CategoricalDtype"><code>CategoricalDtype</code></a></td>
<td align="center">(无)</td>
<td align="center"><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Categorical.html#pandas.Categorical"><code>Categorical</code></a></td>
<td align="center"><a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/categorical.html#categorical">Categorical data</a></td>
</tr>
<tr>
<td align="center">period (time spans)</td>
<td align="center"><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.PeriodDtype.html#pandas.PeriodDtype"><code>PeriodDtype</code></a></td>
<td align="center"><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Period.html#pandas.Period"><code>Period</code></a></td>
<td align="center"><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.arrays.PeriodArray.html#pandas.arrays.PeriodArray"><code>arrays.PeriodArray</code></a></td>
<td align="center"><a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#timeseries-periods">Time span representation</a></td>
</tr>
<tr>
<td align="center">sparse</td>
<td align="center"><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.SparseDtype.html#pandas.SparseDtype"><code>SparseDtype</code></a></td>
<td align="center">(无)</td>
<td align="center"><code>arrays.SparseArray</code></td>
<td align="center"><a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/sparse.html#sparse">Sparse data structures</a></td>
</tr>
<tr>
<td align="center">intervals</td>
<td align="center"><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.IntervalDtype.html#pandas.IntervalDtype"><code>IntervalDtype</code></a></td>
<td align="center"><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Interval.html#pandas.Interval"><code>Interval</code></a></td>
<td align="center"><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.arrays.IntervalArray.html#pandas.arrays.IntervalArray"><code>arrays.IntervalArray</code></a></td>
<td align="center"><a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/advanced.html#advanced-intervalindex">IntervalIndex</a></td>
</tr>
<tr>
<td align="center">nullable integer</td>
<td align="center"><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Int64Dtype.html#pandas.Int64Dtype"><code>Int64Dtype</code></a>, …</td>
<td align="center">(无)</td>
<td align="center"><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.arrays.IntegerArray.html#pandas.arrays.IntegerArray"><code>arrays.IntegerArray</code></a></td>
<td align="center"><a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/integer_na.html#integer-na">Nullable integer data type</a></td>
</tr>
</tbody>
</table><p>Pandas 用 <code class="docutils literal notranslate"><span class="pre">object</span></code> 存储字符串。</p>
<p>虽然， <code class="docutils literal notranslate"><span class="pre">object</span></code> 数据类型能够存储任何对象，但应尽量避免这种操作，要了解与其它支持库与方法的性能与交互操作，参阅 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/getting_started/basics.html#basics-object-conversion">对象转换</a>。</p>
<p>DataFrame 的 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.dtypes.html#pandas.DataFrame.dtypes"><code class="docutils literal notranslate"><span class="pre">dtypes</span></code></a> 属性用起来很方便，以 Series 形式返回每列的数据类型。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">328</span><span class="p">]:</span> <span class="n">dft</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
   <span class="o">.....</span><span class="p">:</span>                     <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
   <span class="o">.....</span><span class="p">:</span>                     <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="s1">&#39;foo&#39;</span><span class="p">,</span>
   <span class="o">.....</span><span class="p">:</span>                     <span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;20010102&#39;</span><span class="p">),</span>
   <span class="o">.....</span><span class="p">:</span>                     <span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mf">1.0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">),</span>
   <span class="o">.....</span><span class="p">:</span>                     <span class="s1">&#39;F&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
   <span class="o">.....</span><span class="p">:</span>                     <span class="s1">&#39;G&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int8&#39;</span><span class="p">)})</span>
   <span class="o">.....</span><span class="p">:</span> 

<span class="n">In</span> <span class="p">[</span><span class="mi">329</span><span class="p">]:</span> <span class="n">dft</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">329</span><span class="p">]:</span> 
          <span class="n">A</span>  <span class="n">B</span>    <span class="n">C</span>          <span class="n">D</span>    <span class="n">E</span>      <span class="n">F</span>  <span class="n">G</span>
<span class="mi">0</span>  <span class="mf">0.035962</span>  <span class="mi">1</span>  <span class="n">foo</span> <span class="mi">2001</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span>  <span class="mf">1.0</span>  <span class="kc">False</span>  <span class="mi">1</span>
<span class="mi">1</span>  <span class="mf">0.701379</span>  <span class="mi">1</span>  <span class="n">foo</span> <span class="mi">2001</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span>  <span class="mf">1.0</span>  <span class="kc">False</span>  <span class="mi">1</span>
<span class="mi">2</span>  <span class="mf">0.281885</span>  <span class="mi">1</span>  <span class="n">foo</span> <span class="mi">2001</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span>  <span class="mf">1.0</span>  <span class="kc">False</span>  <span class="mi">1</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">330</span><span class="p">]:</span> <span class="n">dft</span><span class="o">.</span><span class="n">dtypes</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">330</span><span class="p">]:</span> 
<span class="n">A</span>           <span class="n">float64</span>
<span class="n">B</span>             <span class="n">int64</span>
<span class="n">C</span>            <span class="nb">object</span>
<span class="n">D</span>    <span class="n">datetime64</span><span class="p">[</span><span class="n">ns</span><span class="p">]</span>
<span class="n">E</span>           <span class="n">float32</span>
<span class="n">F</span>              <span class="nb">bool</span>
<span class="n">G</span>              <span class="n">int8</span>
<span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>
</pre></div>
</div>
<p>要查看 <code class="docutils literal notranslate"><span class="pre">Series</span></code> 的数据类型，用 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.dtype.html#pandas.Series.dtype"><code class="docutils literal notranslate"><span class="pre">dtype</span></code></a> 属性。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">331</span><span class="p">]:</span> <span class="n">dft</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">331</span><span class="p">]:</span> <span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Pandas 对象单列中含多种类型的数据时，该列的数据类型为可适配于各类数据的数据类型，通常为 <code class="docutils literal notranslate"><span class="pre">object</span></code>。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># 整数被强制转换为浮点数</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">332</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mf">6.</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">332</span><span class="p">]:</span> 
<span class="mi">0</span>    <span class="mf">1.0</span>
<span class="mi">1</span>    <span class="mf">2.0</span>
<span class="mi">2</span>    <span class="mf">3.0</span>
<span class="mi">3</span>    <span class="mf">4.0</span>
<span class="mi">4</span>    <span class="mf">5.0</span>
<span class="mi">5</span>    <span class="mf">6.0</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>

<span class="c1"># 字符串数据决定了该 Series 的数据类型为 ``object``</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">333</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">6.</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">333</span><span class="p">]:</span> 
<span class="mi">0</span>      <span class="mi">1</span>
<span class="mi">1</span>      <span class="mi">2</span>
<span class="mi">2</span>      <span class="mi">3</span>
<span class="mi">3</span>      <span class="mi">6</span>
<span class="mi">4</span>    <span class="n">foo</span>
<span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">DataFrame.dtypes.value_counts()</span></code> 用于统计 DataFrame 里不同数据类型的列数。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">334</span><span class="p">]:</span> <span class="n">dft</span><span class="o">.</span><span class="n">dtypes</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">334</span><span class="p">]:</span> 
<span class="n">float32</span>           <span class="mi">1</span>
<span class="nb">object</span>            <span class="mi">1</span>
<span class="nb">bool</span>              <span class="mi">1</span>
<span class="n">int8</span>              <span class="mi">1</span>
<span class="n">float64</span>           <span class="mi">1</span>
<span class="n">datetime64</span><span class="p">[</span><span class="n">ns</span><span class="p">]</span>    <span class="mi">1</span>
<span class="n">int64</span>             <span class="mi">1</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>
</pre></div>
</div>
<p>多种数值型数据类型可以在 DataFrame 里共存。如果只传递一种数据类型，不论是通过 <code class="docutils literal notranslate"><span class="pre">dtype</span></code> 关键字直接传递，还是通过 <code class="docutils literal notranslate"><span class="pre">ndarray</span></code> 或 <code class="docutils literal notranslate"><span class="pre">Series</span></code> 传递，都会保存至 DataFrame 操作。此外，不同数值型数据类型<strong>不会</strong>合并。示例如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">335</span><span class="p">]:</span> <span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">336</span><span class="p">]:</span> <span class="n">df1</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">336</span><span class="p">]:</span> 
          <span class="n">A</span>
<span class="mi">0</span>  <span class="mf">0.224364</span>
<span class="mi">1</span>  <span class="mf">1.890546</span>
<span class="mi">2</span>  <span class="mf">0.182879</span>
<span class="mi">3</span>  <span class="mf">0.787847</span>
<span class="mi">4</span> <span class="o">-</span><span class="mf">0.188449</span>
<span class="mi">5</span>  <span class="mf">0.667715</span>
<span class="mi">6</span> <span class="o">-</span><span class="mf">0.011736</span>
<span class="mi">7</span> <span class="o">-</span><span class="mf">0.399073</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">337</span><span class="p">]:</span> <span class="n">df1</span><span class="o">.</span><span class="n">dtypes</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">337</span><span class="p">]:</span> 
<span class="n">A</span>    <span class="n">float32</span>
<span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">338</span><span class="p">]:</span> <span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float16&#39;</span><span class="p">),</span>
   <span class="o">.....</span><span class="p">:</span>                     <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">8</span><span class="p">)),</span>
   <span class="o">.....</span><span class="p">:</span>                     <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span>
   <span class="o">.....</span><span class="p">:</span>                                             <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;uint8&#39;</span><span class="p">))})</span>
   <span class="o">.....</span><span class="p">:</span> 

<span class="n">In</span> <span class="p">[</span><span class="mi">339</span><span class="p">]:</span> <span class="n">df2</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">339</span><span class="p">]:</span> 
          <span class="n">A</span>         <span class="n">B</span>    <span class="n">C</span>
<span class="mi">0</span>  <span class="mf">0.823242</span>  <span class="mf">0.256090</span>    <span class="mi">0</span>
<span class="mi">1</span>  <span class="mf">1.607422</span>  <span class="mf">1.426469</span>    <span class="mi">0</span>
<span class="mi">2</span> <span class="o">-</span><span class="mf">0.333740</span> <span class="o">-</span><span class="mf">0.416203</span>  <span class="mi">255</span>
<span class="mi">3</span> <span class="o">-</span><span class="mf">0.063477</span>  <span class="mf">1.139976</span>    <span class="mi">0</span>
<span class="mi">4</span> <span class="o">-</span><span class="mf">1.014648</span> <span class="o">-</span><span class="mf">1.193477</span>    <span class="mi">0</span>
<span class="mi">5</span>  <span class="mf">0.678711</span>  <span class="mf">0.096706</span>    <span class="mi">0</span>
<span class="mi">6</span> <span class="o">-</span><span class="mf">0.040863</span> <span class="o">-</span><span class="mf">1.956850</span>    <span class="mi">1</span>
<span class="mi">7</span> <span class="o">-</span><span class="mf">0.357422</span> <span class="o">-</span><span class="mf">0.714337</span>    <span class="mi">0</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">340</span><span class="p">]:</span> <span class="n">df2</span><span class="o">.</span><span class="n">dtypes</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">340</span><span class="p">]:</span> 
<span class="n">A</span>    <span class="n">float16</span>
<span class="n">B</span>    <span class="n">float64</span>
<span class="n">C</span>      <span class="n">uint8</span>
<span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>
</pre></div>
</div>
<div class="section" id="id38">
<h3>默认值<a class="headerlink" href="#id38" title="永久链接至标题">¶</a></h3>
<p>整数的默认类型为 <code class="docutils literal notranslate"><span class="pre">int64</span></code>，浮点数的默认类型为 <code class="docutils literal notranslate"><span class="pre">float64</span></code>，这里的默认值与系统平台无关，不管是 32 位系统，还是 64 位系统都是一样的。下列代码返回的结果都是 <code class="docutils literal notranslate"><span class="pre">int64</span></code>：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">341</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">dtypes</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">341</span><span class="p">]:</span> 
<span class="n">a</span>    <span class="n">int64</span>
<span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">342</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]})</span><span class="o">.</span><span class="n">dtypes</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">342</span><span class="p">]:</span> 
<span class="n">a</span>    <span class="n">int64</span>
<span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">343</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span> <span class="n">index</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">.</span><span class="n">dtypes</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">343</span><span class="p">]:</span> 
<span class="n">a</span>    <span class="n">int64</span>
<span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>
</pre></div>
</div>
<p>注意，NumPy 创建数组时，会根据系统选择类型。下列代码在 32 位系统上<strong>将</strong>返回 <code class="docutils literal notranslate"><span class="pre">int32</span></code>。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">344</span><span class="p">]:</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="section" id="id39">
<h3>向上转型<a class="headerlink" href="#id39" title="永久链接至标题">¶</a></h3>
<p>与其它类型合并时，用的是向上转型，指的是从现有类型转换为另一种类型，如<code class="docutils literal notranslate"><span class="pre">int</span></code> 变为 <code class="docutils literal notranslate"><span class="pre">float</span></code>。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">345</span><span class="p">]:</span> <span class="n">df3</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">reindex_like</span><span class="p">(</span><span class="n">df2</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span> <span class="o">+</span> <span class="n">df2</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">346</span><span class="p">]:</span> <span class="n">df3</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">346</span><span class="p">]:</span> 
          <span class="n">A</span>         <span class="n">B</span>      <span class="n">C</span>
<span class="mi">0</span>  <span class="mf">1.047606</span>  <span class="mf">0.256090</span>    <span class="mf">0.0</span>
<span class="mi">1</span>  <span class="mf">3.497968</span>  <span class="mf">1.426469</span>    <span class="mf">0.0</span>
<span class="mi">2</span> <span class="o">-</span><span class="mf">0.150862</span> <span class="o">-</span><span class="mf">0.416203</span>  <span class="mf">255.0</span>
<span class="mi">3</span>  <span class="mf">0.724370</span>  <span class="mf">1.139976</span>    <span class="mf">0.0</span>
<span class="mi">4</span> <span class="o">-</span><span class="mf">1.203098</span> <span class="o">-</span><span class="mf">1.193477</span>    <span class="mf">0.0</span>
<span class="mi">5</span>  <span class="mf">1.346426</span>  <span class="mf">0.096706</span>    <span class="mf">0.0</span>
<span class="mi">6</span> <span class="o">-</span><span class="mf">0.052599</span> <span class="o">-</span><span class="mf">1.956850</span>    <span class="mf">1.0</span>
<span class="mi">7</span> <span class="o">-</span><span class="mf">0.756495</span> <span class="o">-</span><span class="mf">0.714337</span>    <span class="mf">0.0</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">347</span><span class="p">]:</span> <span class="n">df3</span><span class="o">.</span><span class="n">dtypes</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">347</span><span class="p">]:</span> 
<span class="n">A</span>    <span class="n">float32</span>
<span class="n">B</span>    <span class="n">float64</span>
<span class="n">C</span>    <span class="n">float64</span>
<span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>
</pre></div>
</div>
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.to_numpy.html#pandas.DataFrame.to_numpy"><code class="docutils literal notranslate"><span class="pre">DataFrame.to_numpy()</span></code></a> 返回多个数据类型里<strong>用得最多的数据类型</strong>，这里指的是，输出结果的数据类型，适用于所有同构 NumPy 数组的数据类型。此处强制执行<strong>向上转型</strong>。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">348</span><span class="p">]:</span> <span class="n">df3</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span><span class="o">.</span><span class="n">dtype</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">348</span><span class="p">]:</span> <span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="astype">
<h3>astype<a class="headerlink" href="#astype" title="永久链接至标题">¶</a></h3>
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.astype.html#pandas.DataFrame.astype"><code class="docutils literal notranslate"><span class="pre">astype()</span></code></a> 方法显式地把一种数据类型转换为另一种，默认操作为复制数据，就算数据类型没有改变也会复制数据，<code class="docutils literal notranslate"><span class="pre">copy=False</span></code> 改变默认操作模式。此外，<code class="docutils literal notranslate"><span class="pre">astype</span></code> 无效时，会触发异常。</p>
<p>向上转型一般都遵循 <strong>NumPy</strong> 规则。操作中含有两种不同类型的数据时，返回更为通用的那种数据类型。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">349</span><span class="p">]:</span> <span class="n">df3</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">349</span><span class="p">]:</span> 
          <span class="n">A</span>         <span class="n">B</span>      <span class="n">C</span>
<span class="mi">0</span>  <span class="mf">1.047606</span>  <span class="mf">0.256090</span>    <span class="mf">0.0</span>
<span class="mi">1</span>  <span class="mf">3.497968</span>  <span class="mf">1.426469</span>    <span class="mf">0.0</span>
<span class="mi">2</span> <span class="o">-</span><span class="mf">0.150862</span> <span class="o">-</span><span class="mf">0.416203</span>  <span class="mf">255.0</span>
<span class="mi">3</span>  <span class="mf">0.724370</span>  <span class="mf">1.139976</span>    <span class="mf">0.0</span>
<span class="mi">4</span> <span class="o">-</span><span class="mf">1.203098</span> <span class="o">-</span><span class="mf">1.193477</span>    <span class="mf">0.0</span>
<span class="mi">5</span>  <span class="mf">1.346426</span>  <span class="mf">0.096706</span>    <span class="mf">0.0</span>
<span class="mi">6</span> <span class="o">-</span><span class="mf">0.052599</span> <span class="o">-</span><span class="mf">1.956850</span>    <span class="mf">1.0</span>
<span class="mi">7</span> <span class="o">-</span><span class="mf">0.756495</span> <span class="o">-</span><span class="mf">0.714337</span>    <span class="mf">0.0</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">350</span><span class="p">]:</span> <span class="n">df3</span><span class="o">.</span><span class="n">dtypes</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">350</span><span class="p">]:</span> 
<span class="n">A</span>    <span class="n">float32</span>
<span class="n">B</span>    <span class="n">float64</span>
<span class="n">C</span>    <span class="n">float64</span>
<span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>

<span class="c1"># 转换数据类型</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">351</span><span class="p">]:</span> <span class="n">df3</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">dtypes</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">351</span><span class="p">]:</span> 
<span class="n">A</span>    <span class="n">float32</span>
<span class="n">B</span>    <span class="n">float32</span>
<span class="n">C</span>    <span class="n">float32</span>
<span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>
</pre></div>
</div>
<p>用 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.astype.html#pandas.DataFrame.astype"><code class="docutils literal notranslate"><span class="pre">astype()</span></code></a> 把一列或多列转换为指定类型 。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">352</span><span class="p">]:</span> <span class="n">dft</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]})</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">353</span><span class="p">]:</span> <span class="n">dft</span><span class="p">[[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">dft</span><span class="p">[[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">354</span><span class="p">]:</span> <span class="n">dft</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">354</span><span class="p">]:</span> 
   <span class="n">a</span>  <span class="n">b</span>  <span class="n">c</span>
<span class="mi">0</span>  <span class="mi">1</span>  <span class="mi">4</span>  <span class="mi">7</span>
<span class="mi">1</span>  <span class="mi">2</span>  <span class="mi">5</span>  <span class="mi">8</span>
<span class="mi">2</span>  <span class="mi">3</span>  <span class="mi">6</span>  <span class="mi">9</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">355</span><span class="p">]:</span> <span class="n">dft</span><span class="o">.</span><span class="n">dtypes</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">355</span><span class="p">]:</span> 
<span class="n">a</span>    <span class="n">uint8</span>
<span class="n">b</span>    <span class="n">uint8</span>
<span class="n">c</span>    <span class="n">int64</span>
<span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>
</pre></div>
</div>
<p><em>0.19.0 版新增。</em></p>
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.astype.html#pandas.DataFrame.astype"><code class="docutils literal notranslate"><span class="pre">astype()</span></code></a> 通过字典指定哪些列转换为哪些类型。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">356</span><span class="p">]:</span> <span class="n">dft1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]})</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">357</span><span class="p">]:</span> <span class="n">dft1</span> <span class="o">=</span> <span class="n">dft1</span><span class="o">.</span><span class="n">astype</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">})</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">358</span><span class="p">]:</span> <span class="n">dft1</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">358</span><span class="p">]:</span> 
       <span class="n">a</span>  <span class="n">b</span>    <span class="n">c</span>
<span class="mi">0</span>   <span class="kc">True</span>  <span class="mi">4</span>  <span class="mf">7.0</span>
<span class="mi">1</span>  <span class="kc">False</span>  <span class="mi">5</span>  <span class="mf">8.0</span>
<span class="mi">2</span>   <span class="kc">True</span>  <span class="mi">6</span>  <span class="mf">9.0</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">359</span><span class="p">]:</span> <span class="n">dft1</span><span class="o">.</span><span class="n">dtypes</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">359</span><span class="p">]:</span> 
<span class="n">a</span>       <span class="nb">bool</span>
<span class="n">b</span>      <span class="n">int64</span>
<span class="n">c</span>    <span class="n">float64</span>
<span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>
</pre></div>
</div>
<p>::: tip 注意</p>
<p>用 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.astype.html#pandas.DataFrame.astype"><code class="docutils literal notranslate"><span class="pre">astype()</span></code></a> 与 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.loc.html#pandas.DataFrame.loc"><code class="docutils literal notranslate"><span class="pre">loc()</span></code></a> 为部分列转换指定类型时，会发生向上转型。</p>
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.loc.html#pandas.DataFrame.loc"><code class="docutils literal notranslate"><span class="pre">loc()</span></code></a> 尝试分配当前的数据类型，而 <code class="docutils literal notranslate"><span class="pre">[]</span></code> 则会从右方获取数据类型并进行覆盖。因此，下列代码会产出意料之外的结果：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">360</span><span class="p">]:</span> <span class="n">dft</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]})</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">361</span><span class="p">]:</span> <span class="n">dft</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span><span class="o">.</span><span class="n">dtypes</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">361</span><span class="p">]:</span> 
<span class="n">a</span>    <span class="n">uint8</span>
<span class="n">b</span>    <span class="n">uint8</span>
<span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">362</span><span class="p">]:</span> <span class="n">dft</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">dft</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">363</span><span class="p">]:</span> <span class="n">dft</span><span class="o">.</span><span class="n">dtypes</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">363</span><span class="p">]:</span> 
<span class="n">a</span>    <span class="n">int64</span>
<span class="n">b</span>    <span class="n">int64</span>
<span class="n">c</span>    <span class="n">int64</span>
<span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>
</pre></div>
</div>
<p>:::</p>
</div>
<div class="section" id="id40">
<h3>对象转换<a class="headerlink" href="#id40" title="永久链接至标题">¶</a></h3>
<p>Pandas 提供了多种函数可以把 <code class="docutils literal notranslate"><span class="pre">object</span></code> 从一种类型强制转为另一种类型。这是因为，数据有时存储的是正确类型，但在保存时却存成了 <code class="docutils literal notranslate"><span class="pre">object</span></code> 类型，此时，用 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.infer_objects.html#pandas.DataFrame.infer_objects"><code class="docutils literal notranslate"><span class="pre">DataFrame.infer_objects()</span></code></a> 与 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.infer_objects.html#pandas.Series.infer_objects"><code class="docutils literal notranslate"><span class="pre">Series.infer_objects()</span></code></a> 方法即可把数据<strong>软</strong>转换为正确的类型。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">364</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">datetime</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">365</span><span class="p">]:</span> <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
   <span class="o">.....</span><span class="p">:</span>                    <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">],</span>
   <span class="o">.....</span><span class="p">:</span>                    <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2016</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
   <span class="o">.....</span><span class="p">:</span>                     <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2016</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]])</span>
   <span class="o">.....</span><span class="p">:</span> 

<span class="n">In</span> <span class="p">[</span><span class="mi">366</span><span class="p">]:</span> <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">T</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">367</span><span class="p">]:</span> <span class="n">df</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">367</span><span class="p">]:</span> 
   <span class="mi">0</span>  <span class="mi">1</span>          <span class="mi">2</span>
<span class="mi">0</span>  <span class="mi">1</span>  <span class="n">a</span> <span class="mi">2016</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">02</span>
<span class="mi">1</span>  <span class="mi">2</span>  <span class="n">b</span> <span class="mi">2016</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">02</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">368</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">dtypes</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">368</span><span class="p">]:</span> 
<span class="mi">0</span>            <span class="nb">object</span>
<span class="mi">1</span>            <span class="nb">object</span>
<span class="mi">2</span>    <span class="n">datetime64</span><span class="p">[</span><span class="n">ns</span><span class="p">]</span>
<span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>
</pre></div>
</div>
<p>因为数据被转置，所以把原始列的数据类型改成了 <code class="docutils literal notranslate"><span class="pre">object</span></code>，但使用 <code class="docutils literal notranslate"><span class="pre">infer_objects</span></code> 后就变正确了。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">369</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">infer_objects</span><span class="p">()</span><span class="o">.</span><span class="n">dtypes</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">369</span><span class="p">]:</span> 
<span class="mi">0</span>             <span class="n">int64</span>
<span class="mi">1</span>            <span class="nb">object</span>
<span class="mi">2</span>    <span class="n">datetime64</span><span class="p">[</span><span class="n">ns</span><span class="p">]</span>
<span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>
</pre></div>
</div>
<p>下列函数可以应用于一维数组与标量，执行硬转换，把对象转换为指定类型。</p>
<ul class="simple">
<li><p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.to_numeric.html#pandas.to_numeric"><code class="docutils literal notranslate"><span class="pre">to_numeric()</span></code></a>，转换为数值型</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">370</span><span class="p">]:</span> <span class="n">m</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;1.1&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">371</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">371</span><span class="p">]:</span> <span class="n">array</span><span class="p">([</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">2.</span> <span class="p">,</span> <span class="mf">3.</span> <span class="p">])</span>
</pre></div>
</div>
<ul class="simple">
<li><p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.to_datetime.html#pandas.to_datetime"><code class="docutils literal notranslate"><span class="pre">to_datetime()</span></code></a>，转换为 <code class="docutils literal notranslate"><span class="pre">datetime</span></code> 对象</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">372</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">datetime</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">373</span><span class="p">]:</span> <span class="n">m</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;2016-07-09&#39;</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2016</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">374</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">374</span><span class="p">]:</span> <span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2016-07-09&#39;</span><span class="p">,</span> <span class="s1">&#39;2016-03-02&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.to_timedelta.html#pandas.to_timedelta"><code class="docutils literal notranslate"><span class="pre">to_timedelta()</span></code></a>，转换为 <code class="docutils literal notranslate"><span class="pre">timedelta</span></code> 对象。</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">375</span><span class="p">]:</span> <span class="n">m</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;5us&#39;</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="s1">&#39;1day&#39;</span><span class="p">)]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">376</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">376</span><span class="p">]:</span> <span class="n">TimedeltaIndex</span><span class="p">([</span><span class="s1">&#39;0 days 00:00:00.000005&#39;</span><span class="p">,</span> <span class="s1">&#39;1 days 00:00:00&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;timedelta64[ns]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<p>如需强制转换，则要加入 <code class="docutils literal notranslate"><span class="pre">error</span></code> 参数，指定 Pandas 怎样处理不能转换为成预期类型或对象的数据。<code class="docutils literal notranslate"><span class="pre">errors</span></code> 参数的默认值为 <code class="docutils literal notranslate"><span class="pre">False</span></code>，指的是在转换过程中，遇到任何问题都触发错误。设置为 <code class="docutils literal notranslate"><span class="pre">errors='coerce'</span></code> 时，pandas 会忽略错误，强制把问题数据转换为 <code class="docutils literal notranslate"><span class="pre">pd.NaT</span></code>（<code class="docutils literal notranslate"><span class="pre">datetime</span></code> 与 <code class="docutils literal notranslate"><span class="pre">timedelta</span></code>），或 <code class="docutils literal notranslate"><span class="pre">np.nan</span></code>（数值型）。读取数据时，如果大部分要转换的数据是数值型或 <code class="docutils literal notranslate"><span class="pre">datetime</span></code>，这种操作非常有用，但偶尔也会有非制式数据混合在一起，可能会导致展示数据缺失：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">377</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">datetime</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">378</span><span class="p">]:</span> <span class="n">m</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;apple&#39;</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2016</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">379</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">379</span><span class="p">]:</span> <span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;NaT&#39;</span><span class="p">,</span> <span class="s1">&#39;2016-03-02&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">380</span><span class="p">]:</span> <span class="n">m</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;apple&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">381</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">381</span><span class="p">]:</span> <span class="n">array</span><span class="p">([</span><span class="n">nan</span><span class="p">,</span>  <span class="mf">2.</span><span class="p">,</span>  <span class="mf">3.</span><span class="p">])</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">382</span><span class="p">]:</span> <span class="n">m</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;apple&#39;</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="s1">&#39;1day&#39;</span><span class="p">)]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">383</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">383</span><span class="p">]:</span> <span class="n">TimedeltaIndex</span><span class="p">([</span><span class="n">NaT</span><span class="p">,</span> <span class="s1">&#39;1 days&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;timedelta64[ns]&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">error</span></code> 参数还有第三个选项，<code class="docutils literal notranslate"><span class="pre">error='ignore'</span></code>。转换数据时会忽略错误，直接输出问题数据：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">384</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">datetime</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">385</span><span class="p">]:</span> <span class="n">m</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;apple&#39;</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2016</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">386</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">386</span><span class="p">]:</span> <span class="n">Index</span><span class="p">([</span><span class="s1">&#39;apple&#39;</span><span class="p">,</span> <span class="mi">2016</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">02</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;object&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">387</span><span class="p">]:</span> <span class="n">m</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;apple&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">388</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">388</span><span class="p">]:</span> <span class="n">array</span><span class="p">([</span><span class="s1">&#39;apple&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">389</span><span class="p">]:</span> <span class="n">m</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;apple&#39;</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="s1">&#39;1day&#39;</span><span class="p">)]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">390</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">390</span><span class="p">]:</span> <span class="n">array</span><span class="p">([</span><span class="s1">&#39;apple&#39;</span><span class="p">,</span> <span class="n">Timedelta</span><span class="p">(</span><span class="s1">&#39;1 days 00:00:00&#39;</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
</pre></div>
</div>
<p>执行转换操作时，<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.to_numeric.html#pandas.to_numeric"><code class="docutils literal notranslate"><span class="pre">to_numeric()</span></code></a> 还有一个参数，<code class="docutils literal notranslate"><span class="pre">downcast</span></code>，即向下转型，可以把数值型转换为减少内存占用的数据类型：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">391</span><span class="p">]:</span> <span class="n">m</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">392</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">downcast</span><span class="o">=</span><span class="s1">&#39;integer&#39;</span><span class="p">)</span>   <span class="c1"># smallest signed int dtype</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">392</span><span class="p">]:</span> <span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">int8</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">393</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">downcast</span><span class="o">=</span><span class="s1">&#39;signed&#39;</span><span class="p">)</span>    <span class="c1"># same as &#39;integer&#39;</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">393</span><span class="p">]:</span> <span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">int8</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">394</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">downcast</span><span class="o">=</span><span class="s1">&#39;unsigned&#39;</span><span class="p">)</span>  <span class="c1"># smallest unsigned int dtype</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">394</span><span class="p">]:</span> <span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">uint8</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">395</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">downcast</span><span class="o">=</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>     <span class="c1"># smallest float dtype</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">395</span><span class="p">]:</span> <span class="n">array</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">float32</span><span class="p">)</span>
</pre></div>
</div>
<p>上述方法仅能应用于一维数组、列表或标量；不能直接用于 DataFrame 等多维对象。不过，用 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.apply.html#pandas.DataFrame.apply"><code class="docutils literal notranslate"><span class="pre">apply()</span></code></a>，可以快速为每列应用函数：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">396</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">datetime</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">397</span><span class="p">]:</span> <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span>
   <span class="o">.....</span><span class="p">:</span>     <span class="p">[</span><span class="s1">&#39;2016-07-09&#39;</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2016</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;O&#39;</span><span class="p">)</span>
   <span class="o">.....</span><span class="p">:</span> 

<span class="n">In</span> <span class="p">[</span><span class="mi">398</span><span class="p">]:</span> <span class="n">df</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">398</span><span class="p">]:</span> 
            <span class="mi">0</span>                    <span class="mi">1</span>
<span class="mi">0</span>  <span class="mi">2016</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">09</span>  <span class="mi">2016</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">02</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>
<span class="mi">1</span>  <span class="mi">2016</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">09</span>  <span class="mi">2016</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">02</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">399</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">399</span><span class="p">]:</span> 
           <span class="mi">0</span>          <span class="mi">1</span>
<span class="mi">0</span> <span class="mi">2016</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">09</span> <span class="mi">2016</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">02</span>
<span class="mi">1</span> <span class="mi">2016</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">09</span> <span class="mi">2016</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">02</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">400</span><span class="p">]:</span> <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="s1">&#39;1.1&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;O&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">401</span><span class="p">]:</span> <span class="n">df</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">401</span><span class="p">]:</span> 
     <span class="mi">0</span>  <span class="mi">1</span>  <span class="mi">2</span>
<span class="mi">0</span>  <span class="mf">1.1</span>  <span class="mi">2</span>  <span class="mi">3</span>
<span class="mi">1</span>  <span class="mf">1.1</span>  <span class="mi">2</span>  <span class="mi">3</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">402</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">402</span><span class="p">]:</span> 
     <span class="mi">0</span>  <span class="mi">1</span>  <span class="mi">2</span>
<span class="mi">0</span>  <span class="mf">1.1</span>  <span class="mi">2</span>  <span class="mi">3</span>
<span class="mi">1</span>  <span class="mf">1.1</span>  <span class="mi">2</span>  <span class="mi">3</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">403</span><span class="p">]:</span> <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="s1">&#39;5us&#39;</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="s1">&#39;1day&#39;</span><span class="p">)]]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;O&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">404</span><span class="p">]:</span> <span class="n">df</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">404</span><span class="p">]:</span> 
     <span class="mi">0</span>                <span class="mi">1</span>
<span class="mi">0</span>  <span class="mi">5</span><span class="n">us</span>  <span class="mi">1</span> <span class="n">days</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>
<span class="mi">1</span>  <span class="mi">5</span><span class="n">us</span>  <span class="mi">1</span> <span class="n">days</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">405</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">405</span><span class="p">]:</span> 
                <span class="mi">0</span>      <span class="mi">1</span>
<span class="mi">0</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.000005</span> <span class="mi">1</span> <span class="n">days</span>
<span class="mi">1</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.000005</span> <span class="mi">1</span> <span class="n">days</span>
</pre></div>
</div>
</div>
<div class="section" id="id41">
<h3>各种坑<a class="headerlink" href="#id41" title="永久链接至标题">¶</a></h3>
<p>对 <code class="docutils literal notranslate"><span class="pre">integer</span></code> 数据执行选择操作时，可以很轻而易举地把数据转换为 <code class="docutils literal notranslate"><span class="pre">floating</span></code> 。Pandas 会保存输入数据的数据类型，以防未引入 <code class="docutils literal notranslate"><span class="pre">nans</span></code> 的情况。参阅 <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/gotchas.html#gotchas-intna">对整数 NA 空值的支持</a>。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">406</span><span class="p">]:</span> <span class="n">dfi</span> <span class="o">=</span> <span class="n">df3</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int32&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">407</span><span class="p">]:</span> <span class="n">dfi</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">408</span><span class="p">]:</span> <span class="n">dfi</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">408</span><span class="p">]:</span> 
   <span class="n">A</span>  <span class="n">B</span>    <span class="n">C</span>  <span class="n">E</span>
<span class="mi">0</span>  <span class="mi">1</span>  <span class="mi">0</span>    <span class="mi">0</span>  <span class="mi">1</span>
<span class="mi">1</span>  <span class="mi">3</span>  <span class="mi">1</span>    <span class="mi">0</span>  <span class="mi">1</span>
<span class="mi">2</span>  <span class="mi">0</span>  <span class="mi">0</span>  <span class="mi">255</span>  <span class="mi">1</span>
<span class="mi">3</span>  <span class="mi">0</span>  <span class="mi">1</span>    <span class="mi">0</span>  <span class="mi">1</span>
<span class="mi">4</span> <span class="o">-</span><span class="mi">1</span> <span class="o">-</span><span class="mi">1</span>    <span class="mi">0</span>  <span class="mi">1</span>
<span class="mi">5</span>  <span class="mi">1</span>  <span class="mi">0</span>    <span class="mi">0</span>  <span class="mi">1</span>
<span class="mi">6</span>  <span class="mi">0</span> <span class="o">-</span><span class="mi">1</span>    <span class="mi">1</span>  <span class="mi">1</span>
<span class="mi">7</span>  <span class="mi">0</span>  <span class="mi">0</span>    <span class="mi">0</span>  <span class="mi">1</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">409</span><span class="p">]:</span> <span class="n">dfi</span><span class="o">.</span><span class="n">dtypes</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">409</span><span class="p">]:</span> 
<span class="n">A</span>    <span class="n">int32</span>
<span class="n">B</span>    <span class="n">int32</span>
<span class="n">C</span>    <span class="n">int32</span>
<span class="n">E</span>    <span class="n">int64</span>
<span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">410</span><span class="p">]:</span> <span class="n">casted</span> <span class="o">=</span> <span class="n">dfi</span><span class="p">[</span><span class="n">dfi</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">411</span><span class="p">]:</span> <span class="n">casted</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">411</span><span class="p">]:</span> 
     <span class="n">A</span>    <span class="n">B</span>      <span class="n">C</span>  <span class="n">E</span>
<span class="mi">0</span>  <span class="mf">1.0</span>  <span class="n">NaN</span>    <span class="n">NaN</span>  <span class="mi">1</span>
<span class="mi">1</span>  <span class="mf">3.0</span>  <span class="mf">1.0</span>    <span class="n">NaN</span>  <span class="mi">1</span>
<span class="mi">2</span>  <span class="n">NaN</span>  <span class="n">NaN</span>  <span class="mf">255.0</span>  <span class="mi">1</span>
<span class="mi">3</span>  <span class="n">NaN</span>  <span class="mf">1.0</span>    <span class="n">NaN</span>  <span class="mi">1</span>
<span class="mi">4</span>  <span class="n">NaN</span>  <span class="n">NaN</span>    <span class="n">NaN</span>  <span class="mi">1</span>
<span class="mi">5</span>  <span class="mf">1.0</span>  <span class="n">NaN</span>    <span class="n">NaN</span>  <span class="mi">1</span>
<span class="mi">6</span>  <span class="n">NaN</span>  <span class="n">NaN</span>    <span class="mf">1.0</span>  <span class="mi">1</span>
<span class="mi">7</span>  <span class="n">NaN</span>  <span class="n">NaN</span>    <span class="n">NaN</span>  <span class="mi">1</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">412</span><span class="p">]:</span> <span class="n">casted</span><span class="o">.</span><span class="n">dtypes</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">412</span><span class="p">]:</span> 
<span class="n">A</span>    <span class="n">float64</span>
<span class="n">B</span>    <span class="n">float64</span>
<span class="n">C</span>    <span class="n">float64</span>
<span class="n">E</span>      <span class="n">int64</span>
<span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>
</pre></div>
</div>
<p>浮点数类型未改变。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">413</span><span class="p">]:</span> <span class="n">dfa</span> <span class="o">=</span> <span class="n">df3</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">414</span><span class="p">]:</span> <span class="n">dfa</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dfa</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">415</span><span class="p">]:</span> <span class="n">dfa</span><span class="o">.</span><span class="n">dtypes</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">415</span><span class="p">]:</span> 
<span class="n">A</span>    <span class="n">float32</span>
<span class="n">B</span>    <span class="n">float64</span>
<span class="n">C</span>    <span class="n">float64</span>
<span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">416</span><span class="p">]:</span> <span class="n">casted</span> <span class="o">=</span> <span class="n">dfa</span><span class="p">[</span><span class="n">df2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">417</span><span class="p">]:</span> <span class="n">casted</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">417</span><span class="p">]:</span> 
          <span class="n">A</span>         <span class="n">B</span>      <span class="n">C</span>
<span class="mi">0</span>  <span class="mf">1.047606</span>  <span class="mf">0.256090</span>    <span class="n">NaN</span>
<span class="mi">1</span>  <span class="mf">3.497968</span>  <span class="mf">1.426469</span>    <span class="n">NaN</span>
<span class="mi">2</span>       <span class="n">NaN</span>       <span class="n">NaN</span>  <span class="mf">255.0</span>
<span class="mi">3</span>       <span class="n">NaN</span>  <span class="mf">1.139976</span>    <span class="n">NaN</span>
<span class="mi">4</span>       <span class="n">NaN</span>       <span class="n">NaN</span>    <span class="n">NaN</span>
<span class="mi">5</span>  <span class="mf">1.346426</span>  <span class="mf">0.096706</span>    <span class="n">NaN</span>
<span class="mi">6</span>       <span class="n">NaN</span>       <span class="n">NaN</span>    <span class="mf">1.0</span>
<span class="mi">7</span>       <span class="n">NaN</span>       <span class="n">NaN</span>    <span class="n">NaN</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">418</span><span class="p">]:</span> <span class="n">casted</span><span class="o">.</span><span class="n">dtypes</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">418</span><span class="p">]:</span> 
<span class="n">A</span>    <span class="n">float32</span>
<span class="n">B</span>    <span class="n">float64</span>
<span class="n">C</span>    <span class="n">float64</span>
<span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id42">
<h2><span class="section-number">2.14. </span>基于 <code class="docutils literal notranslate"><span class="pre">dtype</span></code> 选择列<a class="headerlink" href="#id42" title="永久链接至标题">¶</a></h2>
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.select_dtypes.html#pandas.DataFrame.select_dtypes"><code class="docutils literal notranslate"><span class="pre">select_dtypes()</span></code></a> 方法基于 <code class="docutils literal notranslate"><span class="pre">dtype</span></code> 选择列。</p>
<p>首先，创建一个由多种数据类型组成的 DataFrame：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">419</span><span class="p">]:</span> <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;string&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="s1">&#39;abc&#39;</span><span class="p">),</span>
   <span class="o">.....</span><span class="p">:</span>                    <span class="s1">&#39;int64&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)),</span>
   <span class="o">.....</span><span class="p">:</span>                    <span class="s1">&#39;uint8&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;u1&#39;</span><span class="p">),</span>
   <span class="o">.....</span><span class="p">:</span>                    <span class="s1">&#39;float64&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">),</span>
   <span class="o">.....</span><span class="p">:</span>                    <span class="s1">&#39;bool1&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">],</span>
   <span class="o">.....</span><span class="p">:</span>                    <span class="s1">&#39;bool2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span>
   <span class="o">.....</span><span class="p">:</span>                    <span class="s1">&#39;dates&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;now&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
   <span class="o">.....</span><span class="p">:</span>                    <span class="s1">&#39;category&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="s2">&quot;ABC&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)})</span>
   <span class="o">.....</span><span class="p">:</span> 

<span class="n">In</span> <span class="p">[</span><span class="mi">420</span><span class="p">]:</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;tdeltas&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">421</span><span class="p">]:</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;uint64&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;u8&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">422</span><span class="p">]:</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;other_dates&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;20130101&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">423</span><span class="p">]:</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;tz_aware_dates&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;20130101&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s1">&#39;US/Eastern&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">424</span><span class="p">]:</span> <span class="n">df</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">424</span><span class="p">]:</span> 
  <span class="n">string</span>  <span class="n">int64</span>  <span class="n">uint8</span>  <span class="n">float64</span>  <span class="n">bool1</span>  <span class="n">bool2</span>                      <span class="n">dates</span> <span class="n">category</span> <span class="n">tdeltas</span>  <span class="n">uint64</span> <span class="n">other_dates</span>            <span class="n">tz_aware_dates</span>
<span class="mi">0</span>      <span class="n">a</span>      <span class="mi">1</span>      <span class="mi">3</span>      <span class="mf">4.0</span>   <span class="kc">True</span>  <span class="kc">False</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">22</span> <span class="mi">15</span><span class="p">:</span><span class="mi">49</span><span class="p">:</span><span class="mf">01.870038</span>        <span class="n">A</span>     <span class="n">NaT</span>       <span class="mi">3</span>  <span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="o">-</span><span class="mi">05</span><span class="p">:</span><span class="mi">00</span>
<span class="mi">1</span>      <span class="n">b</span>      <span class="mi">2</span>      <span class="mi">4</span>      <span class="mf">5.0</span>  <span class="kc">False</span>   <span class="kc">True</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">23</span> <span class="mi">15</span><span class="p">:</span><span class="mi">49</span><span class="p">:</span><span class="mf">01.870038</span>        <span class="n">B</span>  <span class="mi">1</span> <span class="n">days</span>       <span class="mi">4</span>  <span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span> <span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="o">-</span><span class="mi">05</span><span class="p">:</span><span class="mi">00</span>
<span class="mi">2</span>      <span class="n">c</span>      <span class="mi">3</span>      <span class="mi">5</span>      <span class="mf">6.0</span>   <span class="kc">True</span>  <span class="kc">False</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">24</span> <span class="mi">15</span><span class="p">:</span><span class="mi">49</span><span class="p">:</span><span class="mf">01.870038</span>        <span class="n">C</span>  <span class="mi">1</span> <span class="n">days</span>       <span class="mi">5</span>  <span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span> <span class="mi">2013</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="o">-</span><span class="mi">05</span><span class="p">:</span><span class="mi">00</span>
</pre></div>
</div>
<p>该 DataFrame 的数据类型：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">425</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">dtypes</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">425</span><span class="p">]:</span> 
<span class="n">string</span>                                <span class="nb">object</span>
<span class="n">int64</span>                                  <span class="n">int64</span>
<span class="n">uint8</span>                                  <span class="n">uint8</span>
<span class="n">float64</span>                              <span class="n">float64</span>
<span class="n">bool1</span>                                   <span class="nb">bool</span>
<span class="n">bool2</span>                                   <span class="nb">bool</span>
<span class="n">dates</span>                         <span class="n">datetime64</span><span class="p">[</span><span class="n">ns</span><span class="p">]</span>
<span class="n">category</span>                            <span class="n">category</span>
<span class="n">tdeltas</span>                      <span class="n">timedelta64</span><span class="p">[</span><span class="n">ns</span><span class="p">]</span>
<span class="n">uint64</span>                                <span class="n">uint64</span>
<span class="n">other_dates</span>                   <span class="n">datetime64</span><span class="p">[</span><span class="n">ns</span><span class="p">]</span>
<span class="n">tz_aware_dates</span>    <span class="n">datetime64</span><span class="p">[</span><span class="n">ns</span><span class="p">,</span> <span class="n">US</span><span class="o">/</span><span class="n">Eastern</span><span class="p">]</span>
<span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>
</pre></div>
</div>
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.select_dtypes.html#pandas.DataFrame.select_dtypes"><code class="docutils literal notranslate"><span class="pre">select_dtypes()</span></code></a> 有两个参数，<code class="docutils literal notranslate"><span class="pre">include</span></code> 与 <code class="docutils literal notranslate"><span class="pre">exclude</span></code>，用于实现“提取这些数据类型的列” （<code class="docutils literal notranslate"><span class="pre">include</span></code>）或 “提取不是这些数据类型的列”（<code class="docutils literal notranslate"><span class="pre">exclude</span></code>）。</p>
<p>选择 <code class="docutils literal notranslate"><span class="pre">bool</span></code> 型的列，示例如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">426</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="nb">bool</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">426</span><span class="p">]:</span> 
   <span class="n">bool1</span>  <span class="n">bool2</span>
<span class="mi">0</span>   <span class="kc">True</span>  <span class="kc">False</span>
<span class="mi">1</span>  <span class="kc">False</span>   <span class="kc">True</span>
<span class="mi">2</span>   <span class="kc">True</span>  <span class="kc">False</span>
</pre></div>
</div>
<p>该方法还支持输入 <a class="reference external" href="https://docs.scipy.org/doc/numpy/reference/arrays.scalars.html">NumPy 数据类型</a>的名称：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">427</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;bool&#39;</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">427</span><span class="p">]:</span> 
   <span class="n">bool1</span>  <span class="n">bool2</span>
<span class="mi">0</span>   <span class="kc">True</span>  <span class="kc">False</span>
<span class="mi">1</span>  <span class="kc">False</span>   <span class="kc">True</span>
<span class="mi">2</span>   <span class="kc">True</span>  <span class="kc">False</span>
</pre></div>
</div>
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.select_dtypes.html#pandas.DataFrame.select_dtypes"><code class="docutils literal notranslate"><span class="pre">select_dtypes()</span></code></a> 还支持通用数据类型。</p>
<p>比如，选择所有数值型与布尔型的列，同时，排除无符号整数：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">428</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;number&#39;</span><span class="p">,</span> <span class="s1">&#39;bool&#39;</span><span class="p">],</span> <span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;unsignedinteger&#39;</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">428</span><span class="p">]:</span> 
   <span class="n">int64</span>  <span class="n">float64</span>  <span class="n">bool1</span>  <span class="n">bool2</span> <span class="n">tdeltas</span>
<span class="mi">0</span>      <span class="mi">1</span>      <span class="mf">4.0</span>   <span class="kc">True</span>  <span class="kc">False</span>     <span class="n">NaT</span>
<span class="mi">1</span>      <span class="mi">2</span>      <span class="mf">5.0</span>  <span class="kc">False</span>   <span class="kc">True</span>  <span class="mi">1</span> <span class="n">days</span>
<span class="mi">2</span>      <span class="mi">3</span>      <span class="mf">6.0</span>   <span class="kc">True</span>  <span class="kc">False</span>  <span class="mi">1</span> <span class="n">days</span>
</pre></div>
</div>
<p>选择字符串型的列必须要用 <code class="docutils literal notranslate"><span class="pre">object</span></code>：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">429</span><span class="p">]:</span> <span class="n">df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;object&#39;</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">429</span><span class="p">]:</span> 
  <span class="n">string</span>
<span class="mi">0</span>      <span class="n">a</span>
<span class="mi">1</span>      <span class="n">b</span>
<span class="mi">2</span>      <span class="n">c</span>
</pre></div>
</div>
<p>要查看 <code class="docutils literal notranslate"><span class="pre">numpy.number</span></code> 等通用 <code class="docutils literal notranslate"><span class="pre">dtype</span></code> 的所有子类型，可以定义一个函数，返回子类型树：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">430</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">subdtypes</span><span class="p">(</span><span class="n">dtype</span><span class="p">):</span>
   <span class="o">.....</span><span class="p">:</span>     <span class="n">subs</span> <span class="o">=</span> <span class="n">dtype</span><span class="o">.</span><span class="n">__subclasses__</span><span class="p">()</span>
   <span class="o">.....</span><span class="p">:</span>     <span class="k">if</span> <span class="ow">not</span> <span class="n">subs</span><span class="p">:</span>
   <span class="o">.....</span><span class="p">:</span>         <span class="k">return</span> <span class="n">dtype</span>
   <span class="o">.....</span><span class="p">:</span>     <span class="k">return</span> <span class="p">[</span><span class="n">dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">subdtypes</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span> <span class="k">for</span> <span class="n">dt</span> <span class="ow">in</span> <span class="n">subs</span><span class="p">]]</span>
   <span class="o">.....</span><span class="p">:</span> 
</pre></div>
</div>
<p>所有 NumPy 数据类型都是 <code class="docutils literal notranslate"><span class="pre">numpy.generic</span></code> 的子类：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">431</span><span class="p">]:</span> <span class="n">subdtypes</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">generic</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">431</span><span class="p">]:</span> 
<span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">generic</span><span class="p">,</span>
 <span class="p">[[</span><span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">,</span>
   <span class="p">[[</span><span class="n">numpy</span><span class="o">.</span><span class="n">integer</span><span class="p">,</span>
     <span class="p">[[</span><span class="n">numpy</span><span class="o">.</span><span class="n">signedinteger</span><span class="p">,</span>
       <span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">int8</span><span class="p">,</span>
        <span class="n">numpy</span><span class="o">.</span><span class="n">int16</span><span class="p">,</span>
        <span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span>
        <span class="n">numpy</span><span class="o">.</span><span class="n">int64</span><span class="p">,</span>
        <span class="n">numpy</span><span class="o">.</span><span class="n">int64</span><span class="p">,</span>
        <span class="n">numpy</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">]],</span>
      <span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">unsignedinteger</span><span class="p">,</span>
       <span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">uint8</span><span class="p">,</span>
        <span class="n">numpy</span><span class="o">.</span><span class="n">uint16</span><span class="p">,</span>
        <span class="n">numpy</span><span class="o">.</span><span class="n">uint32</span><span class="p">,</span>
        <span class="n">numpy</span><span class="o">.</span><span class="n">uint64</span><span class="p">,</span>
        <span class="n">numpy</span><span class="o">.</span><span class="n">uint64</span><span class="p">]]]],</span>
    <span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">inexact</span><span class="p">,</span>
     <span class="p">[[</span><span class="n">numpy</span><span class="o">.</span><span class="n">floating</span><span class="p">,</span>
       <span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">float16</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">float128</span><span class="p">]],</span>
      <span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">complexfloating</span><span class="p">,</span>
       <span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">complex64</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">complex128</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">complex256</span><span class="p">]]]]]],</span>
  <span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">flexible</span><span class="p">,</span>
   <span class="p">[[</span><span class="n">numpy</span><span class="o">.</span><span class="n">character</span><span class="p">,</span> <span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">bytes_</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">str_</span><span class="p">]],</span>
    <span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">void</span><span class="p">,</span> <span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">record</span><span class="p">]]]],</span>
  <span class="n">numpy</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span>
  <span class="n">numpy</span><span class="o">.</span><span class="n">datetime64</span><span class="p">,</span>
  <span class="n">numpy</span><span class="o">.</span><span class="n">object_</span><span class="p">]]</span>
</pre></div>
</div>
<p><strong>tip 注意: Pandas 支持 <code class="docutils literal notranslate"><span class="pre">category</span></code> 与 <code class="docutils literal notranslate"><span class="pre">datetime64[ns,</span> <span class="pre">tz]</span></code> 类型，但这两种类型未整合到 NumPy 架构，因此，上面的函数没有显示。</strong></p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="pandas-02.html" class="btn btn-neutral float-right" title="3. Pandas 25 式" accesskey="n" rel="next">下一页 <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="pandas-00.html" class="btn btn-neutral float-left" title="1. Pandas 概览" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> 上一页</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; 版权所有 2019–2020, AkShare developers

    </p>
  </div>
    
    
    
    利用 <a href="http://sphinx-doc.org/">Sphinx</a> 构建，使用了 
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">主题</a>
    
    由 <a href="https://readthedocs.org">Read the Docs</a>开发. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  
 
<script type="text/javascript">
!function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t){var e=document.createElement("script");e.type="text/javascript";e.async=!0;e.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)};analytics.SNIPPET_VERSION="3.1.0";
analytics.load("8UDQfnf3cyFSTsM4YANnW5sXmgZVILbA");
analytics.page();
}}();

analytics.ready(function () {
    ga('require', 'linker');
    ga('linker:autoLink', ['scrapinghub.com', 'crawlera.com']);
});
</script>


</body>
</html>