

<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>3. Pandas 25 式 &mdash; AkShare 1.0.0 文档</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script src="../../_static/translations.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="搜索" href="../../search.html" />
    <link rel="next" title="4. Pandas 10大新功能" href="pandas-03.html" />
    <link rel="prev" title="2. Pandas 基础用法" href="pandas-01.html" />
    <meta name="referrer" content="no-referrer"/>
     

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> AkShare
          

          
          </a>

          
            
            
              <div class="version">
                1.0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="在文档中搜索" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">AkShare 概览</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">AkShare 安装指导</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributor.html">AkShare 贡献源码</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../answer.html">AkShare 答疑专栏</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial.html">AkShare 快速入门</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../data/index.html">AkShare 数据字典</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../anaconda.html">AkShare 环境配置</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../special.html">AkShare 特别说明</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../strategy.html">AkShare 量化策略</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../platform.html">AkShare 量化平台</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">AkShare 专题教程</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../anaconda/index.html">Anaconda 教程</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Pandas 教程</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="pandas-00.html">1. Pandas 概览</a></li>
<li class="toctree-l3"><a class="reference internal" href="pandas-01.html">2. Pandas 基础用法</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">3. Pandas 25 式</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id1">3.1. 使用的数据集</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pandas">3.2. 查看 pandas 及其支持项的版本</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dataframe">3.3. 创建 DataFrame</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id2">3.4. 重命名列</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id3">3.5. 反转列序</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id4">3.6. 反转列序</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id5">3.7. 按数据类型选择列</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id6">3.8. 把字符串转换为数值</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id7">3.9. 优化 DataFrame 对内存的占用</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id8">3.10. 用多个文件建立 DataFrame ~ 按行</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id9">3.11. 用多个文件建立 DataFrame ~ 按列</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id10">3.12. 从剪贴板创建 DataFrame</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id11">3.13. 把 DataFrame 分割为两个随机子集</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id12">3.14. 根据多个类别筛选 DataFrame</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id13">3.15. 根据最大的类别筛选 DataFrame</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id14">3.16. 处理缺失值</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id15">3.17. 把字符串分割为多列</a></li>
<li class="toctree-l4"><a class="reference internal" href="#series-dataframe">3.18. 把 Series 里的列表转换为 DataFrame</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id16">3.19. 用多个函数聚合</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id17">3.20. 用一个 DataFrame 合并聚合的输出结果</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id18">3.21. 选择行与列</a></li>
<li class="toctree-l4"><a class="reference internal" href="#series">3.22. 重塑多重索引 Series</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id19">3.23. 创建透视表</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id20">3.24. 把连续型数据转换为类型数据</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id21">3.25. 改变显示选项</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id22">3.26. 设置 DataFrame 样式</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id23">3.27. 彩蛋：预览 DataFrame</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="pandas-03.html">4. Pandas 10大新功能</a></li>
<li class="toctree-l3"><a class="reference internal" href="pandas-04.html">5. Pandas 数据结构</a></li>
<li class="toctree-l3"><a class="reference internal" href="pandas-05.html">6. 时间序列与日期用法</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../demo.html">AkShare 策略示例</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">AkShare 版本更新</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">AkShare</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">AkShare 专题教程</a> &raquo;</li>
        
          <li><a href="index.html">Pandas 教程</a> &raquo;</li>
        
      <li><span class="section-number">3. </span>Pandas 25 式</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/topic/pandas/pandas-02.md.txt" rel="nofollow"> 查看页面源码</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="pandas-25">
<h1><span class="section-number">3. </span>Pandas 25 式<a class="headerlink" href="#pandas-25" title="永久链接至标题">¶</a></h1>
<p>Kevin Markham，数据科学讲师，2002 年，毕业于范德堡大学，计算机工程学士，2014 年，创建了 Data School，在线教授 Python 数据科学课程，他的课程主要包括 Pandas、Scikit-learn、Kaggle 竞赛数据科学、机器学习、自然语言处理等内容，迄今为止，浏览量在油管上已经超过 500 万次。</p>
<p><img alt="Kevin Markham" src="https://upload-images.jianshu.io/upload_images/3240514-af20f82be79a1e87.png" /></p>
<p>Kevin 还是 PyCon 培训讲师，主要培训课程如下：</p>
<ul class="simple">
<li><p>PyCon 2016，用 Scikit-learn 机器学习技术处理文本</p></li>
<li><p>PyCon 2018，如何用 Pandas 更好（或更糟）地实现数据科学</p></li>
<li><p>PyCon 2019，Pandas 数据科学最佳实践</p></li>
</ul>
<p>本文基于 Kevin 于 2019 年 7 月推出的最新视频教程，汇总了他 5 年来最喜欢的 25 个 pandas 操作技巧，希望大家喜欢。</p>
<p><img alt="Data School" src="https://upload-images.jianshu.io/upload_images/3240514-c54dfa4e7530f806.png" /></p>
<p><strong>目录</strong></p>
<ol class="simple">
<li><p>查看 pandas 及其支持项的版本</p></li>
<li><p>创建 DataFrame</p></li>
<li><p>重命名列</p></li>
<li><p>反转行序</p></li>
<li><p>反转列序</p></li>
<li><p>按数据类型选择列</p></li>
<li><p>把字符串转换为数值</p></li>
<li><p>优化 DataFrame 大小</p></li>
<li><p>用多个文件建立 DataFrame ~ 按行</p></li>
<li><p>用多个文件建立 DataFrame ~ 按列</p></li>
<li><p>从剪贴板创建 DataFrame</p></li>
<li><p>把 DataFrame 分割为两个随机子集</p></li>
<li><p>根据多个类别筛选 DataFrame</p></li>
<li><p>根据最大的类别筛选 DataFrame</p></li>
<li><p>操控缺失值</p></li>
<li><p>把字符串分割为多列</p></li>
<li><p>把 Series 里的列表转换为 DataFrame</p></li>
<li><p>用多个函数聚合</p></li>
<li><p>用一个 DataFrame 合并聚合的输出结果</p></li>
<li><p>选择行与列</p></li>
<li><p>重塑多重索引 Series</p></li>
<li><p>创建透视表</p></li>
<li><p>把连续型数据转换为类别型数据</p></li>
<li><p>改变显示选项</p></li>
<li><p>设置 DataFrame 样式</p></li>
<li><p>彩蛋：预览 DataFrame</p></li>
</ol>
<p><strong>文末有 Jupyter Notebook 下载</strong>，正文先上图。</p>
<div class="section" id="id1">
<h2><span class="section-number">3.1. </span>使用的数据集<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h2>
<p>原文的数据集是 bit.ly 短网址的，我这里在读取时出问题，不稳定，就帮大家下载下来，统一放到了 <strong>data</strong> 目录里。</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">drinks</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/drinks.csv&#39;</span><span class="p">)</span>
<span class="n">movies</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/imdb_1000.csv&#39;</span><span class="p">)</span>
<span class="n">orders</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/chipotle.tsv&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">orders</span><span class="p">[</span><span class="s1">&#39;item_price&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">orders</span><span class="o">.</span><span class="n">item_price</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;$&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
<span class="n">stocks</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/stocks.csv&#39;</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">])</span>
<span class="n">titanic</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/titanic_train.csv&#39;</span><span class="p">)</span>
<span class="n">ufo</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/ufo.csv&#39;</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>本文中采用让数据集主要为常见的酒水饮料、IMDB 电影、泰坦尼克号、飞碟目击等数据集。</p>
<p>这里需要注意的是：</p>
<p>1） <code class="docutils literal notranslate"><span class="pre">pd.read_csv('data/chipotle.tsv',</span> <span class="pre">sep='\t')</span></code> 里的 chipotle.tsv，是用 <strong>tab</strong> 作为分隔符的，所以要增加参数 <code class="docutils literal notranslate"><span class="pre">sep=\t</span></code>；
2） <code class="docutils literal notranslate"><span class="pre">orders.item_price.str.replace('$',</span> <span class="pre">'').astype('float')</span></code>，<strong>item_price</strong> 列是带 <strong>$</strong> 的文本，要用 <code class="docutils literal notranslate"><span class="pre">.str.replace('$',</span> <span class="pre">'').astype('float')</span></code> 去掉 <strong>$</strong>，再把该列数据类型改为 <code class="docutils literal notranslate"><span class="pre">float</span></code>；
3）<code class="docutils literal notranslate"><span class="pre">ufo.csv</span></code>里的 <strong>Time</strong> 列，要用 <code class="docutils literal notranslate"><span class="pre">parse_dates=['Time'])</span></code>，解析日期。</p>
</div>
<div class="section" id="pandas">
<h2><span class="section-number">3.2. </span>查看 pandas 及其支持项的版本<a class="headerlink" href="#pandas" title="永久链接至标题">¶</a></h2>
<p>使用 <code class="docutils literal notranslate"><span class="pre">pd.__version__</span></code> 查看 pandas 的版本。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-c7aa827d938b1ff7.png" src="https://upload-images.jianshu.io/upload_images/3240514-c7aa827d938b1ff7.png" /></p>
<p>查看所有 pandas 的支持项版本，使用 <code class="docutils literal notranslate"><span class="pre">show_versions</span></code> 函数。比如，查看 Python、pandas、Numpy、matplotlib 等支持项的版本。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-0ccf966df346093d.png" src="https://upload-images.jianshu.io/upload_images/3240514-0ccf966df346093d.png" /></p>
</div>
<div class="section" id="dataframe">
<h2><span class="section-number">3.3. </span>创建 DataFrame<a class="headerlink" href="#dataframe" title="永久链接至标题">¶</a></h2>
<p>创建 DataFrame 的方式有很多，比如，可以把字典传递给 DataFrame 构建器，字典的 Key 是列名，字典的 Value 为列表，是 DataFrame 的列的值。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-e4851f53a9f96e7c.png" src="https://upload-images.jianshu.io/upload_images/3240514-e4851f53a9f96e7c.png" /></p>
<p>如果 DataFrame 的数据较多，用字典的方式就不合适了，需要输入的东西太多。这时，可以用 Numpy 的 <code class="docutils literal notranslate"><span class="pre">random.rand()</span></code> 函数，设定行数与列数，然后把值传递给 DataFrame 构建器。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-2e4bcf49bae3e593.png" src="https://upload-images.jianshu.io/upload_images/3240514-2e4bcf49bae3e593.png" /></p>
<p>这样就可以生成 DataFrame 了，但如果要用非数字形式的列名，需要强制把字符串转换为列表， 再把这个列表传给 <code class="docutils literal notranslate"><span class="pre">columns</span></code> 参数。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-eb8a9242d111a335.png" src="https://upload-images.jianshu.io/upload_images/3240514-eb8a9242d111a335.png" /></p>
<p>这里要注意的是，字符串里的字符数量必须与 DataFrame 的列数一致。</p>
</div>
<div class="section" id="id2">
<h2><span class="section-number">3.4. </span>重命名列<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h2>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-68b189611799a36a.png" src="https://upload-images.jianshu.io/upload_images/3240514-68b189611799a36a.png" /></p>
<p>用点（<code class="docutils literal notranslate"><span class="pre">.</span></code>）选择 pandas 里的列写起来比较容易，但列名里有空格，就没法这样操作了。</p>
<p><code class="docutils literal notranslate"><span class="pre">rename()</span></code>方法改列名是最灵活的方式，它的参数是<strong>字典</strong>，字典的 Key 是<strong>原列名</strong>，值是<strong>新列名</strong>，还可以指定轴向（axis）。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-ef27d24ec8a2f26a.png" src="https://upload-images.jianshu.io/upload_images/3240514-ef27d24ec8a2f26a.png" /></p>
<p>这种方式的优点是可以重命名任意数量的列，一列、多列、所有列都可以。</p>
<p>还有一种简单的方式可以一次性重命名所有列，即，直接为列的属性赋值。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-5bc29d557a952b4f.png" src="https://upload-images.jianshu.io/upload_images/3240514-5bc29d557a952b4f.png" /></p>
<p>只想替换列名里的空格，还有更简单的操作，直接用 <code class="docutils literal notranslate"><span class="pre">str.replace</span></code> 方法，不必把所有的列名都敲一遍。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-7f727721f50b83e2.png" src="https://upload-images.jianshu.io/upload_images/3240514-7f727721f50b83e2.png" /></p>
<p>以上这三种方式都可以更改列名。</p>
<p>用 <code class="docutils literal notranslate"><span class="pre">add_prefix</span></code> 与 <code class="docutils literal notranslate"><span class="pre">add_suffix</span></code> 函数可以为所有列名添加<strong>前缀</strong>或<strong>后缀</strong>。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-f0300b0c04aebc77.png" src="https://upload-images.jianshu.io/upload_images/3240514-f0300b0c04aebc77.png" /></p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-a962d3f6a021fde5.png" src="https://upload-images.jianshu.io/upload_images/3240514-a962d3f6a021fde5.png" /></p>
</div>
<div class="section" id="id3">
<h2><span class="section-number">3.5. </span>反转列序<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h2>
<p>反转 <code class="docutils literal notranslate"><span class="pre">drinks</span></code> 表的顺序。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-50c4208dbd32f9f7.png" src="https://upload-images.jianshu.io/upload_images/3240514-50c4208dbd32f9f7.png" /></p>
<p>这个数据集按国家列出了酒水平均消耗量，如果想反转列序该怎么办？</p>
<p>最直接的方式是把 <code class="docutils literal notranslate"><span class="pre">::-1</span></code> 传递给 <code class="docutils literal notranslate"><span class="pre">loc</span></code> 访问器，与 Python 里反转列表的切片法一样。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-805a0a371b550e52.png" src="https://upload-images.jianshu.io/upload_images/3240514-805a0a371b550e52.png" /></p>
<p>如果想让索引从 0 到 1，用 <code class="docutils literal notranslate"><span class="pre">reset_index()</span></code>方法，并用 <code class="docutils literal notranslate"><span class="pre">drop</span></code> 关键字去掉原有索引。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-07bad1d76b3b4d4c.png" src="https://upload-images.jianshu.io/upload_images/3240514-07bad1d76b3b4d4c.png" /></p>
<p>这样，行序就已经反转过来了，索引也重置为默认索引。</p>
</div>
<div class="section" id="id4">
<h2><span class="section-number">3.6. </span>反转列序<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h2>
<p>与反转行序类似，还可以用 <code class="docutils literal notranslate"><span class="pre">loc</span></code> 从左到右反转列序。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-05a59276595d6e24.png" src="https://upload-images.jianshu.io/upload_images/3240514-05a59276595d6e24.png" /></p>
<p>逗号前面的分号表示选择<strong>所有行</strong>，逗号后面的 <code class="docutils literal notranslate"><span class="pre">::-1</span></code> 表示<strong>反转列</strong>，这样一来，country 列就跑到最右边去了。</p>
</div>
<div class="section" id="id5">
<h2><span class="section-number">3.7. </span>按数据类型选择列<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h2>
<p>首先，查看一下 <strong>drinks</strong> 的数据类型：</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-f850c7b9d526addd.png" src="https://upload-images.jianshu.io/upload_images/3240514-f850c7b9d526addd.png" /></p>
<p>选择所有<strong>数值型</strong>的列，用 <code class="docutils literal notranslate"><span class="pre">selec_dtypes()</span></code> 方法。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-4b04fa02df0b3708.png" src="https://upload-images.jianshu.io/upload_images/3240514-4b04fa02df0b3708.png" /></p>
<p>同样的方法，还可以选择所有字符型的列。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-7c8438563ffe3eb6.png" src="https://upload-images.jianshu.io/upload_images/3240514-7c8438563ffe3eb6.png" /></p>
<p>同理，还可以用 <code class="docutils literal notranslate"><span class="pre">datetime</span></code> 选择日期型的列。</p>
<p>传递列表即可选择多种类型的列。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-b5efb8833da6b364.png" src="https://upload-images.jianshu.io/upload_images/3240514-b5efb8833da6b364.png" /></p>
<p>还可以使用 <code class="docutils literal notranslate"><span class="pre">exclude</span></code> 关键字排除指定的数据类型。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-7aac62a17a77dc68.png" src="https://upload-images.jianshu.io/upload_images/3240514-7aac62a17a77dc68.png" /></p>
</div>
<div class="section" id="id6">
<h2><span class="section-number">3.8. </span>把字符串转换为数值<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h2>
<p>再创建一个新的 DataFrame 示例。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-fc8d04a2da962936.png" src="https://upload-images.jianshu.io/upload_images/3240514-fc8d04a2da962936.png" /></p>
<p>这个 DataFrame 里的数字其实是以字符串形式保存的，因此，列类型是 <code class="docutils literal notranslate"><span class="pre">object</span></code>。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-651b487a5b9b8ac8.png" src="https://upload-images.jianshu.io/upload_images/3240514-651b487a5b9b8ac8.png" /></p>
<p>要想执行数学计算，要先把这些列的数据类型转换为数值型，下面的代码用 <code class="docutils literal notranslate"><span class="pre">astype()</span></code> 方法把前两列的数据类型转化为 <code class="docutils literal notranslate"><span class="pre">float</span></code>。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-463d4859695b3ce9.png" src="https://upload-images.jianshu.io/upload_images/3240514-463d4859695b3ce9.png" /></p>
<p>用这种方式转换第三列会出错，因为这列里包含一个代表 0 的下划线，pandas 无法自动判断这个下划线。</p>
<p>为了解决这个问题，可以使用 <code class="docutils literal notranslate"><span class="pre">to_numeric()</span></code> 函数来处理第三列，让 pandas 把任意无效输入转为 <code class="docutils literal notranslate"><span class="pre">NaN</span></code>。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-f31b8f2af4f7d975.png" src="https://upload-images.jianshu.io/upload_images/3240514-f31b8f2af4f7d975.png" /></p>
<p><code class="docutils literal notranslate"><span class="pre">NaN</span></code> 代表的是 0，可以用 <code class="docutils literal notranslate"><span class="pre">fillna()</span></code> 方法填充。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-2d3e51c034414b06.png" src="https://upload-images.jianshu.io/upload_images/3240514-2d3e51c034414b06.png" /></p>
<p>一行代码就可以解决这个问题，现在所有列的值都转成 <code class="docutils literal notranslate"><span class="pre">float</span></code> 了。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-108da1d9cdd3335b.png" src="https://upload-images.jianshu.io/upload_images/3240514-108da1d9cdd3335b.png" /></p>
</div>
<div class="section" id="id7">
<h2><span class="section-number">3.9. </span>优化 DataFrame 对内存的占用<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h2>
<p>pandas 的 DataFrame 设计的目标是把数据存到内存里，有时要缩减 DataFrame 的大小，减少对内存的占用。</p>
<p>下面显示了 <strong>drinks</strong> 占用的内存。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-a6b5290d467c067f.png" src="https://upload-images.jianshu.io/upload_images/3240514-a6b5290d467c067f.png" /></p>
<p>这里显示 <strong>drinks</strong> 使用了 30.5 KB 内存。</p>
<p>大型 DataFrame 会影响计算性能，甚至导致 DataFrame 读入内存失败，下面介绍简单几步，即可在读取 DataFrame 时减少内存占用。</p>
<p>第一步是只读取切实所需的列，这里需要指定 <code class="docutils literal notranslate"><span class="pre">usecols</span></code> 参数。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-de7536a2aa6ebcaf.png" src="https://upload-images.jianshu.io/upload_images/3240514-de7536a2aa6ebcaf.png" /></p>
<p>只选择两列以后，DataFrame 对内存的占用减少到 13.7 KB。</p>
<p>第二步是把包含类别型数据的 object 列转换为 Category 数据类型，通过指定 <code class="docutils literal notranslate"><span class="pre">dtype</span></code> 参数实现。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-f2985bbcc0dac727.png" src="https://upload-images.jianshu.io/upload_images/3240514-f2985bbcc0dac727.png" /></p>
<p>把 continent 列改为 category 数据类型后，DataFrame 对内存的占用进一步缩减到 2.4 KB。</p>
<p>注意：类别数量相对于行数较少时，category 数据类型对对内存占用的减少会比较有限。</p>
</div>
<div class="section" id="id8">
<h2><span class="section-number">3.10. </span>用多个文件建立 DataFrame ~ 按行<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h2>
<p>本段介绍怎样把分散于多个文件的数据集读取为一个 DataFrame。</p>
<p>比如，有多个 <strong>stock</strong> 文件，每个 CSV 文件里只存储一天的数据。</p>
<p>下面是三天的股票数据：</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-ea2ac35084da18f0.png" src="https://upload-images.jianshu.io/upload_images/3240514-ea2ac35084da18f0.png" /></p>
<p>把每个 CSV 文件读取成 DataFrame，合并后，再删除导入的原始 DataFrame，但这种方式占用内存太多，而且要写很多代码。</p>
<p>使用 Python 内置的 <code class="docutils literal notranslate"><span class="pre">glob</span></code> 更方便。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-f790c902e88bc81e.png" src="https://upload-images.jianshu.io/upload_images/3240514-f790c902e88bc81e.png" /></p>
<p>把文件名规则传递给 <code class="docutils literal notranslate"><span class="pre">glob()</span></code>，这里包括<strong>通配符</strong>，即可返回包含所有合规文件名的列表。</p>
<p>本例里，<code class="docutils literal notranslate"><span class="pre">glob</span></code> 会查找 <strong>data</strong> 子目录里所有以 <strong>stocks</strong> 开头的 CSV 文件。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-a6d4355459764346.png" src="https://upload-images.jianshu.io/upload_images/3240514-a6d4355459764346.png" /></p>
<p><code class="docutils literal notranslate"><span class="pre">glob</span></code> 返回的是无序文件名，要用 Python 内置的 <code class="docutils literal notranslate"><span class="pre">sorted()</span></code> 函数排序列表。</p>
<p>调用 <code class="docutils literal notranslate"><span class="pre">read_csv()</span></code> 函数读取生成器表达式里的每个文件，把读取结果传递给 <code class="docutils literal notranslate"><span class="pre">concat()</span></code> 函数，然后合并为一个 DataFrame。</p>
<p>注：原文里用的是 <code class="docutils literal notranslate"><span class="pre">stock_files</span> <span class="pre">=</span> <span class="pre">sorted(glob('data/stocks*.csv'))</span></code>，译文里没用 <code class="docutils literal notranslate"><span class="pre">stocks*</span></code>，用的是 <code class="docutils literal notranslate"><span class="pre">stocks?</span></code>，这是因为 <strong>data</strong> 目录里还有一个叫 <strong>stocks.csv</strong> 的文件，如果用 *，会读取出 4 个文件，而不是原文中的 3 个文件。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-cf460be8da2cafc3.png" src="https://upload-images.jianshu.io/upload_images/3240514-cf460be8da2cafc3.png" /></p>
<p>生成的 DataFrame 索引有重复值，见 “0、1、2”。为避免这种情况，要在 <code class="docutils literal notranslate"><span class="pre">concat()</span></code> 函数里用忽略旧索引、重置新索引的参数，<code class="docutils literal notranslate"><span class="pre">ignore_index</span> <span class="pre">=</span> <span class="pre">True</span></code>。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-7ae69422a7fb20b8.png" src="https://upload-images.jianshu.io/upload_images/3240514-7ae69422a7fb20b8.png" /></p>
</div>
<div class="section" id="id9">
<h2><span class="section-number">3.11. </span>用多个文件建立 DataFrame ~ 按列<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h2>
<p>上个技巧按行合并数据集，但是如果多个文件包含不同的列，该怎么办？</p>
<p>本例将 <strong>drinks</strong> 数据集分为了两个 CSV 文件，每个文件都包含 3 列。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-46d95f424d32ef84.png" src="https://upload-images.jianshu.io/upload_images/3240514-46d95f424d32ef84.png" /></p>
<p>与上例一样，还是使用 <code class="docutils literal notranslate"><span class="pre">glob()</span></code>。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-eb71f1dbeb151823.png" src="https://upload-images.jianshu.io/upload_images/3240514-eb71f1dbeb151823.png" /></p>
<p>这里要让 <code class="docutils literal notranslate"><span class="pre">concat()</span></code> 函数按列合并，<code class="docutils literal notranslate"><span class="pre">axis='columns</span></code>。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-aa1dc1b141e6e17e.png" src="https://upload-images.jianshu.io/upload_images/3240514-aa1dc1b141e6e17e.png" /></p>
<p>现在 <strong>drinks</strong> 有 6 列啦！</p>
</div>
<div class="section" id="id10">
<h2><span class="section-number">3.12. </span>从剪贴板创建 DataFrame<a class="headerlink" href="#id10" title="永久链接至标题">¶</a></h2>
<p>想快速把 Excel 或别的表格软件里存储的数据读取为 DataFrame，用 <code class="docutils literal notranslate"><span class="pre">read_clipboard()</span></code> 函数。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-362e1c05cd7ae09b.png" src="https://upload-images.jianshu.io/upload_images/3240514-362e1c05cd7ae09b.png" /></p>
<p>打开要复制的 Excel 文件，选取内容，复制。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-5ef62f76e5caccea.png" src="https://upload-images.jianshu.io/upload_images/3240514-5ef62f76e5caccea.png" /></p>
<p>与 <code class="docutils literal notranslate"><span class="pre">read_csv()</span></code> 函数类似，<code class="docutils literal notranslate"><span class="pre">read_clipboard()</span></code> 会自动检测列名与每列的数据类型。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-91f63833188fba31.png" src="https://upload-images.jianshu.io/upload_images/3240514-91f63833188fba31.png" /></p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-31edc5ec7cb3be67.png" src="https://upload-images.jianshu.io/upload_images/3240514-31edc5ec7cb3be67.png" /></p>
<p>真不错！ pandas 自动把第一列当设置成索引了。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-74c1265ff818cd68.png" src="https://upload-images.jianshu.io/upload_images/3240514-74c1265ff818cd68.png" /></p>
<p>注意：因为不能复用、重现，不推荐在正式代码里使用 <code class="docutils literal notranslate"><span class="pre">read_clipboard()</span></code> 函数。</p>
</div>
<div class="section" id="id11">
<h2><span class="section-number">3.13. </span>把 DataFrame 分割为两个随机子集<a class="headerlink" href="#id11" title="永久链接至标题">¶</a></h2>
<p>把 DataFrame 分为两个随机子集，一个占 75% 的数据量，另一个是剩下的 25%。</p>
<p>以 <strong>Movies</strong> 为例，该数据有 979 条记录。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-16887376d8e71193.png" src="https://upload-images.jianshu.io/upload_images/3240514-16887376d8e71193.png" /></p>
<p>使用 <code class="docutils literal notranslate"><span class="pre">sample()</span></code>方法随机选择 75% 的记录，并将之赋值给 <strong>moives_1</strong>。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-b0a5b6d0bccf9abc.png" src="https://upload-images.jianshu.io/upload_images/3240514-b0a5b6d0bccf9abc.png" /></p>
<p>使用 <code class="docutils literal notranslate"><span class="pre">drop()</span></code> 方法删掉 <strong>movies</strong> 里所有 <strong>movies_1</strong>，并将之赋值给 <strong>movies_2</strong>。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-cba2cc542fdee1c3.png" src="https://upload-images.jianshu.io/upload_images/3240514-cba2cc542fdee1c3.png" /></p>
<p>两个 DataFrame 的行数之和与 <strong>movies</strong> 一致。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-14c39b94c308f388.png" src="https://upload-images.jianshu.io/upload_images/3240514-14c39b94c308f388.png" /></p>
<p><strong>movies_1</strong> 与 <strong>movies_2</strong> 里的每个索引值都来自于 <strong>movies</strong>，而且互不重复。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-11951d4ca3c8d42d.png" src="https://upload-images.jianshu.io/upload_images/3240514-11951d4ca3c8d42d.png" /></p>
<p>注意：如果索引值有重复、不唯一，这种方式会失效。</p>
</div>
<div class="section" id="id12">
<h2><span class="section-number">3.14. </span>根据多个类别筛选 DataFrame<a class="headerlink" href="#id12" title="永久链接至标题">¶</a></h2>
<p>预览 <strong>movies</strong>。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-41c3457d6cf1d2d9.png" src="https://upload-images.jianshu.io/upload_images/3240514-41c3457d6cf1d2d9.png" /></p>
<p>查看 genre（电影类型）列。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-e50bae1f4b66a411.png" src="https://upload-images.jianshu.io/upload_images/3240514-e50bae1f4b66a411.png" /></p>
<p>要是想筛选 Action（动作片）、Drama（剧情片）、Western（西部片），可以用 <code class="docutils literal notranslate"><span class="pre">or</span></code> 的操作符实现多条件筛选。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-d9b753dbc44aa8b5.png" src="https://upload-images.jianshu.io/upload_images/3240514-d9b753dbc44aa8b5.png" /></p>
<p>不过，用 <code class="docutils literal notranslate"><span class="pre">isin()</span></code> 方法筛选会更清晰，只要传递电影类型的列表就可以了。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-74bbf8fdcbb59cfa.png" src="https://upload-images.jianshu.io/upload_images/3240514-74bbf8fdcbb59cfa.png" /></p>
<p>如果想反选，可在条件前添加一个波浪符（tilde ~）。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-b9f1ecb597a5102a.png" src="https://upload-images.jianshu.io/upload_images/3240514-b9f1ecb597a5102a.png" /></p>
</div>
<div class="section" id="id13">
<h2><span class="section-number">3.15. </span>根据最大的类别筛选 DataFrame<a class="headerlink" href="#id13" title="永久链接至标题">¶</a></h2>
<p>筛选电影类别里（genre）数量最多的三类电影。</p>
<p>先用 <code class="docutils literal notranslate"><span class="pre">value_counts()</span></code> 统计各类电影的数量，把统计结果赋值给 <code class="docutils literal notranslate"><span class="pre">counts</span></code>，这个结果是 <strong>Series</strong>。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-5b522c2cc85b9d31.png" src="https://upload-images.jianshu.io/upload_images/3240514-5b522c2cc85b9d31.png" /></p>
<p>使用 <strong>Series</strong> 的 <code class="docutils literal notranslate"><span class="pre">nlargest</span></code> 方法，可以轻松选出 <strong>Series</strong> 里最大的三个值。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-5c9eb30fbeb2b2e2.png" src="https://upload-images.jianshu.io/upload_images/3240514-5c9eb30fbeb2b2e2.png" /></p>
<p>这里所需的只是这个 Series 的 index。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-5c4a495661595a9b.png" src="https://upload-images.jianshu.io/upload_images/3240514-5c4a495661595a9b.png" /></p>
<p>把这个 index 传递给 <code class="docutils literal notranslate"><span class="pre">isin()</span></code>。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-f5673d3da4d85ef6.png" src="https://upload-images.jianshu.io/upload_images/3240514-f5673d3da4d85ef6.png" /></p>
<p>最终，这个 DataFrame 里就只剩下了剧情片、喜剧片与动作片。</p>
</div>
<div class="section" id="id14">
<h2><span class="section-number">3.16. </span>处理缺失值<a class="headerlink" href="#id14" title="永久链接至标题">¶</a></h2>
<p>本例使用目击 <strong>UFO</strong> 数据集。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-ea9e3c0bf118d211.png" src="https://upload-images.jianshu.io/upload_images/3240514-ea9e3c0bf118d211.png" /></p>
<p>可以看到，这个数据集里有缺失值。</p>
<p>要查看每列有多少缺失值，可以使用 <code class="docutils literal notranslate"><span class="pre">isna()</span></code> 方法，然后使用 <code class="docutils literal notranslate"><span class="pre">sum()</span></code>函数。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-e2cfc263d27f0165.png" src="https://upload-images.jianshu.io/upload_images/3240514-e2cfc263d27f0165.png" /></p>
<p><code class="docutils literal notranslate"><span class="pre">isna()</span></code> 生成一个由 <code class="docutils literal notranslate"><span class="pre">True</span></code> 与 <code class="docutils literal notranslate"><span class="pre">False</span></code> 构成的 DataFrame，<code class="docutils literal notranslate"><span class="pre">sum()</span></code> 把 <code class="docutils literal notranslate"><span class="pre">True</span></code> 转换为 1， 把 <code class="docutils literal notranslate"><span class="pre">False</span> </code> 转换为 0。</p>
<p>还可以用 <code class="docutils literal notranslate"><span class="pre">mean()</span></code> 函数，计算<strong>缺失值</strong>占比。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-16f040a1a85e0eec.png" src="https://upload-images.jianshu.io/upload_images/3240514-16f040a1a85e0eec.png" /></p>
<p>用 <code class="docutils literal notranslate"><span class="pre">dropna()</span></code> 删除列里的所有缺失值。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-ae25d5fd29424d84.png" src="https://upload-images.jianshu.io/upload_images/3240514-ae25d5fd29424d84.png" /></p>
<p>只想删除列中缺失值高于 10% 的缺失值，可以设置 <code class="docutils literal notranslate"><span class="pre">dropna()</span></code> 里的阈值，即 <code class="docutils literal notranslate"><span class="pre">threshold</span></code>.</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-a17af58b089b8945.png" src="https://upload-images.jianshu.io/upload_images/3240514-a17af58b089b8945.png" /></p>
</div>
<div class="section" id="id15">
<h2><span class="section-number">3.17. </span>把字符串分割为多列<a class="headerlink" href="#id15" title="永久链接至标题">¶</a></h2>
<p>创建一个 DataFrame 示例。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-7ffb0b882c6e6078.png" src="https://upload-images.jianshu.io/upload_images/3240514-7ffb0b882c6e6078.png" /></p>
<p>把姓名列分为姓与名两列，用 <code class="docutils literal notranslate"><span class="pre">str.split()</span></code> 方法，按空格分割，并用 <code class="docutils literal notranslate"><span class="pre">expand</span></code> 关键字，生成一个新的 DataFrame。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-bca3c935a589482c.png" src="https://upload-images.jianshu.io/upload_images/3240514-bca3c935a589482c.png" /></p>
<p>通过赋值语句，把这两列添加到原 DataFrame。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-2a8160fab8b15d22.png" src="https://upload-images.jianshu.io/upload_images/3240514-2a8160fab8b15d22.png" /></p>
<p>如果想分割字符串，但只想保留分割结果的一列，该怎么操作？</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-a49771b010329777.png" src="https://upload-images.jianshu.io/upload_images/3240514-a49771b010329777.png" /></p>
<p>要是只想保留<strong>城市</strong>列，可以选择只把<strong>城市</strong>加到 DataFrame 里。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-413b47fcc61a4204.png" src="https://upload-images.jianshu.io/upload_images/3240514-413b47fcc61a4204.png" /></p>
</div>
<div class="section" id="series-dataframe">
<h2><span class="section-number">3.18. </span>把 Series 里的列表转换为 DataFrame<a class="headerlink" href="#series-dataframe" title="永久链接至标题">¶</a></h2>
<p>创建一个 DataFrame 示例。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-8771692423664dba.png" src="https://upload-images.jianshu.io/upload_images/3240514-8771692423664dba.png" /></p>
<p>这里包含了两列，第二列包含的是 Python 整数列表。</p>
<p>要把第二列转为 DataFrame，在第二列上使用 <code class="docutils literal notranslate"><span class="pre">apply()</span></code> 方法，并把结果传递给 Series 构建器。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-a261365a08884c7f.png" src="https://upload-images.jianshu.io/upload_images/3240514-a261365a08884c7f.png" /></p>
<p>用 <code class="docutils literal notranslate"><span class="pre">concat()</span></code> 函数，把原 DataFrame 与新 DataFrame 组合在一起。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-5075122b81744050.png" src="https://upload-images.jianshu.io/upload_images/3240514-5075122b81744050.png" /></p>
</div>
<div class="section" id="id16">
<h2><span class="section-number">3.19. </span>用多个函数聚合<a class="headerlink" href="#id16" title="永久链接至标题">¶</a></h2>
<p>先看一下 <strong>Chipotle</strong> 连锁餐馆的 DataFrame。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-ef5e77008f72ad80.png" src="https://upload-images.jianshu.io/upload_images/3240514-ef5e77008f72ad80.png" /></p>
<p>每个订单都有订单号（order_id），每个订单有多行。要统计每个订单的金额，需要先根据每个 order_id 汇总每个订单里各个产品（item_price）的金额。下面的例子列出了订单号为 1 的总价。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-6ca7c9d1be909ef0.png" src="https://upload-images.jianshu.io/upload_images/3240514-6ca7c9d1be909ef0.png" /></p>
<p>计算每单的总价，要按 <code class="docutils literal notranslate"><span class="pre">order_id</span></code> 进行 <code class="docutils literal notranslate"><span class="pre">groupby()</span></code> 分组，再按 <code class="docutils literal notranslate"><span class="pre">item_price</span></code> 计算每组的总价。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-57507a36b331fc73.png" src="https://upload-images.jianshu.io/upload_images/3240514-57507a36b331fc73.png" /></p>
<p>有时，要用多个聚合函数，不一定只是 <code class="docutils literal notranslate"><span class="pre">sum()</span></code> 一个函数。这时，要用 <code class="docutils literal notranslate"><span class="pre">agg()</span></code> 方法，把多个聚合函数的列表作为该方法的参数。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-ca0c72bb4dd9a73b.png" src="https://upload-images.jianshu.io/upload_images/3240514-ca0c72bb4dd9a73b.png" /></p>
<p>上列就算出了每个订单的总价与订单里的产品数量。</p>
</div>
<div class="section" id="id17">
<h2><span class="section-number">3.20. </span>用一个 DataFrame 合并聚合的输出结果<a class="headerlink" href="#id17" title="永久链接至标题">¶</a></h2>
<p>本例用的还是 <strong>orders</strong>。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-5877e47211c5aaa7.png" src="https://upload-images.jianshu.io/upload_images/3240514-5877e47211c5aaa7.png" /></p>
<p>如果想新增一列，为每行列出订单的总价，要怎么操作？上面介绍过用 <code class="docutils literal notranslate"><span class="pre">sum()</span></code> 计算总价。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-cb787017e7cad469.png" src="https://upload-images.jianshu.io/upload_images/3240514-cb787017e7cad469.png" /></p>
<p><code class="docutils literal notranslate"><span class="pre">sum()</span></code> 是聚合函数，该函数返回结果的行数（1834行）比原始数据的行数（4622行）少。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-84fb6a8919690e52.png" src="https://upload-images.jianshu.io/upload_images/3240514-84fb6a8919690e52.png" /></p>
<p>要解决这个问题得用 <code class="docutils literal notranslate"><span class="pre">transform()</span></code> 方法，这个方法执行同样的计算，但返回与原始数据行数一样的输出结果，本例中为 4622 行。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-9c2fcdb3fccc9580.png" src="https://upload-images.jianshu.io/upload_images/3240514-9c2fcdb3fccc9580.png" /></p>
<p>接下来，为 DataFrame 新增一列，<code class="docutils literal notranslate"><span class="pre">total_price</span></code>。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-8eff8097c2c19098.png" src="https://upload-images.jianshu.io/upload_images/3240514-8eff8097c2c19098.png" /></p>
<p>如上所示，每一行都列出了对应的订单总价。</p>
<p>这样一来，计算每行产品占订单总价的百分比就易如反掌了。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-1910a61444b3683c.png" src="https://upload-images.jianshu.io/upload_images/3240514-1910a61444b3683c.png" /></p>
</div>
<div class="section" id="id18">
<h2><span class="section-number">3.21. </span>选择行与列<a class="headerlink" href="#id18" title="永久链接至标题">¶</a></h2>
<p>本例使用大家都看腻了的<strong>泰坦尼克</strong>数据集。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-14540ea6ed4e7651.png" src="https://upload-images.jianshu.io/upload_images/3240514-14540ea6ed4e7651.png" /></p>
<p>这个数据集包括了泰坦尼克乘客的基本信息以及是否逃生的数据。</p>
<p>用 <code class="docutils literal notranslate"><span class="pre">describe()</span></code> 方法，可以得到该数据集的基本统计数据。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-eabf1dda0ae24d8c.png" src="https://upload-images.jianshu.io/upload_images/3240514-eabf1dda0ae24d8c.png" /></p>
<p>这个结果集显示的数据很多，但不一定都是你需要的，可能只需要其中几行。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-185460bc277f93b8.png" src="https://upload-images.jianshu.io/upload_images/3240514-185460bc277f93b8.png" /></p>
<p>还可以只选择部分列。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-ae0a04c310b20bf0.png" src="https://upload-images.jianshu.io/upload_images/3240514-ae0a04c310b20bf0.png" /></p>
</div>
<div class="section" id="series">
<h2><span class="section-number">3.22. </span>重塑多重索引 Series<a class="headerlink" href="#series" title="永久链接至标题">¶</a></h2>
<p>泰坦尼克数据集里有一列标注了**幸存（Survived）**状态，值用 0、1 代表。计算该列的平均值可以计算整体幸存率。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-cfa7d7590c5da08f.png" src="https://upload-images.jianshu.io/upload_images/3240514-cfa7d7590c5da08f.png" /></p>
<p>按**性别（Sex）**统计男女的幸存率，需要使用 <code class="docutils literal notranslate"><span class="pre">groupby()</span></code>。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-91f48c877a345b94.png" src="https://upload-images.jianshu.io/upload_images/3240514-91f48c877a345b94.png" /></p>
<p>要按<strong>性别</strong>与**舱型（Pclass）**统计幸存率，就要按性别与舱型进行 <code class="docutils literal notranslate"><span class="pre">groupby()</span></code>。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-a99db8111f215843.png" src="https://upload-images.jianshu.io/upload_images/3240514-a99db8111f215843.png" /></p>
<p>上面显示了不同性别，不同舱型的幸存率，输出结果是一个多重索引的序列（Series），这种形式与实际数据相比多了多重索引。</p>
<p>这种表现形式不利于阅读，也不方便实现数据交互，用 <code class="docutils literal notranslate"><span class="pre">unstack()</span></code> 把多重索引转换为 DataFrame 更方便。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-b61b594fbc28366b.png" src="https://upload-images.jianshu.io/upload_images/3240514-b61b594fbc28366b.png" /></p>
<p>这个 DataFrame 包含的数据与多重索引序列一模一样，只是可以用大家更熟悉的 DataFrame 方法进行操控。</p>
</div>
<div class="section" id="id19">
<h2><span class="section-number">3.23. </span>创建透视表<a class="headerlink" href="#id19" title="永久链接至标题">¶</a></h2>
<p>经常输出类似上例的 DataFrame，<code class="docutils literal notranslate"><span class="pre">pivot_table()</span></code> 方法更方便。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-4a9bd1e533508c63.png" src="https://upload-images.jianshu.io/upload_images/3240514-4a9bd1e533508c63.png" /></p>
<p>使用透视表，可以直接指定索引、数据列、值与聚合函数。</p>
<p>设置 <code class="docutils literal notranslate"><span class="pre">margins=True</span></code>，即可为透视表添加行与列的汇总。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-f9d597c474c92c09.png" src="https://upload-images.jianshu.io/upload_images/3240514-f9d597c474c92c09.png" /></p>
<p>此表显示了整体幸存率，及按性别与舱型划分的幸存率。</p>
<p>把聚合函数 <code class="docutils literal notranslate"><span class="pre">mean</span></code> 改为 <code class="docutils literal notranslate"><span class="pre">count</span></code>，就可以生成交叉表。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-85d364c642527566.png" src="https://upload-images.jianshu.io/upload_images/3240514-85d364c642527566.png" /></p>
<p>这里显示了每个类别的记录数。</p>
</div>
<div class="section" id="id20">
<h2><span class="section-number">3.24. </span>把连续型数据转换为类型数据<a class="headerlink" href="#id20" title="永久链接至标题">¶</a></h2>
<p>下面看一下泰坦尼克数据集的年龄（Age）列。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-ec09ddfe622989ce.png" src="https://upload-images.jianshu.io/upload_images/3240514-ec09ddfe622989ce.png" /></p>
<p>这一列是连续型数据，如果想把它转换为类别型数据怎么办？</p>
<p>这里可以用 <code class="docutils literal notranslate"><span class="pre">cut</span></code> 函数把年龄划分为儿童、青年、成人三个年龄段。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-855d8b893e39f176.png" src="https://upload-images.jianshu.io/upload_images/3240514-855d8b893e39f176.png" /></p>
<p>这段代码为不同分箱提供了标签，年龄在 0-18 岁的为儿童，18-25 岁的为青年，25-99 岁的为成人。</p>
<p>注意：现在数据已经是类别型了，类别型数据会自动排序。</p>
</div>
<div class="section" id="id21">
<h2><span class="section-number">3.25. </span>改变显示选项<a class="headerlink" href="#id21" title="永久链接至标题">¶</a></h2>
<p>接下来还是看泰坦尼克数据集。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-b020f0f2908ae961.png" src="https://upload-images.jianshu.io/upload_images/3240514-b020f0f2908ae961.png" /></p>
<p>年龄列有 1 位小数，票价列有 4 位小数，如何将这两列显示的小数位数标准化？</p>
<p>用以下代码让这两列只显示 2 位小数。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-79378cf197bb62cb.png" src="https://upload-images.jianshu.io/upload_images/3240514-79378cf197bb62cb.png" /></p>
<p>第一个参数是要设置的选项名称，第二个参数是 Python 的字符串格式。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-89a54eccc9597863.png" src="https://upload-images.jianshu.io/upload_images/3240514-89a54eccc9597863.png" /></p>
<p>现在年龄与票价列为 2 位小数了。</p>
<p>注意：这种操作不改变底层数据，只改变数据的显示形式。</p>
<p>还可以用以下代码重置数据显示选项。</p>
<p><code class="docutils literal notranslate"><span class="pre">pd.reset_option('display.float_format')</span></code></p>
<p>注意：使用同样的方式，还可以设置更多选项。</p>
</div>
<div class="section" id="id22">
<h2><span class="section-number">3.26. </span>设置 DataFrame 样式<a class="headerlink" href="#id22" title="永久链接至标题">¶</a></h2>
<p>上面的技巧适用于调整整个 Jupyter Notebook 的显示内容。</p>
<p>不过，要想为某个 DataFrame 设定指定的样式，pandas 还提供了更灵活的方式。</p>
<p>下面看一下 <strong>stocks</strong>。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-0ea8c7bbfb74b292.png" src="https://upload-images.jianshu.io/upload_images/3240514-0ea8c7bbfb74b292.png" /></p>
<p>创建<strong>样式字符字典</strong>，指定每列使用的格式。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-79f74803416405da.png" src="https://upload-images.jianshu.io/upload_images/3240514-79f74803416405da.png" /></p>
<p>把这个字典传递给 DataFrame 的 <code class="docutils literal notranslate"><span class="pre">style.format()</span></code> 方法。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-55da17ae308ac23c.png" src="https://upload-images.jianshu.io/upload_images/3240514-55da17ae308ac23c.png" /></p>
<p>注意：日期是<strong>月-日-年</strong>的格式，闭市价有美元符，交易量有千分号。</p>
<p>接下来用链式方法实现更多样式。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-c3029032b9310996.png" src="https://upload-images.jianshu.io/upload_images/3240514-c3029032b9310996.png" /></p>
<p>可以看到，这个表隐藏了索引，闭市价最小值用红色显示，最大值用浅绿色显示。</p>
<p>再看一下背景色渐变的样式。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-6512cfa3ff784caf.png" src="https://upload-images.jianshu.io/upload_images/3240514-6512cfa3ff784caf.png" /></p>
<p>交易量（Volume）列现在按不同深浅的蓝色显示，一眼就能看出来数据的大小。</p>
<p>下面看最后一个例子。</p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-1964b4ed644ea68c.png" src="https://upload-images.jianshu.io/upload_images/3240514-1964b4ed644ea68c.png" /></p>
<p>本例的 DataFrame 加上了标题，交易量列使用了迷你条形图。</p>
<p>注意：Pandas 还支持更多 DataFrame 样式选项，详见 pandas 官方文档。</p>
</div>
<div class="section" id="id23">
<h2><span class="section-number">3.27. </span>彩蛋：预览 DataFrame<a class="headerlink" href="#id23" title="永久链接至标题">¶</a></h2>
<p>假如刚拿到一个数据集，想快速了解该数据集，又不想费劲折腾怎么办？这里介绍一个独立的支持库，<a class="reference external" href="https://github.com/pandas-profiling/pandas-profiling">pandas_profiling</a>，可以快速预览数据集。</p>
<p>第一步，安装， <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">pandas-profiling</span></code></p>
<p>第二步，导入，<code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">pandas_profiling</span></code></p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-a7f12301b7b6b6c2.png" src="https://upload-images.jianshu.io/upload_images/3240514-a7f12301b7b6b6c2.png" /></p>
<p>本例简单介绍一下 <code class="docutils literal notranslate"><span class="pre">ProfileReport()</span></code> 函数，这个函数支持任意 DataFrame，并生成交互式 HTML 数据报告：</p>
<ul class="simple">
<li><p>第一部分是纵览数据集，还会列出数据一些可能存在的问题；</p></li>
<li><p>第二部分汇总每列数据，点击 <strong>toggle details</strong> 查看更多信息；</p></li>
<li><p>第三部分显示列之间的关联热力图；</p></li>
<li><p>第四部分显示数据集的前几条数据。</p></li>
</ul>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-f8919837733f5a28.png" src="https://upload-images.jianshu.io/upload_images/3240514-f8919837733f5a28.png" /></p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-b49319ea5b265af6.png" src="https://upload-images.jianshu.io/upload_images/3240514-b49319ea5b265af6.png" /></p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-393b722ae00c477b.png" src="https://upload-images.jianshu.io/upload_images/3240514-393b722ae00c477b.png" /></p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-92f7c8e1e8befb66.png" src="https://upload-images.jianshu.io/upload_images/3240514-92f7c8e1e8befb66.png" /></p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-d5a3eb3df97171ac.png" src="https://upload-images.jianshu.io/upload_images/3240514-d5a3eb3df97171ac.png" /></p>
<p><img alt="https://upload-images.jianshu.io/upload_images/3240514-7252ab7e26bd4979.png" src="https://upload-images.jianshu.io/upload_images/3240514-7252ab7e26bd4979.png" /></p>
<p><a class="reference external" href="https://nbviewer.jupyter.org/github/justmarkham/pandas-videos/blob/master/top_25_pandas_tricks.ipynb">英文版 Jupyter Notebook 链接</a></p>
<p><a class="reference external" href="https://github.com/jaystone776/pandas_answered/blob/master/25_Pandas_Tips_by_PyCon_Master.ipynb">中文版 Jupyter Notebook 链接</a></p>
<p><a class="reference external" href="https://github.com/jaystone776/pandas_answered/blob/master/data/25_Pandas_Tips_by_PyCon_Master_data.zip">数据集下载</a></p>
<p><a class="reference external" href="https://pan.baidu.com/s/1HDgOfG5yd_FuQag-Wsr-Bw">Kevin Markham - My top 25 pandas tricks 英文版视频: 提取码：vqup </a></p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="pandas-03.html" class="btn btn-neutral float-right" title="4. Pandas 10大新功能" accesskey="n" rel="next">下一页 <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="pandas-01.html" class="btn btn-neutral float-left" title="2. Pandas 基础用法" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> 上一页</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; 版权所有 2019–2020, AkShare developers

    </p>
  </div>
    
    
    
    利用 <a href="http://sphinx-doc.org/">Sphinx</a> 构建，使用了 
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">主题</a>
    
    由 <a href="https://readthedocs.org">Read the Docs</a>开发. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  
 
<script type="text/javascript">
!function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t){var e=document.createElement("script");e.type="text/javascript";e.async=!0;e.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)};analytics.SNIPPET_VERSION="3.1.0";
analytics.load("8UDQfnf3cyFSTsM4YANnW5sXmgZVILbA");
analytics.page();
}}();

analytics.ready(function () {
    ga('require', 'linker');
    ga('linker:autoLink', ['scrapinghub.com', 'crawlera.com']);
});
</script>


</body>
</html>